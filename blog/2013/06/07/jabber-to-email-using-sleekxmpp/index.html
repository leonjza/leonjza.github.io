<!doctype html><html lang=en>
<head>
<title>
Jabber to Email using SleekXMPP ::
#!/bin/note
— a checkbox uncheckers notepad
</title>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="So, why would you even want this..? Well, to be honest, I am not really sure of many use cases for this, however maybe someone, somewhere will need to do something like this, and I would have done my deed and saved someone some time ::sun::
Introducing SleekXMPP SleekXMPP is a python XMPP framework. It takes a bit to get your head around it, but once you have some basics covered its quite a rewarding library to work with. :) To start, you need to install 2 dependencies. Python Mailer and SleekXMPP itself. Something like pip install mailer sleekxmpp or for the older school, easy_install sleekxmpp mailer should do the trick. It can&amp;rsquo;t hurt to check if the distro you use has these are packages already too.
">
<meta name=keywords content="blog,hack,ctf,leonjza,pentester,red team,attack">
<meta name=robots content="noodp">
<link rel=canonical href=https://leonjza.github.io/blog/2013/06/07/jabber-to-email-using-sleekxmpp/>
<link rel=stylesheet href=https://leonjza.github.io/assets/style.css>
<link rel=stylesheet href=https://leonjza.github.io/style.css>
<link rel=apple-touch-icon-precomposed sizes=144x144 href=https://leonjza.github.io/img/apple-touch-icon-144-precomposed.png>
<link rel="shortcut icon" href=https://leonjza.github.io/img/favicon.png>
<link href=https://leonjza.github.io/assets/fonts/Inter-Italic.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=https://leonjza.github.io/assets/fonts/Inter-Regular.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=https://leonjza.github.io/assets/fonts/Inter-Medium.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=https://leonjza.github.io/assets/fonts/Inter-MediumItalic.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=https://leonjza.github.io/assets/fonts/Inter-Bold.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=https://leonjza.github.io/assets/fonts/Inter-BoldItalic.woff2 rel=preload type=font/woff2 as=font crossorigin>
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Jabber to Email using SleekXMPP">
<meta name=twitter:description content="So, why would you even want this..?
Well, to be honest, I am not really sure of many use cases for this, however maybe someone, somewhere will need to do something like this, and I would have done my deed and saved someone some time ::sun::
Introducing SleekXMPP
SleekXMPP is a python XMPP framework. It takes a bit to get your head around it, but once you have some basics covered its quite a rewarding library to work with. :) To start, you need to install 2 dependencies. Python Mailer and SleekXMPP itself. Something like pip install mailer sleekxmpp or for the older school, easy_install sleekxmpp mailer should do the trick. It can&rsquo;t hurt to check if the distro you use has these are packages already too.">
<meta property="og:title" content="Jabber to Email using SleekXMPP">
<meta property="og:description" content="So, why would you even want this..?
Well, to be honest, I am not really sure of many use cases for this, however maybe someone, somewhere will need to do something like this, and I would have done my deed and saved someone some time ::sun::
Introducing SleekXMPP
SleekXMPP is a python XMPP framework. It takes a bit to get your head around it, but once you have some basics covered its quite a rewarding library to work with. :) To start, you need to install 2 dependencies. Python Mailer and SleekXMPP itself. Something like pip install mailer sleekxmpp or for the older school, easy_install sleekxmpp mailer should do the trick. It can&rsquo;t hurt to check if the distro you use has these are packages already too.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://leonjza.github.io/blog/2013/06/07/jabber-to-email-using-sleekxmpp/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2013-06-07T00:00:00+00:00">
<meta property="article:modified_time" content="2013-06-07T00:00:00+00:00"><meta property="og:site_name" content="#!/bin/note
">
</head>
<body class=dark-theme>
<div class=container>
<header class=header>
<span class=header__inner>
<a href=/ class=logo style=text-decoration:none>
<span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg>
</span>
<span class=logo__text>#!/bin/note
</span>
<span class=logo__cursor></span>
</a>
<span class=header__right>
<nav class=menu>
<ul class="menu__inner menu__inner--desktop">
<li><a href=/about/>About Me</a></li>
<li><a href=/categories>Categories</a></li>
<li><a href=/posts>Posts</a></li>
</ul>
<ul class="menu__inner menu__inner--mobile">
<li><a href=/about/>About Me</a></li>
<li><a href=/categories>Categories</a></li>
<li><a href=/posts>Posts</a></li>
</ul>
</nav>
<span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
</span>
<span class=theme-toggle><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg>
</span>
</span>
</span>
</header>
<div class=content>
<div class=post>
<h1 class=post-title>Jabber to Email using SleekXMPP</h1>
<div class=post-meta>
<span class=post-date>
2013-06-07
</span>
<span class=post-read-time>— 6 min read</span>
</div>
<div class=post-content>
<h2>Table of Contents</h2>
<aside class=table-of-contents><nav id=TableOfContents>
<ul>
<li>
<ul>
<li>
<ul>
<li><a href=#so-why-would-you-even-want-this>So, why would you even want this..?</a></li>
<li><a href=#introducing-sleekxmpp>Introducing SleekXMPP</a></li>
<li><a href=#configuration-and-testing-time>Configuration and testing time</a></li>
<li><a href=#ok-code>Ok, code</a></li>
<li><a href=#so-how-do-i-actually-use-this-thing-i-just-saw>So how do I actually use this thing I just saw?</a></li>
<li><a href=#things-to-note>Things to note.</a></li>
<li><a href=#test-d>Test! :D</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav></aside>
<h3 id=so-why-would-you-even-want-this>So, why would you even want this..?</h3>
<p>Well, to be honest, I am not really sure of many use cases for this, however maybe someone, somewhere will need to do something like this, and I would have done my deed and saved someone some time ::sun::</p>
<h3 id=introducing-sleekxmpp>Introducing SleekXMPP</h3>
<p><a href=http://sleekxmpp.com/>SleekXMPP</a> is a python XMPP framework. It takes a bit to get your head around it, but once you have some basics covered its quite a rewarding library to work with. :) To start, you need to install 2 dependencies. Python Mailer and SleekXMPP itself. Something like <code>pip install mailer sleekxmpp</code> or for the older school, <code>easy_install sleekxmpp mailer</code> should do the trick. It can&rsquo;t hurt to check if the distro you use has these are packages already too.</p>
<h3 id=configuration-and-testing-time>Configuration and testing time</h3>
<p>Once the install completes, do a quick check to see if everything is ok, Try to import the modules. They should return no errors. If they do, check that the installation of the previously mentioned dependencies were successful.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>%</span> python2
Python <span style=color:#ae81ff>2.7.5</span> (default, May <span style=color:#ae81ff>12</span> <span style=color:#ae81ff>2013</span>, <span style=color:#ae81ff>12</span>:<span style=color:#ae81ff>00</span>:<span style=color:#ae81ff>47</span>)
[GCC <span style=color:#ae81ff>4.8.0</span> <span style=color:#ae81ff>20130502</span> (prerelease)] on linux2
Type <span style=color:#e6db74>&#34;help&#34;</span>, <span style=color:#e6db74>&#34;copyright&#34;</span>, <span style=color:#e6db74>&#34;credits&#34;</span> <span style=color:#f92672>or</span> <span style=color:#e6db74>&#34;license&#34;</span> <span style=color:#66d9ef>for</span> more information<span style=color:#f92672>.</span>
<span style=color:#f92672>&gt;&gt;&gt;</span> <span style=color:#f92672>import</span> sleekxmpp
<span style=color:#f92672>&gt;&gt;&gt;</span> <span style=color:#f92672>import</span> mailer
<span style=color:#f92672>&gt;&gt;&gt;</span>
</code></pre></div><p>Next, you need a <em>bot</em> account to use. Provision a user on your jabber server for the bot and test with a jabber client that it works.</p>
<h3 id=ok-code>Ok, code</h3>
<p>Next, we take the <a href=http://sleekxmpp.com/#here-s-your-first-sleekxmpp-bot>sample</a> echobot from the SleekXMPP website, and modify it slightly to handle our incoming message by sending a email, instead of simply replying back what we have sent.</p>
<p>First, we import the mailer requirements with:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>from</span> mailer <span style=color:#f92672>import</span> Mailer
<span style=color:#f92672>from</span> mailer <span style=color:#f92672>import</span> Message
</code></pre></div><p>The above can be placed right after the option parser has been imported. Then, we only need to change the <code>message</code> method within the <code>EchoBot</code> class really:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#75715e>#!/usr/bin/env python</span>

<span style=color:#75715e># Shameless SleekXMPP modification of the</span>
<span style=color:#75715e># echobot http://sleekxmpp.com/#here-s-your-first-sleekxmpp-bot</span>

<span style=color:#66d9ef>if</span> msg[<span style=color:#e6db74>&#39;type&#39;</span>] <span style=color:#f92672>in</span> (<span style=color:#e6db74>&#39;chat&#39;</span>, <span style=color:#e6db74>&#39;normal&#39;</span>):

   print <span style=color:#e6db74>&#34;Received Message:</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>%(body)s</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>%</span> msg

   <span style=color:#75715e># Mail the message Received</span>
   message <span style=color:#f92672>=</span> Message(From<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#39;Jabber Email Service&#39; &lt;someone@domain.com&gt;&#34;</span>,
         To<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#34;someone@domain.com&#34;</span>],
         Subject<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;[Jabber Message Received] From: </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>%</span> msg[<span style=color:#e6db74>&#34;from&#34;</span>])
   themessage <span style=color:#f92672>=</span> msg[<span style=color:#e6db74>&#34;body&#34;</span>]
   themessage <span style=color:#f92672>=</span> themessage<span style=color:#f92672>.</span>decode(<span style=color:#e6db74>&#39;unicode_escape&#39;</span>)<span style=color:#f92672>.</span>encode(<span style=color:#e6db74>&#39;ascii&#39;</span>,<span style=color:#e6db74>&#39;ignore&#39;</span>)
   message<span style=color:#f92672>.</span>Body <span style=color:#f92672>=</span> themessage

   sender <span style=color:#f92672>=</span> Mailer(<span style=color:#e6db74>&#34;127.0.0.1&#34;</span>)
   sender<span style=color:#f92672>.</span>send(message)
</code></pre></div><p>A complete modified example that includes the above changes:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#75715e>#!/usr/bin/env python</span>
<span style=color:#75715e># -*- coding: utf-8 -*-</span>

<span style=color:#75715e># Shameless SleekXMPP modification of the</span>
<span style=color:#75715e># echobot http://sleekxmpp.com/#here-s-your-first-sleekxmpp-bot</span>

<span style=color:#e6db74>&#34;&#34;&#34;
</span><span style=color:#e6db74>    SleekXMPP: The Sleek XMPP Library
</span><span style=color:#e6db74>    Copyright (C) 2010  Nathanael C. Fritz
</span><span style=color:#e6db74>    This file is part of SleekXMPP.
</span><span style=color:#e6db74>
</span><span style=color:#e6db74>    See the file LICENSE for copying permission.
</span><span style=color:#e6db74>&#34;&#34;&#34;</span>

<span style=color:#f92672>import</span> sys
<span style=color:#f92672>import</span> logging
<span style=color:#f92672>import</span> getpass
<span style=color:#f92672>from</span> optparse <span style=color:#f92672>import</span> OptionParser

<span style=color:#f92672>from</span> mailer <span style=color:#f92672>import</span> Mailer
<span style=color:#f92672>from</span> mailer <span style=color:#f92672>import</span> Message

<span style=color:#f92672>import</span> sleekxmpp

<span style=color:#75715e># Python versions before 3.0 do not use UTF-8 encoding</span>
<span style=color:#75715e># by default. To ensure that Unicode is handled properly</span>
<span style=color:#75715e># throughout SleekXMPP, we will set the default encoding</span>
<span style=color:#75715e># ourselves to UTF-8.</span>
<span style=color:#66d9ef>if</span> sys<span style=color:#f92672>.</span>version_info <span style=color:#f92672>&lt;</span> (<span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>0</span>):
    reload(sys)
    sys<span style=color:#f92672>.</span>setdefaultencoding(<span style=color:#e6db74>&#39;utf8&#39;</span>)
<span style=color:#66d9ef>else</span>:
    raw_input <span style=color:#f92672>=</span> input


<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>EchoBot</span>(sleekxmpp<span style=color:#f92672>.</span>ClientXMPP):

    <span style=color:#e6db74>&#34;&#34;&#34;
</span><span style=color:#e6db74>    A simple SleekXMPP bot that will echo messages it
</span><span style=color:#e6db74>    receives, along with a short thank you message.
</span><span style=color:#e6db74>    &#34;&#34;&#34;</span>

    <span style=color:#66d9ef>def</span> __init__(self, jid, password):
        sleekxmpp<span style=color:#f92672>.</span>ClientXMPP<span style=color:#f92672>.</span>__init__(self, jid, password)

        <span style=color:#75715e># The session_start event will be triggered when</span>
        <span style=color:#75715e># the bot establishes its connection with the server</span>
        <span style=color:#75715e># and the XML streams are ready for use. We want to</span>
        <span style=color:#75715e># listen for this event so that we we can initialize</span>
        <span style=color:#75715e># our roster.</span>
        self<span style=color:#f92672>.</span>add_event_handler(<span style=color:#e6db74>&#34;session_start&#34;</span>, self<span style=color:#f92672>.</span>start)

        <span style=color:#75715e># The message event is triggered whenever a message</span>
        <span style=color:#75715e># stanza is received. Be aware that that includes</span>
        <span style=color:#75715e># MUC messages and error messages.</span>
        self<span style=color:#f92672>.</span>add_event_handler(<span style=color:#e6db74>&#34;message&#34;</span>, self<span style=color:#f92672>.</span>message)

    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>start</span>(self, event):
        <span style=color:#e6db74>&#34;&#34;&#34;
</span><span style=color:#e6db74>        Process the session_start event.
</span><span style=color:#e6db74>
</span><span style=color:#e6db74>        Typical actions for the session_start event are
</span><span style=color:#e6db74>        requesting the roster and broadcasting an initial
</span><span style=color:#e6db74>        presence stanza.
</span><span style=color:#e6db74>
</span><span style=color:#e6db74>        Arguments:
</span><span style=color:#e6db74>            event -- An empty dictionary. The session_start
</span><span style=color:#e6db74>                     event does not provide any additional
</span><span style=color:#e6db74>                     data.
</span><span style=color:#e6db74>        &#34;&#34;&#34;</span>
        self<span style=color:#f92672>.</span>send_presence()
        self<span style=color:#f92672>.</span>get_roster()
        self<span style=color:#f92672>.</span>nick <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;jabberMailBot&#34;</span>

    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>message</span>(self, msg):
        <span style=color:#e6db74>&#34;&#34;&#34;
</span><span style=color:#e6db74>        Process incoming message stanzas. Be aware that this also
</span><span style=color:#e6db74>        includes MUC messages and error messages. It is usually
</span><span style=color:#e6db74>        a good idea to check the messages&#39;s type before processing
</span><span style=color:#e6db74>        or sending replies.
</span><span style=color:#e6db74>
</span><span style=color:#e6db74>        Arguments:
</span><span style=color:#e6db74>            msg -- The received message stanza. See the documentation
</span><span style=color:#e6db74>                   for stanza objects and the Message stanza to see
</span><span style=color:#e6db74>                   how it may be used.
</span><span style=color:#e6db74>        &#34;&#34;&#34;</span>
        <span style=color:#66d9ef>if</span> msg[<span style=color:#e6db74>&#39;type&#39;</span>] <span style=color:#f92672>in</span> (<span style=color:#e6db74>&#39;chat&#39;</span>, <span style=color:#e6db74>&#39;normal&#39;</span>):

            print <span style=color:#e6db74>&#34;Received Message:</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>%(body)s</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>%</span> msg

            <span style=color:#75715e># Mail the message Received</span>
            message <span style=color:#f92672>=</span> Message(From<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#39;Jabber Email Service&#39; &lt;someone@domain.com&gt;&#34;</span>,
                  To<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#34;someone@domain.com&#34;</span>],
                  Subject<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;[Jabber Message Received] From: </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>%</span> msg[<span style=color:#e6db74>&#34;from&#34;</span>])
            themessage <span style=color:#f92672>=</span> msg[<span style=color:#e6db74>&#34;body&#34;</span>]
            themessage <span style=color:#f92672>=</span> themessage<span style=color:#f92672>.</span>decode(<span style=color:#e6db74>&#39;unicode_escape&#39;</span>)<span style=color:#f92672>.</span>encode(<span style=color:#e6db74>&#39;ascii&#39;</span>,<span style=color:#e6db74>&#39;ignore&#39;</span>)
            message<span style=color:#f92672>.</span>Body <span style=color:#f92672>=</span> themessage

            sender <span style=color:#f92672>=</span> Mailer(<span style=color:#e6db74>&#34;127.0.0.1&#34;</span>)
            sender<span style=color:#f92672>.</span>send(message)

<span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
    <span style=color:#75715e># Setup the command line arguments.</span>
    optp <span style=color:#f92672>=</span> OptionParser()

    <span style=color:#75715e># Output verbosity options.</span>
    optp<span style=color:#f92672>.</span>add_option(<span style=color:#e6db74>&#39;-q&#39;</span>, <span style=color:#e6db74>&#39;--quiet&#39;</span>, help<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;set logging to ERROR&#39;</span>,
                    action<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;store_const&#39;</span>, dest<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;loglevel&#39;</span>,
                    const<span style=color:#f92672>=</span>logging<span style=color:#f92672>.</span>ERROR, default<span style=color:#f92672>=</span>logging<span style=color:#f92672>.</span>INFO)
    optp<span style=color:#f92672>.</span>add_option(<span style=color:#e6db74>&#39;-d&#39;</span>, <span style=color:#e6db74>&#39;--debug&#39;</span>, help<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;set logging to DEBUG&#39;</span>,
                    action<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;store_const&#39;</span>, dest<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;loglevel&#39;</span>,
                    const<span style=color:#f92672>=</span>logging<span style=color:#f92672>.</span>DEBUG, default<span style=color:#f92672>=</span>logging<span style=color:#f92672>.</span>INFO)
    optp<span style=color:#f92672>.</span>add_option(<span style=color:#e6db74>&#39;-v&#39;</span>, <span style=color:#e6db74>&#39;--verbose&#39;</span>, help<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;set logging to COMM&#39;</span>,
                    action<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;store_const&#39;</span>, dest<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;loglevel&#39;</span>,
                    const<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span>, default<span style=color:#f92672>=</span>logging<span style=color:#f92672>.</span>INFO)

    <span style=color:#75715e># JID and password options.</span>
    optp<span style=color:#f92672>.</span>add_option(<span style=color:#e6db74>&#34;-j&#34;</span>, <span style=color:#e6db74>&#34;--jid&#34;</span>, dest<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;jid&#34;</span>,
                    help<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;JID to use&#34;</span>)
    optp<span style=color:#f92672>.</span>add_option(<span style=color:#e6db74>&#34;-p&#34;</span>, <span style=color:#e6db74>&#34;--password&#34;</span>, dest<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;password&#34;</span>,
                    help<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;password to use&#34;</span>)

    opts, args <span style=color:#f92672>=</span> optp<span style=color:#f92672>.</span>parse_args()

    <span style=color:#75715e># Setup logging.</span>
    logging<span style=color:#f92672>.</span>basicConfig(level<span style=color:#f92672>=</span>opts<span style=color:#f92672>.</span>loglevel,
                        format<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>%(levelname)-8s</span><span style=color:#e6db74> </span><span style=color:#e6db74>%(message)s</span><span style=color:#e6db74>&#39;</span>)

    <span style=color:#66d9ef>if</span> opts<span style=color:#f92672>.</span>jid <span style=color:#f92672>is</span> <span style=color:#66d9ef>None</span>:
        opts<span style=color:#f92672>.</span>jid <span style=color:#f92672>=</span> raw_input(<span style=color:#e6db74>&#34;Username: &#34;</span>)
    <span style=color:#66d9ef>if</span> opts<span style=color:#f92672>.</span>password <span style=color:#f92672>is</span> <span style=color:#66d9ef>None</span>:
        opts<span style=color:#f92672>.</span>password <span style=color:#f92672>=</span> getpass<span style=color:#f92672>.</span>getpass(<span style=color:#e6db74>&#34;Password: &#34;</span>)

    <span style=color:#75715e># Setup the EchoBot and register plugins. Note that while plugins may</span>
    <span style=color:#75715e># have interdependencies, the order in which you register them does</span>
    <span style=color:#75715e># not matter.</span>
    xmpp <span style=color:#f92672>=</span> EchoBot(opts<span style=color:#f92672>.</span>jid, opts<span style=color:#f92672>.</span>password)
    xmpp<span style=color:#f92672>.</span>register_plugin(<span style=color:#e6db74>&#39;xep_0030&#39;</span>) <span style=color:#75715e># Service Discovery</span>
    xmpp<span style=color:#f92672>.</span>register_plugin(<span style=color:#e6db74>&#39;xep_0004&#39;</span>) <span style=color:#75715e># Data Forms</span>
    xmpp<span style=color:#f92672>.</span>register_plugin(<span style=color:#e6db74>&#39;xep_0060&#39;</span>) <span style=color:#75715e># PubSub</span>
    xmpp<span style=color:#f92672>.</span>register_plugin(<span style=color:#e6db74>&#39;xep_0199&#39;</span>) <span style=color:#75715e># XMPP Ping</span>

    <span style=color:#75715e># If you are working with an OpenFire server, you may need</span>
    <span style=color:#75715e># to adjust the SSL version used:</span>
    <span style=color:#75715e># xmpp.ssl_version = ssl.PROTOCOL_SSLv3</span>

    <span style=color:#75715e># If you want to verify the SSL certificates offered by a server:</span>
    <span style=color:#75715e># xmpp.ca_certs = &#34;path/to/ca/cert&#34;</span>

    <span style=color:#75715e># Connect to the XMPP server and start processing XMPP stanzas.</span>
    <span style=color:#66d9ef>if</span> xmpp<span style=color:#f92672>.</span>connect():
        <span style=color:#75715e># If you do not have the dnspython library installed, you will need</span>
        <span style=color:#75715e># to manually specify the name of the server if it does not match</span>
        <span style=color:#75715e># the one in the JID. For example, to use Google Talk you would</span>
        <span style=color:#75715e># need to use:</span>
        <span style=color:#75715e>#</span>
        <span style=color:#75715e># if xmpp.connect((&#39;talk.google.com&#39;, 5222)):</span>
        <span style=color:#75715e>#     ...</span>
        xmpp<span style=color:#f92672>.</span>process(block<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
        print(<span style=color:#e6db74>&#34;Done&#34;</span>)
    <span style=color:#66d9ef>else</span>:
        print(<span style=color:#e6db74>&#34;Unable to connect.&#34;</span>)
</code></pre></div><h3 id=so-how-do-i-actually-use-this-thing-i-just-saw>So how do I actually use this thing I just saw?</h3>
<p>Take the complete example and save it to a file like <code>bot.py</code>. Then, run it!
The complete example will echo the message just before it attempts to mail it. You can comment out line <strong>86</strong> to stop this from happening and run the script with the <code>-q</code> argument once you are happy all is working.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>% python bot.py -j <span style=color:#e6db74>&#34;myEmailbot@myJabberServer.local&#34;</span>
Password:
INFO     Negotiating TLS
INFO     Using SSL version: <span style=color:#ae81ff>3</span>
INFO     CERT: Time <span style=color:#66d9ef>until</span> certificate expiration: <span style=color:#ae81ff>952</span> days, 6:46:01.014041

Received Message:
This is a test message that will be mailed :D
</code></pre></div><h3 id=things-to-note>Things to note.</h3>
<ul>
<li>Even though the script allows you to specify a <code>-p</code> argument, I would highly discourage the usage of this. Any person that has access to your machine, be it legitimate or not, would then see your bot&rsquo;s process, with the password in the <code>ps</code> output!</li>
<li>Ensure the SMTP server specified in line <strong>96</strong> of the complete example allows yo to relay! Change it if needed.</li>
</ul>
<h3 id=test-d>Test! :D</h3>
<p>Send your bot a message and see if your mail arrives ^^</p>
<p><strong>EDIT</strong>: Modify the message encoding to ASCII as the utf8 stuff seems to barf out sometimes :|</p>
</div>
<div class=pagination>
<div class=pagination__title>
<span class=pagination__title-h>Read other posts</span>
<hr>
</div>
<div class=pagination__buttons>
<span class="button previous">
<a href=https://leonjza.github.io/blog/2013/06/23/quick-win-quickly-execute-last-shell-command/>
<span class=button__icon>←</span>
<span class=button__text>Quick Win: Quickly Execute Last Shell Command</span>
</a>
</span>
<span class="button next">
<a href=https://leonjza.github.io/blog/2013/05/25/how-to-extremely-simple-python-jabber-broadcast-bot/>
<span class=button__text>How To: Extremely simple python Jabber Broadcast Bot</span>
<span class=button__icon>→</span>
</a>
</span>
</div>
</div>
</div>
</div>
<footer class=footer>
<div class=footer__inner>
<div class="copyright copyright--user"><a href=https://twitter.com/leonjza>@leonjza</a></div>
</div>
</footer>
<script src=https://leonjza.github.io/assets/main.js></script>
<script src=https://leonjza.github.io/assets/prism.js></script>
</div>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-44457032-2','auto'),ga('send','pageview'))</script>
</body>
</html>