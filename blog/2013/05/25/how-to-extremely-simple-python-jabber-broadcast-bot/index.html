<!doctype html><html lang=en>
<head>
<title>
How To: Extremely simple python Jabber Broadcast Bot ::
#!/bin/note
— a checkbox uncheckers notepad
</title>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="Bots! Bots! Bots! Generally speaking, a &amp;lsquo;&amp;lsquo;bot&amp;rsquo;&amp;rsquo; is something that like does work for you. But, for this purpose, the need for a jabber bot came from the fact that I had to deal with a lot of email on a daily basis. This large amount of mail sometimes would cause me to completely miss critical mail alerts. Realising later that I could have prevented a catastrophe if I didn&amp;rsquo;t miss that one email was just not on anymore. So, I started investigating ways to get the important stuff delivered faster.
As a team at work, we have long gone dropped the whole Skype group chat thing for our own Jabber server. My privacy related concerns back then was recently heightened here when a trap URL received a HEAD request from 65.52.100.214. The user that received the URL in a chat was under strict instructions not to actually click it&amp;hellip;
">
<meta name=keywords content="blog,hack,ctf,leonjza,pentester,red team,attack">
<meta name=robots content="noodp">
<link rel=canonical href=https://leonjza.github.io/blog/2013/05/25/how-to-extremely-simple-python-jabber-broadcast-bot/>
<link rel=stylesheet href=https://leonjza.github.io/assets/style.css>
<link rel=stylesheet href=https://leonjza.github.io/style.css>
<link rel=apple-touch-icon-precomposed sizes=144x144 href=https://leonjza.github.io/img/apple-touch-icon-144-precomposed.png>
<link rel="shortcut icon" href=https://leonjza.github.io/img/favicon.png>
<link href=https://leonjza.github.io/assets/fonts/Inter-Italic.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=https://leonjza.github.io/assets/fonts/Inter-Regular.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=https://leonjza.github.io/assets/fonts/Inter-Medium.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=https://leonjza.github.io/assets/fonts/Inter-MediumItalic.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=https://leonjza.github.io/assets/fonts/Inter-Bold.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=https://leonjza.github.io/assets/fonts/Inter-BoldItalic.woff2 rel=preload type=font/woff2 as=font crossorigin>
<meta name=twitter:card content="summary">
<meta name=twitter:title content="How To: Extremely simple python Jabber Broadcast Bot">
<meta name=twitter:description content="Bots! Bots! Bots!
Generally speaking, a &lsquo;&lsquo;bot&rsquo;&rsquo; is something that like does work for you. But, for this purpose, the need for a jabber bot came from the fact that I had to deal with a lot of email on a daily basis. This large amount of mail sometimes would cause me to completely miss critical mail alerts. Realising later that I could have prevented a catastrophe if I didn&rsquo;t miss that one email was just not on anymore. So, I started investigating ways to get the important stuff delivered faster.
As a team at work, we have long gone dropped the whole Skype group chat thing for our own Jabber server. My privacy related concerns back then was recently heightened here when a trap URL received a HEAD request from 65.52.100.214. The user that received the URL in a chat was under strict instructions not to actually click it&mldr;">
<meta property="og:title" content="How To: Extremely simple python Jabber Broadcast Bot">
<meta property="og:description" content="Bots! Bots! Bots!
Generally speaking, a &lsquo;&lsquo;bot&rsquo;&rsquo; is something that like does work for you. But, for this purpose, the need for a jabber bot came from the fact that I had to deal with a lot of email on a daily basis. This large amount of mail sometimes would cause me to completely miss critical mail alerts. Realising later that I could have prevented a catastrophe if I didn&rsquo;t miss that one email was just not on anymore. So, I started investigating ways to get the important stuff delivered faster.
As a team at work, we have long gone dropped the whole Skype group chat thing for our own Jabber server. My privacy related concerns back then was recently heightened here when a trap URL received a HEAD request from 65.52.100.214. The user that received the URL in a chat was under strict instructions not to actually click it&mldr;">
<meta property="og:type" content="article">
<meta property="og:url" content="https://leonjza.github.io/blog/2013/05/25/how-to-extremely-simple-python-jabber-broadcast-bot/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2013-05-25T00:00:00+00:00">
<meta property="article:modified_time" content="2013-05-25T00:00:00+00:00"><meta property="og:site_name" content="#!/bin/note
">
</head>
<body class=dark-theme>
<div class=container>
<header class=header>
<span class=header__inner>
<a href=/ class=logo style=text-decoration:none>
<span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg>
</span>
<span class=logo__text>#!/bin/note
</span>
<span class=logo__cursor></span>
</a>
<span class=header__right>
<nav class=menu>
<ul class="menu__inner menu__inner--desktop">
<li><a href=/about/>About Me</a></li>
<li><a href=/categories>Categories</a></li>
<li><a href=/posts>Posts</a></li>
</ul>
<ul class="menu__inner menu__inner--mobile">
<li><a href=/about/>About Me</a></li>
<li><a href=/categories>Categories</a></li>
<li><a href=/posts>Posts</a></li>
</ul>
</nav>
<span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
</span>
<span class=theme-toggle><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg>
</span>
</span>
</span>
</header>
<div class=content>
<div class=post>
<h1 class=post-title>How To: Extremely simple python Jabber Broadcast Bot</h1>
<div class=post-meta>
<span class=post-date>
2013-05-25
</span>
<span class=post-read-time>— 4 min read</span>
</div>
<div class=post-content>
<h2>Table of Contents</h2>
<aside class=table-of-contents><nav id=TableOfContents>
<ul>
<li>
<ul>
<li>
<ul>
<li><a href=#bots-bots-bots>Bots! Bots! Bots!</a></li>
<li><a href=#so-how-do-we-do-this>So, how do we do this?</a></li>
<li><a href=#introducing-jabbersendpy>Introducing jabbersend.py</a></li>
<li><a href=#we-have-the-code-now-use-it>We have the code, now use it!</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav></aside>
<h3 id=bots-bots-bots>Bots! Bots! Bots!</h3>
<p>Generally speaking, a &lsquo;&lsquo;bot&rsquo;&rsquo; is something that like <em>does work for you</em>. But, for this purpose, the need for a jabber bot came from the fact that I had to deal with a lot of email on a daily basis. This large amount of mail sometimes would cause me to completely miss critical mail alerts. Realising later that I could have prevented a catastrophe if I didn&rsquo;t miss that <strong>one</strong> email was just not on anymore. So, I started investigating ways to get the <em>important</em> stuff delivered faster.</p>
<p>As a team at work, we have long gone dropped the whole Skype group chat thing for our own Jabber server. My privacy related concerns back then was recently heightened <a href=http://lists.randombit.net/pipermail/cryptography/2013-May/004224.html>here</a> when a trap URL received a HEAD request from <strong>65.52.100.214</strong>. The user that received the URL in a chat was under strict instructions not to actually click it&mldr;</p>
<h3 id=so-how-do-we-do-this>So, how do we do this?</h3>
<p>We implemented a <a href=http://www.igniterealtime.org/projects/openfire/>Openfire Server</a> that was really easy to setup and get going. Whats really nice about this Jabber server is that it supports plugins, some of which you can simply install via the web interface.</p>
<p>One such plugin that was installed is called the <a href=http://www.igniterealtime.org/projects/openfire/plugins/broadcast/readme.html>broadcast</a> plugin. This allows you to broadcast a message to all users on the server or those in defined groups.</p>
<figure class=left>
<img src=/images/openfire_screenshot.png>
</figure>
<p>Once this plugin is installed, some minor configuration is required to allow the broadcasting feature to work. In no way is this an extensive guide on the power of the plugin, but for the purpose of this post well just quickly rush over it.</p>
<p>Head over to <em>Server</em> -> <em>Server Manager</em> -> <em>System Properties</em>. From here you need to add the fields that are not there with the <strong>plugin.broadcast.</strong> prefix. Don&rsquo;t worry if they are not there, just add them.</p>
<figure class=left>
<img src=/images/openfire_screenshot2.png>
</figure>
<p>The above is just a sample of a working configuration. Feel free to play around more with different setups.</p>
<p>With everything configured, you should now be able to send a message to something like <em><a href=mailto:all@broadcast.jabber.server>all@broadcast.jabber.server</a></em>. In my configuration, <em>plugin.broadcast.all2offline</em> is set to <strong>true</strong>. So, when a message is broadcasted and I was offline, I&rsquo;ll receive the broadcast as soon as I&rsquo;m back :)</p>
<h3 id=introducing-jabbersendpy>Introducing jabbersend.py</h3>
<p>With our jabber server now configured and working, we are ready to start automating things. From here we need two things. Something that will broadcast for us, and something <em>to</em> broadcast. The <em>what to broadcast</em> is entirely up to you, as the script will accept a text file to broadcast.</p>
<p>The only dependency you probably need to satisfy will be <code>xmpp</code>. This should be easily doable with something like <code>easy_install xmpp</code></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#75715e>#!/usr/bin/python</span>
<span style=color:#f92672>import</span> sys<span style=color:#f92672>,</span>os<span style=color:#f92672>,</span>xmpp<span style=color:#f92672>,</span>time

<span style=color:#75715e># check the received arguments</span>
<span style=color:#66d9ef>if</span> len(sys<span style=color:#f92672>.</span>argv) <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>2</span>:
    print <span style=color:#e6db74>&#34;Syntax: jabbersend.py JID textfile&#34;</span>
    sys<span style=color:#f92672>.</span>exit(<span style=color:#ae81ff>0</span>)

<span style=color:#75715e># set the values to work with and read the file</span>
tojid<span style=color:#f92672>=</span>sys<span style=color:#f92672>.</span>argv[<span style=color:#ae81ff>1</span>]
m <span style=color:#f92672>=</span> open(sys<span style=color:#f92672>.</span>argv[<span style=color:#ae81ff>2</span>],<span style=color:#e6db74>&#39;r&#39;</span>)
array <span style=color:#f92672>=</span> m<span style=color:#f92672>.</span>readlines()
m<span style=color:#f92672>.</span>close()

msg<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>
<span style=color:#66d9ef>for</span> record <span style=color:#f92672>in</span> array:
        msg <span style=color:#f92672>=</span> msg <span style=color:#f92672>+</span> record

<span style=color:#75715e># configure your jabber account for the bot here.</span>
username <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;jabber_bot@jabber.server&#39;</span> <span style=color:#75715e># from whom will the message be sent</span>
password <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;jabber_bot_secret_password&#39;</span>

jid<span style=color:#f92672>=</span>xmpp<span style=color:#f92672>.</span>protocol<span style=color:#f92672>.</span>JID(username)

<span style=color:#75715e># for debugging purposes, uncomment the below line so that &#39;debug&#39; is 1.</span>
<span style=color:#75715e># This makes the script very verbose though, but its helpful if you stuck ^^</span>
<span style=color:#75715e>#cl=xmpp.Client(jid.getDomain(),debug=1)</span>
cl<span style=color:#f92672>=</span>xmpp<span style=color:#f92672>.</span>Client(jid<span style=color:#f92672>.</span>getDomain(),debug<span style=color:#f92672>=</span>[])

<span style=color:#75715e># Sadly I don&#39;t have a valid certificate for my jabber server, so this had to</span>
<span style=color:#75715e># be set to False. I do however recommend, if you can, to get a valid certificate</span>
<span style=color:#75715e># and enable this</span>
con<span style=color:#f92672>=</span>cl<span style=color:#f92672>.</span>connect(secure<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>) <span style=color:#75715e># Set this to validate the servers certificate.</span>
<span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> con:
    print <span style=color:#e6db74>&#34;Could not connect&#34;</span>
    sys<span style=color:#f92672>.</span>exit()

<span style=color:#75715e># authenticate the client</span>
auth<span style=color:#f92672>=</span>cl<span style=color:#f92672>.</span>auth(jid<span style=color:#f92672>.</span>getNode(),password,resource<span style=color:#f92672>=</span>jid<span style=color:#f92672>.</span>getResource())
<span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> auth:
    print <span style=color:#e6db74>&#34;Authentication failed&#34;</span>
    sys<span style=color:#f92672>.</span>exit()

<span style=color:#75715e># send the message</span>
id<span style=color:#f92672>=</span>cl<span style=color:#f92672>.</span>send(xmpp<span style=color:#f92672>.</span>protocol<span style=color:#f92672>.</span>Message(tojid, msg))

<span style=color:#75715e># some older servers will not send the message if you disconnect immediately</span>
time<span style=color:#f92672>.</span>sleep(<span style=color:#ae81ff>1</span>)
</code></pre></div><h3 id=we-have-the-code-now-use-it>We have the code, now use it!</h3>
<p>Save this code to something like <code>jabbersend.py</code> and execute it like this:
<code>python jabbersend.py all@broadcast.jabber.server message_file.txt</code></p>
<p>If all went OK, you should have received a message from <a href=mailto:jabber_bot@jabber.server>jabber_bot@jabber.server</a> :P</p>
<p>Our internal implementation of this has been used in multiple areas. From broadcasting OSSEC alerts to broadcasting important events from cronjobs.
The OSSEC broadcasting I&rsquo;ll blog a little later, but you can obviously see the value that something like this brings. No more missing emails, if I receive a message from the bot, its important :)</p>
</div>
<div class=pagination>
<div class=pagination__title>
<span class=pagination__title-h>Read other posts</span>
<hr>
</div>
<div class=pagination__buttons>
<span class="button previous">
<a href=https://leonjza.github.io/blog/2013/06/07/jabber-to-email-using-sleekxmpp/>
<span class=button__icon>←</span>
<span class=button__text>Jabber to Email using SleekXMPP</span>
</a>
</span>
<span class="button next">
<a href=https://leonjza.github.io/blog/2013/05/24/hello-world-oh-and-heres-some-code/>
<span class=button__text>Hello World! Oh and here's some code!</span>
<span class=button__icon>→</span>
</a>
</span>
</div>
</div>
</div>
</div>
<footer class=footer>
<div class=footer__inner>
<div class="copyright copyright--user"><a href=https://twitter.com/leonjza>@leonjza</a></div>
</div>
</footer>
<script src=https://leonjza.github.io/assets/main.js></script>
<script src=https://leonjza.github.io/assets/prism.js></script>
</div>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-44457032-2','auto'),ga('send','pageview'))</script>
</body>
</html>