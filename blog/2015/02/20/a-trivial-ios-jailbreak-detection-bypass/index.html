<!doctype html><html lang=en>
<head>
<title>
a trivial iOS jailbreak detection bypass ::
#!/bin/note
— a checkbox uncheckers notepad
</title>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="introduction Not too long ago, I toyed with a Android root detection bypass. In a similar scenario, I was poking at a iOS application that also had some root detection built in. For very much the same purpose, I suppose the application has its own ~reasons~ for the jailbreak detection. Of course, this makes the testing I actually wanted to do impossible as I&amp;rsquo;d very much like to dig under the hood :)
 So, its was time to try and bypass the jailbreak detection of the application. All I had to work with was a .ipa. Similar to the android .apk file, the .ipa is also just a zipped up archive of the actual application files. To test with, I had a iPad mini. The iPad was running the latest iOS (8.1.2 at the time of this post) and was also jailbroken. If I remember correctly the jailbreak tool used was called TaiG. Anyways, inside the applications .ipa archive was a whole bunch of resource files and what not, including the compiled application executable. This executable is what is of interest.
">
<meta name=keywords content="blog,hack,ctf,leonjza,pentester,red team,attack">
<meta name=robots content="noodp">
<link rel=canonical href=https://leonjza.github.io/blog/2015/02/20/a-trivial-ios-jailbreak-detection-bypass/>
<link rel=stylesheet href=https://leonjza.github.io/assets/style.css>
<link rel=stylesheet href=https://leonjza.github.io/style.css>
<link rel=apple-touch-icon-precomposed sizes=144x144 href=https://leonjza.github.io/img/apple-touch-icon-144-precomposed.png>
<link rel="shortcut icon" href=https://leonjza.github.io/img/favicon.png>
<link href=https://leonjza.github.io/assets/fonts/Inter-Italic.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=https://leonjza.github.io/assets/fonts/Inter-Regular.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=https://leonjza.github.io/assets/fonts/Inter-Medium.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=https://leonjza.github.io/assets/fonts/Inter-MediumItalic.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=https://leonjza.github.io/assets/fonts/Inter-Bold.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=https://leonjza.github.io/assets/fonts/Inter-BoldItalic.woff2 rel=preload type=font/woff2 as=font crossorigin>
<meta name=twitter:card content="summary">
<meta name=twitter:title content="a trivial iOS jailbreak detection bypass">
<meta name=twitter:description content="introduction
Not too long ago, I toyed with a Android root detection bypass. In a similar scenario, I was poking at a iOS application that also had some root detection built in. For very much the same purpose, I suppose the application has its own ~reasons~ for the jailbreak detection. Of course, this makes the testing I actually wanted to do impossible as I&rsquo;d very much like to dig under the hood :)

  
    
    
  


So, its was time to try and bypass the jailbreak detection of the application.
All I had to work with was a .ipa. Similar to the android .apk file, the .ipa is also just a zipped up archive of the actual application files. To test with, I had a iPad mini. The iPad was running the latest iOS (8.1.2 at the time of this post) and was also jailbroken. If I remember correctly the jailbreak tool used was called TaiG. Anyways, inside the applications .ipa archive was a whole bunch of resource files and what not, including the compiled application executable. This executable is what is of interest.">
<meta property="og:title" content="a trivial iOS jailbreak detection bypass">
<meta property="og:description" content="introduction
Not too long ago, I toyed with a Android root detection bypass. In a similar scenario, I was poking at a iOS application that also had some root detection built in. For very much the same purpose, I suppose the application has its own ~reasons~ for the jailbreak detection. Of course, this makes the testing I actually wanted to do impossible as I&rsquo;d very much like to dig under the hood :)

  
    
    
  


So, its was time to try and bypass the jailbreak detection of the application.
All I had to work with was a .ipa. Similar to the android .apk file, the .ipa is also just a zipped up archive of the actual application files. To test with, I had a iPad mini. The iPad was running the latest iOS (8.1.2 at the time of this post) and was also jailbroken. If I remember correctly the jailbreak tool used was called TaiG. Anyways, inside the applications .ipa archive was a whole bunch of resource files and what not, including the compiled application executable. This executable is what is of interest.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://leonjza.github.io/blog/2015/02/20/a-trivial-ios-jailbreak-detection-bypass/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2015-02-20T21:09:21+00:00">
<meta property="article:modified_time" content="2015-02-20T21:09:21+00:00"><meta property="og:site_name" content="#!/bin/note
">
</head>
<body class=dark-theme>
<div class=container>
<header class=header>
<span class=header__inner>
<a href=/ class=logo style=text-decoration:none>
<span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg>
</span>
<span class=logo__text>#!/bin/note
</span>
<span class=logo__cursor></span>
</a>
<span class=header__right>
<nav class=menu>
<ul class="menu__inner menu__inner--desktop">
<li><a href=/about/>About Me</a></li>
<li><a href=/categories>Categories</a></li>
<li><a href=/posts>Posts</a></li>
</ul>
<ul class="menu__inner menu__inner--mobile">
<li><a href=/about/>About Me</a></li>
<li><a href=/categories>Categories</a></li>
<li><a href=/posts>Posts</a></li>
</ul>
</nav>
<span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
</span>
<span class=theme-toggle><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg>
</span>
</span>
</span>
</header>
<div class=content>
<div class=post>
<h1 class=post-title>a trivial iOS jailbreak detection bypass</h1>
<div class=post-meta>
<span class=post-date>
2015-02-20
</span>
<span class=post-read-time>— 6 min read</span>
</div>
<div class=post-content>
<h2>Table of Contents</h2>
<aside class=table-of-contents><nav id=TableOfContents>
<ul>
<li>
<ul>
<li><a href=#introduction>introduction</a></li>
<li><a href=#understanding-the-behavior>understanding the behavior</a></li>
<li><a href=#discovering-the-implementation>discovering the implementation</a></li>
<li><a href=#planning-an-attack>planning an attack</a></li>
<li><a href=#in-1992-we-had-hex-editors-too>in 1992 we had hex editors too</a></li>
<li><a href=#summary>summary</a></li>
</ul>
</li>
</ul>
</nav></aside>
<h2 id=introduction>introduction</h2>
<p>Not too long ago, I toyed with a <a href=https://leonjza.github.io/blog/2015/02/09/no-more-jailbreak-detection-an-adventure-into-android-app-reversing-and-smali-patching/>Android root detection bypass</a>. In a similar scenario, I was poking at a iOS application that also had some root detection built in. For very much the same purpose, I suppose the application has its own ~reasons~ for the jailbreak detection. Of course, this makes the testing I <em>actually</em> wanted to do impossible as I&rsquo;d very much like to dig under the hood :)</p>
<figure class=left>
<img src=/images/ios_jailbreak_logo.png>
</figure>
<p>So, its was time to try and bypass the jailbreak detection of the application.
All I had to work with was a <code>.ipa</code>. Similar to the android <code>.apk</code> file, the <code>.ipa</code> is also just a zipped up archive of the actual application files. To test with, I had a iPad mini. The iPad was running the latest iOS (8.1.2 at the time of this post) and was also jailbroken. If I remember correctly the jailbreak tool used was called TaiG. Anyways, inside the applications <code>.ipa</code> archive was a whole bunch of resource files and what not, including the compiled application executable. This executable is what is of interest.</p>
<h2 id=understanding-the-behavior>understanding the behavior</h2>
<p>I installed the app onto my iPad, and started to inspect its behavior. When the application starts, it would immediately throw a security related error, notifying the user that it has detected the environment as one that is jailbroken. This happens pretty fast too. Once the jailbreak detection error shows, the application refuses to continue to run. Restarting the application simply continues this loop.</p>
<p>I studied some iOS jailbreak detection methods online which revealed many of them as being pretty obvious. From detecting the presence of <code>/bin/bash</code> or <code>Cydia.app</code>, to examining the exit status if <code>fork()</code>. There are some more advanced methods as well such as checking the existence of certain known <a href=https://developer.apple.com/library/mac/documentation/DeveloperTools/Conceptual/DynamicLibraries/100-Articles/DynamicLibraryUsageGuidelines.html>dylib</a>&rsquo;s too (which apparently is the hardest to circumvent). For the purpose of this post, the jailbreak detection was pretty weak and did not have any of the more advanced methods implemented. In fact, I am pretty sure there won’t be that many apps out there that will be this easy to bypass.</p>
<h2 id=discovering-the-implementation>discovering the implementation</h2>
<p>Armed with some knowledge of how its typically done in the iOS world, I proceeded to take a look at the actual application binary:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>leonjza@laptop » file myApplication
myApplication: Mach-O executable arm
</code></pre></div><p>Compiled as a <em>Mach-O executable</em> from Objective-C, I loaded up the binary from the extracted <code>.ipa</code> into the Hopper disassembler to help me get an idea of what is happening. Hopper has some nice features such as generating pseudo code etc, so I quite like using it for these types of excursions. To start off, I searched around for strings that were related to the word <strong>jailbreak</strong> within the app. Class definitions, methods or any strings related to the term jailbreak was ok. I just wanted to get something to start off with. I found nothing.</p>
<p>Of course this had me thinking that I may have missed the plot entirely. I continued to search for other things related to jailbreaking, and got a hit immediately for the term <code>/bin/bash</code> in the <em>string</em> section:</p>
<figure class=left>
<img src=/images/ios_jailbreak_hopper.png>
</figure>
<p>In fact, there are quite a few other jailbreak related strings in this section. From within Hopper, one can check where these strings are referenced from. So, I followed this and landed up in a function that does what I would have expected a jailbreak detection function to do, but with a completely unexpected class/method name. <em>-[MobileDisplay isRetinaDisplay]:</em>. Very sneaky :) So we are working with the <code>isRetinaDisplay</code> method which is the one doing the jailbreak detection:</p>
<figure class=left>
<img src=/images/ios_jailbreak_hopper2.png>
</figure>
<p>As can be seen in the above screenshot, the <code>fileExistsAtPath</code> for <code>/Applications/Cydia.app</code> is hardly something I would have expected in a <code>isRetinaDisplay</code> implementation :P</p>
<h2 id=planning-an-attack>planning an attack</h2>
<p>At this stage, I was fairly certain that I had found the code I was looking for. From the method name <em>isRetinaDisplay</em>, I reasoned a little and guessed that this was actually supposed to say <code>isJailBroken</code>. I want this method to return false. My mind went straight to getting <a href=http://www.cycript.org/>cycript</a> ready for some <a href=http://iphonedevwiki.net/index.php/Cycript_Tricks>method swizzling</a>. I started to set things up and played around a little, when I realized that I don&rsquo;t think I will be able to manipulate the runtime fast enough for this to work. Remember, the first thing the app does is check the jailbreak status.</p>
<p>A bit of thinking, a few coffees, special alone time with Google and lots of reading, I come to realize that even if I <em>was</em> able to get this method swizzling to work, I&rsquo;d have to do this every time the application starts up. This was not going to work for me. It was time to rethink my strategy.</p>
<p>Considering <em>how</em> the jailbreak detection works, most of the ways that I saw in the application were related to file existence checks. There was also an attempt to write to <code>/private/jailbreak.txt</code>, as well as open a <code>cydia://</code> url. I realized that I could probably just change these strings to things that will inherently fail and cause the method to not return true for any of the checks.</p>
<h2 id=in-1992-we-had-hex-editors-too>in 1992 we had hex editors too</h2>
<p>I ssh&rsquo;d into my iPad and located the applications installed directory. Once I had found this, I <code>scp</code>&rsquo;d the compiled binary to my kali linux install, and opened it in a hex editor. I realized later I could have probably just used the binary I already had locally :P</p>
<p>Referencing the disassembly of <code>isRetinaDisplay</code>, I searched for the strings it used using a Hex editor. Each string I would replace a few characters with <code>0</code> ensuring that I keep the original string length intact. For eg: <code>/bin/bash</code> was replaced with <code>/bin/ba00</code>.</p>
<p>I ended up editing the following strings using the hex editor:</p>
<ul>
<li>/Applications/Cydia.app -> /Applications/Cyd00.app</li>
<li>/Library/MobileSubstrate/MobileSubstrate.dylib -> /Library/MobileSubstrate/MobileSubstra00.dylib</li>
<li>/bin/bash -> /bin/ba00</li>
<li>/usr/sbin/sshd -> /usr/sbin/ss00</li>
<li>/etc/apt -> /etc/a00</li>
<li>/private/jailbreak.txt -> /0000000/0000000000000</li>
<li>cydia://package/com.example.package -> cyd00://package/com.example.package</li>
</ul>
<figure class=left>
<img src=/images/ios_jailbreak_hex_editor.png>
</figure>
<p>I saved the modifications that I had done, and <code>scp</code>&rsquo;d the binary back to my iPad to the folder where it was installed. I literally just overwrote the existing binary. At this stage I figured I will most certainly have some form of signing related problem as the binary has been tampered with. Well, this was not the case. Instead, I no longer was greeted with the lame jailbreak security error :P</p>
<h2 id=summary>summary</h2>
<p>In the end, it was pretty easy to find the jailbreak detection code. Deducing a few things based on the disassembly made it easy to find the method responsible for the checks, regardless of the attempt to hide it via a name change. Furthermore, using something as simple as a hex editor, a trivial implementation such as this was very easily bypassed :)</p>
</div>
<div class=pagination>
<div class=pagination__title>
<span class=pagination__title-h>Read other posts</span>
<hr>
</div>
<div class=pagination__buttons>
<span class="button previous">
<a href=https://leonjza.github.io/blog/2015/02/21/beating-sokar-the-vulnhub-turns-0b10-challenge/>
<span class=button__icon>←</span>
<span class=button__text>beating sokar the vulnhub turns 0b10 challenge</span>
</a>
</span>
<span class="button next">
<a href=https://leonjza.github.io/blog/2015/02/09/no-more-jailbreak-detection-an-adventure-into-android-app-reversing-and-smali-patching/>
<span class=button__text>no more jailbreak detection an adventure into Android app reversing and smali patching</span>
<span class=button__icon>→</span>
</a>
</span>
</div>
</div>
</div>
</div>
<footer class=footer>
<div class=footer__inner>
<div class="copyright copyright--user"><a href=https://twitter.com/leonjza>@leonjza</a></div>
</div>
</footer>
<script src=https://leonjza.github.io/assets/main.js></script>
<script src=https://leonjza.github.io/assets/prism.js></script>
</div>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-44457032-2','auto'),ga('send','pageview'))</script>
</body>
</html>