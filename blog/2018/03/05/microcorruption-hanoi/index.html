<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  
  <script type="application/ld+json">
{
    "@context" : "http://schema.org",
    "@type" : "BlogPosting",
    "mainEntityOfPage": {
         "@type": "WebPage",
         "@id": "https:\/\/leonjza.github.io"
    },
    "articleSection" : "post",
    "name" : "microcorruption - hanoi",
    "headline" : "microcorruption - hanoi",
    "description" : "\u003cfigure\u003e\n    \u003cimg src=\u0022\/images\/microcorruption\/microcorruption.png\u0022\/\u003e \n\u003c\/figure\u003e\n\n\u003cp\u003eThis post is part of the series of solving \u003ca href=\u0022https:\/\/microcorruption.com\u0022\u003emicrocorruption.com\u003c\/a\u003e ctf challenges which continues from the \u003ca href=\u0022https:\/\/leonjza.github.io\/blog\/2018\/03\/04\/microcorruption---sydney\/\u0022\u003eprevious challenge\u003c\/a\u003e called \u003cem\u003eSydney\u003c\/em\u003e. This challenge is titled \u003cem\u003eHanoi\u003c\/em\u003e.\u003c\/p\u003e\n\u003cp\u003eIf you were to read the description when you enter the challenge, one would see the following towards the bottom:\u003c\/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eLockIT Pro Hardware Security Module 1 stores the login password, ensuring users can not access the password through other means. The LockIT Pro can send the LockIT Pro HSM-1 a password, and the HSM will return if the password is correct by setting a flag in memory.\u003c\/p\u003e\n\u003c\/blockquote\u003e\n\u003cp\u003eOk, so mention of a HSM here. Neat! Lets take a look at how that works!\u003c\/p\u003e",
    "inLanguage" : "en-US",
    "author" : "Leon Jacobs",
    "creator" : "Leon Jacobs",
    "publisher": "Leon Jacobs",
    "accountablePerson" : "Leon Jacobs",
    "copyrightHolder" : "Leon Jacobs",
    "copyrightYear" : "2018",
    "datePublished": "2018-03-05 19:08:33 \u002b0200 SAST",
    "dateModified" : "2018-03-05 19:08:33 \u002b0200 SAST",
    "url" : "https:\/\/leonjza.github.io\/blog\/2018\/03\/05\/microcorruption-hanoi\/",
    "wordCount" : "952",
    "keywords" : [ "ctf","exploit","assembly","microcorruption","hanoi","Blog" ]
}
</script>


  <title>microcorruption - hanoi &middot; </title>

  
  <link rel="stylesheet" href="https://leonjza.github.io/css/poole.css">
  <link rel="stylesheet" href="https://leonjza.github.io/css/hyde.css">
  <link rel="stylesheet" href="https://leonjza.github.io/css/poole-overrides.css">
  <link rel="stylesheet" href="https://leonjza.github.io/css/hyde-overrides.css">
  <link rel="stylesheet" href="https://leonjza.github.io/css/hyde-x.css">
  <link rel="stylesheet" href="https://leonjza.github.io/css/highlight/solarized_light.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://leonjza.github.io/touch-icon-144-precomposed.png">
  <link href="https://leonjza.github.io/favicon.png" rel="icon">

  
  
  
  

  <meta name="description" content="">
  <meta name="keywords" content="">
  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-44457032-2', 'auto');
    ga('send', 'pageview');
  </script>
  
</head>
<body class="theme-base-0d">
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      
      <h1></h1>
      <p class="lead">#!/slash/note<br>
<em>A checkbox unchecker&rsquo;s notepad</em></p>
    </div>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item"><a href="https://leonjza.github.io/">Blog</a></li>
      
      <li class="sidebar-nav-item"><a href="https://leonjza.github.io/post">Posts</a></li>
      
      <li class="sidebar-nav-item"><a href="https://leonjza.github.io/about/">About Me</a></li>
      
    </ul>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">
      <a href="https://github.com/leonjza"><i class="fa fa-github-square fa-3x"></i></a>
      
      
      
      
      
      <a href="https://twitter.com/leonjza"><i class="fa fa-twitter-square fa-3x"></i></a>
      
      
      </li>
    </ul>

    

    <p>Copyright &copy; 2020 <a href="https://leonjza.github.io/license/">License</a><br/>
       Powered by <a href="http://gohugo.io">Hugo</a> and <a href="https://github.com/zyro/hyde-x">Hyde-X</a></p>

  </div>
</div>


<div class="content container">
  <div class="post">
    <h1 class="post-title">microcorruption - hanoi</h1>
    <span class="post-date">Mar 5, 2018 &middot; 5 minute read &middot; <a href="https://leonjza.github.io/blog/2018/03/05/microcorruption-hanoi/#disqus_thread">Comments</a>
    
    <br/>
    <a class="label" href="https://leonjza.github.io/categories/ctf">ctf</a><a class="label" href="https://leonjza.github.io/categories/exploit">exploit</a><a class="label" href="https://leonjza.github.io/categories/assembly">assembly</a><a class="label" href="https://leonjza.github.io/categories/microcorruption">microcorruption</a><a class="label" href="https://leonjza.github.io/categories/hanoi">hanoi</a>
    </span>
    <figure>
    <img src="https://leonjza.github.io/images/microcorruption/microcorruption.png"/> 
</figure>

<p>This post is part of the series of solving <a href="https://microcorruption.com">microcorruption.com</a> ctf challenges which continues from the <a href="https://leonjza.github.io/blog/2018/03/04/microcorruption---sydney/">previous challenge</a> called <em>Sydney</em>. This challenge is titled <em>Hanoi</em>.</p>
<p>If you were to read the description when you enter the challenge, one would see the following towards the bottom:</p>
<blockquote>
<p>LockIT Pro Hardware Security Module 1 stores the login password, ensuring users can not access the password through other means. The LockIT Pro can send the LockIT Pro HSM-1 a password, and the HSM will return if the password is correct by setting a flag in memory.</p>
</blockquote>
<p>Ok, so mention of a HSM here. Neat! Lets take a look at how that works!</p>
<h2 id="hanoi">hanoi</h2>
<p>This time round, our <code>main</code> function is quite a bit shorter than the previous programs we have analysed:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-asm" data-lang="asm"><span style="color:#960050;background-color:#1e0010">4438</span> <span style="color:#960050;background-color:#1e0010">&lt;</span><span style="color:#a6e22e">main</span><span style="color:#960050;background-color:#1e0010">&gt;</span>
<span style="color:#960050;background-color:#1e0010">4438:</span>  <span style="color:#a6e22e">b012</span> <span style="color:#ae81ff">2045</span>      <span style="color:#66d9ef">call</span>  <span style="color:#75715e">#0x4520 &lt;login&gt;
</span><span style="color:#75715e"></span><span style="color:#ae81ff">443</span><span style="color:#66d9ef">c</span>:  <span style="color:#ae81ff">0</span><span style="color:#66d9ef">f43</span>           <span style="color:#66d9ef">clr</span>   <span style="color:#66d9ef">r15</span>
</code></pre></div><p>Just a call to <code>login</code> which in turn has a similar flow to that which we saw in the previous <code>main</code> functions. A semi-shortened, annotated version of <code>login</code> is:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-asm" data-lang="asm"><span style="color:#960050;background-color:#1e0010">4520</span> <span style="color:#960050;background-color:#1e0010">&lt;</span><span style="color:#a6e22e">login</span><span style="color:#960050;background-color:#1e0010">&gt;</span>
<span style="color:#960050;background-color:#1e0010">4520:</span>  <span style="color:#a6e22e">c243</span> <span style="color:#ae81ff">1024</span>      <span style="color:#66d9ef">mov.b</span> <span style="color:#75715e">#0x0, &amp;0x2410
</span><span style="color:#75715e"></span><span style="color:#ae81ff">4524</span>:  <span style="color:#ae81ff">3</span><span style="color:#66d9ef">f40</span> <span style="color:#ae81ff">7</span><span style="color:#66d9ef">e44</span>      <span style="color:#66d9ef">mov</span>   <span style="color:#75715e">#0x447e &#34;Enter the password to continue.&#34;, r15
</span><span style="color:#75715e"></span><span style="color:#ae81ff">4528</span>:  <span style="color:#66d9ef">b012</span> <span style="color:#66d9ef">de45</span>      <span style="color:#66d9ef">call</span>  <span style="color:#75715e">#0x45de &lt;puts&gt;
</span><span style="color:#75715e"></span>
<span style="color:#75715e">; but what if i put in more than 16 characters? ;)
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">452</span>c:  <span style="color:#960050;background-color:#1e0010">3</span><span style="color:#a6e22e">f40</span> <span style="color:#ae81ff">9</span><span style="color:#66d9ef">e44</span>      <span style="color:#66d9ef">mov</span>   <span style="color:#75715e">#0x449e &#34;Remember: passwords are between 8 and 16 characters.&#34;, r15
</span><span style="color:#75715e"></span><span style="color:#ae81ff">4530</span>:  <span style="color:#66d9ef">b012</span> <span style="color:#66d9ef">de45</span>      <span style="color:#66d9ef">call</span>  <span style="color:#75715e">#0x45de &lt;puts&gt;
</span><span style="color:#75715e"></span>
<span style="color:#960050;background-color:#1e0010">[</span><span style="color:#a6e22e">..</span> <span style="color:#66d9ef">routine</span> <span style="color:#66d9ef">to</span> <span style="color:#66d9ef">get</span> <span style="color:#66d9ef">the</span> <span style="color:#66d9ef">password</span> <span style="color:#66d9ef">..</span>]

<span style="color:#960050;background-color:#1e0010">4544:</span>  <span style="color:#a6e22e">b012</span> <span style="color:#ae81ff">5444</span>      <span style="color:#66d9ef">call</span>  <span style="color:#75715e">#0x4454 &lt;test_password_valid&gt;
</span><span style="color:#75715e"></span><span style="color:#ae81ff">4548</span>:  <span style="color:#ae81ff">0</span><span style="color:#66d9ef">f93</span>           <span style="color:#66d9ef">tst</span>   <span style="color:#66d9ef">r15</span>
<span style="color:#960050;background-color:#1e0010">454</span>a:  <span style="color:#960050;background-color:#1e0010">0324</span>           <span style="color:#a6e22e">jz</span>    <span style="color:#66d9ef">$</span><span style="color:#960050;background-color:#1e0010">+</span><span style="color:#ae81ff">0x8</span>

<span style="color:#75715e">; erm? what is going on here?
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">454</span>c:  <span style="color:#a6e22e">f240</span> <span style="color:#ae81ff">5000</span> <span style="color:#ae81ff">1024</span> <span style="color:#66d9ef">mov.b</span> <span style="color:#75715e">#0x50, &amp;0x2410
</span><span style="color:#75715e"></span><span style="color:#ae81ff">4552</span>:  <span style="color:#ae81ff">3</span><span style="color:#66d9ef">f40</span> <span style="color:#66d9ef">d344</span>      <span style="color:#66d9ef">mov</span>   <span style="color:#75715e">#0x44d3 &#34;Testing if password is valid.&#34;, r15
</span><span style="color:#75715e"></span><span style="color:#ae81ff">4556</span>:  <span style="color:#66d9ef">b012</span> <span style="color:#66d9ef">de45</span>      <span style="color:#66d9ef">call</span>  <span style="color:#75715e">#0x45de &lt;puts&gt;
</span><span style="color:#75715e"></span>
<span style="color:#75715e">; and what about here?
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">455</span>a:  <span style="color:#a6e22e">f290</span> <span style="color:#ae81ff">6300</span> <span style="color:#ae81ff">1024</span> <span style="color:#66d9ef">cmp.b</span> <span style="color:#75715e">#0x63, &amp;0x2410
</span><span style="color:#75715e"></span><span style="color:#ae81ff">4560</span>:  <span style="color:#ae81ff">0720</span>           <span style="color:#66d9ef">jne</span>   <span style="color:#75715e">#0x4570 &lt;login+0x50o&gt;
</span><span style="color:#75715e"></span>
<span style="color:#75715e">; grants us access!
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">4562:</span>  <span style="color:#960050;background-color:#1e0010">3</span><span style="color:#a6e22e">f40</span> <span style="color:#66d9ef">f144</span>      <span style="color:#66d9ef">mov</span>   <span style="color:#75715e">#0x44f1 &#34;Access granted.&#34;, r15
</span><span style="color:#75715e"></span><span style="color:#ae81ff">4566</span>:  <span style="color:#66d9ef">b012</span> <span style="color:#66d9ef">de45</span>      <span style="color:#66d9ef">call</span>  <span style="color:#75715e">#0x45de &lt;puts&gt;
</span><span style="color:#75715e"></span><span style="color:#ae81ff">456</span><span style="color:#66d9ef">a</span>:  <span style="color:#66d9ef">b012</span> <span style="color:#ae81ff">4844</span>      <span style="color:#66d9ef">call</span>  <span style="color:#75715e">#0x4448 &lt;unlock_door&gt;
</span><span style="color:#75715e"></span><span style="color:#ae81ff">456</span><span style="color:#66d9ef">e</span>:  <span style="color:#ae81ff">3041</span>           <span style="color:#66d9ef">ret</span>

<span style="color:#75715e">; failed
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">4570:</span>  <span style="color:#960050;background-color:#1e0010">3</span><span style="color:#a6e22e">f40</span> <span style="color:#ae81ff">0145</span>      <span style="color:#66d9ef">mov</span>   <span style="color:#75715e">#0x4501 &#34;That password is not correct.&#34;, r15
</span><span style="color:#75715e"></span><span style="color:#ae81ff">4574</span>:  <span style="color:#66d9ef">b012</span> <span style="color:#66d9ef">de45</span>      <span style="color:#66d9ef">call</span>  <span style="color:#75715e">#0x45de &lt;puts&gt;
</span><span style="color:#75715e"></span><span style="color:#ae81ff">4578</span>:  <span style="color:#ae81ff">3041</span>           <span style="color:#66d9ef">ret</span>
</code></pre></div><p>Some interesting things happening there it seems. I think the next routine to check out is most definitely <code>test_password_valid</code>. Taking a look at that routine looks as follows:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-asm" data-lang="asm"><span style="color:#960050;background-color:#1e0010">4454</span> <span style="color:#960050;background-color:#1e0010">&lt;</span><span style="color:#a6e22e">test_password_valid</span><span style="color:#960050;background-color:#1e0010">&gt;</span>

<span style="color:#75715e">; move a bunch of stuff around
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">4454:</span>  <span style="color:#960050;background-color:#1e0010">0412</span>           <span style="color:#a6e22e">push</span>  <span style="color:#66d9ef">r4</span>
<span style="color:#960050;background-color:#1e0010">4456:</span>  <span style="color:#960050;background-color:#1e0010">0441</span>           <span style="color:#a6e22e">mov</span>   <span style="color:#66d9ef">sp</span>, <span style="color:#66d9ef">r4</span>
<span style="color:#960050;background-color:#1e0010">4458:</span>  <span style="color:#960050;background-color:#1e0010">2453</span>           <span style="color:#a6e22e">incd</span>  <span style="color:#66d9ef">r4</span>
<span style="color:#960050;background-color:#1e0010">445</span>a:  <span style="color:#960050;background-color:#1e0010">2183</span>           <span style="color:#a6e22e">decd</span>  <span style="color:#66d9ef">sp</span>
<span style="color:#960050;background-color:#1e0010">445</span>c:  <span style="color:#a6e22e">c443</span> <span style="color:#66d9ef">fcff</span>      <span style="color:#66d9ef">mov.b</span> <span style="color:#75715e">#0x0, -0x4(r4)  ; 0x2400 at this stage
</span><span style="color:#75715e"></span><span style="color:#ae81ff">4460</span>:  <span style="color:#ae81ff">3</span><span style="color:#66d9ef">e40</span> <span style="color:#66d9ef">fcff</span>      <span style="color:#66d9ef">mov</span>   <span style="color:#75715e">#0xfffc, r14
</span><span style="color:#75715e"></span><span style="color:#ae81ff">4464</span>:  <span style="color:#ae81ff">0</span><span style="color:#66d9ef">e54</span>           <span style="color:#66d9ef">add</span>   <span style="color:#66d9ef">r4</span>, <span style="color:#66d9ef">r14</span>
<span style="color:#960050;background-color:#1e0010">4466:</span>  <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">e12</span>           <span style="color:#66d9ef">push</span>  <span style="color:#66d9ef">r14</span>
<span style="color:#960050;background-color:#1e0010">4468:</span>  <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">f12</span>           <span style="color:#66d9ef">push</span>  <span style="color:#66d9ef">r15</span>

<span style="color:#75715e">; push 0x7d into the stack and prep for a syscall
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">446</span>a:  <span style="color:#960050;background-color:#1e0010">3012</span> <span style="color:#960050;background-color:#1e0010">7</span><span style="color:#a6e22e">d00</span>      <span style="color:#66d9ef">push</span>  <span style="color:#75715e">#0x7d
</span><span style="color:#75715e"></span><span style="color:#ae81ff">446</span><span style="color:#66d9ef">e</span>:  <span style="color:#66d9ef">b012</span> <span style="color:#ae81ff">7</span><span style="color:#66d9ef">a45</span>      <span style="color:#66d9ef">call</span>  <span style="color:#75715e">#0x457a &lt;INT&gt;
</span><span style="color:#75715e"></span>
<span style="color:#960050;background-color:#1e0010">[</span><span style="color:#a6e22e">..</span> <span style="color:#66d9ef">end</span> <span style="color:#66d9ef">this</span> <span style="color:#66d9ef">routine</span> <span style="color:#66d9ef">..</span>]
<span style="color:#960050;background-color:#1e0010">447</span>c:  <span style="color:#960050;background-color:#1e0010">3041</span>           <span style="color:#a6e22e">ret</span>
</code></pre></div><p>Hmm ok, a bunch of <code>mov</code> instructions and other arithmetic and finally syscall with interrupt <code>0x7d</code> which is described as <em>&ldquo;Interface with the HSM-1. Set a flag in memory if the password passed in is
correct.&quot;</em> according to the locks <a href="https://microcorruption.com/manual.pdf">manual</a>.</p>
<p>So not <em>that</em> interesting after all. Looking at <code>login</code> again, it seems like we would ideally want to have <code>unlock_door</code> called from <code>login</code> at <code>0x456a</code> to win. But how to get there?</p>
<h3 id="debugging">debugging</h3>
<p>My static analysis capabilities were pretty much exhausted here, and it was now time for some runtime debugging. I manually stepped through the program, focussing on the <code>test_password_valid</code> routine. I noticed the password I entered as <code>12345678</code> was stored at offset <code>0x2400</code> and referenced when the interrupt for the HSM to check was set up.</p>
<figure>
    <img src="https://leonjza.github.io/images/microcorruption/hanoi_password_in_memory.png"/> 
</figure>

<p>A few steps through this routine with no obvious ways to fool it, I decided to park it for now and see what happens after <code>test_password_valid</code> is done. This is now back at <code>login</code> once <code>test_password_valid</code> has returned:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-asm" data-lang="asm"><span style="color:#75715e">; test_password_valid has returned
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">4552:</span>  <span style="color:#960050;background-color:#1e0010">3</span><span style="color:#a6e22e">f40</span> <span style="color:#66d9ef">d344</span>      <span style="color:#66d9ef">mov</span>   <span style="color:#75715e">#0x44d3 &#34;Testing if password is valid.&#34;, r15
</span><span style="color:#75715e"></span><span style="color:#ae81ff">4556</span>:  <span style="color:#66d9ef">b012</span> <span style="color:#66d9ef">de45</span>      <span style="color:#66d9ef">call</span>  <span style="color:#75715e">#0x45de &lt;puts&gt;
</span><span style="color:#75715e"></span>
<span style="color:#75715e">; what is this cmp doing?
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">455</span>a:  <span style="color:#a6e22e">f290</span> <span style="color:#ae81ff">6300</span> <span style="color:#ae81ff">1024</span> <span style="color:#66d9ef">cmp.b</span> <span style="color:#75715e">#0x63, &amp;0x2410
</span><span style="color:#75715e"></span><span style="color:#ae81ff">4560</span>:  <span style="color:#ae81ff">0720</span>           <span style="color:#66d9ef">jne</span>   <span style="color:#75715e">#0x4570 &lt;login+0x50&gt;
</span><span style="color:#75715e"></span>
<span style="color:#75715e">; making the jne not get taken will land us at unlock_door
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">4562:</span>  <span style="color:#960050;background-color:#1e0010">3</span><span style="color:#a6e22e">f40</span> <span style="color:#66d9ef">f144</span>      <span style="color:#66d9ef">mov</span>   <span style="color:#75715e">#0x44f1 &#34;Access granted.&#34;, r15
</span><span style="color:#75715e"></span><span style="color:#ae81ff">4566</span>:  <span style="color:#66d9ef">b012</span> <span style="color:#66d9ef">de45</span>      <span style="color:#66d9ef">call</span>  <span style="color:#75715e">#0x45de &lt;puts&gt;
</span><span style="color:#75715e"></span><span style="color:#ae81ff">456</span><span style="color:#66d9ef">a</span>:  <span style="color:#66d9ef">b012</span> <span style="color:#ae81ff">4844</span>      <span style="color:#66d9ef">call</span>  <span style="color:#75715e">#0x4448 &lt;unlock_door&gt;
</span></code></pre></div><p>I noticed the <code>cmp.b #0x63, &amp;0x2410</code> instruction again and realised that <code>0x2410</code> is close to the area where my password buffer was being stored in memory. Infact, this was just 16 bytes away from <code>0x2400</code>! Now remember that message telling us passwords are supposed to be 8 to 16 characters long? Well, looks like that is because char 17 and 18 forms part of this <code>cmp.b</code> instruction!</p>
<p>If we can make the aforementioned instruction pass the test checking if the value at that memory address is <code>0x63</code>, (ASCII character <code>c</code>), then we can get past the <code>jne</code> instruction at <code>0x4560</code>, eventually landing us in <code>unlock_door</code> routine.</p>
<p>So given that the distance to <code>0x2410</code> is 16 bytes from <code>0x2400</code> where our password buffer is stored, lets see if we can overflow the buffer to <code>0x2410</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;A&#39;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">16</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;c&#39;</span>)
AAAAAAAAAAAAAAAAc
</code></pre></div><p>I set a breakpoint at <code>0x455a</code> with <code>break 455a</code> in the debugger and continued the CPU entering <code>AAAAAAAAAAAAAAAAc</code> as the password when prompted.</p>
<figure>
    <img src="https://leonjza.github.io/images/microcorruption/hanoi_jump_little_endian.png"/> 
</figure>

<p>After hitting the breakpoint and inspecting the contents of memory address <code>0x2410</code> with <code>read 2410</code> in the debugger reveals that the byte <code>0x63</code> is at <code>0x2410</code> (thanks to our overflow). This results in the <code>cmp.b</code> instruction setting the status register to <code>0x3</code> (CZ), which in turn means the jump is not taken!</p>
<p>Turns out <code>test_password_valid</code> was just a decoy and the real vulnerability was a simple buffer overflow.</p>
<h2 id="solution">solution</h2>
<p>Enter <code>AAAAAAAAAAAAAAAAc</code> as ASCII or <code>4141414141414141414141414141414163</code> as hex encoded input.</p>
<h2 id="other-challenges">other challenges</h2>
<p>For my other write ups in the microcorruption series, checkout <a href="https://leonjza.github.io/categories/microcorruption/">this</a> link.</p>
  </div>
  <div id="disqus_thread"></div>
</div>


<script type="text/javascript">
var disqus_shortname = "slashnote";
(function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>



<script type="text/javascript">
    var disqus_shortname = "slashnote";
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

<script src="https://leonjza.github.io/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>

